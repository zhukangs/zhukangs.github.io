<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Posts on Promise</title>
		<link>https://blog.gookm.cn/posts/</link>
		<description>Recent content in Posts on Promise</description>
		<generator>Hugo -- gohugo.io</generator>
		<language>zh-hans</language>
		<copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright>
		<lastBuildDate>Sat, 05 Mar 2022 00:00:00 +0000</lastBuildDate>
		<atom:link href="https://blog.gookm.cn/posts/index.xml" rel="self" type="application/rss+xml" />
		
		<item>
			<title>Laravel ä½¿ç”¨JWT API æˆæƒğŸš€</title>
			<link>https://blog.gookm.cn/posts/2022/20220305-api-jwt/</link>
			<pubDate>Sat, 05 Mar 2022 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2022/20220305-api-jwt/</guid>
			<description>ä»€ä¹ˆæ˜¯JWT Json web token (JWT), æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼ˆ(RFC 7519).è¯¥tokenè¢«è®¾è®¡ä¸ºç´§å‡‘ä¸”å®‰å…¨çš„ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åœºæ™¯ã€‚JWTçš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘æ‰€å¿…é¡»çš„å£°æ˜ä¿¡æ¯ï¼Œè¯¥tokenä¹Ÿå¯ç›´æ¥è¢«ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯è¢«åŠ å¯†ã€‚ä½œè€…ï¼šDearmadmané“¾æ¥ï¼šhttps://www.jianshu.com/p/576dbf44b2aeæ¥æºï¼šç®€ä¹¦è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
å…³äºJWTè®²è§£ä¸åˆ†æï¼šhttps://learnku.com/articles/17883
å®‰è£… composer å®‰è£… lcobucci/jwt ï¼Œæˆ‘è¿™é‡Œé»˜è®¤å®‰è£…çš„æ˜¯æœ€æ–°ç‰ˆ 4.1 ã€‚
composer require lcobucci/jwt å°è£… åœ¨ app\Helpers ç›®å½•ä¸‹æ–°å»º Jwt.php æ–‡ä»¶ï¼Œå°è£… Jwt ç±»ã€‚
&amp;lt;?php /** * Created by PhpStorm. * User: zhukang * Date: 2019/8/22 * Time: 16:39 */ namespace App\Helpers; use Illuminate\Support\Facades\Redis; use Lcobucci\Clock\SystemClock; use Lcobucci\JWT\Configuration; use Lcobucci\JWT\Exception; use Lcobucci\JWT\Signer\Hmac\Sha256; use Lcobucci\JWT\Signer\Key\InMemory; use Lcobucci\JWT\Token\Plain; use Lcobucci\JWT\Validation\Constraint\IdentifiedBy; use Lcobucci\JWT\Validation\Constraint\IssuedBy; use Lcobucci\JWT\Validation\Constraint\PermittedFor; use Lcobucci\JWT\Validation\Constraint\SignedWith; use Lcobucci\JWT\Validation\Constraint\ValidAt; use Lcobucci\JWT\Validation\RequiredConstraintsViolated; trait Jwt { protected $issuedBy;//ç­¾å‘äºº protected $permittedFor;//å—ä¼— protected $identifiedBy;//jwtç¼–å· protected $issuedAt;//ç­¾å‘æ—¶é—´ protected $expiresAt;//è¿‡æœŸæ—¶é—´ protected $jwt_secret; //ç§˜é’¥ public function __construct() { //è·å–jwté…ç½®ä¿¡æ¯ $jwt_configs = config(&amp;#39;jwt&amp;#39;); $this-&amp;gt;issuedBy = $jwt_configs[&amp;#39;issuedBy&amp;#39;]; $this-&amp;gt;permittedFor = $jwt_configs[&amp;#39;permittedFor&amp;#39;]; $this-&amp;gt;identifiedBy = $jwt_configs[&amp;#39;identifiedBy&amp;#39;]; $this-&amp;gt;issuedAt = $jwt_configs[&amp;#39;issuedAt&amp;#39;]; $this-&amp;gt;expiresAt = $this-&amp;gt;issuedAt-&amp;gt;modify($jwt_configs[&amp;#39;expiresAt&amp;#39;]); $this-&amp;gt;jwt_secret = $jwt_configs[&amp;#39;jwt_secret&amp;#39;]; } /** * @Description:ç”Ÿæˆjwté…ç½®å¯¹è±¡ * @return Configuration * @Author:zhukang * @Date:2022/4/7 16:05 */ public function createJwtObject() { return Configuration::forSymmetricSigner( new Sha256(), InMemory::base64Encoded($this-&amp;gt;jwt_secret) ); } /** * @Description:ç”Ÿæˆtoken * @param array $bind éœ€è¦åœ¨jwtè½½ä½“(payload)ä¸­åŠ å…¥çš„æ•°æ® [&amp;#39;userid&amp;#39;=&amp;gt;1,&amp;#39;xxxx&amp;#39;=&amp;gt;xxxx] * @return string \Lcobucci\JWT\Token * @Author:zhukang * @Date:2022/4/7 16:04 */ public function getToken(array $bind = []) { $jwt_object = $this-&amp;gt;createJwtObject(); $jwt_obj = $jwt_object-&amp;gt;builder() -&amp;gt;issuedBy($this-&amp;gt;issuedBy) -&amp;gt;permittedFor($this-&amp;gt;permittedFor) -&amp;gt;identifiedBy($this-&amp;gt;identifiedBy) -&amp;gt;issuedAt($this-&amp;gt;issuedAt) -&amp;gt;canOnlyBeUsedAfter($this-&amp;gt;issuedAt) -&amp;gt;expiresAt($this-&amp;gt;expiresAt); if (is_array($bind) &amp;amp;&amp;amp; !</description>
			<content type="html"><![CDATA[<p><img src="https://qiniu.zkilm.cn/blog/posts/2022/20220305-api-jwt.jpg" alt="å°é¢ï¼"></p>
<h3 id="ä»€ä¹ˆæ˜¯jwt">ä»€ä¹ˆæ˜¯JWT</h3>
<blockquote>
<p>Json web token (JWT), æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼ˆ<a href="https://link.jianshu.com?t=https://tools.ietf.org/html/rfc7519">(RFC 7519</a>).è¯¥tokenè¢«è®¾è®¡ä¸ºç´§å‡‘ä¸”å®‰å…¨çš„ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åœºæ™¯ã€‚JWTçš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘æ‰€å¿…é¡»çš„å£°æ˜ä¿¡æ¯ï¼Œè¯¥tokenä¹Ÿå¯ç›´æ¥è¢«ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯è¢«åŠ å¯†ã€‚ä½œè€…ï¼šDearmadmané“¾æ¥ï¼šhttps://www.jianshu.com/p/576dbf44b2aeæ¥æºï¼šç®€ä¹¦è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote>
<p>å…³äºJWTè®²è§£ä¸åˆ†æï¼šhttps://learnku.com/articles/17883</p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<p><code>composer</code> å®‰è£… <code>lcobucci/jwt</code> ï¼Œæˆ‘è¿™é‡Œé»˜è®¤å®‰è£…çš„æ˜¯æœ€æ–°ç‰ˆ <code>4.1</code> ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">composer</span> <span class="k">require</span> <span class="nx">lcobucci</span><span class="o">/</span><span class="nx">jwt</span>
</span></span></code></pre></div><h3 id="å°è£…">å°è£…</h3>
<p>åœ¨  <code>app\Helpers</code> ç›®å½•ä¸‹æ–°å»º <code>Jwt.php</code> æ–‡ä»¶ï¼Œå°è£… <code>Jwt</code> ç±»ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Created by PhpStorm.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * User: zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Date: 2019/8/22
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Time: 16:39
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Helpers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Redis</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\Clock\SystemClock</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Configuration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Exception</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Signer\Hmac\Sha256</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Signer\Key\InMemory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Token\Plain</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Validation\Constraint\IdentifiedBy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Validation\Constraint\IssuedBy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Validation\Constraint\PermittedFor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Validation\Constraint\SignedWith</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Validation\Constraint\ValidAt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Lcobucci\JWT\Validation\RequiredConstraintsViolated</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">trait</span> <span class="nx">Jwt</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$issuedBy</span><span class="p">;</span><span class="c1">//ç­¾å‘äºº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">protected</span> <span class="nv">$permittedFor</span><span class="p">;</span><span class="c1">//å—ä¼—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">protected</span> <span class="nv">$identifiedBy</span><span class="p">;</span><span class="c1">//jwtç¼–å·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">protected</span> <span class="nv">$issuedAt</span><span class="p">;</span><span class="c1">//ç­¾å‘æ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">protected</span> <span class="nv">$expiresAt</span><span class="p">;</span><span class="c1">//è¿‡æœŸæ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">protected</span> <span class="nv">$jwt_secret</span><span class="p">;</span> <span class="c1">//ç§˜é’¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è·å–jwté…ç½®ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$jwt_configs</span>        <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;jwt&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">issuedBy</span>     <span class="o">=</span> <span class="nv">$jwt_configs</span><span class="p">[</span><span class="s1">&#39;issuedBy&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">permittedFor</span> <span class="o">=</span> <span class="nv">$jwt_configs</span><span class="p">[</span><span class="s1">&#39;permittedFor&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">identifiedBy</span> <span class="o">=</span> <span class="nv">$jwt_configs</span><span class="p">[</span><span class="s1">&#39;identifiedBy&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">issuedAt</span>     <span class="o">=</span> <span class="nv">$jwt_configs</span><span class="p">[</span><span class="s1">&#39;issuedAt&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expiresAt</span>    <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">issuedAt</span><span class="o">-&gt;</span><span class="na">modify</span><span class="p">(</span><span class="nv">$jwt_configs</span><span class="p">[</span><span class="s1">&#39;expiresAt&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">jwt_secret</span>   <span class="o">=</span> <span class="nv">$jwt_configs</span><span class="p">[</span><span class="s1">&#39;jwt_secret&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Description:ç”Ÿæˆjwté…ç½®å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return Configuration
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Author:zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Date:2022/4/7 16:05
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">createJwtObject</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">Configuration</span><span class="o">::</span><span class="na">forSymmetricSigner</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="nx">Sha256</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="nx">InMemory</span><span class="o">::</span><span class="na">base64Encoded</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">jwt_secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Description:ç”Ÿæˆtoken
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param array $bind éœ€è¦åœ¨jwtè½½ä½“(payload)ä¸­åŠ å…¥çš„æ•°æ®  [&#39;userid&#39;=&gt;1,&#39;xxxx&#39;=&gt;xxxx]
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return string \Lcobucci\JWT\Token
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Author:zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Date:2022/4/7 16:04
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getToken</span><span class="p">(</span><span class="k">array</span> <span class="nv">$bind</span> <span class="o">=</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createJwtObject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_obj</span>    <span class="o">=</span> <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">builder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">-&gt;</span><span class="na">issuedBy</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">issuedBy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">-&gt;</span><span class="na">permittedFor</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">permittedFor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">-&gt;</span><span class="na">identifiedBy</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">identifiedBy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">-&gt;</span><span class="na">issuedAt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">issuedAt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">-&gt;</span><span class="na">canOnlyBeUsedAfter</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">issuedAt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">-&gt;</span><span class="na">expiresAt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expiresAt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="nv">$bind</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$bind</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$bind</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$jwt_obj</span><span class="o">-&gt;</span><span class="na">withClaim</span><span class="p">(</span><span class="nv">$k</span><span class="p">,</span> <span class="nv">$v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ç­¾åç®—æ³•å’Œç­¾åç§˜é’¥å¾—åˆ°token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="nv">$jwt_obj</span><span class="o">-&gt;</span><span class="na">getToken</span><span class="p">(</span><span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">signer</span><span class="p">(),</span> <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">signingKey</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Description:éªŒè¯token
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $token
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Author:zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Date:2022/4/7 16:04
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifyToken</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createJwtObject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">parser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">parse</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$validate_jwt_id</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IdentifiedBy</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">identifiedBy</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">setValidationConstraints</span><span class="p">(</span><span class="nv">$validate_jwt_id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$validate_issued</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IssuedBy</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">issuedBy</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">setValidationConstraints</span><span class="p">(</span><span class="nv">$validate_issued</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$validate_aud</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PermittedFor</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">permittedFor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">setValidationConstraints</span><span class="p">(</span><span class="nv">$validate_aud</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//éªŒè¯æ˜¯å¦è¿‡æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$timezone</span>        <span class="o">=</span> <span class="k">new</span> <span class="nx">\DateTimeZone</span><span class="p">(</span><span class="s1">&#39;PRC&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$time</span>            <span class="o">=</span> <span class="k">new</span> <span class="nx">SystemClock</span><span class="p">(</span><span class="nv">$timezone</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$validate_jwt_at</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ValidAt</span><span class="p">(</span><span class="nv">$time</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">setValidationConstraints</span><span class="p">(</span><span class="nv">$validate_jwt_at</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$validate_contents</span> <span class="o">=</span> <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">validationConstraints</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="o">...</span><span class="nv">$validate_contents</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">RequiredConstraintsViolated</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Description:è§£ætokené‡Œé¢çš„è½½ä½“æ•°æ®ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $token
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Author:zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Date:2022/4/7 16:03
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTokenContent</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createJwtObject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$token</span>  <span class="o">=</span> <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">parser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">parse</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$claims</span> <span class="o">=</span> <span class="nx">json_decode</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$token</span><span class="o">-&gt;</span><span class="na">claims</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">()),</span> <span class="k">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">([</span><span class="mi">405001</span><span class="p">,</span> <span class="s1">&#39;éæ³•tokenå€¼ï¼&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$claims</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Description:éªŒè¯tokenæ˜¯å¦åœ¨åˆ·æ–°æœ‰æ•ˆæœŸå†…
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $token
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Author:zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Date:2022/4/7 16:03
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifyRefresh</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createJwtObject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">parser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">parse</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$claims</span> <span class="o">=</span> <span class="nx">json_decode</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$token</span><span class="o">-&gt;</span><span class="na">claims</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">()),</span> <span class="k">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ç­¾å‘æ—¶é—´å¤§äºå½“å‰æœåŠ¡å™¨æ—¶é—´éªŒè¯å¤±è´¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$claims</span><span class="p">[</span><span class="s1">&#39;iat&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$claims</span><span class="p">[</span><span class="s1">&#39;iat&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">time</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$claims</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ç”Ÿæ•ˆæ—¶é—´å¤§äºå½“å‰æœåŠ¡å™¨æ—¶é—´éªŒè¯å¤±è´¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$claims</span><span class="p">[</span><span class="s1">&#39;nbf&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$claims</span><span class="p">[</span><span class="s1">&#39;nbf&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">time</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// å½“å‰æœåŠ¡å™¨æ—¶é—´å¤§äºè¿‡æœŸæ—¶é—´éªŒè¯å¤±è´¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$claims</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nv">$claims</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Description:éªŒè¯ç­¾å
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $token
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Author:zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Date:2022/4/7 16:17
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifySign</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createJwtObject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">parser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">parse</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$validate_jwt_signer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SignedWith</span><span class="p">(</span><span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">signer</span><span class="p">(),</span> <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">signingKey</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">setValidationConstraints</span><span class="p">(</span><span class="nv">$validate_jwt_signer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$validate_contents</span> <span class="o">=</span> <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">validationConstraints</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$jwt_object</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="o">...</span><span class="nv">$validate_contents</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">RequiredConstraintsViolated</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">([</span><span class="mi">405001</span><span class="p">,</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Description:ä½¿Tokenå¤±æ•ˆ
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return string
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Author:zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Date:2022/4/7 16:18
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">invalidate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Description:å°†tokenåŠ å…¥é»‘åå•
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $token
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Author:zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Date:2022/4/7 16:19
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">addBlacklist</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$token_redis_ex</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTokenContent</span><span class="p">(</span><span class="nv">$token</span><span class="p">)[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nx">time</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// è®¾ç½®æˆåŠŸè¿”å›true å¤±è´¥false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$result</span> <span class="o">=</span> <span class="nx">Redis</span><span class="o">::</span><span class="na">setex</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="nv">$token_redis_ex</span><span class="p">,</span> <span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="é…ç½®">é…ç½®</h3>
<p>åœ¨ <code>config</code> ç›®å½•ä¸‹ï¼Œæ–°å»º <code>Jwt</code>é…ç½®æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    |--------------------------------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">    | Jwt Configuration
</span></span></span><span class="line"><span class="cl"><span class="cm">    |--------------------------------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">    |
</span></span></span><span class="line"><span class="cl"><span class="cm">    | lcobucci/jwt is a framework-agnostic PHP library that allows you to
</span></span></span><span class="line"><span class="cl"><span class="cm">    | issue, parse, and validate JSON Web Tokens based on the RFC 7519.
</span></span></span><span class="line"><span class="cl"><span class="cm">    |
</span></span></span><span class="line"><span class="cl"><span class="cm">    */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ç­¾å‘äºº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;issuedBy&#39;</span>     <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_NAME&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//å—ä¼—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;permittedFor&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-user&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//jwtç¼–å·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;identifiedBy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ç­¾å‘æ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;issuedAt&#39;</span>     <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTimeImmutable</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//è¿‡æœŸæ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;expiresAt&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;+1 hour&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ç§˜é’¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;jwt_secret&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;zhukangshuai&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div><h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<p>åœ¨ <code>app\Http\Middleware</code> ç›®å½•ä¸‹ï¼Œæ–°å»º <code>AuthApi.php</code> æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Helpers\Jwt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Helpers\ApiResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Redis</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AuthApi</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">Jwt</span><span class="p">,</span> <span class="nx">ApiResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Description:Handle an incoming request.
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $request
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param Closure $next
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return \Illuminate\Http\JsonResponse|mixed
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Author:zhukang
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @Date:2022/4/8 10:53
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è·å–token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">bearerToken</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//åˆ¤æ–­tokençŸ¥å¦ä¸ºç©º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$token</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">([</span><span class="mi">4001</span><span class="p">,</span> <span class="s1">&#39;Token is missing!&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//åˆ¤æ–­redisæ˜¯å¦è¿˜å­˜åœ¨è¯¥token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">Redis</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">([</span><span class="mi">4002</span><span class="p">,</span> <span class="s1">&#39;Login authorization has expired!&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//éªŒè¯tokenç­¾åæ˜¯å¦åˆæ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifySign</span><span class="p">(</span><span class="nv">$token</span><span class="p">))</span> <span class="o">||</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifySign</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span> <span class="o">!==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">([</span><span class="mi">4004</span><span class="p">,</span> <span class="s1">&#39;The token is invalid, please replace it.&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//åˆ¤æ–­è¯¥tokenæ‰€ç»‘å®šçš„ç”¨æˆ·IDæ˜¯å¦çœŸå®å­˜åœ¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$info</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTokenContent</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nv">$info</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$user</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">([</span><span class="mi">4004</span><span class="p">,</span> <span class="s1">&#39;The token is invalid, please replace it.&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// éªŒè¯tokenæ˜¯å¦æœ‰æ•ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$verify_res</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifyToken</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$verify_res</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// éªŒè¯tokenæ˜¯å¦åœ¨åˆ·æ–°æœ‰æ•ˆæœŸå†…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nv">$legal</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifyRefresh</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$legal</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">([</span><span class="mi">4003</span><span class="p">,</span> <span class="s1">&#39;Login authorization has expired!&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nv">$user_data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTokenContent</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span><span class="c1">// è·å–åŸtokenä¸­çš„æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nv">$token</span>     <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getToken</span><span class="p">(</span><span class="nv">$user_data</span><span class="p">);</span><span class="c1">// é‡æ–°ç”Ÿæˆtoken
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;token:&#39;</span> <span class="o">.</span> <span class="nv">$token</span><span class="p">);</span><span class="c1">// è®¾ç½®å“åº”å¤´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">([</span><span class="mi">4004</span><span class="p">,</span> <span class="s1">&#39;The token is invalid, please replace it.&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//åˆ¤æ–­è´¦æˆ·çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">status</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">([</span><span class="mi">4044</span><span class="p">,</span> <span class="s1">&#39;Account anomaly, please contact CS!&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>åœ¨ <code>AuthController</code> ä¸­ä½¿ç”¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">loginByTwo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  	<span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getToken</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;email&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">success</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;token&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;expires_at&#39;</span> <span class="o">=&gt;</span> <span class="nx">floor</span><span class="p">((</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTokenContent</span><span class="p">(</span><span class="nv">$token</span><span class="p">))[</span><span class="s1">&#39;exp&#39;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;user&#39;</span>       <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å“åº”ç»“æœ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">200001</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;æ“ä½œæˆåŠŸ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;token&#34;</span><span class="p">:</span> <span class="s2">&#34;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJMYXJhdmVsIiwiYXVkIjoiY2xpZW50LXVzZXIiLCJqdGkiOiJhZG1pbiIsImlhdCI6MTY0OTM4ODMyMi44Mzg1NzIsIm5iZiI6MTY0OTM4ODMyMi44Mzg1NzIsImV4cCI6MTY0OTM5MTkyMi44Mzg1NzIsInVzZXJfaWQiOjEsImVtYWlsIjoiemtwaHBlckAxNjMuY29tIn0.x8G_yyi7l8wvdhAPCiAIUo8HY6IjnXcuHzw7yGvEUUc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;expires_at&#34;</span><span class="p">:</span> <span class="mi">1649391922</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;user&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;zhukang&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;zkphper@163.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;created_at&#34;</span><span class="p">:</span> <span class="s2">&#34;2022-03-29 15:36:49&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Laravel ä½¿ç”¨ Sanctum API æˆæƒ</title>
			<link>https://blog.gookm.cn/posts/2022/20220218-api-sanctum/</link>
			<pubDate>Fri, 18 Feb 2022 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2022/20220218-api-sanctum/</guid>
			<description>ä»‹ç» Laravel Sanctum ä¸º SPAï¼ˆå•é¡µåº”ç”¨ç¨‹åºï¼‰ã€ç§»åŠ¨åº”ç”¨ç¨‹åºå’ŒåŸºäºä»¤ç‰Œçš„ã€ç®€å•çš„ API æä¾›è½»é‡çº§èº«ä»½éªŒè¯ç³»ç»Ÿã€‚Sanctum å…è®¸åº”ç”¨ç¨‹åºçš„æ¯ä¸ªç”¨æˆ·ä¸ºä»–ä»¬çš„å¸æˆ·ç”Ÿæˆå¤šä¸ª API ä»¤ç‰Œã€‚è¿™äº›ä»¤ç‰Œå¯ä»¥è¢«æˆäºˆæŒ‡å®šå…è®¸ä»¤ç‰Œæ‰§è¡Œå“ªäº›æ“ä½œçš„èƒ½åŠ› / èŒƒå›´ã€‚
ç›¸å…³æ–‡æ¡£ï¼šhttps://learnku.com/docs/laravel/9.x/sanctum/12272
å®‰è£… å®‰è£… Laravel Sanctum
composer require laravel/sanctum Artisan å‘½ä»¤å‘å¸ƒ Sanctum çš„é…ç½®å’Œè¿ç§»æ–‡ä»¶
php artisan vendor:publish --provider=&amp;#34;Laravel\Sanctum\SanctumServiceProvider&amp;#34; Sanctum å°†åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨æ¥å­˜å‚¨ API ä»¤ç‰Œ
php artisan migrate å°† Sanctum çš„ä¸­é—´ä»¶æ·»åŠ åˆ°æ‚¨åº”ç”¨çš„ app/Http/Kernel.php æ–‡ä»¶ä¸­çš„ api ä¸­é—´ä»¶ç»„ä¸­
&amp;#39;api&amp;#39; =&amp;gt; [ \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class, &amp;#39;throttle:api&amp;#39;, \Illuminate\Routing\Middleware\SubstituteBindings::class, ], é…ç½® é‡å†™é»˜è®¤æ¨¡å‹
æ‰§è¡Œè¿ç§»å‘½ä»¤å¾—æ—¶å€™ä¼šç”Ÿæˆapp\Models\PersonalAccessToken.phpæ–‡ä»¶ï¼Œå°½ç®¡é€šå¸¸ä¸éœ€è¦ï¼Œä½†æ‚¨å¯ä»¥è‡ªç”±æ‰©å±• Sanctum å†…éƒ¨ä½¿ç”¨çš„ PersonalAccessToken æ¨¡å‹ã€‚ç”±äºç”Ÿæˆçš„è¡¨åå« personal_access_tokensï¼Œå¼€å‘ä¸­æˆ‘ä»¬ä¹ æƒ¯ç”¨æˆ·è¡¨åå« usersï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¡¨åä¿®æ”¹ä¸º user_tokens ã€‚
åˆ›å»º UserToken æ¨¡å‹æ–‡ä»¶ï¼š
php artisan make:model UserToken æ¨¡å‹æ–‡ä»¶ UserToken.php å†…å®¹å¦‚ä¸‹ï¼š</description>
			<content type="html"><![CDATA[<p><img src="https://qiniu.zkilm.cn/blog/posts/2022/20220218-api-sanctum.jpg" alt="å°é¢"></p>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<blockquote>
<p><a href="https://github.com/laravel/sanctum">Laravel Sanctum</a> ä¸º SPAï¼ˆå•é¡µåº”ç”¨ç¨‹åºï¼‰ã€ç§»åŠ¨åº”ç”¨ç¨‹åºå’ŒåŸºäºä»¤ç‰Œçš„ã€ç®€å•çš„ API æä¾›è½»é‡çº§èº«ä»½éªŒè¯ç³»ç»Ÿã€‚Sanctum å…è®¸åº”ç”¨ç¨‹åºçš„æ¯ä¸ªç”¨æˆ·ä¸ºä»–ä»¬çš„å¸æˆ·ç”Ÿæˆå¤šä¸ª API ä»¤ç‰Œã€‚è¿™äº›ä»¤ç‰Œå¯ä»¥è¢«æˆäºˆæŒ‡å®šå…è®¸ä»¤ç‰Œæ‰§è¡Œå“ªäº›æ“ä½œçš„èƒ½åŠ› / èŒƒå›´ã€‚</p>
</blockquote>
<p>ç›¸å…³æ–‡æ¡£ï¼šhttps://learnku.com/docs/laravel/9.x/sanctum/12272</p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<ul>
<li>
<p>å®‰è£… Laravel Sanctum</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">composer</span> <span class="k">require</span> <span class="nx">laravel</span><span class="o">/</span><span class="nx">sanctum</span>
</span></span></code></pre></div></li>
<li>
<p>Artisan å‘½ä»¤å‘å¸ƒ Sanctum çš„é…ç½®å’Œè¿ç§»æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">vendor</span><span class="o">:</span><span class="nx">publish</span> <span class="o">--</span><span class="nx">provider</span><span class="o">=</span><span class="s2">&#34;Laravel\Sanctum\SanctumServiceProvider&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Sanctum å°†åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨æ¥å­˜å‚¨ API ä»¤ç‰Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</span></span></code></pre></div></li>
<li>
<p>å°† Sanctum çš„ä¸­é—´ä»¶æ·»åŠ åˆ°æ‚¨åº”ç”¨çš„ <code>app/Http/Kernel.php</code> æ–‡ä»¶ä¸­çš„ <code>api</code> ä¸­é—´ä»¶ç»„ä¸­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;api&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="nx">\Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;throttle:api&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="é…ç½®">é…ç½®</h3>
<ul>
<li>
<p>é‡å†™é»˜è®¤æ¨¡å‹</p>
<p>æ‰§è¡Œè¿ç§»å‘½ä»¤å¾—æ—¶å€™ä¼šç”Ÿæˆapp\Models\PersonalAccessToken.phpæ–‡ä»¶ï¼Œå°½ç®¡é€šå¸¸ä¸éœ€è¦ï¼Œä½†æ‚¨å¯ä»¥è‡ªç”±æ‰©å±• Sanctum å†…éƒ¨ä½¿ç”¨çš„ <code>PersonalAccessToken</code> æ¨¡å‹ã€‚ç”±äºç”Ÿæˆçš„è¡¨åå« <code>personal_access_tokens</code>ï¼Œå¼€å‘ä¸­æˆ‘ä»¬ä¹ æƒ¯ç”¨æˆ·è¡¨åå« <code>users</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¡¨åä¿®æ”¹ä¸º <code>user_tokens</code> ã€‚</p>
<p>åˆ›å»º UserToken æ¨¡å‹æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">model</span> <span class="nx">UserToken</span>
</span></span></code></pre></div><p>æ¨¡å‹æ–‡ä»¶ <code>UserToken.php</code> å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Laravel\Sanctum\PersonalAccessToken</span> <span class="k">as</span> <span class="nx">SanctumPersonalAccessToken</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">DateTimeInterface</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserToken</span> <span class="k">extends</span> <span class="nx">SanctumPersonalAccessToken</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è½¬æ¢æ—¶é—´æ ¼å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">serializeDate</span><span class="p">(</span><span class="nx">DateTimeInterface</span> <span class="nv">$dateTime</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$dateTime</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>ç„¶ååœ¨<code>app/Providers/AuthServiceProvider.php</code> æ–‡ä»¶ä¸­è®¾ç½®æ¨¡å‹åç§°ï¼Œæ‚¨å¯ä»¥é€šè¿‡ Sanctum æä¾›çš„ <code>usePersonalAccessTokenModel</code> æ–¹æ³•è®¾ç½® Sanctum ä½¿ç”¨æ‚¨çš„è®¿é—®ä»¤ç‰Œæ¨¡å‹åç§°ã€‚ é€šå¸¸ï¼Œæ‚¨åº”è¯¥åœ¨åº”ç”¨ç¨‹åºçš„æœåŠ¡æä¾›å™¨çš„ <code>boot</code> æ–¹æ³•ä¸­è°ƒç”¨æ­¤æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\UserToken</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Laravel\Sanctum\Sanctum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * å¼•å¯¼åº”ç”¨ç¨‹åºæœåŠ¡ã€‚
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return void
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¾ç½®è®¿é—®ä»¤ç‰Œæ¨¡å‹åç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Sanctum</span><span class="o">::</span><span class="na">usePersonalAccessTokenModel</span><span class="p">(</span><span class="nx">UserToken</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¿™æ ·é‡å†™é»˜è®¤æ¨¡å‹å°±å®Œæˆäº†ã€‚</p>
</li>
<li>
<p>è¦å¼€å§‹ä¸ºç”¨æˆ·é¢å‘ä»¤ç‰Œï¼Œä½ çš„ User æ¨¡å‹åº”ä½¿ç”¨ <code>Laravel\Sanctum\HasApiTokens</code> traitï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Laravel\Sanctum\HasApiTokens</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">HasFactory</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>åˆ›å»ºä»¤ç‰Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/tokens/create&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createToken</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">token_name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="o">-&gt;</span><span class="na">plainTextToken</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="è‡ªå®šä¹‰éªŒè¯">è‡ªå®šä¹‰éªŒè¯</h3>
<p>æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼ŒéªŒè¯è§„åˆ™å¯èƒ½ä¼šéœ€è¦åšä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°æ¥è¿›è¡Œè‡ªå®šä¹‰éªŒè¯ï¼Œé‡Œé¢çš„å°±å¯ä»¥å†™ä¸€äº›æˆ‘ä»¬è‡ªå®šä¹‰çš„é€»è¾‘å†…å®¹ã€‚</p>
<ul>
<li>
<p>æŒ‡å®šéªŒè¯è®¿é—®ä»¤ç‰Œçš„å›è°ƒ</p>
<p>åœ¨ <code>app/Providers/AuthServiceProvider.php</code> æ–‡ä»¶ä¸­ï¼Œè°ƒç”¨ <code>authenticateAccessTokensUsing</code> æ–¹æ³•æŒ‡å®šéªŒè¯è®¿é—®ä»¤ç‰Œçš„å›è°ƒã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\UserToken</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Laravel\Sanctum\Sanctum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * å¼•å¯¼åº”ç”¨ç¨‹åºæœåŠ¡ã€‚
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return void
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// éªŒè¯è®¿é—®ä»¤ç‰Œçš„å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Sanctum</span><span class="o">::</span><span class="na">authenticateAccessTokensUsing</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nx">PersonalAccessToken</span> <span class="nv">$accessToken</span><span class="p">,</span> <span class="nx">bool</span> <span class="nv">$isValid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// ä½ çš„è‡ªå®šä¹‰é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p><code>$accessToken</code> ä¸º token ä¿¡æ¯ï¼Œtokenable åŒ…å«äº†ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œtoken è¿‡æœŸæ—¶ tokenable å­—æ®µå°±ä¸ä¼šå†è¿”å›</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">#attributes: array:9 [
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s2">&#34;id&#34;</span> <span class="o">=&gt;</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;tokenable_type&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;App\Models\User&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;tokenable_id&#34;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;name&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;token&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;23c8f6b3ad9dc564f626caf36fa435679353c47b15ffb071e5fcacdccb5ee705&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;abilities&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;[&#34;</span><span class="o">*</span><span class="s2">&#34;]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;last_used_at&#34;</span> <span class="o">=&gt;</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;created_at&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;2022-04-08 16:07:59&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;updated_at&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;2022-04-08 16:07:59&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span></code></pre></div><p><code>$isValid</code> ä¸º token æœ‰æ•ˆçŠ¶æ€ï¼Œå½“ token æœªè¿‡æœŸæ—¶è¿”å› trueï¼Œå¦åˆ™å°±è¿”å› false</p>
</blockquote>
</li>
<li>
<p>è‡ªå®šä¹‰ä»¤ç‰Œæœ‰æ•ˆæœŸ</p>
<p>Sanctum å¯ä»¥åœ¨ <code>config/sanctum.php</code> é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ <code>expiration</code> æ¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºåˆ†é’Ÿï¼Œä½†æ— æ³•çµæ´»åœ°è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p>
<p>è®¾ç½®çŸ­æœŸä»¤ç‰Œï¼š</p>
<p>1.åˆ›å»ºä»¤ç‰Œæ—¶ï¼Œå¯¹ä»¤ç‰Œè®¾ç½®ä»¤ç‰Œèƒ½åŠ› <code>server:limited</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createToken</span><span class="p">(</span><span class="s1">&#39;token-name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;server:limited&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">plainTextToken</span><span class="p">;</span>
</span></span></code></pre></div><p>2.åœ¨ <code>app/Providers/AuthServiceProvider.php</code> æ–‡ä»¶ä¸­æ ¹æ®ä»¤ç‰Œèƒ½åŠ›è®¾ç½®è¿‡æœŸæ—¶é—´</p>
<p><code>å¦‚æœä»¤ç‰Œæœ‰æ•ˆï¼Œå°±å°† token è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºè‡ªå®šä¹‰çš„è¿‡æœŸæ—¶é—´ï¼Œä¸‹é¢ now ()-&gt;subMinutes (5) è¡¨ç¤ºæœ‰æ•ˆæœŸä¸º 5 åˆ†é’Ÿ</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// éªŒè¯è®¿é—®ä»¤ç‰Œçš„å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="nx">Sanctum</span><span class="o">::</span><span class="na">authenticateAccessTokensUsing</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">         <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nx">PersonalAccessToken</span> <span class="nv">$accessToken</span><span class="p">,</span> <span class="nx">bool</span> <span class="nv">$isValid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$accessToken</span><span class="o">-&gt;</span><span class="na">can</span><span class="p">(</span><span class="s1">&#39;server:limited&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nv">$isValid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">             <span class="p">}</span>
</span></span><span class="line"><span class="cl">             <span class="k">return</span> <span class="nv">$isValid</span> <span class="o">&amp;&amp;</span> <span class="nv">$accessToken</span><span class="o">-&gt;</span><span class="na">created_at</span><span class="o">-&gt;</span><span class="na">gt</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subMinutes</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>è®¾ç½®ä¸€æ¬¡æ€§è®¿é—®ä»¤ç‰Œ</p>
<p>1.åˆ›å»ºä»¤ç‰Œæ—¶ï¼Œå¯¹ä»¤ç‰Œè®¾ç½®ä»¤ç‰Œèƒ½åŠ› <code>server:once</code></p>
<pre tabindex="0"><code>$user-&gt;createToken(&#39;token-name&#39;, [&#39;server:once&#39;])-&gt;plainTextToken;
</code></pre><p>2.åœ¨ <code>app/Providers/AuthServiceProvider.php</code> æ–‡ä»¶ä¸­æ ¹æ®ä»¤ç‰Œèƒ½åŠ›è®¾ç½®è¿‡æœŸæ—¶é—´</p>
<p><code>å¦‚æœä»¤ç‰Œæœ‰æ•ˆï¼Œå¹¶ä¸”æœªç™»é™†è¿‡ï¼Œå°±å°† token è®¾ç½®ä¸ºå¤±æ•ˆï¼Œå³å¯å®ç°ä¸€æ¬¡æ€§ä»¤ç‰Œæ•ˆæœ</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// éªŒè¯è®¿é—®ä»¤ç‰Œçš„å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="nx">Sanctum</span><span class="o">::</span><span class="na">authenticateAccessTokensUsing</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">         <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nx">PersonalAccessToken</span> <span class="nv">$accessToken</span><span class="p">,</span> <span class="nx">bool</span> <span class="nv">$isValid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$accessToken</span><span class="o">-&gt;</span><span class="na">can</span><span class="p">(</span><span class="s1">&#39;server:once&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nv">$isValid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">             <span class="p">}</span>
</span></span><span class="line"><span class="cl">             <span class="k">return</span> <span class="nv">$isValid</span> <span class="o">&amp;&amp;</span> <span class="nv">$accessToken</span><span class="o">-&gt;</span><span class="na">last_used_at</span> <span class="o">===</span>  <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="ç”¨æ³•">ç”¨æ³•</h3>
<ul>
<li>
<p>ä¸ºéœ€è¦tokenéªŒè¯çš„è·¯ç”±åŠ ä¸Šä¸­é—´ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">middleware</span><span class="p">([</span><span class="s1">&#39;auth:sanctum&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/info&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="é—®é¢˜">é—®é¢˜</h3>
<ul>
<li>
<p>æœªæˆæƒè·³ç™»å½•è·¯ç”±é—®é¢˜(<code>app/Exception/Handler.php</code>)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Throwable</span> <span class="nv">$exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æœªæˆæƒå¼‚å¸¸æŠ›å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">AuthenticationException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwBusinessException</span><span class="p">(</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">CLIENT_HTTP_UNAUTHORIZED</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div></li>
</ul>
]]></content>
		</item>
		
		<item>
			<title>Laravel å¼€å‘ API åˆå§‹æ­å»º</title>
			<link>https://blog.gookm.cn/posts/2022/20220115-api-init/</link>
			<pubDate>Sat, 15 Jan 2022 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2022/20220115-api-init/</guid>
			<description>å‰è¨€ ä½¿ç”¨ Laravel å¼€å‘è¿‡ä¸å°‘é¡¹ç›®ï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯å‰åç«¯åˆ†ç¦»çš„ï¼Œæ‰€ä»¥ä»Šå¤©å°±æ€»ç»“å½’çº³ä¸‹åœ¨å¼€å‘APIé¡¹ç›®æ—¶ï¼ŒLaravel çš„å‰æœŸæ¡†æ¶æ­å»ºè¿‡ç¨‹ï¼
ç¯å¢ƒ PHP 8.0.5 (cli) MySQL 8.0.25-0ubuntu0.20.04.1 (Ubuntu) Nginx nginx/1.18.0 (Ubuntu) IDE PhpStorm2020.2 æ­å»º å®‰è£…
//é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬ composer create-project laravel/laravel newapi //æŒ‡å®šç‰ˆæœ¬ composer create-project --prefer-dist laravel/laravel newapi &amp;#34;6.0.*&amp;#34; é…ç½®
æ•°æ®åº“ï¼ˆé…ç½®æ ¹ç›®å½•ä¸‹ .env æ–‡ä»¶ï¼‰
DB_CONNECTION=mysql // hoståœ°å€ DB_HOST=127.0.0.1 // ç«¯å£å· DB_PORT=3306 // æ•°æ®åº“å DB_DATABASE=laravel9 // ç”¨æˆ·å DB_USERNAME=root // å¯†ç  DB_PASSWORD= æ—¶åŒºï¼ˆé…ç½® config/app.php æ–‡ä»¶ï¼‰
&amp;#39;timezone&amp;#39; =&amp;gt; &amp;#39;PRC&amp;#39;, // å¤§é™†æ—¶é—´ å®‰è£…æ‰©å±•åŒ…
åªåˆ—å‡ºé¡¹ç›®å¿…å¤‡çš„å‡ ä¸ªï¼Œå¦‚æœæœ‰éœ€è¦å¯ä»¥ä»ä¸‹é¢é“¾æ¥é‡Œçœ‹ä¸€ä¸‹
ä¸‹è½½é‡æœ€é«˜çš„ 100 ä¸ª Laravel æ‰©å±•åŒ…æ¨è
ä»£ç æç¤ºå·¥å…·(https://github.com/barryvdh/laravel-ide-helper)
//åœ¨ dev ç¯å¢ƒå®‰è£… composer require barryvdh/laravel-ide-helper --dev è¯­è¨€åŒ…(https://github.</description>
			<content type="html"><![CDATA[<p><img src="https://qiniu.zkilm.cn/blog/cover/blue-light.png" alt="å°é¢ï¼"></p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<p>ä½¿ç”¨ <code>Laravel</code> å¼€å‘è¿‡ä¸å°‘é¡¹ç›®ï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯å‰åç«¯åˆ†ç¦»çš„ï¼Œæ‰€ä»¥ä»Šå¤©å°±æ€»ç»“å½’çº³ä¸‹åœ¨å¼€å‘APIé¡¹ç›®æ—¶ï¼Œ<code>Laravel</code> çš„å‰æœŸæ¡†æ¶æ­å»ºè¿‡ç¨‹ï¼</p>
<h3 id="ç¯å¢ƒ">ç¯å¢ƒ</h3>
<ul>
<li>PHP 8.0.5 (cli)</li>
<li>MySQL  8.0.25-0ubuntu0.20.04.1 (Ubuntu)</li>
<li>Nginx  nginx/1.18.0 (Ubuntu)</li>
<li>IDE PhpStorm2020.2</li>
</ul>
<h3 id="æ­å»º">æ­å»º</h3>
<ol>
<li>
<p>å®‰è£…</p>
<pre tabindex="0"><code>//é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬
composer create-project laravel/laravel newapi
//æŒ‡å®šç‰ˆæœ¬
composer create-project --prefer-dist laravel/laravel newapi &#34;6.0.*&#34;
</code></pre></li>
<li>
<p>é…ç½®</p>
<ul>
<li>
<p>æ•°æ®åº“ï¼ˆé…ç½®æ ¹ç›®å½•ä¸‹ <code>.env</code> æ–‡ä»¶ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">DB_CONNECTION</span><span class="o">=</span><span class="nx">mysql</span>
</span></span><span class="line"><span class="cl"><span class="c1">// hoståœ°å€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">DB_HOST</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç«¯å£å·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">DB_PORT</span><span class="o">=</span><span class="mi">3306</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ•°æ®åº“å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">DB_DATABASE</span><span class="o">=</span><span class="nx">laravel9</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨æˆ·å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">DB_USERNAME</span><span class="o">=</span><span class="nx">root</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¯†ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">DB_PASSWORD</span><span class="o">=</span>
</span></span></code></pre></div></li>
<li>
<p>æ—¶åŒºï¼ˆé…ç½® <code>config/app.php</code> æ–‡ä»¶ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;timezone&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;PRC&#39;</span><span class="p">,</span> <span class="c1">// å¤§é™†æ—¶é—´
</span></span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>å®‰è£…æ‰©å±•åŒ…</p>
<p>åªåˆ—å‡ºé¡¹ç›®å¿…å¤‡çš„å‡ ä¸ªï¼Œå¦‚æœæœ‰éœ€è¦å¯ä»¥ä»ä¸‹é¢é“¾æ¥é‡Œçœ‹ä¸€ä¸‹</p>
<p><a href="https://learnku.com/laravel/t/2530/the-highest-amount-of-downloads-of-the-100-laravel-extensions-recommended">ä¸‹è½½é‡æœ€é«˜çš„ 100 ä¸ª Laravel æ‰©å±•åŒ…æ¨è</a></p>
<ul>
<li>
<p>ä»£ç æç¤ºå·¥å…·(<a href="https://github.com/barryvdh/laravel-ide-helper">https://github.com/barryvdh/laravel-ide-helper</a>)</p>
<pre tabindex="0"><code>//åœ¨ dev ç¯å¢ƒå®‰è£…
composer require barryvdh/laravel-ide-helper --dev
</code></pre></li>
<li>
<p>è¯­è¨€åŒ…(<a href="https://github.com/overtrue/laravel-lang">https://github.com/overtrue/laravel-lang</a>)</p>
<pre tabindex="0"><code>//ä¸€äº›é…ç½®æµç¨‹å‚è€ƒé“¾æ¥æ–‡æ¡£
composer require overtrue/laravel-lang:~6.0
</code></pre></li>
<li>
<p>å¼€å‘è°ƒè¯•åˆ©å™¨(<a href="https://github.com/barryvdh/laravel-debugbar">https://github.com/barryvdh/laravel-debugbar</a>)</p>
<pre tabindex="0"><code>//åœ¨ dev ç¯å¢ƒå®‰è£…
composer require barryvdh/laravel-debugbar --dev
</code></pre></li>
</ul>
</li>
</ol>
<h3 id="å°è£…apiæ¥å£å“åº”">å°è£…APIæ¥å£å“åº”</h3>
<p>è¿™é‡Œæ˜¯é‡‡ç”¨çš„è‡ªå®šä¹‰ï¼Œæ²¡æœ‰ç”¨ <code>Dingo</code>ã€‚æˆ‘ä»¬å…ˆåœ¨ <code>app</code> ä¸‹æ–°å»º <code>Helpers</code> ç›®å½•ã€‚</p>
<ol>
<li>
<p>å°è£… API è¿”å›çš„ç»Ÿä¸€æ¶ˆæ¯ï¼ˆApiResponseï¼‰</p>
<p>åœ¨ <code>app/Helpers</code> ç›®å½•ä¸‹åˆ›å»º <code>ApiResponse.php</code> æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Helpers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Helpers\ResponseEnum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Exceptions\BusinessException</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\JsonResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Pagination\LengthAwarePaginator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\Collection</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">trait</span> <span class="nx">ApiResponse</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * æˆåŠŸ
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param null $data
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param array $codeResponse
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return JsonResponse
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">success</span><span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$codeResponse</span><span class="o">=</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">HTTP_OK</span><span class="p">)</span><span class="o">:</span> <span class="nx">JsonResponse</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">jsonResponse</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="nv">$codeResponse</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * å¤±è´¥
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param array $codeResponse
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param null $data
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param null $error
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return JsonResponse
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">fail</span><span class="p">(</span><span class="nv">$codeResponse</span><span class="o">=</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">HTTP_ERROR</span><span class="p">,</span> <span class="nv">$data</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$error</span><span class="o">=</span><span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">JsonResponse</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">jsonResponse</span><span class="p">(</span><span class="s1">&#39;fail&#39;</span><span class="p">,</span> <span class="nv">$codeResponse</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * jsonå“åº”
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $status
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $codeResponse
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $data
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $error
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return JsonResponse
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">jsonResponse</span><span class="p">(</span><span class="nv">$status</span><span class="p">,</span> <span class="nv">$codeResponse</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$error</span><span class="p">)</span><span class="o">:</span> <span class="nx">JsonResponse</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">list</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$message</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$codeResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;status&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$status</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;code&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$code</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;data&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$data</span> <span class="o">??</span> <span class="k">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;error&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$error</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><pre><code>/**
 * æˆåŠŸåˆ†é¡µè¿”å›
 * @param $page
 * @return JsonResponse
 */
protected function successPaginate($page): JsonResponse
{
    return $this-&gt;success($this-&gt;paginate($page));
}

private function paginate($page)
{
    if ($page instanceof LengthAwarePaginator){
        return [
            'total'  =&gt; $page-&gt;total(),
            'page'   =&gt; $page-&gt;currentPage(),
            'limit'  =&gt; $page-&gt;perPage(),
            'pages'  =&gt; $page-&gt;lastPage(),
            'list'   =&gt; $page-&gt;items()
        ];
    }
    if ($page instanceof Collection){
        $page = $page-&gt;toArray();
    }
    if (!is_array($page)){
        return $page;
    }
    $total = count($page);
    return [
        'total'  =&gt; $total, //æ•°æ®æ€»æ•°
        'page'   =&gt; 1, // å½“å‰é¡µç 
        'limit'  =&gt; $total, // æ¯é¡µçš„æ•°æ®æ¡æ•°
        'pages'  =&gt; 1, // æœ€åä¸€é¡µçš„é¡µç 
        'list'   =&gt; $page // æ•°æ®
    ];
}

/**
 * ä¸šåŠ¡å¼‚å¸¸è¿”å›
 * @param array $codeResponse
 * @param string $info
 * @throws BusinessException
 */
public function throwBusinessException(array $codeResponse=ResponseEnum::HTTP_ERROR, string $info = '')
{
    throw new BusinessException($codeResponse, $info);
}
</code></pre>
<p>}</p>
<pre tabindex="0"><code></code></pre></li>
<li>
<p>å°è£…ç»Ÿä¸€çŠ¶æ€ç ï¼ˆResponseEnumï¼‰</p>
<p>åœ¨ <code>app/Helpers</code> ç›®å½•ä¸‹åˆ›å»º <code>ResponseEnum.php</code> æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Helpers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ResponseEnum</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 001 ~ 099 è¡¨ç¤ºç³»ç»ŸçŠ¶æ€ï¼›100 ~ 199 è¡¨ç¤ºæˆæƒä¸šåŠ¡ï¼›200 ~ 299 è¡¨ç¤ºç”¨æˆ·ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*-------------------------------------------------------------------------------------------*/</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 100å¼€å¤´çš„è¡¨ç¤º ä¿¡æ¯æç¤ºï¼Œè¿™ç±»çŠ¶æ€è¡¨ç¤ºä¸´æ—¶çš„å“åº”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 100 - ç»§ç»­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 101 - åˆ‡æ¢åè®®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/*-------------------------------------------------------------------------------------------*/</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 200è¡¨ç¤ºæœåŠ¡å™¨æˆåŠŸåœ°æ¥å—äº†å®¢æˆ·ç«¯è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="no">HTTP_OK</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200001</span><span class="p">,</span> <span class="s1">&#39;æ“ä½œæˆåŠŸ&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">HTTP_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200002</span><span class="p">,</span> <span class="s1">&#39;æ“ä½œå¤±è´¥&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">HTTP_ACTION_COUNT_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200302</span><span class="p">,</span> <span class="s1">&#39;æ“ä½œé¢‘ç¹&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">USER_SERVICE_LOGIN_SUCCESS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200200</span><span class="p">,</span> <span class="s1">&#39;ç™»å½•æˆåŠŸ&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">USER_SERVICE_LOGIN_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200201</span><span class="p">,</span> <span class="s1">&#39;ç™»å½•å¤±è´¥&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">USER_SERVICE_LOGOUT_SUCCESS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200202</span><span class="p">,</span> <span class="s1">&#39;é€€å‡ºç™»å½•æˆåŠŸ&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">USER_SERVICE_LOGOUT_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200203</span><span class="p">,</span> <span class="s1">&#39;é€€å‡ºç™»å½•å¤±è´¥&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">USER_SERVICE_REGISTER_SUCCESS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200104</span><span class="p">,</span> <span class="s1">&#39;æ³¨å†ŒæˆåŠŸ&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">USER_SERVICE_REGISTER_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200105</span><span class="p">,</span> <span class="s1">&#39;æ³¨å†Œå¤±è´¥&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">USER_ACCOUNT_REGISTERED</span> <span class="o">=</span> <span class="p">[</span><span class="mi">23001</span><span class="p">,</span> <span class="s1">&#39;è´¦å·å·²æ³¨å†Œ&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/*-------------------------------------------------------------------------------------------*/</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 300å¼€å¤´çš„è¡¨ç¤ºæœåŠ¡å™¨é‡å®šå‘,æŒ‡å‘çš„åˆ«çš„åœ°æ–¹ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨å¿…é¡»é‡‡å–æ›´å¤šæ“ä½œæ¥å®ç°è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 302 - å¯¹è±¡å·²ç§»åŠ¨ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 304 - æœªä¿®æ”¹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 307 - ä¸´æ—¶é‡å®šå‘ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/*-------------------------------------------------------------------------------------------*/</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 400å¼€å¤´çš„è¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯è¯·æ±‚é”™è¯¯ï¼Œè¯·æ±‚ä¸åˆ°æ•°æ®ï¼Œæˆ–è€…æ‰¾ä¸åˆ°ç­‰ç­‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 400 - é”™è¯¯çš„è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="no">CLIENT_NOT_FOUND_HTTP_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400001</span><span class="p">,</span> <span class="s1">&#39;è¯·æ±‚å¤±è´¥&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">CLIENT_PARAMETER_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400200</span><span class="p">,</span> <span class="s1">&#39;å‚æ•°é”™è¯¯&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">CLIENT_CREATED_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400201</span><span class="p">,</span> <span class="s1">&#39;æ•°æ®å·²å­˜åœ¨&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">CLIENT_DELETED_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400202</span><span class="p">,</span> <span class="s1">&#39;æ•°æ®ä¸å­˜åœ¨&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 401 - è®¿é—®è¢«æ‹’ç»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="no">CLIENT_HTTP_UNAUTHORIZED</span> <span class="o">=</span> <span class="p">[</span><span class="mi">401001</span><span class="p">,</span> <span class="s1">&#39;æˆæƒå¤±è´¥ï¼Œè¯·å…ˆç™»å½•&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">CLIENT_HTTP_UNAUTHORIZED_EXPIRED</span> <span class="o">=</span> <span class="p">[</span><span class="mi">401200</span><span class="p">,</span> <span class="s1">&#39;è´¦å·ä¿¡æ¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">CLIENT_HTTP_UNAUTHORIZED_BLACKLISTED</span> <span class="o">=</span> <span class="p">[</span><span class="mi">401201</span><span class="p">,</span> <span class="s1">&#39;è´¦å·åœ¨å…¶ä»–è®¾å¤‡ç™»å½•ï¼Œè¯·é‡æ–°ç™»å½•&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 403 - ç¦æ­¢è®¿é—®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 404 - æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶æˆ–ç›®å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="no">CLIENT_NOT_FOUND_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">404001</span><span class="p">,</span> <span class="s1">&#39;æ²¡æœ‰æ‰¾åˆ°è¯¥é¡µé¢&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 405 - ç”¨æ¥è®¿é—®æœ¬é¡µé¢çš„ HTTP è°“è¯ä¸è¢«å…è®¸ï¼ˆæ–¹æ³•ä¸è¢«å…è®¸ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="no">CLIENT_METHOD_HTTP_TYPE_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">405001</span><span class="p">,</span> <span class="s1">&#39;HTTPè¯·æ±‚ç±»å‹é”™è¯¯&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 406 - å®¢æˆ·ç«¯æµè§ˆå™¨ä¸æ¥å—æ‰€è¯·æ±‚é¡µé¢çš„ MIME ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 407 - è¦æ±‚è¿›è¡Œä»£ç†èº«ä»½éªŒè¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 412 - å‰ææ¡ä»¶å¤±è´¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 413 â€“ è¯·æ±‚å®ä½“å¤ªå¤§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 414 - è¯·æ±‚ URI å¤ªé•¿
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 415 â€“ ä¸æ”¯æŒçš„åª’ä½“ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 416 â€“ æ‰€è¯·æ±‚çš„èŒƒå›´æ— æ³•æ»¡è¶³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 417 â€“ æ‰§è¡Œå¤±è´¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 423 â€“ é”å®šçš„é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/*-------------------------------------------------------------------------------------------*/</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 500å¼€å¤´çš„è¡¨ç¤ºæœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨å› ä¸ºä»£ç ï¼Œæˆ–è€…ä»€ä¹ˆåŸå› ç»ˆæ­¢è¿è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// æœåŠ¡ç«¯æ“ä½œé”™è¯¯ç ï¼š500 ~ 599 å¼€å¤´ï¼Œåæ‹¼æ¥ 3 ä½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 500 - å†…éƒ¨æœåŠ¡å™¨é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="no">SYSTEM_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500001</span><span class="p">,</span> <span class="s1">&#39;æœåŠ¡å™¨é”™è¯¯&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">SYSTEM_UNAVAILABLE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500002</span><span class="p">,</span> <span class="s1">&#39;æœåŠ¡å™¨æ­£åœ¨ç»´æŠ¤ï¼Œæš‚ä¸å¯ç”¨&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">SYSTEM_CACHE_CONFIG_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500003</span><span class="p">,</span> <span class="s1">&#39;ç¼“å­˜é…ç½®é”™è¯¯&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">SYSTEM_CACHE_MISSED_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500004</span><span class="p">,</span> <span class="s1">&#39;ç¼“å­˜æœªå‘½ä¸­&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">SYSTEM_CONFIG_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500005</span><span class="p">,</span> <span class="s1">&#39;ç³»ç»Ÿé…ç½®é”™è¯¯&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ä¸šåŠ¡æ“ä½œé”™è¯¯ç ï¼ˆå¤–éƒ¨æœåŠ¡æˆ–å†…éƒ¨æœåŠ¡è°ƒç”¨ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="no">SERVICE_REGISTER_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500101</span><span class="p">,</span> <span class="s1">&#39;æ³¨å†Œå¤±è´¥&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">SERVICE_LOGIN_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500102</span><span class="p">,</span> <span class="s1">&#39;ç™»å½•å¤±è´¥&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">SERVICE_LOGIN_ACCOUNT_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500103</span><span class="p">,</span> <span class="s1">&#39;è´¦å·æˆ–å¯†ç é”™è¯¯&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="no">SERVICE_USER_INTEGRAL_ERROR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500200</span><span class="p">,</span> <span class="s1">&#39;ç§¯åˆ†ä¸è¶³&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//501 - é¡µçœ‰å€¼æŒ‡å®šäº†æœªå®ç°çš„é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//502 - Web æœåŠ¡å™¨ç”¨ä½œç½‘å…³æˆ–ä»£ç†æœåŠ¡å™¨æ—¶æ”¶åˆ°äº†æ— æ•ˆå“åº”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//503 - æœåŠ¡ä¸å¯ç”¨ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//504 - ç½‘å…³è¶…æ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//505 - HTTP ç‰ˆæœ¬ä¸å—æ”¯æŒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="cm">/*-------------------------------------------------------------------------------------------*/</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>åˆ›å»ºä¸šåŠ¡å¼‚å¸¸æ•è· Exception æ–‡ä»¶</p>
<p>åœ¨ <code>app/Exceptions</code> ç›®å½•ä¸‹åˆ›å»º <code>BusinessException.php</code> æ–‡ä»¶ç”¨äºä¸šåŠ¡å¼‚å¸¸çš„æŠ›å‡º</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Exception</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BusinessException</span> <span class="k">extends</span> <span class="nx">Exception</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * ä¸šåŠ¡å¼‚å¸¸æ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param array $codeResponse çŠ¶æ€ç 
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param string $info è‡ªå®šä¹‰è¿”å›ä¿¡æ¯ï¼Œä¸ä¸ºç©ºæ—¶ä¼šæ›¿æ¢æ‰codeResponse é‡Œé¢çš„messageæ–‡å­—ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="k">array</span> <span class="nv">$codeResponse</span><span class="p">,</span> <span class="nv">$info</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$message</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$codeResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$info</span> <span class="o">?:</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$code</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>è‡ªå®šä¹‰è¿”å›å¼‚å¸¸</p>
<p>ä¿®æ”¹ <code>app/Exceptions</code> ç›®å½•ä¸‹çš„ <code>Handler.php</code> æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Helpers\ApiResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Helpers\ResponseEnum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Auth\AuthenticationException</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Foundation\Exceptions\Handler</span> <span class="k">as</span> <span class="nx">ExceptionHandler</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Validation\ValidationException</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Exception\MethodNotAllowedHttpException</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Exception\NotFoundHttpException</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Throwable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Handler</span> <span class="k">extends</span> <span class="nx">ExceptionHandler</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">ApiResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * A list of the exception types that are not reported.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var array&lt;int, class-string&lt;Throwable&gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$dontReport</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * A list of the inputs that are never flashed for validation exceptions.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var array&lt;int, string&gt;
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$dontFlash</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;current_password&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;password&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;password_confirmation&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Register the exception handling callbacks for the application.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return void
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reportable</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Throwable</span> <span class="nv">$exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒåˆ™è¿”å›500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.debug&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwBusinessException</span><span class="p">(</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">SYSTEM_ERROR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è¯·æ±‚ç±»å‹é”™è¯¯å¼‚å¸¸æŠ›å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">MethodNotAllowedHttpException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwBusinessException</span><span class="p">(</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">CLIENT_METHOD_HTTP_TYPE_ERROR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å‚æ•°æ ¡éªŒé”™è¯¯å¼‚å¸¸æŠ›å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">ValidationException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwBusinessException</span><span class="p">(</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">CLIENT_PARAMETER_ERROR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è·¯ç”±ä¸å­˜åœ¨å¼‚å¸¸æŠ›å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">NotFoundHttpException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwBusinessException</span><span class="p">(</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">CLIENT_NOT_FOUND_ERROR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æœªæˆæƒå¼‚å¸¸æŠ›å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">AuthenticationException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwBusinessException</span><span class="p">(</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">CLIENT_HTTP_UNAUTHORIZED</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è‡ªå®šä¹‰é”™è¯¯å¼‚å¸¸æŠ›å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">BusinessException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;fail&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;code&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;data&#39;</span>    <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;error&#39;</span>  <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>åˆ›å»ºæ§åˆ¶å™¨åŸºç±»</p>
<p>åœ¨ <code>app/Http/controller</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>BaseController.php</code> ä½œä¸º Api çš„åŸºç±»ï¼Œç„¶ååœ¨ <code>BaseController.php</code> è¿™ä¸ªåŸºç±»ä¸­ç»§æ‰¿ Controllerï¼Œå¹¶å¼•å…¥å°è£… API è¿”å›çš„ç»Ÿä¸€æ¶ˆæ¯ï¼ˆApiResponseï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Helpers\ApiResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// APIæ¥å£å“åº”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">use</span> <span class="nx">ApiResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>ä½¿ç”¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//è¿”å›æˆåŠŸä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">success</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è¿”å›å¤±è´¥ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">(</span><span class="nv">$codeResponse</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//æŠ›å‡ºå¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwBusinessException</span><span class="p">(</span><span class="nv">$codeResponse</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//åˆ†é¡µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">successPaginate</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="ç»Ÿä¸€è¡¨å•å‚æ•°è¾“å…¥æ ¡éªŒ">ç»Ÿä¸€è¡¨å•å‚æ•°è¾“å…¥æ ¡éªŒ</h3>
<ol>
<li>
<p>åˆ›å»º</p>
<p>åœ¨ <code>App\Helpers</code> ç›®å½•ä¸‹åˆ›å»º <code>VerifyRequestInput.php</code> æ–‡ä»¶ï¼Œå¹¶å¼•å…¥ <code>ApiResponse</code> ï¼Œè¿™æ ·å¯ä»¥æ›´ä¾¿æ·åœ°æ ¡éªŒè¡¨å•å‚æ•°ï¼Œå…¶ä¸­ <code>verifyData</code> æ–¹æ³•å¯ä»¥è‡ªå®šä¹‰æ ¡éªŒå­—æ®µåŠè§„åˆ™</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Helpers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Helpers\ResponseEnum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Exceptions\BusinessException</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Validation\Rule</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">trait</span> <span class="nx">VerifyRequestInput</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">ApiResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * éªŒè¯ID
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $key
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param null $default
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed|null
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @throws BusinessException
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifyId</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifyData</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="p">,</span> <span class="s1">&#39;integer|digits_between:1,20&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * éªŒè¯æ˜¯å¦ä¸ºæ•´æ•°
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $key
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param null $default
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed|null
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @throws BusinessException
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifyInteger</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifyData</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * éªŒè¯æ˜¯å¦ä¸ºæ•°å­—
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $key
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param null $default
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed|null
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @throws BusinessException
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifyNumeric</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifyData</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="p">,</span> <span class="s1">&#39;numeric&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * éªŒè¯æ˜¯å¦ä¸ºå­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $key
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param null $default
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed|null
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @throws BusinessException
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifyString</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifyData</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * éªŒè¯æ˜¯å¦ä¸ºå¸ƒå°”å€¼
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $key
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param null $default
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed|null
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @throws BusinessException
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifyBoolean</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifyData</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="p">,</span> <span class="s1">&#39;boolean&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * éªŒè¯æ˜¯å¦ä¸ºæšä¸¾
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $key
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param null $default
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param array $enum
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed|null
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @throws BusinessException
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifyEnum</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="o">=</span><span class="k">null</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$enum</span><span class="o">=</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifyData</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">in</span><span class="p">(</span><span class="nv">$enum</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * è‡ªå®šä¹‰æ ¡éªŒå‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $key string å­—æ®µ
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $default string é»˜è®¤å€¼
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $rule string éªŒè¯è§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed|null
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @throws BusinessException
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">verifyData</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="p">,</span> <span class="nv">$rule</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$value</span> <span class="o">=</span> <span class="nx">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$validator</span> <span class="o">=</span> <span class="nx">\Validator</span><span class="o">::</span><span class="na">make</span><span class="p">([</span><span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">],</span> <span class="p">[</span><span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$rule</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">is_null</span><span class="p">(</span><span class="nv">$value</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwBusinessException</span><span class="p">(</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">CLIENT_PARAMETER_ERROR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">fails</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwBusinessException</span><span class="p">(</span><span class="nx">ResponseEnum</span><span class="o">::</span><span class="na">CLIENT_PARAMETER_ERROR</span><span class="p">,</span> <span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>ä½¿ç”¨</p>
<p>éœ€è¦åœ¨ <code>App\Http\Controllers\BaseController</code> è¿™ä¸ªæ§åˆ¶å™¨åŸºç±»ä¸­å¼•å…¥ <code>VerifyRequestInput</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Helpers\VerifyRequestInput</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// éªŒè¯è¡¨å•å‚æ•°è¾“å…¥è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span> <span class="nx">VerifyRequestInput</span><span class="p">;</span>
</span></span></code></pre></div></li>
<li>
<p>æ¡ˆä¾‹</p>
<p>æœ‰ä¸€ä¸ª <code>index</code> æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è·å–å‚æ•°æ—¶ä½¿ç”¨ <code>verifyId</code> æ¥æ ¡éªŒè¯·æ±‚çš„å‚æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">verifyId</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æµ‹è¯•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">http</span><span class="o">://</span><span class="nx">newapi</span><span class="o">.</span><span class="nx">test</span><span class="o">/</span><span class="nx">api</span><span class="o">/</span><span class="nx">user</span><span class="o">/</span><span class="nx">index</span><span class="o">?</span><span class="nx">id</span><span class="o">=</span><span class="nx">asds</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;status&#34;</span><span class="o">:</span> <span class="s2">&#34;fail&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;code&#34;</span><span class="o">:</span> <span class="mi">400200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;message&#34;</span><span class="o">:</span> <span class="s2">&#34;The id must be an integer.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;data&#34;</span><span class="o">:</span> <span class="k">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;error&#34;</span><span class="o">:</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="åˆ›å»ºæœåŠ¡å±‚-service">åˆ›å»ºæœåŠ¡å±‚ Service</h3>
<p>å¦‚æœé¡¹ç›®æ¯”è¾ƒå°ï¼Œæ¥å£è¾ƒå°‘ï¼Œä¸šåŠ¡é€»è¾‘æ”¾åœ¨ controller å’Œ model å±‚å°±å¯ä»¥ã€‚å¦åˆ™å°±éœ€è¦åˆ›å»ºä¸€ä¸ª Service å±‚æ¥å­˜æ”¾ä¸€äº›è¾ƒå¤æ‚äº›çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<ol>
<li>
<p>åœ¨ <code>app</code> ç›®å½•ä¸‹ï¼Œåˆ›å»ºåå« <code>Services</code> çš„æ–‡ä»¶å¤¹</p>
</li>
<li>
<p>åœ¨æ–°åˆ›å»ºçš„ <code>Services</code> ç›®å½•ä¸‹åˆ›å»ºåŸºç±» <code>BaseService.php</code> ï¼Œé‡‡ç”¨å•ä¾‹æ¨¡å¼é¿å…å¯¹å†…å­˜é€ æˆæµªè´¹ï¼Œä¹Ÿæ–¹ä¾¿è°ƒç”¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Services</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Helpers\ApiResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BaseService</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¼•å…¥apiç»Ÿä¸€è¿”å›æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">use</span> <span class="nx">ApiResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">static</span> <span class="nv">$instance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getInstance</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="nv">$instance</span> <span class="nx">instanceof</span> <span class="k">static</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">static</span><span class="o">::</span><span class="nv">$instance</span> <span class="o">=</span> <span class="k">new</span> <span class="k">static</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">function</span> <span class="fm">__clone</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>ä½¿ç”¨</p>
<ul>
<li>
<p>åœ¨ Service å±‚åˆ›å»ºä¸€ä¸ª <code>UserService.php</code> çš„æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Services</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Services\BaseService</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserService</span> <span class="k">extends</span> <span class="nx">BaseService</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–ç”¨æˆ·ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUserInfo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nickname&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;å¼ ä¸‰&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="o">=&gt;</span> <span class="mi">18</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>åœ¨æ§åˆ¶å™¨ <code>UserController</code> ä¸­å¢åŠ ä¸€ä¸ª <code>info</code> æ–¹æ³•ï¼Œå¹¶è°ƒç”¨æœåŠ¡å±‚ä¸­çš„ getUserInfo () æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Services\UserService</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">UserService</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getUserInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">success</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>è¿”å›</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;status&#34;</span><span class="o">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;code&#34;</span><span class="o">:</span> <span class="mi">200001</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;message&#34;</span><span class="o">:</span> <span class="s2">&#34;æ“ä½œæˆåŠŸ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;data&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;name&#34;</span><span class="o">:</span> <span class="s2">&#34;promise&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;email&#34;</span><span class="o">:</span> <span class="s2">&#34;phper@163.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;token&#34;</span><span class="o">:</span> <span class="s2">&#34;4|vPaja1IIpyoRmvAGxF5dgpqiuwWVbQBrumFg5pQW&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;error&#34;</span><span class="o">:</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>â€‹</p>
</li>
</ul>
</li>
</ol>
]]></content>
		</item>
		
		<item>
			<title>RSAåŠ è§£å¯†ğŸ”’</title>
			<link>https://blog.gookm.cn/posts/2021/20211215-rsa/</link>
			<pubDate>Wed, 15 Dec 2021 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2021/20211215-rsa/</guid>
			<description>ç”ŸæˆRSAå…¬ç§é’¥ ä»£ç  class RsaHandler { /** * è¿‡æœŸæ—¶é—´ * @var int|mixed */ protected $expire; /** * å¯†é’¥å¯†ç  * @var string */ protected $pass_phrase; /** * å¯†é’¥ä¿å­˜è·¯å¾„ * @var string */ protected $path; /** * ç§é’¥ * @var string */ protected $private_key; /** * æ—¶é—´æˆ³ * @var integer */ protected $time; /** * åŸºç¡€é…ç½® * @var string[] */ public $dn = [ &amp;#34;countryName&amp;#34; =&amp;gt; &amp;#34;CN&amp;#34;, &amp;#34;stateOrProvinceName&amp;#34; =&amp;gt; &amp;#34;ChongQing&amp;#34;, &amp;#34;localityName&amp;#34; =&amp;gt; &amp;#34;China&amp;#34;, &amp;#34;organizationName&amp;#34; =&amp;gt; &amp;#34;The Brain Room Limited&amp;#34;, &amp;#34;organizationalUnitName&amp;#34; =&amp;gt; &amp;#34;PHP Documentation Team&amp;#34;, &amp;#34;commonName&amp;#34; =&amp;gt; &amp;#34;Rancy Bruce&amp;#34;, &amp;#34;emailAddress&amp;#34; =&amp;gt; &amp;#34;rancy@rancy.</description>
			<content type="html"><![CDATA[<h3 id="ç”Ÿæˆrsaå…¬ç§é’¥">ç”ŸæˆRSAå…¬ç§é’¥</h3>
<ul>
<li>ä»£ç </li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RsaHandler</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * è¿‡æœŸæ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var int|mixed
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$expire</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * å¯†é’¥å¯†ç 
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var string
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$pass_phrase</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * å¯†é’¥ä¿å­˜è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var string
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * ç§é’¥
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var string
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$private_key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * æ—¶é—´æˆ³
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var integer
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$time</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * åŸºç¡€é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var string[]
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$dn</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;countryName&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;CN&#34;</span><span class="p">,</span> <span class="s2">&#34;stateOrProvinceName&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;ChongQing&#34;</span><span class="p">,</span> <span class="s2">&#34;localityName&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;China&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;organizationName&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;The Brain Room Limited&#34;</span><span class="p">,</span> <span class="s2">&#34;organizationalUnitName&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;PHP Documentation Team&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;commonName&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;Rancy Bruce&#34;</span><span class="p">,</span> <span class="s2">&#34;emailAddress&#34;</span> <span class="o">=&gt;</span> <span class="s2">&#34;rancy@rancy.top&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * å¯†é’¥é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var array
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æŒ‡å®šåº”è¯¥ä½¿ç”¨å¤šå°‘ä½æ¥ç”Ÿæˆç§é’¥  512 1024  2048  4096ç­‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s2">&#34;private_key_bits&#34;</span> <span class="o">=&gt;</span> <span class="mi">1024</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//é€‰æ‹©åœ¨åˆ›å»ºCSRæ—¶åº”è¯¥ä½¿ç”¨å“ªäº›æ‰©å±•ã€‚å¯é€‰å€¼æœ‰ OPENSSL_KEYTYPE_DSA, OPENSSL_KEYTYPE_DH, OPENSSL_KEYTYPE_RSA æˆ– OPENSSL_KEYTYPE_EC. é»˜è®¤å€¼æ˜¯ OPENSSL_KEYTYPE_RSA.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s2">&#34;private_key_type&#34;</span> <span class="o">=&gt;</span> <span class="nx">OPENSSL_KEYTYPE_RSA</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * OpensslServer constructor.
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param string $path ä¿å­˜è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param int $expire æœ‰æ•ˆæœŸå¤©æ•°
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param string $pass_phrase å¯†é’¥å¯†ç 
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$path</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$expire</span> <span class="o">=</span> <span class="mi">365</span><span class="p">,</span> <span class="nv">$pass_phrase</span> <span class="o">=</span> <span class="s1">&#39;rancy&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span> <span class="o">=</span> <span class="nv">$path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expire</span> <span class="o">=</span> <span class="nv">$expire</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pass_phrase</span> <span class="o">=</span> <span class="nv">$pass_phrase</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">time</span> <span class="o">=</span> <span class="nx">time</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * ç”Ÿæˆå¯†é’¥å¯¹
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">generate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç”Ÿæˆå…¬é’¥ç§é’¥èµ„æº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$res</span> <span class="o">=</span> <span class="nx">openssl_pkey_new</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å¯¼å‡ºç§é’¥ $this-&gt;private_key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">openssl_pkey_export</span><span class="p">(</span><span class="nv">$res</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">private_key</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pass_phrase</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//  å¯¼å‡ºå…¬é’¥ $pubKey
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$pubKey</span> <span class="o">=</span> <span class="nx">openssl_pkey_get_details</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//var_dump($this-&gt;private_key);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//var_dump($pubKey);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="nx">file_put_contents</span><span class="p">(</span><span class="nx">public_path</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">time</span><span class="si">}</span><span class="s2">_private.key&#34;</span><span class="p">),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">private_key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">file_put_contents</span><span class="p">(</span><span class="nx">public_path</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">time</span><span class="si">}</span><span class="s2">_public.key&#34;</span><span class="p">),</span> <span class="nv">$pubKey</span><span class="p">[</span><span class="s2">&#34;key&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * ç­¾åè¯ä¹¦
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">cert</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//åŸºäº$dnç”Ÿæˆæ–°çš„ CSR ï¼ˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$csr</span> <span class="o">=</span> <span class="nx">openssl_csr_new</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dn</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">private_key</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æ ¹æ®é…ç½®è‡ªå·±å¯¹è¯ä¹¦è¿›è¡Œç­¾å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$csr_sign</span> <span class="o">=</span> <span class="nx">openssl_csr_sign</span><span class="p">(</span><span class="nv">$csr</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">private_key</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expire</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å°†å…¬é’¥è¯ä¹¦å­˜å‚¨åˆ°ä¸€ä¸ªå˜é‡ $csr_keyï¼Œç”± PEM ç¼–ç æ ¼å¼å‘½åã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">openssl_x509_export</span><span class="p">(</span><span class="nv">$csr_sign</span><span class="p">,</span> <span class="nv">$csr_key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å°†ç§é’¥å­˜å‚¨åˆ°åä¸ºçš„å‡º PKCS12 æ–‡ä»¶æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">openssl_pkcs12_export</span><span class="p">(</span><span class="nv">$csr_sign</span><span class="p">,</span> <span class="nv">$private_pkcs12</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">private_key</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pass_phrase</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//var_dump($csr_key);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//var_dump($private_pkcs12);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="nx">file_put_contents</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">time</span><span class="si">}</span><span class="s2">_cert.cer&#34;</span><span class="p">,</span> <span class="nv">$csr_key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">file_put_contents</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">time</span><span class="si">}</span><span class="s2">_private.pfx&#34;</span><span class="p">,</span> <span class="nv">$private_pkcs12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>è°ƒç”¨</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">generateRsa</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$openssl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RsaHandler</span><span class="p">(</span><span class="s1">&#39;certs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$openssl</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$openssl</span><span class="o">-&gt;</span><span class="na">cert</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="rsaåŠ è§£å¯†">RSAåŠ è§£å¯†</h3>
<ul>
<li>ä»£ç </li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Rsa</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$_config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;public_key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;private_key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$private_key_filepath</span><span class="p">,</span> <span class="nv">$public_key_filepath</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_config</span><span class="p">[</span><span class="s1">&#39;private_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getContents</span><span class="p">(</span><span class="nv">$private_key_filepath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_config</span><span class="p">[</span><span class="s1">&#39;public_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getContents</span><span class="p">(</span><span class="nv">$public_key_filepath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @uses è·å–æ–‡ä»¶å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param $file_path string
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return bool|string
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">_getContents</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">file_exists</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span> <span class="p">(</span><span class="s1">&#39;å¯†é’¥æˆ–å…¬é’¥çš„æ–‡ä»¶è·¯å¾„é”™è¯¯&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @uses è·å–ç§é’¥
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return bool|resource     
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span> 
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">_getPrivateKey</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$priv_key</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_config</span><span class="p">[</span><span class="s1">&#39;private_key&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nx">openssl_pkey_get_private</span><span class="p">(</span><span class="nv">$priv_key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @uses è·å–å…¬é’¥
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return bool|resource     
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>    
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">function</span> <span class="nf">_getPublicKey</span><span class="p">()</span> <span class="p">{</span>        
</span></span><span class="line"><span class="cl">        <span class="nv">$public_key</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_config</span><span class="p">[</span><span class="s1">&#39;public_key&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">openssl_pkey_get_public</span><span class="p">(</span><span class="nv">$public_key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @uses ç§é’¥åŠ å¯†
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param string $data     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return null|string     
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">privEncrypt</span><span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>       
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">openssl_private_encrypt</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$encrypted</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getPrivateKey</span><span class="p">())</span> <span class="o">?</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nv">$encrypted</span><span class="p">)</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @uses å…¬é’¥åŠ å¯†     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param string $data     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return null|string     
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">publicEncrypt</span><span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>        
</span></span><span class="line"><span class="cl">        <span class="p">}</span>        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">openssl_public_encrypt</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$encrypted</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getPublicKey</span><span class="p">())</span> <span class="o">?</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nv">$encrypted</span><span class="p">)</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @uses ç§é’¥è§£å¯†     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param string $encrypted     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return null     
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">privDecrypt</span><span class="p">(</span><span class="nv">$encrypted</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$encrypted</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>        
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="nx">openssl_private_decrypt</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$encrypted</span><span class="p">),</span> <span class="nv">$decrypted</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getPrivateKey</span><span class="p">()))</span> <span class="o">?</span> <span class="nv">$decrypted</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @uses å…¬é’¥è§£å¯†     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param string $encrypted     
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return null     
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">publicDecrypt</span><span class="p">(</span><span class="nv">$encrypted</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$encrypted</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>        
</span></span><span class="line"><span class="cl">        <span class="p">}</span>        
</span></span><span class="line"><span class="cl">           <span class="k">return</span> <span class="p">(</span><span class="nx">openssl_public_decrypt</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$encrypted</span><span class="p">),</span> <span class="nv">$decrypted</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getPublicKey</span><span class="p">()))</span> <span class="o">?</span> <span class="nv">$decrypted</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è°ƒç”¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$private_key</span> <span class="o">=</span> <span class="s1">&#39;private_key.pem&#39;</span><span class="p">;</span> <span class="c1">// ç§é’¥è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$public_key</span> <span class="o">=</span> <span class="s1">&#39;rsa_public_key.pem&#39;</span><span class="p">;</span> <span class="c1">// å…¬é’¥è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$rsa</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rsa</span><span class="p">(</span><span class="nv">$private_key</span><span class="p">,</span> <span class="nv">$public_key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$origin_data</span> <span class="o">=</span> <span class="s1">&#39;è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ•°æ®&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$ecryption_data</span> <span class="o">=</span> <span class="nv">$rsa</span><span class="o">-&gt;</span><span class="na">privEncrypt</span><span class="p">(</span><span class="nv">$origin_data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$decryption_data</span> <span class="o">=</span> <span class="nv">$rsa</span><span class="o">-&gt;</span><span class="na">publicDecrypt</span><span class="p">(</span><span class="nv">$ecryption_data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;ç§é’¥åŠ å¯†åçš„æ•°æ®ä¸ºï¼š&#39;</span> <span class="o">.</span> <span class="nv">$ecryption_data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s1">&#39;å…¬é’¥è§£å¯†åçš„æ•°æ®ä¸º: &#39;</span> <span class="o">.</span> <span class="nv">$decryption_data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</span></span></code></pre></div><blockquote>
<p>è¯´æ˜ï¼šå…¬é’¥ã€ç§é’¥éƒ½å¯ä»¥åŠ å¯†ï¼Œä¹Ÿéƒ½å¯ä»¥è§£å¯†ã€‚å…¶ä¸­ï¼šç”¨å…¬é’¥åŠ å¯†éœ€è¦ç§é’¥è§£å¯†ï¼Œç§°ä¸ºâ€œåŠ å¯†â€ã€‚ç”±äºç§é’¥æ˜¯ä¸å…¬å¼€çš„ï¼Œç¡®ä¿äº†å†…å®¹çš„ä¿å¯†ï¼Œæ²¡æœ‰ç§é’¥æ— æ³•è·å¾—å†…å®¹ï¼›ç”¨ç§é’¥åŠ å¯†éœ€è¦å…¬é’¥è§£å¯†ï¼Œç§°ä¸ºâ€œç­¾åâ€ã€‚ç”±äºå…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è§£å¯†å†…å®¹ï¼Œä½†åªèƒ½ç”¨å‘å¸ƒè€…çš„å…¬é’¥è§£å¯†ï¼ŒéªŒè¯äº†å†…å®¹æ˜¯è¯¥å‘å¸ƒè€…å‘å‡ºçš„ã€‚</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>Laravel è¡¨å•éªŒè¯å°è£…ğŸ’ª</title>
			<link>https://blog.gookm.cn/posts/2021/20211119-laravel-formrequest/</link>
			<pubDate>Fri, 19 Nov 2021 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2021/20211119-laravel-formrequest/</guid>
			<description>æ–°å»ºã€Œè¡¨å•éªŒè¯åŸºç±»ã€ æ–°å»ºã€Œè¡¨å•éªŒè¯åŸºç±»ã€ app/Http/Requests/FormRequest.php &amp;lt;?php namespace App\Http\Requests; use Illuminate\Foundation\Http\FormRequest as BaseFormRequest; class FormRequest extends BaseFormRequest { use SceneValidator; /** * Determine if the user is authorized to make this request. * * @return bool */ public function authorize() { return true; } } æ–°å»ºåœºæ™¯éªŒè¯ç±» æ–°å»º app/Http/Requests/SceneValidator.php &amp;lt;?php namespace App\Http\Requests; use Illuminate\Contracts\Validation\{Factory, Validator}; trait SceneValidator { protected $scene = null; protected $onlyRule = []; protected $autoValidate = true; /** * Validate. * * @param string|array $scene */ public function validate($scene = &amp;#39;&amp;#39;) { if (!</description>
			<content type="html"><![CDATA[<h3 id="æ–°å»ºè¡¨å•éªŒè¯åŸºç±»">æ–°å»ºã€Œè¡¨å•éªŒè¯åŸºç±»ã€</h3>
<ul>
<li>æ–°å»ºã€Œè¡¨å•éªŒè¯åŸºç±»ã€ <code>app/Http/Requests/FormRequest.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span> <span class="k">as</span> <span class="nx">BaseFormRequest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FormRequest</span> <span class="k">extends</span> <span class="nx">BaseFormRequest</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">SceneValidator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Determine if the user is authorized to make this request.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return bool
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">authorize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="æ–°å»ºåœºæ™¯éªŒè¯ç±»">æ–°å»ºåœºæ™¯éªŒè¯ç±»</h3>
<ul>
<li>æ–°å»º <code>app/Http/Requests/SceneValidator.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Contracts\Validation\</span><span class="p">{</span><span class="nx">Factory</span><span class="p">,</span> <span class="nx">Validator</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">trait</span> <span class="nx">SceneValidator</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$scene</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$onlyRule</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$autoValidate</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Validate.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param string|array $scene
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">validate</span><span class="p">(</span><span class="nv">$scene</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">autoValidate</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="nv">$scene</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">onlyRule</span> <span class="o">=</span> <span class="nv">$scene</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">scene</span> <span class="o">=</span> <span class="nv">$scene</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handleValidate</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * è¦†ç›– ValidatesWhenResolvedTrait-&gt;validateResolved
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateResolved</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">method_exists</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;autoValidate&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">autoValidate</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;autoValidate&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">autoValidate</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handleValidate</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Handle validate.
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">function</span> <span class="nf">handleValidate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">parent</span><span class="o">::</span><span class="na">validateResolved</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * å®šä¹‰ FormRequest-&gt;getValidatorInstance ä¸‹ validator éªŒè¯å™¨
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param Factory $factory
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return Validator
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">validator</span><span class="p">(</span><span class="nx">Factory</span> <span class="nv">$factory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$validationData</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isMethod</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">()</span> <span class="o">:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">make</span><span class="p">(</span><span class="nv">$validationData</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getRules</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">messages</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Get rules.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return array
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getRules</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handleScene</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;rules&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Handle scene.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param array $rules
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return array
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">function</span> <span class="nf">handleScene</span><span class="p">(</span><span class="k">array</span> <span class="nv">$rules</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">onlyRule</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handleRules</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">onlyRule</span><span class="p">,</span> <span class="nv">$rules</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">scene</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">method_exists</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;scene&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$scene</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">([</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;scene&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">array_key_exists</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">scene</span><span class="p">,</span> <span class="nv">$scene</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handleRules</span><span class="p">(</span><span class="nv">$scene</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">scene</span><span class="p">],</span> <span class="nv">$rules</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$rules</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Handle rules.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param array $sceneRules
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param array $rules
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return array
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">function</span> <span class="nf">handleRules</span><span class="p">(</span><span class="k">array</span> <span class="nv">$sceneRules</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$rules</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$sceneRules</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">array_key_exists</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$rules</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$result</span><span class="p">[</span><span class="nv">$value</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$rules</span><span class="p">[</span><span class="nv">$value</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$result</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="æ–°å»ºè¯·æ±‚ç±»">æ–°å»ºã€Œè¯·æ±‚ç±»ã€</h3>
<ul>
<li>æ–°å»ºã€Œè¯·æ±‚ç±»ã€ <code>app/Http/Requests/PermissionRequest.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Validation\Rule</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PermissionRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$autoValidate</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Get the validation rules that apply to the request.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return array
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//å…¨éƒ¨çš„éªŒè¯è§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;between:2,16&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="nx">Rule</span><span class="o">::</span><span class="na">in</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;user_ids&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;role_id&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;action_codes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Get custom attributes for validator errors.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return array
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">attributes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;è§’è‰²åç§°&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;è§’è‰²ç±»å‹&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;user_ids&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ç”¨æˆ·IDé›†&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;role_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;è§’è‰²ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ç”¨æˆ·ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;action_codes&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;è¡Œä¸ºç¼–ç é›†&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * scene.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return array
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">scene</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;roleCreate&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;roleMemberAdd&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;user_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;role_id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;roleMemberDel&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;role_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;roleMemberList&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;role_id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;roleActionEdit&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;role_id&#39;</span><span class="p">,</span> <span class="s1">&#39;action_codes&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;roleActionList&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;role_id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;allActionMarkList&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;role_id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="ç¼–è¾‘æ§åˆ¶å™¨">ç¼–è¾‘æ§åˆ¶å™¨</h3>
<ul>
<li>ç¼–è¾‘ <code>app/Http/Controllers/PermissionController.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Http\Requests\PermissionRequest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">roleCreate</span><span class="p">(</span><span class="nx">PermissionRequest</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å‚æ•°éªŒè¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span><span class="s1">&#39;roleCreate&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></div><h3 id="ç¼–è¾‘é…ç½®æ–‡ä»¶">ç¼–è¾‘é…ç½®æ–‡ä»¶</h3>
<ul>
<li>ç¼–è¾‘ <code>config/app.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="s1">&#39;locale&#39;</span><span class="w"> </span><span class="l">=&gt; &#39;zn&#39;,</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>æˆ–å®‰è£… <code>overtrue/laravel-lang</code> - è¯­è¨€åŒ…</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">composer require &#34;overtrue/laravel-lang:~3.0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 1. é…ç½® config/app.php</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Illuminate\Translation\TranslationServiceProvider::class</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">æ›¿æ¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Overtrue\LaravelLang\TranslationServiceProvider::class</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 2. é…ç½® config/app.php</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="s1">&#39;locale&#39;</span><span class="w"> </span><span class="l">=&gt; &#39;zh-CN&#39;</span><span class="w">
</span></span></span></code></pre></div><h3 id="ç¼–è¾‘å¼‚å¸¸å¤„ç†æ–‡ä»¶">ç¼–è¾‘å¼‚å¸¸å¤„ç†æ–‡ä»¶</h3>
<ul>
<li>
<p>ç¼–è¾‘ <code>app/Exception/Handler.php</code></p>
</li>
<li>
<p>Laravel 6.*</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">report</span><span class="p">(</span><span class="nx">Exception</span> <span class="nv">$exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">parent</span><span class="o">::</span><span class="na">report</span><span class="p">(</span><span class="nv">$exception</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Exception</span> <span class="nv">$exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$commonHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CommonHandler</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// éªŒè¯é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="s2">&#34;api/*&#34;</span><span class="p">))</span> <span class="p">{</span><span class="c1">// æˆ‘ä»¬ä»…ä»…å¤„ç† apiçš„å¼‚å¸¸ï¼Œæ‰€ä»¥è¿™é‡Œè¦æ’é™¤ä¸‹å…¶ä»–å‰ç¼€è·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//å¦‚æœæŠ›å‡ºçš„å¼‚å¸¸æ˜¯ DefineValidationException çš„å®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šè¯¥å¼‚å¸¸æ˜¯è¡¨å•éªŒè¯å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">\Illuminate\Validation\ValidationException</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ä¸‹é¢æ˜¯ä½ éœ€è¦åŒ…è£…çš„æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">validator</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span><span class="c1">// æ›´å¥½çš„è·å–é”™è¯¯çš„æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">authMessage</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//å¤„ç†è¯·æ±‚æ–¹æ³•å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">MethodNotAllowedHttpException</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">authMessage</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="nv">$$exception</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//å¤„ç†å†…éƒ¨é”™è¯¯å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">FatalThrowableError</span> <span class="o">||</span> <span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">\ErrorException</span> <span class="o">||</span> <span class="nv">$exception</span> <span class="nx">instanceof</span> <span class="nx">QueryException</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_ENV&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;local&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">authMessage</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="nv">$$exception</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">render</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>Laravel 8.*</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reportable</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">//æ•æ‰è¡¨å•éªŒè¯é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">renderable</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">ValidationException</span> <span class="nv">$exception</span><span class="p">,</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">validator</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span><span class="c1">// æ›´å¥½çš„è·å–é”™è¯¯çš„æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="mi">40000</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="p">[]]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="post-è¯·æ±‚æµ‹è¯•">POST è¯·æ±‚æµ‹è¯•</h3>
<ul>
<li>POST è¯·æ±‚ <code>/permission/role/create</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">40000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;è§’è‰²åç§° å¿…é¡»åœ¨ 2 åˆ° 16 ä¸ªå­—ç¬¦ä¹‹é—´&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>ç›‘æ§æœåŠ¡å™¨å¼‚å¸¸ä¸é‡å¯</title>
			<link>https://blog.gookm.cn/posts/2021/20210909-restart-lnmp/</link>
			<pubDate>Thu, 09 Sep 2021 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2021/20210909-restart-lnmp/</guid>
			<description>åœ¨ä¸€äº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡è„šæœ¬å»è‡ªåŠ¨ç›‘æ§æœåŠ¡å™¨çš„çŠ¶æ€æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è‡ªåŠ¨è¿›è¡Œé‡å¯ï¼Œæ›¿ä»£äººæ‰‹å»é‡å¯ã€‚
PHPä¸Nginx æŸ¥çœ‹æœåŠ¡è¿›ç¨‹æ•° é€šè¿‡æŸ¥çœ‹æœåŠ¡å™¨ç›¸å…³è¿›ç¨‹æ•°ï¼Œæ¥åˆ¤æ–­æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œè„šæœ¬ service-restart.sh å¦‚ä¸‹ï¼š
# ! /bin/sh ###æŸ¥çœ‹fpmæœåŠ¡æ˜¯å¦è¿è¡Œ phpfpm_procnum=`ps -ef|grep &amp;#34;php-fpm&amp;#34;|grep -v grep|wc -l` if [ $phpfpm_procnum -eq 0 ] then echo &amp;#34;restart php-fpm...&amp;#34; systemctl restart php-fpm &amp;gt;&amp;gt; /var/log/listen_service_start.log 2&amp;gt;&amp;amp;1 fi ###æŸ¥çœ‹nginxæœåŠ¡æ˜¯å¦è¿è¡Œ nginx_procnum=`ps -ef|grep &amp;#34;nginx&amp;#34;|grep -v grep|wc -l` if [ $nginx_procnum -eq 0 ] then echo &amp;#34;restart nginx...&amp;#34; systemctl restart nginx &amp;gt;&amp;gt; /var/log/listen_service_start.log 2&amp;gt;&amp;amp;1 fi æŸ¥çœ‹æœåŠ¡å™¨å“åº” é€šè¿‡ curl æœåŠ¡å™¨åœ°å€ï¼Œæ ¹æ®å“åº”ä¿¡æ¯åˆ¤æ–­æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œè„šæœ¬ nginx404.php å¦‚ä¸‹ï¼š
&amp;lt;?php $url = &amp;#39;https://test.com&amp;#39;; $cmd = &amp;#39;systemctl restart php-fpm&amp;#39;; for ($i = 0; $i &amp;lt; 5; $i++) { $exec = &amp;#34;curl connect-timeout 3 -I $url 2&amp;gt;/dev/null&amp;#34;; $res = shell_exec($exec); if (stripos($res, &amp;#39;404 Not Found&amp;#39;) !</description>
			<content type="html"><![CDATA[<p>åœ¨ä¸€äº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡è„šæœ¬å»è‡ªåŠ¨ç›‘æ§æœåŠ¡å™¨çš„çŠ¶æ€æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è‡ªåŠ¨è¿›è¡Œé‡å¯ï¼Œæ›¿ä»£äººæ‰‹å»é‡å¯ã€‚</p>
<h2 id="phpä¸nginx">PHPä¸Nginx</h2>
<h3 id="æŸ¥çœ‹æœåŠ¡è¿›ç¨‹æ•°">æŸ¥çœ‹æœåŠ¡è¿›ç¨‹æ•°</h3>
<p>é€šè¿‡æŸ¥çœ‹æœåŠ¡å™¨ç›¸å…³è¿›ç¨‹æ•°ï¼Œæ¥åˆ¤æ–­æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œè„šæœ¬ <code>service-restart.sh</code> å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># ! /bin/sh</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1">###æŸ¥çœ‹fpmæœåŠ¡æ˜¯å¦è¿è¡Œ</span>
</span></span><span class="line"><span class="cl"><span class="nv">phpfpm_procnum</span><span class="o">=</span><span class="sb">`</span>ps -ef<span class="p">|</span>grep <span class="s2">&#34;php-fpm&#34;</span><span class="p">|</span>grep -v grep<span class="p">|</span>wc -l<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="nv">$phpfpm_procnum</span> -eq <span class="m">0</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;restart php-fpm...&#34;</span>
</span></span><span class="line"><span class="cl">        systemctl restart php-fpm &gt;&gt; /var/log/listen_service_start.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="c1">###æŸ¥çœ‹nginxæœåŠ¡æ˜¯å¦è¿è¡Œ</span>
</span></span><span class="line"><span class="cl"><span class="nv">nginx_procnum</span><span class="o">=</span><span class="sb">`</span>ps -ef<span class="p">|</span>grep <span class="s2">&#34;nginx&#34;</span><span class="p">|</span>grep -v grep<span class="p">|</span>wc -l<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="nv">$nginx_procnum</span> -eq <span class="m">0</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">then</span> 
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;restart nginx...&#34;</span>
</span></span><span class="line"><span class="cl">        systemctl restart nginx &gt;&gt; /var/log/listen_service_start.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></div><h3 id="æŸ¥çœ‹æœåŠ¡å™¨å“åº”">æŸ¥çœ‹æœåŠ¡å™¨å“åº”</h3>
<p>é€šè¿‡ <code>curl</code> æœåŠ¡å™¨åœ°å€ï¼Œæ ¹æ®å“åº”ä¿¡æ¯åˆ¤æ–­æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œè„šæœ¬ <code>nginx404.php</code> å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;https://test.com&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$cmd</span> <span class="o">=</span> <span class="s1">&#39;systemctl restart php-fpm&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$exec</span> <span class="o">=</span> <span class="s2">&#34;curl connect-timeout 3 -I </span><span class="si">$url</span><span class="s2"> 2&gt;/dev/null&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$res</span> <span class="o">=</span> <span class="nx">shell_exec</span><span class="p">(</span><span class="nv">$exec</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nv">$res</span><span class="p">,</span> <span class="s1">&#39;404 Not Found&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">shell_exec</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="supervisor">Supervisor</h2>
<h3 id="åˆ¤æ–­å‘½ä»¤å“åº”çŠ¶æ€">åˆ¤æ–­å‘½ä»¤å“åº”çŠ¶æ€</h3>
<p>é€šè¿‡æ‰§è¡ŒæŸ¥çœ‹ <code>Supervisor</code> çš„çŠ¶æ€å‘½ä»¤ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º <code>RUNNING</code>ï¼Œè„šæœ¬ <code>check-supervisor.sh</code> å¦‚ä¸‹</p>
<p><strong>é‡å¯æŒ‡å®š</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    
</span></span><span class="line"><span class="cl">smart-retail-api_00<span class="o">=</span><span class="sb">`</span>supervisorctl status smart-retail-api:smart-retail-api_00<span class="sb">`</span>
</span></span><span class="line"><span class="cl">smart-retail-api_00<span class="o">=</span><span class="sb">`</span>supervisorctl status smart-retail-api:smart-retail-api_01<span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34;</span><span class="nv">$smart</span><span class="s2">-retail-api_00&#34;</span> <span class="o">=</span>~ <span class="s2">&#34;RUNNING&#34;</span> <span class="o">]]</span>
</span></span><span class="line"><span class="cl"><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;smart-retail-api_00 RUNNING&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;smart-retail-api:smart-retail-api_00 starting...&#34;</span>
</span></span><span class="line"><span class="cl">    supervisorctl start smart-retail-api:smart-retail-api_00
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34;</span><span class="nv">$smart</span><span class="s2">-retail-api_01&#34;</span> <span class="o">=</span>~ <span class="s2">&#34;RUNNING&#34;</span> <span class="o">]]</span>
</span></span><span class="line"><span class="cl"><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;smart-retail-api_01 RUNNING&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;smart-retail-api:smart-retail-api_00 starting...&#34;</span>
</span></span><span class="line"><span class="cl">    supervisorctl start smart-retail-api:smart-retail-api_01
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></div><p><strong>é‡å¯å…¨éƒ¨</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    
</span></span><span class="line"><span class="cl"><span class="nv">supervisor_status</span><span class="o">=</span><span class="sb">`</span>supervisorctl status<span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34;</span><span class="nv">$supervisor_status</span><span class="s2">&#34;</span> <span class="o">=</span>~ <span class="s2">&#34;FATAL&#34;</span> <span class="o">]]</span> <span class="o">||</span> <span class="o">[[</span> <span class="s2">&#34;</span><span class="nv">$supervisor_status</span><span class="s2">&#34;</span> <span class="o">=</span>~ <span class="s2">&#34;STOPPED&#34;</span> <span class="o">]]</span>
</span></span><span class="line"><span class="cl"><span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;supervisor restarting all...&#34;</span>
</span></span><span class="line"><span class="cl">    supervisorctl restart all
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;supervisor RUNNING&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></div><h2 id="é…ç½®ä»»åŠ¡è°ƒåº¦">é…ç½®ä»»åŠ¡è°ƒåº¦</h2>
<p><strong>æ¯åˆ†é’Ÿæ£€æµ‹</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">crontab -e
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">* * * * * bash /root/service-restart.sh
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>ç™¾ä¸‡çº§æ•°æ®å¯¼å…¥ Elasticsearch ğŸ˜Œ</title>
			<link>https://blog.gookm.cn/posts/2021/20210901-python-es/</link>
			<pubDate>Wed, 01 Sep 2021 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2021/20210901-python-es/</guid>
			<description>æ¶‰åŠçŸ¥è¯†ç‚¹ Python è¯»å–CSVæ–‡ä»¶ Elasticsearch å¯¼å…¥jsonæ–‡ä»¶ æœ¬æ–‡ç›®æ ‡ å®Œæˆè¶…è¿‡100Mçš„SCVæ–‡ä»¶ä¸Šä¼ åˆ°ES å¯¼è¯­ å¦‚ä½•å°†100wæ¡è®°å½•åŒæ­¥åˆ°Esï¼Ÿ
Kibana æœ‰ä¸ª Data Visualizer å¯ä»¥ç›´æ¥ä¸Šä¼  CSV æ–‡ä»¶ï¼Œä½†æ˜¯æœ‰ä¸ªé™åˆ¶æ˜¯æ–‡ä»¶ä¸èƒ½å¤§äº100Mã€‚
é‚£ä¹ˆå¯¹äºå¤§äº100Mçš„ CSV æ–‡ä»¶æˆ‘ä»¬è¯¥å¦‚ä½•è¿›è¡Œä¸Šä¼ åˆ°ESå‘¢ï¼Ÿ
æˆ‘è¿™é‡Œé‡‡ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡Esçš„ Bulk API è¿›è¡Œå¯¼å…¥ã€‚
å‚è€ƒåœ°å€ï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html
ä½†æ˜¯ Bulk API å¯¹ä¸Šä¼ çš„JSONæ–‡ä»¶å¤§å°ä¹Ÿä¼šæœ‰é™åˆ¶ï¼Œé™åˆ¶ä¸º50Mï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå¯¹JSONæ–‡ä»¶è¿›è¡Œæ‹†åˆ†ï¼Œä¿è¯æ¯ä¸ªå•JSONæ–‡ä»¶ä¸è¶…è¿‡50Mã€‚
æ•´ä½“åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼š
æ­¥éª¤ä¸€ï¼šå¯¹æ€»CSVæ–‡ä»¶è¿›è¡Œjsonæ ¼å¼åŒ–ï¼Œæ ¼å¼åŒ–ä¸ºæŒ‡å®šçš„jsonæ ¼å¼ï¼Œéœ€è¦ç¬¦åˆBulk APIçš„ä¸Šä¼ è¦æ±‚ æ­¥éª¤äºŒï¼šå¯¹jsonæ–‡ä»¶è¿›è¡Œæ‹†åˆ†å­˜å‚¨ï¼Œä¿è¯å•jsonæ–‡ä»¶å¤§å°ä¸è¶…è¿‡50M Pyè„šæœ¬ Python ä»£ç å¦‚ä¸‹(test.py)ï¼š
import csv from collections import defaultdict, OrderedDict import json import time import argparse import os parser = argparse.ArgumentParser(description=&amp;#39;è‡ªå®šä¹‰CLIä¼ å‚&amp;#39;) parser.add_argument(&amp;#39;--csv_filename&amp;#39;, &amp;#39;-cf&amp;#39;, help=&amp;#39;csv_filename é€‰å–æŒ‡å®šCSVæ–‡ä»¶åï¼Œå¿…è¦å‚æ•°&amp;#39;, required=True) parser.add_argument(&amp;#39;--json_dirname&amp;#39;, &amp;#39;-jd&amp;#39;, help=&amp;#39;json_dirname å°†ä½œä¸ºJSONæ–‡ä»¶ç›®å½•åï¼Œå¿…è¦å‚æ•°&amp;#39;, required=True) args = parser.parse_args() start_time=time.time() csv_filename=args.csv_filename csv_filename=csv_filename.strip() json_dirname=args.json_dirname json_dirname=json_dirname.</description>
			<content type="html"><![CDATA[<h3 id="æ¶‰åŠçŸ¥è¯†ç‚¹">æ¶‰åŠçŸ¥è¯†ç‚¹</h3>
<ul>
<li><code>Python</code> è¯»å–CSVæ–‡ä»¶</li>
<li><code>Elasticsearch</code> å¯¼å…¥jsonæ–‡ä»¶</li>
</ul>
<h3 id="æœ¬æ–‡ç›®æ ‡">æœ¬æ–‡ç›®æ ‡</h3>
<ul>
<li>å®Œæˆè¶…è¿‡100Mçš„SCVæ–‡ä»¶ä¸Šä¼ åˆ°ES</li>
</ul>
<h3 id="å¯¼è¯­">å¯¼è¯­</h3>
<p>å¦‚ä½•å°†<strong>100w</strong>æ¡è®°å½•åŒæ­¥åˆ°Esï¼Ÿ</p>
<p><code>Kibana</code> æœ‰ä¸ª <code>Data Visualizer</code> å¯ä»¥ç›´æ¥ä¸Šä¼  <code>CSV</code> æ–‡ä»¶ï¼Œä½†æ˜¯æœ‰ä¸ªé™åˆ¶æ˜¯æ–‡ä»¶ä¸èƒ½å¤§äº100Mã€‚</p>
<p>é‚£ä¹ˆå¯¹äºå¤§äº100Mçš„ <code>CSV</code> æ–‡ä»¶æˆ‘ä»¬è¯¥å¦‚ä½•è¿›è¡Œä¸Šä¼ åˆ°ESå‘¢ï¼Ÿ</p>
<p>æˆ‘è¿™é‡Œé‡‡ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡Esçš„ <code>Bulk API</code> è¿›è¡Œå¯¼å…¥ã€‚</p>
<p>å‚è€ƒåœ°å€ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html</a></p>
<p>ä½†æ˜¯ <code>Bulk API</code> å¯¹ä¸Šä¼ çš„JSONæ–‡ä»¶å¤§å°ä¹Ÿä¼šæœ‰é™åˆ¶ï¼Œé™åˆ¶ä¸º50Mï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå¯¹JSONæ–‡ä»¶è¿›è¡Œæ‹†åˆ†ï¼Œä¿è¯æ¯ä¸ªå•JSONæ–‡ä»¶ä¸è¶…è¿‡50Mã€‚</p>
<p>æ•´ä½“åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">æ­¥éª¤ä¸€ï¼šå¯¹æ€»CSVæ–‡ä»¶è¿›è¡Œjsonæ ¼å¼åŒ–ï¼Œæ ¼å¼åŒ–ä¸ºæŒ‡å®šçš„jsonæ ¼å¼ï¼Œéœ€è¦ç¬¦åˆBulk APIçš„ä¸Šä¼ è¦æ±‚
</span></span><span class="line"><span class="cl">æ­¥éª¤äºŒï¼šå¯¹jsonæ–‡ä»¶è¿›è¡Œæ‹†åˆ†å­˜å‚¨ï¼Œä¿è¯å•jsonæ–‡ä»¶å¤§å°ä¸è¶…è¿‡50M
</span></span></code></pre></div><h3 id="pyè„šæœ¬">Pyè„šæœ¬</h3>
<p><code>Python</code> ä»£ç å¦‚ä¸‹(test.py)ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">import</span> <span class="nx">csv</span>
</span></span><span class="line"><span class="cl"><span class="nx">from</span> <span class="nx">collections</span> <span class="nx">import</span> <span class="nx">defaultdict</span><span class="p">,</span> <span class="nx">OrderedDict</span>
</span></span><span class="line"><span class="cl"><span class="nx">import</span> <span class="nx">json</span>
</span></span><span class="line"><span class="cl"><span class="nx">import</span> <span class="nx">time</span>
</span></span><span class="line"><span class="cl"><span class="nx">import</span> <span class="nx">argparse</span>
</span></span><span class="line"><span class="cl"><span class="nx">import</span> <span class="nx">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">parser</span> <span class="o">=</span> <span class="nx">argparse</span><span class="o">.</span><span class="nx">ArgumentParser</span><span class="p">(</span><span class="nx">description</span><span class="o">=</span><span class="s1">&#39;è‡ªå®šä¹‰CLIä¼ å‚&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">parser</span><span class="o">.</span><span class="nx">add_argument</span><span class="p">(</span><span class="s1">&#39;--csv_filename&#39;</span><span class="p">,</span> <span class="s1">&#39;-cf&#39;</span><span class="p">,</span> <span class="nx">help</span><span class="o">=</span><span class="s1">&#39;csv_filename é€‰å–æŒ‡å®šCSVæ–‡ä»¶åï¼Œå¿…è¦å‚æ•°&#39;</span><span class="p">,</span> <span class="nx">required</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">parser</span><span class="o">.</span><span class="nx">add_argument</span><span class="p">(</span><span class="s1">&#39;--json_dirname&#39;</span><span class="p">,</span> <span class="s1">&#39;-jd&#39;</span><span class="p">,</span> <span class="nx">help</span><span class="o">=</span><span class="s1">&#39;json_dirname å°†ä½œä¸ºJSONæ–‡ä»¶ç›®å½•åï¼Œå¿…è¦å‚æ•°&#39;</span><span class="p">,</span> <span class="nx">required</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">args</span> <span class="o">=</span> <span class="nx">parser</span><span class="o">.</span><span class="nx">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">start_time</span><span class="o">=</span><span class="nx">time</span><span class="o">.</span><span class="nx">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">csv_filename</span><span class="o">=</span><span class="nx">args</span><span class="o">.</span><span class="nx">csv_filename</span>
</span></span><span class="line"><span class="cl"><span class="nx">csv_filename</span><span class="o">=</span><span class="nx">csv_filename</span><span class="o">.</span><span class="nx">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">json_dirname</span><span class="o">=</span><span class="nx">args</span><span class="o">.</span><span class="nx">json_dirname</span>
</span></span><span class="line"><span class="cl"><span class="nx">json_dirname</span><span class="o">=</span><span class="nx">json_dirname</span><span class="o">.</span><span class="nx">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">i</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="nx">with</span> <span class="nx">open</span><span class="p">(</span><span class="nx">csv_filename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="nx">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nx">csvfile</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">reader</span> <span class="o">=</span> <span class="nx">csv</span><span class="o">.</span><span class="nx">DictReader</span><span class="p">(</span><span class="nx">csvfile</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;CSVè½¬JSONä¸­...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">row</span> <span class="nx">in</span> <span class="nx">reader</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span><span class="o">=</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nx">str1</span><span class="o">=</span><span class="s1">&#39;{&#34;index&#34;: {&#34;_index&#34;: &#34;index_test&#34;, &#34;_type&#34;: &#34;_doc&#34;}}&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">json_str</span> <span class="o">=</span> <span class="nx">json</span><span class="o">.</span><span class="nx">dumps</span><span class="p">(</span><span class="nx">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">json_name</span><span class="o">=</span><span class="nx">str</span><span class="p">(</span><span class="nx">int</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="mi">100000</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">with</span> <span class="nx">open</span><span class="p">(</span><span class="nx">os</span><span class="o">.</span><span class="nx">path</span><span class="o">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">json_dirname</span><span class="p">,</span><span class="nx">json_name</span><span class="p">),</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nx">json_file</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">json_file</span><span class="o">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">str1</span><span class="o">+</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">json_file</span><span class="o">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">json_str</span><span class="o">+</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span><span class="p">(</span><span class="s1">&#39;CSVè½¬JSONå·²å®Œæˆ&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">filePath</span> <span class="o">=</span> <span class="s1">&#39;/yourpath/test/&#39;</span><span class="o">+</span><span class="nx">json_dirname</span>
</span></span><span class="line"><span class="cl"><span class="nx">file_arr</span><span class="o">=</span><span class="nx">os</span><span class="o">.</span><span class="nx">listdir</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">new_file_arr</span><span class="o">=</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nx">file</span> <span class="nx">in</span> <span class="nx">file_arr</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_key</span><span class="o">=</span><span class="nx">file</span><span class="o">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_key</span><span class="o">=</span><span class="nx">file_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">new_file_arr</span><span class="p">[</span><span class="nx">int</span><span class="p">(</span><span class="nx">file_key</span><span class="p">)]</span><span class="o">=</span><span class="nx">file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">new_file_arr</span><span class="o">=</span><span class="nx">sorted</span><span class="p">(</span><span class="nx">new_file_arr</span><span class="o">.</span><span class="nx">keys</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">print</span><span class="p">(</span><span class="s1">&#39;============================æ‰§è¡ŒElasticsearch===============================&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nx">json_num</span> <span class="nx">in</span> <span class="nx">new_file_arr</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;[&#39;</span><span class="o">+</span><span class="nx">str</span><span class="p">(</span><span class="nx">json_num</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.json]å¤„ç†ä¸­...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">curl_cmd</span><span class="o">=</span><span class="s2">&#34;curl -X POST -u name:pwd &#39;http://localhost:9200/_bulk?filter_path=items.*.error?pretty&#39; -H &#39;Content-Type: application/json&#39; --data-binary @/yourpath/test/&#34;</span><span class="o">+</span><span class="nx">json_dirname</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">str</span><span class="p">(</span><span class="nx">json_num</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">tmpres</span> <span class="o">=</span> <span class="nx">os</span><span class="o">.</span><span class="nx">popen</span><span class="p">(</span><span class="nx">curl_cmd</span><span class="p">)</span><span class="o">.</span><span class="nx">readlines</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span><span class="p">(</span><span class="s1">&#39;===========================================================================&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">end_time</span><span class="o">=</span><span class="nx">time</span><span class="o">.</span><span class="nx">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">diff_time</span><span class="o">=</span><span class="nx">end_time</span> <span class="o">-</span> <span class="nx">start_time</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span><span class="p">(</span><span class="s1">&#39;ä¿¡æ¯:ä¸€å…±å¤„ç†[&#39;</span><span class="o">+</span> <span class="nx">str</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;]æ¡è®°å½•.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span><span class="p">(</span><span class="s1">&#39;è€—æ—¶:&#39;</span><span class="o">+</span><span class="nx">str</span><span class="p">(</span><span class="nx">round</span><span class="p">(</span><span class="nx">diff_time</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;ç§’.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">print</span><span class="p">(</span><span class="s1">&#39;Successfulï¼&#39;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="shè„šæœ¬">Shè„šæœ¬</h3>
<p>é…ç½®ä¸€ä¸ªshellè„šæœ¬è¿è¡Œ(test_job.sh)ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">csv_filename</span><span class="o">=</span><span class="nv">$1</span>
</span></span><span class="line"><span class="cl"><span class="nv">json_dirname</span><span class="o">=</span><span class="s2">&#34;test_json_&#34;</span><span class="k">$(</span>date <span class="s2">&#34;+%Y%m%d&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$json_dirname</span>  <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">  mkdir <span class="nv">$json_dirname</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">python3 /yourpath/test/test.py -cf <span class="nv">$csv_filename</span> -jd <span class="nv">$json_dirname</span>
</span></span></code></pre></div><h3 id="åŠŸèƒ½æµ‹è¯•">åŠŸèƒ½æµ‹è¯•</h3>
<p>æµ‹è¯•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt;bash test_job.sh test.csv
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CSVè½¬JSONä¸­...
</span></span><span class="line"><span class="cl"><span class="nv">CSVè½¬JSONå·²å®Œæˆ</span>
</span></span><span class="line"><span class="cl"><span class="o">============================</span><span class="nv">æ‰§è¡ŒElasticsearch</span><span class="o">===============================</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="o">[</span>0.json<span class="o">]</span>å¤„ç†ä¸­...
</span></span><span class="line"><span class="cl">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class="line"><span class="cl">                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class="line"><span class="cl"><span class="m">100</span> 30.5M    <span class="m">0</span>     <span class="m">2</span>  <span class="m">100</span> 30.5M      <span class="m">0</span>  3000k  0:00:10  0:00:10 --:--:--     <span class="m">0</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="o">[</span>1.json<span class="o">]</span>å¤„ç†ä¸­...
</span></span><span class="line"><span class="cl">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class="line"><span class="cl">                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class="line"><span class="cl"><span class="m">100</span> 30.5M    <span class="m">0</span>     <span class="m">2</span>  <span class="m">100</span> 30.5M      <span class="m">0</span>  3399k  0:00:09  0:00:09 --:--:--     <span class="m">0</span>
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="o">[</span>10.json<span class="o">]</span>å¤„ç†ä¸­...
</span></span><span class="line"><span class="cl">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class="line"><span class="cl">                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class="line"><span class="cl"><span class="m">100</span>   <span class="m">322</span>  <span class="m">100</span>     <span class="m">2</span>  <span class="m">100</span>   <span class="m">320</span>    <span class="m">340</span>  <span class="m">54468</span> --:--:-- --:--:-- --:--:-- <span class="nv">64000</span>
</span></span><span class="line"><span class="cl"><span class="o">===========================================================================</span>
</span></span><span class="line"><span class="cl">ä¿¡æ¯:ä¸€å…±å¤„ç†<span class="o">[</span>1000000<span class="o">]</span>æ¡è®°å½•.
</span></span><span class="line"><span class="cl">è€—æ—¶:132.14ç§’.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Successfulï¼
</span></span></code></pre></div><blockquote>
<p>æ³¨æ„ï¼šè¿™é‡Œä¸­æ–‡å¯èƒ½å‡ºç°ç¼–ç ä¸å¯¹ï¼Œæ‰€ä»¥åŠ äº† <code>UTF-8</code>ï¼Œ<code>Python</code> ç‰ˆæœ¬æœ€å¥½å‡çº§åˆ°v3ä»¥ä¸Šï¼Œé¿å…è¸©å‘ã€‚</p>
</blockquote>
<p>å…¶ä»–å‚è€ƒï¼š</p>
<p><a href="https://www.lfhacks.com/tech/python-read-specific-row-csv">https://www.lfhacks.com/tech/python-read-specific-row-csv</a></p>
<p><a href="https://www.lfhacks.com/tech/elasticsearch-bulk-from-excel">https://www.lfhacks.com/tech/elasticsearch-bulk-from-excel</a></p>
]]></content>
		</item>
		
		<item>
			<title>Elasticsearch åœ¨ Laravel ä¸­çš„ä½¿ç”¨ğŸ‘</title>
			<link>https://blog.gookm.cn/posts/2021/20210823-laravel-es/</link>
			<pubDate>Mon, 23 Aug 2021 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2021/20210823-laravel-es/</guid>
			<description>æœ¬æ–‡ç›®æ ‡ å­¦ä¼šåœ¨ Laravel ä¸­å®‰è£… Elasticsearchã€‚ åˆ›å»ºç´¢å¼•ã€‚ ç®€å•æŸ¥è¯¢ã€‚ å®‰è£… composer åŒ… composer require elasticsearch/elasticsearch &amp;#39;~7.0&amp;#39; é…ç½® config/database.php # Elasticsearch Config Info &amp;#39;elasticsearch&amp;#39; =&amp;gt; [ // Elasticsearch æ”¯æŒå¤šå°æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå› æ­¤è¿™é‡Œæ˜¯ä¸€ä¸ªæ•°ç»„ &amp;#39;hosts&amp;#39; =&amp;gt; explode(&amp;#39;,&amp;#39;, env(&amp;#39;ES_HOSTS&amp;#39;)), &amp;#39;username&amp;#39; =&amp;gt; env(&amp;#39;ES_USERNAME&amp;#39;), &amp;#39;password&amp;#39; =&amp;gt; env(&amp;#39;ES_PASSWORD&amp;#39;), ], åˆå§‹åŒ– Elasticsearch å¯¹è±¡ // æ³¨å†Œä¸€ä¸ªåä¸º es çš„å•ä¾‹ $this-&amp;gt;app-&amp;gt;singleton(&amp;#39;es&amp;#39;, function () { // ä»é…ç½®æ–‡ä»¶è¯»å– Elasticsearch æœåŠ¡å™¨åˆ—è¡¨ $builder = ESClientBuilder::create()-&amp;gt;setHosts(config(&amp;#39;database.elasticsearch.hosts&amp;#39;)) -&amp;gt;setBasicAuthentication(config(&amp;#39;database.elasticsearch.username&amp;#39;),config(&amp;#39;database.elasticsearch.password&amp;#39;)); // å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒ if (app()-&amp;gt;environment() === &amp;#39;local&amp;#39;) { // é…ç½®æ—¥å¿—ï¼ŒElasticsearch çš„è¯·æ±‚å’Œè¿”å›æ•°æ®å°†æ‰“å°åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯• $builder-&amp;gt;setLogger(app(&amp;#39;log&amp;#39;)-&amp;gt;driver()); } return $builder-&amp;gt;build(); }); åˆ›å»ºç´¢å¼• curl -XPUT -u name:pwd http://ip:9200/user_behavior?</description>
			<content type="html"><![CDATA[<p><img src="https://qiniu.zkilm.cn/image/aJXCpPH5dKc4Grq0Jg2d3pJjL23P4BnUcPRvTQGm.jpeg" alt="ç®€å•ç”Ÿæ´»ï¼Œçƒ­çˆ±ä¸€åˆ‡ï¼"></p>
<h3 id="æœ¬æ–‡ç›®æ ‡">æœ¬æ–‡ç›®æ ‡</h3>
<ul>
<li>å­¦ä¼šåœ¨ <code>Laravel</code> ä¸­å®‰è£… <code>Elasticsearch</code>ã€‚</li>
<li>åˆ›å»ºç´¢å¼•ã€‚</li>
<li>ç®€å•æŸ¥è¯¢ã€‚</li>
</ul>
<h3 id="å®‰è£…-composer-åŒ…">å®‰è£… <code>composer</code> åŒ…</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require elasticsearch/elasticsearch <span class="s1">&#39;~7.0&#39;</span>
</span></span></code></pre></div><h3 id="é…ç½®-configdatabasephp">é…ç½® <code>config/database.php</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1"># Elasticsearch Config Info
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s1">&#39;elasticsearch&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Elasticsearch æ”¯æŒå¤šå°æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå› æ­¤è¿™é‡Œæ˜¯ä¸€ä¸ªæ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;hosts&#39;</span> <span class="o">=&gt;</span> <span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;ES_HOSTS&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;ES_USERNAME&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;ES_PASSWORD&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><h3 id="åˆå§‹åŒ–-elasticsearch-å¯¹è±¡">åˆå§‹åŒ– <code>Elasticsearch</code> å¯¹è±¡</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// æ³¨å†Œä¸€ä¸ªåä¸º es çš„å•ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä»é…ç½®æ–‡ä»¶è¯»å– Elasticsearch æœåŠ¡å™¨åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$builder</span> <span class="o">=</span> <span class="nx">ESClientBuilder</span><span class="o">::</span><span class="na">create</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">setHosts</span><span class="p">(</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;database.elasticsearch.hosts&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="na">setBasicAuthentication</span><span class="p">(</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;database.elasticsearch.username&#39;</span><span class="p">),</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;database.elasticsearch.password&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;local&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// é…ç½®æ—¥å¿—ï¼ŒElasticsearch çš„è¯·æ±‚å’Œè¿”å›æ•°æ®å°†æ‰“å°åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">setLogger</span><span class="p">(</span><span class="nx">app</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">driver</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><h3 id="åˆ›å»ºç´¢å¼•">åˆ›å»ºç´¢å¼•</h3>
<pre tabindex="0"><code>curl -XPUT -u name:pwd http://ip:9200/user_behavior?pretty
</code></pre><h3 id="åˆ›å»ºç´¢å¼•ç»“æ„">åˆ›å»ºç´¢å¼•ç»“æ„</h3>
<pre tabindex="0"><code>curl -H&#39;Content-Type: application/json&#39;  -XPUT -u name:pwd http://ip:9200/user_behavior/_mapping/?pretty -d&#39;{
  &#34;properties&#34;: {
    &#34;open_id&#34;: { &#34;type&#34;: &#34;text&#34;, &#34;store&#34;:true }, 
    &#34;imp_date&#34;: { &#34;type&#34;: &#34;text&#34;, &#34;store&#34;:true }, 
    &#34;first_login&#34;: { &#34;type&#34;: &#34;text&#34;,&#34;store&#34;:true }
    }
  }
}&#39;
</code></pre><h3 id="æµ‹è¯•å†™å…¥æ•°æ®">æµ‹è¯•å†™å…¥æ•°æ®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">([</span><span class="s1">&#39;index&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_behavior&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;open_id&#39;</span><span class="o">=&gt;</span><span class="nx">md5</span><span class="p">(</span><span class="nx">time</span><span class="p">()),</span><span class="s1">&#39;imp_date&#39;</span><span class="o">=&gt;</span><span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nx">date</span><span class="p">(</span><span class="s1">&#39;Ymd&#39;</span><span class="p">),</span><span class="s1">&#39;first_login&#39;</span><span class="o">=&gt;</span><span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nx">date</span><span class="p">(</span><span class="s1">&#39;Ymd&#39;</span><span class="p">)]])</span>
</span></span></code></pre></div><h3 id="æŸ¥è¯¢æ•°æ®">æŸ¥è¯¢æ•°æ®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$params</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;index&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_behavior&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;_source&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;imp_date&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;query&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;bool&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;range&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;imp_date&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;gte&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;20210120&#39;</span><span class="p">,</span> <span class="s1">&#39;lte&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;20210430&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;size&#39;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//&#39;collapse&#39; =&gt; [&#39;field&#39; =&gt; &#39;open_id&#39;],
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;aggs&#39;</span><span class="o">=&gt;</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/*&#39;my_count&#39;=&gt;[
</span></span></span><span class="line"><span class="cl"><span class="cm">                &#39;value_count&#39;=&gt;[&#39;field&#39; =&gt; &#39;open_id&#39;]
</span></span></span><span class="line"><span class="cl"><span class="cm">            ],*/</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;distinct_open_id&#39;</span><span class="o">=&gt;</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;cardinality&#39;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;open_id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$results</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">search</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$results</span><span class="p">[</span><span class="s1">&#39;aggregations&#39;</span><span class="p">][</span><span class="s1">&#39;distinct_open_id&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
</span></span></code></pre></div><p>å¦å¤–å¯å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.junphp.com/details/325.jsp">https://blog.junphp.com/details/325.jsp</a></p>
]]></content>
		</item>
		
		<item>
			<title>Homestead(ubuntu)&#43;Laravel ä½¿ç”¨ RabbitMQ</title>
			<link>https://blog.gookm.cn/posts/2021/20210121-laravel-rabbitmq/</link>
			<pubDate>Thu, 21 Jan 2021 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2021/20210121-laravel-rabbitmq/</guid>
			<description>å®‰è£… erlang erlang æ˜¯ RabbitMQ çš„ä¾èµ–ã€‚é¦–å…ˆæ‰§è¡Œ sudo apt-get update ç„¶åæ‰§è¡Œ sudo apt-get install erlang å®‰è£…å®Œæ¯•åï¼Œè¾“å…¥ erl æŸ¥çœ‹ erlang ç‰ˆæœ¬ï¼Œå‡ºç°å¦‚ä¸‹æç¤ºåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š Erlang/OTP 20 [erts-9.2] [source] [64-bit] [smp:1:1] [ds:1:1:10] [async-threads:10] [kernel-poll:false] Eshell V9.2 (abort with ^G) 1&amp;gt; ç„¶åé€€å‡º erlang å‘½ä»¤è¡Œï¼šæŒ‰ä¸‹ ctrl+cï¼Œç„¶åè¾“å…¥ a å³å¯ã€‚ å®‰è£… RabbitMq sudo apt-get install rabbitmq-server å®‰è£…å®Œæ¯•åï¼ŒæŸ¥çœ‹ RabbitMQ çŠ¶æ€ï¼š sudo rabbitmqctl status # é™„ï¼š # å¯åŠ¨RabbitMQï¼š service rabbitmq-server start # åœæ­¢RabbitMQï¼š service rabbitmq-server stop # é‡å¯RabbitMQï¼š service rabbitmq-server restart é…ç½® RabbitMQ æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨ RabbitMQ æ’ä»¶ sudo rabbitmq-plugins enable rabbitmq_management æ·»åŠ ç”¨æˆ· RabbitMQï¼Œæ ¼å¼ï¼šrabbitmqctl add_user ç”¨æˆ·å å¯†ç  rabbitmqctl add_user admin admin ç»™äºˆç”¨æˆ·ç®¡ç†å‘˜æƒé™ sudo rabbitmqctl set_user_tags admin administrator ä¸ºç”¨æˆ·è®¾ç½®è¯»å†™æƒé™ sudo rabbitmqctl set_permissions -p / admin &amp;#34;.</description>
			<content type="html"><![CDATA[<h3 id="å®‰è£…-erlang">å®‰è£… erlang</h3>
<ul>
<li><code>erlang</code> æ˜¯ <code>RabbitMQ</code> çš„ä¾èµ–ã€‚é¦–å…ˆæ‰§è¡Œ</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span></code></pre></div><ul>
<li>ç„¶åæ‰§è¡Œ</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install erlang
</span></span></code></pre></div><ul>
<li>å®‰è£…å®Œæ¯•åï¼Œè¾“å…¥ <code>erl</code> æŸ¥çœ‹ <code>erlang</code> ç‰ˆæœ¬ï¼Œå‡ºç°å¦‚ä¸‹æç¤ºåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Erlang/OTP <span class="m">20</span> <span class="o">[</span>erts-9.2<span class="o">]</span> <span class="o">[</span>source<span class="o">]</span> <span class="o">[</span>64-bit<span class="o">]</span> <span class="o">[</span>smp:1:1<span class="o">]</span> <span class="o">[</span>ds:1:1:10<span class="o">]</span> <span class="o">[</span>async-threads:10<span class="o">]</span> <span class="o">[</span>kernel-poll:false<span class="o">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">Eshell V9.2  <span class="o">(</span>abort with ^G<span class="o">)</span>
</span></span><span class="line"><span class="cl">1&gt;
</span></span></code></pre></div><ul>
<li>ç„¶åé€€å‡º <code>erlang</code> å‘½ä»¤è¡Œï¼šæŒ‰ä¸‹ ctrl+cï¼Œç„¶åè¾“å…¥ a å³å¯ã€‚</li>
</ul>
<h3 id="å®‰è£…-rabbitmq">å®‰è£… RabbitMq</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install rabbitmq-server
</span></span></code></pre></div><ul>
<li>å®‰è£…å®Œæ¯•åï¼ŒæŸ¥çœ‹ RabbitMQ çŠ¶æ€ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo rabbitmqctl status
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># é™„ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨RabbitMQï¼š service rabbitmq-server start</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åœæ­¢RabbitMQï¼š service rabbitmq-server stop </span>
</span></span><span class="line"><span class="cl"><span class="c1"># é‡å¯RabbitMQï¼š service rabbitmq-server restart </span>
</span></span></code></pre></div><h3 id="é…ç½®-rabbitmq">é…ç½® RabbitMQ</h3>
<ul>
<li>æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨ <code>RabbitMQ</code> æ’ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo rabbitmq-plugins <span class="nb">enable</span> rabbitmq_management
</span></span></code></pre></div><ul>
<li>æ·»åŠ ç”¨æˆ· <code>RabbitMQ</code>ï¼Œæ ¼å¼ï¼šrabbitmqctl add_user ç”¨æˆ·å å¯†ç </li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">rabbitmqctl add_user admin admin
</span></span></code></pre></div><ul>
<li>ç»™äºˆç”¨æˆ·ç®¡ç†å‘˜æƒé™</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo rabbitmqctl set_user_tags admin administrator
</span></span></code></pre></div><ul>
<li>ä¸ºç”¨æˆ·è®¾ç½®è¯»å†™æƒé™</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo rabbitmqctl set_permissions -p / admin <span class="s2">&#34;.*&#34;</span> <span class="s2">&#34;.*&#34;</span> <span class="s2">&#34;.*&#34;</span>
</span></span></code></pre></div><ul>
<li>æ‰“å¼€ <code>RabbitMQ</code> åå°</li>
</ul>
<pre tabindex="0"><code>æµè§ˆå™¨ä¸­è¾“å…¥ï¼šhttp:// æœåŠ¡å™¨ ip+:15672, ä¾‹å¦‚æˆ‘çš„æ˜¯ï¼š192.168.10.10:15672/
</code></pre><ul>
<li>15672 ç«¯å£é»˜è®¤æ˜¯å…³é—­çš„ï¼Œå› æ­¤éœ€è¦æ‰“å¼€</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1. sudo apt-get install iptables
</span></span><span class="line"><span class="cl">2. sudo iptables -I INPUT -p tcp --dport <span class="m">15672</span> -j ACCEPT
</span></span></code></pre></div><h3 id="è¿è¡Œç¯å¢ƒubuntuå®‰è£…-amqp-æ‰©å±•">è¿è¡Œç¯å¢ƒï¼ˆubuntuï¼‰å®‰è£… amqp æ‰©å±•</h3>
<ul>
<li>è¿™äº›æ‰©å±•æ˜¯è¿è¡Œå¿…é¡»ï¼Œå¯ä»¥ç±»æ¯”ä¸º mongodb,redis æ‰©å±•ã€‚åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get -y install gcc make autoconf libc-dev pkg-config
</span></span><span class="line"><span class="cl">sudo apt-get -y install libssl-dev
</span></span><span class="line"><span class="cl">sudo apt-get -y install librabbitmq-dev
</span></span></code></pre></div><ul>
<li>åœ¨è¿™é‡Œå®‰è£…å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å°é—®é¢˜ï¼Œé‡äº‹ä¸å†³å°±æ‰§è¡Œï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">//æ—¶é—´å¯èƒ½ä¼šéœ€è¦å¾ˆä¹…ï¼Œæˆ‘æ‰§è¡Œç­‰å®ƒè¿è¡Œçš„æ—¶å€™å¤§æ¦‚èŠ±äº†ä¸€ä¸ªå°æ—¶
</span></span><span class="line"><span class="cl">sudo apt-get upgrade
</span></span></code></pre></div><ul>
<li>ä»¥ä¸Šçš„æ‰©å±•å®‰è£…å®Œæˆåæ‰§è¡ŒæŒ‡ä»¤å®‰è£… <code>amqp</code> æ‰©å±•ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo pecl install amqp
</span></span></code></pre></div><ul>
<li>å®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤º</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="m">28</span> <span class="nb">source</span> files, building
</span></span><span class="line"><span class="cl">running: phpize
</span></span><span class="line"><span class="cl">Configuring <span class="k">for</span>:
</span></span><span class="line"><span class="cl">PHP Api Version:         <span class="m">20170718</span>
</span></span><span class="line"><span class="cl">Zend Module Api No:      <span class="m">20170718</span>
</span></span><span class="line"><span class="cl">Zend Extension Api No:   <span class="m">320170718</span>
</span></span><span class="line"><span class="cl">Set the path to librabbitmq install prefix <span class="o">[</span>autodetect<span class="o">]</span> :
</span></span></code></pre></div><ul>
<li>å›è½¦å³å¯ï¼Œç­‰å¾…å®‰è£…å®Œæˆï¼š
<code>You should add &quot;extension=amqp.so&quot; to php.ini</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo -s
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">extension</span><span class="o">=</span>amqp.so &gt;&gt; /etc/php/7.2/cli/php.ini
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">extension</span><span class="o">=</span>amqp.so &gt;&gt; /etc/php/7.2/fpm/php.ini
</span></span><span class="line"><span class="cl">sudo service php7.2-fpm restart
</span></span></code></pre></div><ul>
<li>ç„¶åæ‰§è¡Œ <code>php -m</code> æŸ¥çœ‹æ‰©å±•æ˜¯å¦å®‰è£…å®Œæˆ</li>
</ul>
<h3 id="laravel-é¡¹ç›®ä¸­ä½¿ç”¨">Laravel é¡¹ç›®ä¸­ä½¿ç”¨</h3>
<p>æ·»åŠ  <code>RabbitMQ</code></p>
<table>
<thead>
<tr>
<th>Package Version</th>
<th>Laravel Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>6.0</td>
<td>5.5</td>
</tr>
<tr>
<td>7.0</td>
<td>5.6</td>
</tr>
<tr>
<td>7.1</td>
<td>5.7</td>
</tr>
<tr>
<td>7.2</td>
<td>5.8</td>
</tr>
<tr>
<td>8.0</td>
<td>5.9</td>
</tr>
<tr>
<td>9</td>
<td>6</td>
</tr>
<tr>
<td>10</td>
<td>6.7</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require vladimir-yuldashev/laravel-queue-rabbitmq ^7.1
</span></span></code></pre></div><ul>
<li>åœ¨ <code>app/config/queue.php</code> æ–‡ä»¶ä¸­ï¼Œ<code>connections</code> æ•°ç»„ä¸­æ·»åŠ </li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;rabbitmq&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;driver&#39;</span>                <span class="o">=&gt;</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;host&#39;</span>                  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;port&#39;</span>                  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_PORT&#39;</span><span class="p">,</span> <span class="mi">5672</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;vhost&#39;</span>                 <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_VHOST&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;login&#39;</span>                 <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_LOGIN&#39;</span><span class="p">,</span> <span class="s1">&#39;guest&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;password&#39;</span>              <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;guest&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;queue&#39;</span>                 <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE&#39;</span><span class="p">),</span> <span class="c1">// name of the default queue,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> 
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;exchange_declare&#39;</span>      <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_DECLARE&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="c1">// create the exchange if not exists
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;queue_declare_bind&#39;</span>    <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_DECLARE_BIND&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="c1">// create the queue if not exists and bind to the exchange
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> 
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;queue_params&#39;</span>          <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;passive&#39;</span>           <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_PASSIVE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;durable&#39;</span>           <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_DURABLE&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;exclusive&#39;</span>         <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_EXCLUSIVE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;auto_delete&#39;</span>       <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_AUTODELETE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;exchange_params&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;name&#39;</span>        <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_NAME&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;type&#39;</span>        <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;direct&#39;</span><span class="p">),</span> <span class="c1">// more info at http://www.rabbitmq.com/tutorials/amqp-concepts.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;passive&#39;</span>     <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_PASSIVE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;durable&#39;</span>     <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_DURABLE&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="c1">// the exchange will survive server restarts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;auto_delete&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_AUTODELETE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><ul>
<li>åœ¨ <code>.env</code> ä¸­æ·»åŠ </li>
</ul>
<pre tabindex="0"><code class="language-dotenv" data-lang="dotenv">QUEUE_CONNECTION=rabbitmq #ä¿®æ”¹ä¸€ä¸‹
RABBITMQ_HOST = 127.0.0.1   #è¦è¿æ¥å¾—ä¸»æœºå
RABBITMQ_PORT = 5672  #ç«¯å£
RABBITMQ_VHOST = / 
RABBITMQ_LOGIN = admin #mqç™»å½•å
RABBITMQ_PASSWORD = admin  #mqç™»é™†å¯†ç 
RABBITMQ_QUEUE = test  #mqè¿æ¥å¾—æµ‹è¯•å
</code></pre><ul>
<li>å…¶ä»–å’Œæ­£å¸¸è·‘é˜Ÿåˆ—åŒºåˆ«ä¸å¤§</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan queue:restart
</span></span><span class="line"><span class="cl">php artisan queue:work
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Linuxé˜²ç«å¢™</title>
			<link>https://blog.gookm.cn/posts/2020/20201214-linux-firwall/</link>
			<pubDate>Mon, 14 Dec 2020 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2020/20201214-linux-firwall/</guid>
			<description>iptables é˜²ç«å¢™ 1ã€åŸºæœ¬æ“ä½œ
# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ service iptables status # åœæ­¢é˜²ç«å¢™ service iptables stop # å¯åŠ¨é˜²ç«å¢™ service iptables start # é‡å¯é˜²ç«å¢™ service iptables restart # æ°¸ä¹…å…³é—­é˜²ç«å¢™ chkconfig iptables off # æ°¸ä¹…å…³é—­åé‡å¯ chkconfig iptables on 2ã€å¼€å¯80ç«¯å£
vim /etc/sysconfig/iptables # åŠ å…¥å¦‚ä¸‹ä»£ç  -A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT ä¿å­˜é€€å‡ºåé‡å¯é˜²ç«å¢™
service iptables restart firewall é˜²ç«å¢™ 1ã€æŸ¥çœ‹firewallæœåŠ¡çŠ¶æ€
systemctl status firewalld firewall-cmd --state 2ã€å¼€å¯ã€é‡å¯ã€å…³é—­ã€firewalld.serviceæœåŠ¡
# å¼€å¯ service firewalld start # é‡å¯ service firewalld restart # å…³é—­ service firewalld stop 3ã€æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™</description>
			<content type="html"><![CDATA[<h3 id="iptables-é˜²ç«å¢™">iptables é˜²ç«å¢™</h3>
<p>1ã€åŸºæœ¬æ“ä½œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span>
</span></span><span class="line"><span class="cl">service iptables status  
</span></span><span class="line"><span class="cl"><span class="c1"># åœæ­¢é˜²ç«å¢™</span>
</span></span><span class="line"><span class="cl">service iptables stop  
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨é˜²ç«å¢™</span>
</span></span><span class="line"><span class="cl">service iptables start  
</span></span><span class="line"><span class="cl"><span class="c1"># é‡å¯é˜²ç«å¢™</span>
</span></span><span class="line"><span class="cl">service iptables restart
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æ°¸ä¹…å…³é—­é˜²ç«å¢™</span>
</span></span><span class="line"><span class="cl">chkconfig iptables off  
</span></span><span class="line"><span class="cl"><span class="c1"># æ°¸ä¹…å…³é—­åé‡å¯</span>
</span></span><span class="line"><span class="cl">chkconfig iptables on
</span></span></code></pre></div><p>2ã€å¼€å¯80ç«¯å£</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vim /etc/sysconfig/iptables
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ å…¥å¦‚ä¸‹ä»£ç </span>
</span></span><span class="line"><span class="cl">-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class="m">80</span> -j ACCEPT
</span></span></code></pre></div><p>ä¿å­˜é€€å‡ºåé‡å¯é˜²ç«å¢™</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">service iptables restart
</span></span></code></pre></div><h3 id="firewall-é˜²ç«å¢™">firewall é˜²ç«å¢™</h3>
<p>1ã€æŸ¥çœ‹firewallæœåŠ¡çŠ¶æ€</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl status firewalld
</span></span><span class="line"><span class="cl">firewall-cmd --state
</span></span></code></pre></div><p>2ã€å¼€å¯ã€é‡å¯ã€å…³é—­ã€firewalld.serviceæœåŠ¡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¼€å¯</span>
</span></span><span class="line"><span class="cl">service firewalld start
</span></span><span class="line"><span class="cl"><span class="c1"># é‡å¯</span>
</span></span><span class="line"><span class="cl">service firewalld restart
</span></span><span class="line"><span class="cl"><span class="c1"># å…³é—­</span>
</span></span><span class="line"><span class="cl">service firewalld stop
</span></span></code></pre></div><p>3ã€æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">firewall-cmd --list-all 
</span></span></code></pre></div><p>4ã€æŸ¥è¯¢ã€å¼€æ”¾ã€å…³é—­ç«¯å£</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æŸ¥è¯¢ç«¯å£æ˜¯å¦å¼€æ”¾</span>
</span></span><span class="line"><span class="cl">firewall-cmd --query-port<span class="o">=</span>8080/tcp
</span></span><span class="line"><span class="cl"><span class="c1"># å¼€æ”¾80ç«¯å£</span>
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --add-port<span class="o">=</span>80/tcp
</span></span><span class="line"><span class="cl"><span class="c1"># ç§»é™¤ç«¯å£</span>
</span></span><span class="line"><span class="cl">firewall-cmd --permanent --remove-port<span class="o">=</span>8080/tcp
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#é‡å¯é˜²ç«å¢™(ä¿®æ”¹é…ç½®åè¦é‡å¯é˜²ç«å¢™)</span>
</span></span><span class="line"><span class="cl">firewall-cmd --reload
</span></span><span class="line"><span class="cl"><span class="c1"># å‚æ•°è§£é‡Š</span>
</span></span><span class="line"><span class="cl">1ã€firwall-cmdï¼šæ˜¯Linuxæä¾›çš„æ“ä½œfirewallçš„ä¸€ä¸ªå·¥å…·ï¼›
</span></span><span class="line"><span class="cl">2ã€--permanentï¼šè¡¨ç¤ºè®¾ç½®ä¸ºæŒä¹…ï¼›
</span></span><span class="line"><span class="cl">3ã€--add-portï¼šæ ‡è¯†æ·»åŠ çš„ç«¯å£ï¼›
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Homestead å®‰è£… Swoole æ‰©å±•</title>
			<link>https://blog.gookm.cn/posts/2020/20200906-homestead-swoole/</link>
			<pubDate>Sun, 06 Sep 2020 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2020/20200906-homestead-swoole/</guid>
			<description>é…ç½®é•œåƒæº é…ç½®å¥½ ubuntu çš„å›½å†…é•œåƒæºå¹¶æ›´æ–° å®‰è£… dev æŸ¥çœ‹ php ç‰ˆæœ¬ï¼Œå¹¶å®‰è£…å¯¹åº” php ç‰ˆæœ¬çš„ dev sudo apt install php7.2-dev é…ç½® pecl sudo pecl channel-update pecl.php.net sudo pear clear-cache sudo pear update-channels sudo pear upgrade å®‰è£… swoole æ‰©å±• å®‰è£… php çš„ swoole æ‰©å±• sudo pecl install swoole ä¿®æ”¹ php.ini åœ¨ php.ini ä¸­å¢åŠ  extension=swoole.so php -i | grep php.ini vim /etc/php/7.2/cli/php.ini # åœ¨php.iniçš„å°¾éƒ¨å¢åŠ å¦‚ä¸‹ä»£ç  extension=swoole.so é‡å¯ php # åœ¨php.iniçš„å°¾éƒ¨å¢åŠ å¦‚ä¸‹ä»£ç  extension=swoole.so æŸ¥çœ‹æ˜¯å¦æˆåŠŸå®‰è£… æŸ¥çœ‹ php æ˜¯å¦æˆåŠŸå®‰è£… swoole æ¨¡å— php -m | grep swoole </description>
			<content type="html"><![CDATA[<h3 id="é…ç½®é•œåƒæº">é…ç½®é•œåƒæº</h3>
<ul>
<li>é…ç½®å¥½ <code>ubuntu</code> çš„å›½å†…é•œåƒæºå¹¶æ›´æ–°</li>
</ul>
<h3 id="å®‰è£…-dev">å®‰è£… <code>dev</code></h3>
<ul>
<li>æŸ¥çœ‹ <code>php</code> ç‰ˆæœ¬ï¼Œå¹¶å®‰è£…å¯¹åº” <code>php</code> ç‰ˆæœ¬çš„ <code>dev</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt install php7.2-dev
</span></span></code></pre></div><h3 id="é…ç½®-pecl">é…ç½® <code>pecl</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo pecl channel-update pecl.php.net
</span></span><span class="line"><span class="cl">sudo pear clear-cache
</span></span><span class="line"><span class="cl">sudo pear update-channels
</span></span><span class="line"><span class="cl">sudo pear upgrade
</span></span></code></pre></div><h3 id="å®‰è£…-swoole-æ‰©å±•">å®‰è£… <code>swoole</code> æ‰©å±•</h3>
<ul>
<li>å®‰è£… <code>php</code> çš„ <code>swoole</code> æ‰©å±•</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo pecl install swoole
</span></span></code></pre></div><h3 id="ä¿®æ”¹-phpini">ä¿®æ”¹ <code>php.ini</code></h3>
<ul>
<li>åœ¨ <code>php.ini</code> ä¸­å¢åŠ  <code>extension=swoole.so</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php -i <span class="p">|</span> grep php.ini
</span></span></code></pre></div><ul>
<li><code>vim</code>  <code>/etc/php/7.2/cli/php.ini</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åœ¨php.iniçš„å°¾éƒ¨å¢åŠ å¦‚ä¸‹ä»£ç </span>
</span></span><span class="line"><span class="cl"><span class="nv">extension</span><span class="o">=</span>swoole.so
</span></span></code></pre></div><h3 id="é‡å¯-php">é‡å¯ <code>php</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åœ¨php.iniçš„å°¾éƒ¨å¢åŠ å¦‚ä¸‹ä»£ç </span>
</span></span><span class="line"><span class="cl"><span class="nv">extension</span><span class="o">=</span>swoole.so
</span></span></code></pre></div><h4 id="æŸ¥çœ‹æ˜¯å¦æˆåŠŸå®‰è£…">æŸ¥çœ‹æ˜¯å¦æˆåŠŸå®‰è£…</h4>
<ul>
<li>æŸ¥çœ‹ <code>php</code> æ˜¯å¦æˆåŠŸå®‰è£… <code>swoole</code> æ¨¡å—</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php -m <span class="p">|</span> grep swoole
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Homesteadå®‰è£…Redis</title>
			<link>https://blog.gookm.cn/posts/2020/20200828-homestead-redis/</link>
			<pubDate>Fri, 28 Aug 2020 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2020/20200828-homestead-redis/</guid>
			<description>ä¸‹è½½æœ€æ–°å®‰è£…åŒ… vagrant@homestead:/usr/local/src$ sudo git clone https://github.com/phpredis/phpredis.git Cloning into &amp;#39;phpredis&amp;#39;... remote: Enumerating objects: 41, done. remote: Counting objects: 100% (41/41), done. remote: Compressing objects: 100% (34/34), done. remote: Total 10462 (delta 19), reused 17 (delta 7), pack-reused 10421 Receiving objects: 100% (10462/10462), 6.38 MiB | 31.00 KiB/s, done. Resolving deltas: 100% (7214/7214), done. ä½¿ç”¨ phpize å‘½ä»¤å®Œæˆ php ç¯å¢ƒçš„æ£€æµ‹ vagrant@homestead:/usr/local/src$ cd phpredis/ vagrant@homestead:/usr/local/src/phpredis$ sudo /usr/bin/phpize7.2 #ä¸åŒphpç‰ˆæœ¬çš„æƒ…å†µä¸‹phpizeç‰ˆæœ¬ä¸åŒ Configuring for: PHP Api Version: 20170718 Zend Module Api No: 20170718 Zend Extension Api No: 320180731 vagrant@homestead:/usr/local/src/phpredis$ sudo .</description>
			<content type="html"><![CDATA[<ol>
<li>ä¸‹è½½æœ€æ–°å®‰è£…åŒ…</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vagrant@homestead:/usr/local/src$ sudo git clone https://github.com/phpredis/phpredis.git
</span></span><span class="line"><span class="cl">Cloning into <span class="s1">&#39;phpredis&#39;</span>...
</span></span><span class="line"><span class="cl">remote: Enumerating objects: 41, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Counting objects: 100% <span class="o">(</span>41/41<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Compressing objects: 100% <span class="o">(</span>34/34<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Total <span class="m">10462</span> <span class="o">(</span>delta 19<span class="o">)</span>, reused <span class="m">17</span> <span class="o">(</span>delta 7<span class="o">)</span>, pack-reused <span class="m">10421</span>
</span></span><span class="line"><span class="cl">Receiving objects: 100% <span class="o">(</span>10462/10462<span class="o">)</span>, 6.38 MiB <span class="p">|</span> 31.00 KiB/s, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">Resolving deltas: 100% <span class="o">(</span>7214/7214<span class="o">)</span>, <span class="k">done</span>.
</span></span></code></pre></div><ol start="2">
<li>ä½¿ç”¨  <code>phpize</code> å‘½ä»¤å®Œæˆ <code>php</code> ç¯å¢ƒçš„æ£€æµ‹</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vagrant@homestead:/usr/local/src$ <span class="nb">cd</span> phpredis/
</span></span><span class="line"><span class="cl">vagrant@homestead:/usr/local/src/phpredis$ sudo /usr/bin/phpize7.2 <span class="c1">#ä¸åŒphpç‰ˆæœ¬çš„æƒ…å†µä¸‹phpizeç‰ˆæœ¬ä¸åŒ</span>
</span></span><span class="line"><span class="cl">Configuring <span class="k">for</span>:
</span></span><span class="line"><span class="cl">PHP Api Version:         <span class="m">20170718</span>
</span></span><span class="line"><span class="cl">Zend Module Api No:      <span class="m">20170718</span>
</span></span><span class="line"><span class="cl">Zend Extension Api No:   <span class="m">320180731</span>
</span></span><span class="line"><span class="cl">vagrant@homestead:/usr/local/src/phpredis$ sudo ./configure --with-php-config<span class="o">=</span>/usr/bin/php-config7.2
</span></span></code></pre></div><ol start="3">
<li>ç¼–è¯‘å®‰è£…</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vagrant@homestead:/usr/local/src/phpredis$ sudo make <span class="o">&amp;&amp;</span> make install
</span></span><span class="line"><span class="cl">Build complete.
</span></span><span class="line"><span class="cl">Don<span class="s1">&#39;t forget to run &#39;</span>make test<span class="s1">&#39;.
</span></span></span><span class="line"><span class="cl"><span class="s1">Installing shared extensions:     /usr/lib/php/20170718/
</span></span></span><span class="line"><span class="cl"><span class="s1">Makefile:87: recipe for target &#39;</span>install-modules<span class="err">&#39;</span> failed
</span></span><span class="line"><span class="cl">make: *** <span class="o">[</span>install-modules<span class="o">]</span> Error <span class="m">1</span>
</span></span></code></pre></div><ol start="4">
<li>æŸ¥çœ‹æ‰©å±•</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vagrant@homestead:/usr/local/src/phpredis$ php -i<span class="p">|</span>grep extension_dir
</span></span><span class="line"><span class="cl"><span class="nv">extension_dir</span> <span class="o">=</span>&gt; /usr/lib/php/20170718 <span class="o">=</span>&gt; /usr/lib/php/20170718
</span></span></code></pre></div><ol start="5">
<li>æŠŠ <code>redis.so</code> æ‰©å±•æ¨¡å—ç§»å…¥ <code>PHP</code> æ‰©å±•ç›®å½•ä¸­</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vagrant@homestead:/usr/local/src/phpredis$ sudo mv ./modules/redis.so /usr/lib/php/20170718/
</span></span></code></pre></div><ol start="6">
<li>æ·»åŠ  <code>PHP</code> é…ç½®æ–‡ä»¶çš„ <code>ini</code> æ–‡ä»¶</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">åˆ›å»ºæ–‡ä»¶
</span></span><span class="line"><span class="cl">vagrant@homestead:/usr/local/src/phpredis$ sudo touch /etc/php/7.2/fpm/conf.d/20-redis.ini
</span></span><span class="line"><span class="cl">ä½¿ç”¨viç¼–è¾‘å™¨å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š
</span></span><span class="line"><span class="cl"><span class="nv">extension</span><span class="o">=</span>redis.so
</span></span></code></pre></div><ol start="7">
<li>é‡å¯ <code>php-fpm</code></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vagrant@homestead:/usr/local/src/phpredis$ sudo service php7.2-fpm restart
</span></span></code></pre></div><ol start="8">
<li>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">phpinfo</span><span class="p">();</span>
</span></span></code></pre></div><ul>
<li>å¦‚æœçœ‹åˆ°Redisçš„æ‰©å±•åˆ™å®‰è£…æˆåŠŸ</li>
</ul>
<ol start="9">
<li>ç»ˆç«¯æ— æ³•è¿æ¥ <code>homestead</code> çš„ <code>Reids</code></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1<span class="o">)</span>ä¿®æ”¹redisé…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤è·¯å¾„/etc/redis/redis.confï¼‰
</span></span><span class="line"><span class="cl"><span class="nb">bind</span> 127.0.0.1 ä¿®æ”¹ä¸º <span class="nb">bind</span> 0.0.0.0
</span></span><span class="line"><span class="cl">2<span class="o">)</span>ä¿®æ”¹å®Œé…ç½®åé‡å¯redis
</span></span><span class="line"><span class="cl">æ‰§è¡Œå‘½ä»¤sudo service redis restartåï¼Œä½¿ç”¨redis-cliè®¿é—®redis
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>MySQL è§„çº¦â€</title>
			<link>https://blog.gookm.cn/posts/2020/20200824-mysql-statute/</link>
			<pubDate>Mon, 24 Aug 2020 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2020/20200824-mysql-statute/</guid>
			<description>ä¸€ã€å»ºè¡¨è§„çº¦ 1. ã€å¼ºåˆ¶ã€‘è¡¨è¾¾æ˜¯ä¸å¦æ¦‚å¿µçš„å­—æ®µï¼Œå¿…é¡»ä½¿ç”¨ is_xxx çš„æ–¹å¼å‘½åï¼Œæ•°æ®ç±»å‹æ˜¯ unsigned tinyintï¼ˆ 1 è¡¨ç¤ºæ˜¯ï¼Œ0 è¡¨ç¤ºå¦ï¼‰ï¼Œæ­¤è§„åˆ™åŒæ ·é€‚ç”¨äº odps å»ºè¡¨ã€‚ è¯´æ˜ï¼šä»»ä½•å­—æ®µå¦‚æœä¸ºéè´Ÿæ•°ï¼Œå¿…é¡»æ˜¯ unsignedã€‚ 2. ã€å¼ºåˆ¶ã€‘è¡¨åã€å­—æ®µåå¿…é¡»ä½¿ç”¨å°å†™å­—æ¯æˆ–æ•°å­—ï¼›ç¦æ­¢å‡ºç°æ•°å­—å¼€å¤´ï¼Œç¦æ­¢ä¸¤ä¸ªä¸‹åˆ’çº¿ä¸­é—´åªå‡ºç°æ•°å­—ã€‚æ•°æ®åº“å­—æ®µåçš„ä¿®æ”¹ä»£ä»·å¾ˆå¤§ï¼Œå› ä¸ºæ— æ³•è¿›è¡Œé¢„å‘å¸ƒï¼Œæ‰€ä»¥å­—æ®µåç§°éœ€è¦æ…é‡è€ƒè™‘ã€‚ æ­£ä¾‹ï¼šgetter_adminï¼Œtask_configï¼Œlevel3_name åä¾‹ï¼šGetterAdminï¼ŒtaskConfigï¼Œlevel_3_name 3. ã€å¼ºåˆ¶ã€‘è¡¨åä¸ä½¿ç”¨å¤æ•°åè¯ã€‚ è¯´æ˜ï¼šè¡¨ååº”è¯¥ä»…ä»…è¡¨ç¤ºè¡¨é‡Œé¢çš„å®ä½“å†…å®¹ï¼Œä¸åº”è¯¥è¡¨ç¤ºå®ä½“æ•°é‡ï¼Œå¯¹åº”äº DO ç±»åä¹Ÿæ˜¯å•æ•°å½¢å¼ï¼Œç¬¦åˆè¡¨è¾¾ä¹ æƒ¯ã€‚ 4. ã€å¼ºåˆ¶ã€‘ç¦ç”¨ä¿ç•™å­—ï¼Œå¦‚ descã€rangeã€matchã€delayed ç­‰ï¼Œè¯·å‚è€ƒ MySQL å®˜æ–¹ä¿ç•™å­—ã€‚ 5. ã€å¼ºåˆ¶ã€‘å”¯ä¸€ç´¢å¼•åä¸º ukå­—æ®µåï¼›æ™®é€šç´¢å¼•ååˆ™ä¸º idxå­—æ®µåã€‚ è¯´æ˜ï¼šuk_ å³ unique keyï¼›idx_ å³ index çš„ç®€ç§°ã€‚ 6. ã€å¼ºåˆ¶ã€‘å°æ•°ç±»å‹ä¸º decimalï¼Œç¦æ­¢ä½¿ç”¨ float å’Œ doubleã€‚ è¯´æ˜ï¼šfloat å’Œ double åœ¨å­˜å‚¨çš„æ—¶å€™ï¼Œå­˜åœ¨ç²¾åº¦æŸå¤±çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½åœ¨å€¼çš„æ¯”è¾ƒæ—¶ï¼Œå¾—åˆ°ä¸æ­£ç¡®çš„ç»“æœã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®èŒƒå›´è¶…è¿‡ decimal çš„èŒƒå›´ï¼Œå»ºè®®å°†æ•°æ®æ‹†æˆæ•´æ•°å’Œå°æ•°åˆ†å¼€å­˜å‚¨ã€‚ 7. ã€å¼ºåˆ¶ã€‘å¦‚æœå­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦å‡ ä¹ç›¸ç­‰ï¼Œä½¿ç”¨ char å®šé•¿å­—ç¬¦ä¸²ç±»å‹ã€‚ 8. ã€å¼ºåˆ¶ã€‘varchar æ˜¯å¯å˜é•¿å­—ç¬¦ä¸²ï¼Œä¸é¢„å…ˆåˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé•¿åº¦ä¸è¦è¶…è¿‡ 5000ï¼Œå¦‚æœå­˜å‚¨é•¿åº¦å¤§äºæ­¤å€¼ï¼Œå®šä¹‰å­—æ®µç±»å‹ä¸º textï¼Œç‹¬ç«‹å‡ºæ¥ä¸€å¼ è¡¨ï¼Œç”¨ä¸»é”®æ¥å¯¹åº”ï¼Œé¿å…å½±å“å…¶å®ƒå­—æ®µç´¢å¼•æ•ˆç‡ã€‚ 9. ã€å¼ºåˆ¶ã€‘è¡¨å¿…å¤‡ä¸‰å­—æ®µï¼šid, gmt_create, gmt_modifiedã€‚ è¯´æ˜ï¼šå…¶ä¸­ id å¿…ä¸ºä¸»é”®ï¼Œç±»å‹ä¸º unsigned bigintã€å•è¡¨æ—¶è‡ªå¢ã€æ­¥é•¿ä¸º 1ã€‚gmt_create,gmt_modified çš„ç±»å‹å‡ä¸º date_time ç±»å‹ã€‚ 10.</description>
			<content type="html"><![CDATA[<h3 id="ä¸€å»ºè¡¨è§„çº¦">ä¸€ã€å»ºè¡¨è§„çº¦</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1. ã€å¼ºåˆ¶ã€‘è¡¨è¾¾æ˜¯ä¸å¦æ¦‚å¿µçš„å­—æ®µï¼Œå¿…é¡»ä½¿ç”¨ is_xxx çš„æ–¹å¼å‘½åï¼Œæ•°æ®ç±»å‹æ˜¯ unsigned tinyintï¼ˆ 1 è¡¨ç¤ºæ˜¯ï¼Œ0 è¡¨ç¤ºå¦ï¼‰ï¼Œæ­¤è§„åˆ™åŒæ ·é€‚ç”¨äº odps å»ºè¡¨ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šä»»ä½•å­—æ®µå¦‚æœä¸ºéè´Ÿæ•°ï¼Œå¿…é¡»æ˜¯ unsignedã€‚
</span></span><span class="line"><span class="cl">2. ã€å¼ºåˆ¶ã€‘è¡¨åã€å­—æ®µåå¿…é¡»ä½¿ç”¨å°å†™å­—æ¯æˆ–æ•°å­—ï¼›ç¦æ­¢å‡ºç°æ•°å­—å¼€å¤´ï¼Œç¦æ­¢ä¸¤ä¸ªä¸‹åˆ’çº¿ä¸­é—´åªå‡ºç°æ•°å­—ã€‚æ•°æ®åº“å­—æ®µåçš„ä¿®æ”¹ä»£ä»·å¾ˆå¤§ï¼Œå› ä¸ºæ— æ³•è¿›è¡Œé¢„å‘å¸ƒï¼Œæ‰€ä»¥å­—æ®µåç§°éœ€è¦æ…é‡è€ƒè™‘ã€‚
</span></span><span class="line"><span class="cl">   æ­£ä¾‹ï¼šgetter_adminï¼Œtask_configï¼Œlevel3_name
</span></span><span class="line"><span class="cl">   åä¾‹ï¼šGetterAdminï¼ŒtaskConfigï¼Œlevel_3_name
</span></span><span class="line"><span class="cl">3. ã€å¼ºåˆ¶ã€‘è¡¨åä¸ä½¿ç”¨å¤æ•°åè¯ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šè¡¨ååº”è¯¥ä»…ä»…è¡¨ç¤ºè¡¨é‡Œé¢çš„å®ä½“å†…å®¹ï¼Œä¸åº”è¯¥è¡¨ç¤ºå®ä½“æ•°é‡ï¼Œå¯¹åº”äº DO ç±»åä¹Ÿæ˜¯å•æ•°å½¢å¼ï¼Œç¬¦åˆè¡¨è¾¾ä¹ æƒ¯ã€‚
</span></span><span class="line"><span class="cl">4. ã€å¼ºåˆ¶ã€‘ç¦ç”¨ä¿ç•™å­—ï¼Œå¦‚ descã€rangeã€matchã€delayed ç­‰ï¼Œè¯·å‚è€ƒ MySQL å®˜æ–¹ä¿ç•™å­—ã€‚
</span></span><span class="line"><span class="cl">5. ã€å¼ºåˆ¶ã€‘å”¯ä¸€ç´¢å¼•åä¸º ukå­—æ®µåï¼›æ™®é€šç´¢å¼•ååˆ™ä¸º idxå­—æ®µåã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šuk_ å³ unique keyï¼›idx_ å³ index çš„ç®€ç§°ã€‚
</span></span><span class="line"><span class="cl">6. ã€å¼ºåˆ¶ã€‘å°æ•°ç±»å‹ä¸º decimalï¼Œç¦æ­¢ä½¿ç”¨ float å’Œ doubleã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šfloat å’Œ double åœ¨å­˜å‚¨çš„æ—¶å€™ï¼Œå­˜åœ¨ç²¾åº¦æŸå¤±çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½åœ¨å€¼çš„æ¯”è¾ƒæ—¶ï¼Œå¾—åˆ°ä¸æ­£ç¡®çš„ç»“æœã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®èŒƒå›´è¶…è¿‡ decimal çš„èŒƒå›´ï¼Œå»ºè®®å°†æ•°æ®æ‹†æˆæ•´æ•°å’Œå°æ•°åˆ†å¼€å­˜å‚¨ã€‚
</span></span><span class="line"><span class="cl">7. ã€å¼ºåˆ¶ã€‘å¦‚æœå­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦å‡ ä¹ç›¸ç­‰ï¼Œä½¿ç”¨ char å®šé•¿å­—ç¬¦ä¸²ç±»å‹ã€‚
</span></span><span class="line"><span class="cl">8. ã€å¼ºåˆ¶ã€‘varchar æ˜¯å¯å˜é•¿å­—ç¬¦ä¸²ï¼Œä¸é¢„å…ˆåˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé•¿åº¦ä¸è¦è¶…è¿‡ 5000ï¼Œå¦‚æœå­˜å‚¨é•¿åº¦å¤§äºæ­¤å€¼ï¼Œå®šä¹‰å­—æ®µç±»å‹ä¸º textï¼Œç‹¬ç«‹å‡ºæ¥ä¸€å¼ è¡¨ï¼Œç”¨ä¸»é”®æ¥å¯¹åº”ï¼Œé¿å…å½±å“å…¶å®ƒå­—æ®µç´¢å¼•æ•ˆç‡ã€‚
</span></span><span class="line"><span class="cl">9. ã€å¼ºåˆ¶ã€‘è¡¨å¿…å¤‡ä¸‰å­—æ®µï¼šid, gmt_create, gmt_modifiedã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šå…¶ä¸­ id å¿…ä¸ºä¸»é”®ï¼Œç±»å‹ä¸º unsigned bigintã€å•è¡¨æ—¶è‡ªå¢ã€æ­¥é•¿ä¸º 1ã€‚gmt_create,gmt_modified çš„ç±»å‹å‡ä¸º date_time ç±»å‹ã€‚
</span></span><span class="line"><span class="cl">10. ã€æ¨èã€‘è¡¨çš„å‘½åæœ€å¥½æ˜¯åŠ ä¸Š â€œä¸šåŠ¡åç§°_è¡¨çš„ä½œç”¨â€ã€‚
</span></span><span class="line"><span class="cl">    æ­£ä¾‹ï¼štiger_task /tiger_reader/mpp_config
</span></span><span class="line"><span class="cl">11. ã€æ¨èã€‘åº“åä¸åº”ç”¨åç§°å°½é‡ä¸€è‡´ã€‚
</span></span><span class="line"><span class="cl">12. ã€æ¨èã€‘å¦‚æœä¿®æ”¹å­—æ®µå«ä¹‰æˆ–å¯¹å­—æ®µè¡¨ç¤ºçš„çŠ¶æ€è¿½åŠ æ—¶ï¼Œéœ€è¦åŠæ—¶æ›´æ–°å­—æ®µæ³¨é‡Šã€‚
</span></span><span class="line"><span class="cl">13. ã€æ¨èã€‘å­—æ®µå…è®¸é€‚å½“å†—ä½™ï¼Œä»¥æé«˜æ€§èƒ½ï¼Œä½†æ˜¯å¿…é¡»è€ƒè™‘æ•°æ®åŒæ­¥çš„æƒ…å†µã€‚å†—ä½™å­—æ®µåº”éµå¾ªï¼š
</span></span><span class="line"><span class="cl">    1ï¼‰ä¸æ˜¯é¢‘ç¹ä¿®æ”¹çš„å­—æ®µã€‚
</span></span><span class="line"><span class="cl">    2ï¼‰ä¸æ˜¯ varchar è¶…é•¿å­—æ®µï¼Œæ›´ä¸èƒ½æ˜¯ text å­—æ®µã€‚
</span></span><span class="line"><span class="cl">    æ­£ä¾‹ï¼šå•†å“ç±»ç›®åç§°ä½¿ç”¨é¢‘ç‡é«˜ï¼Œå­—æ®µé•¿åº¦çŸ­ï¼Œåç§°åŸºæœ¬ä¸€æˆä¸å˜ï¼Œå¯åœ¨ç›¸å…³è”çš„è¡¨ä¸­å†—ä½™å­˜å‚¨ç±»ç›®åç§°ï¼Œé¿å…å…³è”æŸ¥è¯¢ã€‚
</span></span><span class="line"><span class="cl">14. ã€æ¨èã€‘å•è¡¨è¡Œæ•°è¶…è¿‡ 500 ä¸‡è¡Œæˆ–è€…å•è¡¨å®¹é‡è¶…è¿‡ 2GBï¼Œæ‰æ¨èè¿›è¡Œåˆ†åº“åˆ†è¡¨ã€‚
</span></span><span class="line"><span class="cl">    è¯´æ˜ï¼šå¦‚æœé¢„è®¡ä¸‰å¹´åçš„æ•°æ®é‡æ ¹æœ¬è¾¾ä¸åˆ°è¿™ä¸ªçº§åˆ«ï¼Œè¯·ä¸è¦åœ¨åˆ›å»ºè¡¨æ—¶å°±åˆ†åº“åˆ†è¡¨ã€‚
</span></span><span class="line"><span class="cl">15. ã€å‚è€ƒã€‘åˆé€‚çš„å­—ç¬¦å­˜å‚¨é•¿åº¦ï¼Œä¸ä½†èŠ‚çº¦æ•°æ®åº“è¡¨ç©ºé—´ã€èŠ‚çº¦ç´¢å¼•å­˜å‚¨ï¼Œæ›´é‡è¦çš„æ˜¯æå‡æ£€ç´¢é€Ÿåº¦ã€‚
</span></span><span class="line"><span class="cl">    æ­£ä¾‹ï¼šäººçš„å¹´é¾„ç”¨ unsigned tinyintï¼ˆè¡¨ç¤ºèŒƒå›´ 0-255ï¼Œäººçš„å¯¿å‘½ä¸ä¼šè¶…è¿‡ 255 å²ï¼‰ï¼›æµ·é¾Ÿå°±å¿…é¡»æ˜¯ smallintï¼Œä½†å¦‚æœæ˜¯å¤ªé˜³çš„å¹´é¾„ï¼Œå°±å¿…é¡»æ˜¯ intï¼›å¦‚æœæ˜¯æ‰€æœ‰æ’æ˜Ÿçš„å¹´é¾„éƒ½åŠ èµ·æ¥ï¼Œé‚£ä¹ˆå°±å¿…é¡»ä½¿ç”¨ bigintã€‚
</span></span></code></pre></div><h3 id="äºŒç´¢å¼•è§„çº¦">äºŒã€ç´¢å¼•è§„çº¦</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1. ã€å¼ºåˆ¶ã€‘ä¸šåŠ¡ä¸Šå…·æœ‰å”¯ä¸€ç‰¹æ€§çš„å­—æ®µï¼Œå³ä½¿æ˜¯ç»„åˆå­—æ®µï¼Œä¹Ÿå¿…é¡»å»ºæˆå”¯ä¸€ç´¢å¼•ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šä¸è¦ä»¥ä¸ºå”¯ä¸€ç´¢å¼•å½±å“äº† insert é€Ÿåº¦ï¼Œè¿™ä¸ªé€Ÿåº¦æŸè€—å¯ä»¥å¿½ç•¥ï¼Œä½†æé«˜æŸ¥æ‰¾é€Ÿåº¦æ˜¯æ˜æ˜¾çš„ï¼›å¦å¤–ï¼Œå³ä½¿åœ¨åº”ç”¨å±‚åšäº†éå¸¸å®Œå–„çš„æ ¡éªŒå’Œæ§åˆ¶ï¼Œåªè¦æ²¡æœ‰å”¯ä¸€ç´¢å¼•ï¼Œæ ¹æ®å¢¨è²å®šå¾‹ï¼Œå¿…ç„¶æœ‰è„æ•°æ®äº§ç”Ÿã€‚
</span></span><span class="line"><span class="cl">2. ã€å¼ºåˆ¶ã€‘ è¶…è¿‡ä¸‰ä¸ªè¡¨ç¦æ­¢ joinã€‚éœ€è¦ join çš„å­—æ®µï¼Œæ•°æ®ç±»å‹ä¿æŒç»å¯¹ä¸€è‡´ï¼›å¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œä¿è¯è¢«å…³è”çš„å­—æ®µéœ€è¦æœ‰ç´¢å¼•ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šå³ä½¿åŒè¡¨ join ä¹Ÿè¦æ³¨æ„è¡¨ç´¢å¼•ã€SQL æ€§èƒ½ã€‚
</span></span><span class="line"><span class="cl">3. ã€å¼ºåˆ¶ã€‘åœ¨ varchar å­—æ®µä¸Šå»ºç«‹ç´¢å¼•æ—¶ï¼Œå¿…é¡»æŒ‡å®šç´¢å¼•é•¿åº¦ï¼Œæ²¡å¿…è¦å¯¹å…¨å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œæ ¹æ®å®é™…æ–‡æœ¬åŒºåˆ†åº¦å†³å®šç´¢å¼•é•¿åº¦ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šç´¢å¼•çš„é•¿åº¦ä¸åŒºåˆ†åº¦æ˜¯ä¸€å¯¹çŸ›ç›¾ä½“ï¼Œä¸€èˆ¬å¯¹å­—ç¬¦ä¸²ç±»å‹æ•°æ®ï¼Œé•¿åº¦ä¸º 20 çš„ç´¢å¼•ï¼ŒåŒºåˆ†åº¦ä¼šé«˜è¾¾ 90% ä»¥ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ count (distinct left (åˆ—åï¼Œç´¢å¼•é•¿åº¦))/count (*) çš„åŒºåˆ†åº¦æ¥ç¡®å®šã€‚
</span></span><span class="line"><span class="cl">4. ã€å¼ºåˆ¶ã€‘é¡µé¢æœç´¢ä¸¥ç¦å·¦æ¨¡ç³Šæˆ–è€…å…¨æ¨¡ç³Šï¼Œå¦‚æœéœ€è¦è¯·èµ°æœç´¢å¼•æ“æ¥è§£å†³ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šç´¢å¼•æ–‡ä»¶å…·æœ‰ B-Tree çš„æœ€å·¦å‰ç¼€åŒ¹é…ç‰¹æ€§ï¼Œå¦‚æœå·¦è¾¹çš„å€¼æœªç¡®å®šï¼Œé‚£ä¹ˆæ— æ³•ä½¿ç”¨æ­¤ç´¢å¼•ã€‚
</span></span><span class="line"><span class="cl">5. ã€æ¨èã€‘å¦‚æœæœ‰ order by çš„åœºæ™¯ï¼Œè¯·æ³¨æ„åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ã€‚order by æœ€åçš„å­—æ®µæ˜¯ç»„åˆç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æ”¾åœ¨ç´¢å¼•ç»„åˆé¡ºåºçš„æœ€åï¼Œé¿å…å‡ºç° file_sort çš„æƒ…å†µï¼Œå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚
</span></span><span class="line"><span class="cl">   æ­£ä¾‹ï¼šwhere a=? and b=? order by c; ç´¢å¼•ï¼ša_b_c åä¾‹ï¼šç´¢å¼•ä¸­æœ‰èŒƒå›´æŸ¥æ‰¾ï¼Œé‚£ä¹ˆç´¢å¼•æœ‰åºæ€§æ— æ³•åˆ©ç”¨ï¼Œå¦‚ï¼šWHERE a&gt;10 ORDER BY b; ç´¢å¼• a_b æ— æ³•æ’åºã€‚
</span></span><span class="line"><span class="cl">6. ã€æ¨èã€‘åˆ©ç”¨è¦†ç›–ç´¢å¼•æ¥è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œæ¥é¿å…å›è¡¨æ“ä½œã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šå¦‚æœä¸€æœ¬ä¹¦éœ€è¦çŸ¥é“ç¬¬ 11 ç« æ˜¯ä»€ä¹ˆæ ‡é¢˜ï¼Œä¼šç¿»å¼€ç¬¬ 11 ç« å¯¹åº”çš„é‚£ä¸€é¡µå—ï¼Ÿç›®å½•æµè§ˆä¸€ä¸‹å°±å¥½ï¼Œè¿™ä¸ªç›®å½•å°±æ˜¯èµ·åˆ°è¦†ç›–ç´¢å¼•çš„ä½œç”¨ã€‚
</span></span><span class="line"><span class="cl">   æ­£ä¾‹ï¼šèƒ½å¤Ÿå»ºç«‹ç´¢å¼•çš„ç§ç±»ï¼šä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ï¼Œè€Œè¦†ç›–ç´¢å¼•æ˜¯ä¸€ç§æŸ¥è¯¢çš„ä¸€ç§æ•ˆæœï¼Œç”¨ explain çš„ç»“æœï¼Œextra åˆ—ä¼šå‡ºç°ï¼šusing indexã€‚
</span></span><span class="line"><span class="cl">7. ã€æ¨èã€‘åˆ©ç”¨å»¶è¿Ÿå…³è”æˆ–è€…å­æŸ¥è¯¢ä¼˜åŒ–è¶…å¤šåˆ†é¡µåœºæ™¯ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šMySQL å¹¶ä¸æ˜¯è·³è¿‡ offset è¡Œï¼Œè€Œæ˜¯å– offset+N è¡Œï¼Œç„¶åè¿”å›æ”¾å¼ƒå‰ offset è¡Œï¼Œè¿”å› N è¡Œï¼Œé‚£å½“ offset ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œæ•ˆç‡å°±éå¸¸çš„ä½ä¸‹ï¼Œè¦ä¹ˆæ§åˆ¶è¿”å›çš„æ€»é¡µæ•°ï¼Œè¦ä¹ˆå¯¹è¶…è¿‡ç‰¹å®šé˜ˆå€¼çš„é¡µæ•°è¿›è¡Œ SQL æ”¹å†™ã€‚
</span></span><span class="line"><span class="cl">   æ­£ä¾‹ï¼šå…ˆå¿«é€Ÿå®šä½éœ€è¦è·å–çš„ id æ®µï¼Œç„¶åå†å…³è”ï¼šSELECT a.* FROM è¡¨ 1 a, (select id from è¡¨ 1 where æ¡ä»¶ LIMIT 100000,20) b where a.id=b.id
</span></span><span class="line"><span class="cl">8. ã€æ¨èã€‘SQL æ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼šè‡³å°‘è¦è¾¾åˆ° range çº§åˆ«ï¼Œè¦æ±‚æ˜¯ ref çº§åˆ«ï¼Œå¦‚æœå¯ä»¥æ˜¯ consts æœ€å¥½ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼š
</span></span><span class="line"><span class="cl">   1ï¼‰consts å•è¡¨ä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªåŒ¹é…è¡Œï¼ˆä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼‰ï¼Œåœ¨ä¼˜åŒ–é˜¶æ®µå³å¯è¯»å–åˆ°æ•°æ®ã€‚
</span></span><span class="line"><span class="cl">   2ï¼‰ref æŒ‡çš„æ˜¯ä½¿ç”¨æ™®é€šçš„ç´¢å¼•ï¼ˆnormal indexï¼‰ã€‚
</span></span><span class="line"><span class="cl">   3ï¼‰range å¯¹ç´¢å¼•è¿›è¡ŒèŒƒå›´æ£€ç´¢ã€‚
</span></span><span class="line"><span class="cl">   åä¾‹ï¼šexplain è¡¨çš„ç»“æœï¼Œtype=indexï¼Œç´¢å¼•ç‰©ç†æ–‡ä»¶å…¨æ‰«á§¿ï¼Œé€Ÿåº¦éå¸¸æ…¢ï¼Œè¿™ä¸ª index çº§åˆ«æ¯”è¾ƒ range è¿˜ä½ï¼Œä¸å…¨è¡¨æ‰«á§¿æ˜¯å°å·«è§å¤§å·«ã€‚
</span></span><span class="line"><span class="cl">9. ã€æ¨èã€‘å»ºç»„åˆç´¢å¼•çš„æ—¶å€™ï¼ŒåŒºåˆ†åº¦æœ€é«˜çš„åœ¨æœ€å·¦è¾¹ã€‚
</span></span><span class="line"><span class="cl">   æ­£ä¾‹ï¼šå¦‚æœ where a=? and b=? ï¼Œa åˆ—çš„å‡ ä¹æ¥è¿‘äºå”¯ä¸€å€¼ï¼Œé‚£ä¹ˆåªéœ€è¦å•å»º idx_a ç´¢å¼•å³å¯ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šå­˜åœ¨éç­‰å·å’Œç­‰å·æ··åˆåˆ¤æ–­æ¡ä»¶æ—¶ï¼Œåœ¨å»ºç´¢å¼•æ—¶ï¼Œè¯·æŠŠç­‰å·æ¡ä»¶çš„åˆ—å‰ç½®ã€‚å¦‚ï¼šwhere a&gt;?and b=? é‚£ä¹ˆå³ä½¿ a çš„åŒºåˆ†åº¦æ›´é«˜ï¼Œä¹Ÿå¿…é¡»æŠŠ b æ”¾åœ¨ç´¢å¼•çš„æœ€å‰åˆ—ã€‚
</span></span><span class="line"><span class="cl">10. ã€å‚è€ƒã€‘åˆ›å»ºç´¢å¼•æ—¶é¿å…æœ‰å¦‚ä¸‹æç«¯è¯¯è§£ï¼š
</span></span><span class="line"><span class="cl">    1ï¼‰è¯¯è®¤ä¸ºä¸€ä¸ªæŸ¥è¯¢å°±éœ€è¦å»ºä¸€ä¸ªç´¢å¼•ã€‚
</span></span><span class="line"><span class="cl">    2ï¼‰è¯¯è®¤ä¸ºç´¢å¼•ä¼šæ¶ˆè€—ç©ºé—´ã€ä¸¥é‡æ‹–æ…¢æ›´æ–°å’Œæ–°å¢é€Ÿåº¦ã€‚
</span></span><span class="line"><span class="cl">    3ï¼‰è¯¯è®¤ä¸ºå”¯ä¸€ç´¢å¼•ä¸€å¾‹éœ€è¦åœ¨åº”ç”¨å±‚é€šè¿‡ â€œå…ˆæŸ¥åæ’â€ æ–¹å¼è§£å†³ã€‚
</span></span></code></pre></div><h3 id="ä¸‰sql-è§„çº¦">ä¸‰ã€SQL è§„çº¦</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1. ã€å¼ºåˆ¶ã€‘ä¸è¦ä½¿ç”¨ count (åˆ—å) æˆ– count (å¸¸é‡) æ¥æ›¿ä»£ count ()ï¼Œcount() å°±æ˜¯ SQL92 å®šä¹‰çš„æ ‡å‡†ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œè·Ÿæ•°æ®åº“æ— å…³ï¼Œè·Ÿ NULL å’Œé NULL æ— å…³ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šcount (*) ä¼šç»Ÿè®¡å€¼ä¸º NULL çš„è¡Œï¼Œè€Œ count (åˆ—å) ä¸ä¼šç»Ÿè®¡æ­¤åˆ—ä¸º NULL å€¼çš„è¡Œã€‚
</span></span><span class="line"><span class="cl">2. ã€å¼ºåˆ¶ã€‘count (distinct col) è®¡ç®—è¯¥åˆ—é™¤ NULL ä¹‹å¤–çš„ä¸é‡å¤æ•°é‡ã€‚æ³¨æ„ count (distinctcol1, col2) å¦‚æœå…¶ä¸­ä¸€åˆ—å…¨ä¸º NULLï¼Œé‚£ä¹ˆå³ä½¿å¦ä¸€åˆ—æœ‰ä¸åŒçš„å€¼ï¼Œä¹Ÿè¿”å›ä¸º 0ã€‚
</span></span><span class="line"><span class="cl">3. ã€å¼ºåˆ¶ã€‘å½“æŸä¸€åˆ—çš„å€¼å…¨æ˜¯ NULL æ—¶ï¼Œcount (col) çš„è¿”å›ç»“æœä¸º 0ï¼Œä½† sum (col) çš„è¿”å›ç»“æœä¸º NULLï¼Œå› æ­¤ä½¿ç”¨ sum () æ—¶éœ€æ³¨æ„ NPE é—®é¢˜ã€‚
</span></span><span class="line"><span class="cl">   æ­£ä¾‹ï¼šå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥é¿å… sum çš„ NPE é—®é¢˜ï¼šSELECT IF (ISNULL (SUM (g)),0,SUM (g)) FROM table;
</span></span><span class="line"><span class="cl">4. ã€å¼ºåˆ¶ã€‘ä½¿ç”¨ ISNULL () æ¥åˆ¤æ–­æ˜¯å¦ä¸º NULL å€¼ã€‚æ³¨æ„ï¼šNULL ä¸ä»»ä½•å€¼çš„ç›´æ¥æ¯”è¾ƒéƒ½ä¸º NULLã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼š
</span></span><span class="line"><span class="cl">   1ï¼‰ NULL&lt;&gt;NULL çš„è¿”å›ç»“æœæ˜¯ NULLï¼Œè€Œä¸æ˜¯ falseã€‚
</span></span><span class="line"><span class="cl">   2ï¼‰ NULL=NULL çš„è¿”å›ç»“æœæ˜¯ NULLï¼Œè€Œä¸æ˜¯ trueã€‚
</span></span><span class="line"><span class="cl">   3ï¼‰ NULL&lt;&gt;1 çš„è¿”å›ç»“æœæ˜¯ NULLï¼Œè€Œä¸æ˜¯ trueã€‚
</span></span><span class="line"><span class="cl">5. ã€å¼ºåˆ¶ã€‘åœ¨ä»£ç ä¸­å†™åˆ†é¡µæŸ¥è¯¢é€»è¾‘æ—¶ï¼Œè‹¥ count ä¸º 0 åº”ç›´æ¥è¿”å›ï¼Œé¿å…æ‰§è¡Œåé¢çš„åˆ†é¡µè¯­å¥ã€‚
</span></span><span class="line"><span class="cl">6. ã€å¼ºåˆ¶ã€‘ä¸å¾—ä½¿ç”¨å¤–é”®ä¸çº§è”ï¼Œä¸€åˆ‡å¤–é”®æ¦‚å¿µå¿…é¡»åœ¨åº”ç”¨å±‚è§£å†³ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šï¼ˆæ¦‚å¿µè§£é‡Šï¼‰å­¦ç”Ÿè¡¨ä¸­çš„ student_id æ˜¯ä¸»é”®ï¼Œé‚£ä¹ˆæˆç»©è¡¨ä¸­çš„ student_id åˆ™ä¸ºå¤–é”®ã€‚å¦‚æœæ›´æ–°å­¦ç”Ÿè¡¨ä¸­çš„ student_idï¼ŒåŒæ—¶è§¦å‘æˆç»©è¡¨ä¸­çš„ student_id æ›´æ–°ï¼Œåˆ™ä¸ºçº§è”æ›´æ–°ã€‚å¤–é”®ä¸çº§è”æ›´æ–°é€‚ç”¨äºå•æœºä½å¹¶å‘ï¼Œä¸é€‚åˆåˆ†å¸ƒå¼ã€é«˜å¹¶å‘é›†ç¾¤ï¼›çº§è”æ›´æ–°æ˜¯å¼ºé˜»å¡ï¼Œå­˜åœ¨æ•°æ®åº“æ›´æ–°é£æš´çš„é£é™©ï¼›å¤–é”®å½±å“æ•°æ®åº“çš„æ’å…¥é€Ÿåº¦ã€‚
</span></span><span class="line"><span class="cl">7. ã€å¼ºåˆ¶ã€‘ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œå­˜å‚¨è¿‡ç¨‹éš¾ä»¥è°ƒè¯•å’Œæ‰©å±•ï¼Œæ›´æ²¡æœ‰ç§»æ¤æ€§ã€‚
</span></span><span class="line"><span class="cl">8. ã€å¼ºåˆ¶ã€‘æ•°æ®è®¢æ­£æ—¶ï¼Œåˆ é™¤å’Œä¿®æ”¹è®°å½•æ—¶ï¼Œè¦å…ˆ selectï¼Œé¿å…å‡ºç°è¯¯åˆ é™¤ï¼Œç¡®è®¤æ— è¯¯æ‰èƒ½æ‰§è¡Œæ›´æ–°è¯­å¥ã€‚
</span></span><span class="line"><span class="cl">9. ã€æ¨èã€‘in æ“ä½œèƒ½é¿å…åˆ™é¿å…ï¼Œè‹¥å®åœ¨é¿å…ä¸äº†ï¼Œéœ€è¦ä»”ç»†è¯„ä¼° in åè¾¹çš„é›†åˆå…ƒç´ æ•°é‡ï¼Œæ§åˆ¶åœ¨ 1000 ä¸ªä¹‹å†…ã€‚
</span></span><span class="line"><span class="cl">10. ã€å‚è€ƒã€‘å¦‚æœæœ‰å…¨çƒåŒ–éœ€è¦ï¼Œæ‰€æœ‰çš„å­—ç¬¦å­˜å‚¨ä¸è¡¨ç¤ºï¼Œå‡ä»¥ utf-8 ç¼–ç ï¼Œé‚£ä¹ˆå­—ç¬¦è®¡æ•°æ–¹æ³•æ³¨æ„ï¼š
</span></span><span class="line"><span class="cl">    è¯´æ˜ï¼š
</span></span><span class="line"><span class="cl">    SELECT LENGTH (â€œè½»æ¾å·¥ä½œâ€)ï¼› è¿”å›ä¸º 12
</span></span><span class="line"><span class="cl">    SELECT CHARACTER_LENGTH (â€œè½»æ¾å·¥ä½œâ€)ï¼› è¿”å›ä¸º 4
</span></span><span class="line"><span class="cl">    å¦‚æœè¦ä½¿ç”¨è¡¨æƒ…ï¼Œé‚£ä¹ˆä½¿ç”¨ utfmb4 æ¥è¿›è¡Œå­˜å‚¨ï¼Œæ³¨æ„å®ƒä¸ utf-8 ç¼–ç çš„åŒºåˆ«ã€‚
</span></span><span class="line"><span class="cl">11. ã€å‚è€ƒã€‘TRUNCATE TABLE æ¯” DELETE é€Ÿåº¦å¿«ï¼Œä¸”ä½¿ç”¨çš„ç³»ç»Ÿå’Œäº‹åŠ¡æ—¥å¿—èµ„æºå°‘ï¼Œä½† TRUNCATE æ— äº‹åŠ¡ä¸”ä¸è§¦å‘ triggerï¼Œæœ‰å¯èƒ½é€ æˆäº‹æ•…ï¼Œæ•…ä¸å»ºè®®åœ¨å¼€å‘ä»£ç ä¸­ä½¿ç”¨æ­¤è¯­å¥ã€‚
</span></span><span class="line"><span class="cl">    è¯´æ˜ï¼šTRUNCATE TABLE åœ¨åŠŸèƒ½ä¸Šä¸ä¸å¸¦ WHERE å­å¥çš„ DELETE è¯­å¥ç›¸åŒã€‚
</span></span></code></pre></div><h3 id="å››orm-è§„çº¦">å››ã€ORM è§„çº¦</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1. ã€å¼ºåˆ¶ã€‘åœ¨è¡¨æŸ¥è¯¢ä¸­ï¼Œä¸€å¾‹ä¸è¦ä½¿ç”¨ * ä½œä¸ºæŸ¥è¯¢çš„å­—æ®µåˆ—è¡¨ï¼Œéœ€è¦å“ªäº›å­—æ®µå¿…é¡»æ˜ç¡®å†™æ˜ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼š1ï¼‰å¢åŠ æŸ¥è¯¢åˆ†æå™¨è§£ææˆæœ¬ã€‚2ï¼‰å¢å‡å­—æ®µå®¹æ˜“ä¸ resultMap é…ç½®ä¸ä¸€è‡´ã€‚
</span></span><span class="line"><span class="cl">2. ã€å¼ºåˆ¶ã€‘POJO ç±»çš„ boolean å±æ€§ä¸èƒ½åŠ  isï¼Œè€Œæ•°æ®åº“å­—æ®µå¿…é¡»åŠ  is_ï¼Œè¦æ±‚åœ¨ resultMap ä¸­è¿›è¡Œå­—æ®µä¸å±æ€§ä¹‹é—´çš„æ˜ å°„ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šå‚è§å®šä¹‰ POJO ç±»ä»¥åŠæ•°æ®åº“å­—æ®µå®šä¹‰è§„å®šï¼Œåœ¨ sql.xml å¢åŠ æ˜ å°„ï¼Œæ˜¯å¿…é¡»çš„ã€‚
</span></span><span class="line"><span class="cl">3. ã€å¼ºåˆ¶ã€‘ä¸è¦ç”¨ resultClass å½“è¿”å›å‚æ•°ï¼Œå³ä½¿æ‰€æœ‰ç±»å±æ€§åä¸æ•°æ®åº“å­—æ®µä¸€ä¸€å¯¹åº”ï¼Œä¹Ÿéœ€è¦å®šä¹‰ï¼›åè¿‡æ¥ï¼Œæ¯ä¸€ä¸ªè¡¨ä¹Ÿå¿…ç„¶æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šé…ç½®æ˜ å°„å…³ç³»ï¼Œä½¿å­—æ®µä¸ DO ç±»è§£è€¦ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚
</span></span><span class="line"><span class="cl">4. ã€å¼ºåˆ¶ã€‘xml é…ç½®ä¸­å‚æ•°æ³¨æ„ä½¿ç”¨ï¼š#{}ï¼Œ#param# ä¸è¦ä½¿ç”¨ ${} æ­¤ç§æ–¹å¼å®¹æ˜“å‡ºç° SQL æ³¨å…¥ã€‚
</span></span><span class="line"><span class="cl">5. ã€å¼ºåˆ¶ã€‘iBATIS è‡ªå¸¦çš„ queryForList (String statementName,int start,int size) ä¸æ¨èä½¿ç”¨ã€‚
</span></span><span class="line"><span class="cl">   è¯´æ˜ï¼šå…¶å®ç°æ–¹å¼æ˜¯åœ¨æ•°æ®åº“å–åˆ° statementName å¯¹åº”çš„ SQL è¯­å¥çš„æ‰€æœ‰è®°å½•ï¼Œå†é€šè¿‡ subList å– start,size çš„å­é›†åˆï¼Œçº¿ä¸Šå› ä¸ºè¿™ä¸ªåŸå› æ›¾ç»å‡ºç°è¿‡ OOMã€‚
</span></span><span class="line"><span class="cl">   æ­£ä¾‹ï¼šåœ¨ sqlmap.xml ä¸­å¼•å…¥ #start#, #size#
</span></span><span class="line"><span class="cl">   Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
</span></span><span class="line"><span class="cl">   map.put(â€œstartâ€, start);
</span></span><span class="line"><span class="cl">   map.put(â€œsizeâ€, size);
</span></span><span class="line"><span class="cl">6. ã€å¼ºåˆ¶ã€‘ä¸å…è®¸ç›´æ¥æ‹¿ HashMap ä¸ Hashtable ä½œä¸ºæŸ¥è¯¢ç»“æœé›†çš„è¾“å‡ºã€‚
</span></span><span class="line"><span class="cl">7. ã€å¼ºåˆ¶ã€‘æ›´æ–°æ•°æ®è¡¨è®°å½•æ—¶ï¼Œå¿…é¡»åŒæ—¶æ›´æ–°è®°å½•å¯¹åº”çš„ gmt_modified å­—æ®µå€¼ä¸ºå½“å‰æ—¶é—´ã€‚
</span></span><span class="line"><span class="cl">8. ã€æ¨èã€‘ä¸è¦å†™ä¸€ä¸ªå¤§è€Œå…¨çš„æ•°æ®æ›´æ–°æ¥å£ï¼Œä¼ å…¥ä¸º POJO ç±»ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯è‡ªå·±çš„ç›®æ ‡æ›´æ–°å­—æ®µï¼Œéƒ½è¿›è¡Œ update table set c1=value1,c2=value2,c3=value3; è¿™æ˜¯ä¸å¯¹çš„ã€‚æ‰§è¡Œ SQL æ—¶ï¼Œå°½é‡ä¸è¦æ›´æ–°æ— æ”¹åŠ¨çš„å­—æ®µï¼Œä¸€æ˜¯æ˜“å‡ºé”™ï¼›äºŒæ˜¯æ•ˆç‡ä½ï¼›ä¸‰æ˜¯ binlog å¢åŠ å­˜å‚¨ã€‚
</span></span><span class="line"><span class="cl">9. ã€å‚è€ƒã€‘@Transactional äº‹åŠ¡ä¸è¦æ»¥ç”¨ã€‚äº‹åŠ¡ä¼šå½±å“æ•°æ®åº“çš„ QPSï¼Œå¦å¤–ä½¿ç”¨äº‹åŠ¡çš„åœ°æ–¹éœ€è¦è€ƒè™‘å„æ–¹é¢çš„å›æ»šæ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç¼“å­˜å›æ»šã€æœç´¢å¼•æ“å›æ»šã€æ¶ˆæ¯è¡¥å¿ã€ç»Ÿè®¡ä¿®æ­£ç­‰ã€‚
</span></span><span class="line"><span class="cl">10. ã€å‚è€ƒã€‘ä¸­çš„ compareValue æ˜¯ä¸å±æ€§å€¼å¯¹æ¯”çš„å¸¸é‡ï¼Œä¸€èˆ¬æ˜¯æ•°å­—ï¼Œè¡¨ç¤ºç›¸ç­‰æ—¶å¸¦ä¸Šæ­¤æ¡ä»¶ï¼›è¡¨ç¤ºä¸ä¸ºç©ºä¸”ä¸ä¸º null æ—¶æ‰§è¡Œï¼›è¡¨ç¤ºä¸ä¸º null å€¼æ—¶æ‰§è¡Œã€‚
</span></span></code></pre></div><blockquote>
<p>è½¬è‡ªé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œï¼Œä¾µåˆ ï½</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>å¾®ä¿¡æ‰«ç  - å…³æ³¨å…¬ä¼—å·åç½‘ç«™è‡ªåŠ¨ç™»å½•</title>
			<link>https://blog.gookm.cn/posts/2020/20200207-wx-scan/</link>
			<pubDate>Fri, 07 Feb 2020 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2020/20200207-wx-scan/</guid>
			<description>å¤§æ¦‚æµç¨‹æ˜¯ï¼šç‚¹å‡»å¾®ä¿¡ç™»å½•ï¼Œç½‘ç«™è‡ªå·±å¼¹å‡ºä¸€ä¸ªäºŒç»´ç ã€æ‰«æäºŒç»´ç åå¼¹å‡ºå…¬ä¼—å·çš„å…³æ³¨ç•Œé¢ã€åªè¦ä¸€å…³æ³¨å…¬ä¼—å·ç½‘ç«™è‡ªåŠ¨ç™»å½•ã€ç¬¬äºŒæ¬¡æ‰«æç™»å½•çš„æ—¶å€™ç½‘ç«™ç›´æ¥ç™»å½•ã€‚è¿™ç§æ‰«ç ç™»å½•çš„æ–¹å¼ä¸ªäººè§‰å¾—éå¸¸åˆ©äºæ¨å¹¿å…¬ä¼—å·ã€‚
å¤§å®¶å¯ä»¥ä½“éªŒä¸€ä¸‹ ã€Œè¿™ç§ç™»å½•æ–¹å¼ã€
å‰æœŸå‡†å¤‡ æœåŠ¡å·ï¼ˆæˆ–è€…å¾®ä¿¡æµ‹è¯•è´¦å·ï¼‰ EasyWeChat æ‰©å±•åŒ… ç†è§£ ç®€å•çš„è§£é‡Šä¸€ä¸‹æ‰«æè¿™ä¸ªå¸¦å‚äºŒç»´ç æœ‰ä»€ä¹ˆä¸åŒï¼š
æ‰«æäºŒç»´ç ï¼Œå¦‚æœç”¨æˆ·è¿˜æœªå…³æ³¨å…¬ä¼—å·ï¼Œåˆ™ç”¨æˆ·å¯ä»¥å…³æ³¨å…¬ä¼—å·ï¼Œå…³æ³¨åå¾®ä¿¡ä¼šå°†å¸¦åœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å€¼ï¼‰å…³æ³¨äº‹ä»¶æ¨é€ç»™å¼€å‘è€…ã€‚ æ‰«æäºŒç»´ç ï¼Œå¦‚æœç”¨æˆ·å·²ç»å…³æ³¨å…¬ä¼—å·ï¼Œåœ¨ç”¨æˆ·æ‰«æåä¼šè‡ªåŠ¨è¿›å…¥ä¼šè¯ï¼Œå¾®ä¿¡ä¹Ÿä¼šå°†å¸¦åœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å€¼ï¼‰æ‰«ç äº‹ä»¶æ¨é€ç»™å¼€å‘è€…ã€‚ æ¢³ç† çœ‹åˆ°è¿™é‡Œç›¸ä¿¡ä½ å·²ç»æ˜ç™½äº†ï¼Œæ¢³ç†ä¸€ä¸‹ï¼š
ç”ŸæˆäºŒç»´ç çš„æ—¶å€™ä½ è‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°åˆ°äºŒç»´ç ä¸­ï¼Œé¡ºä¾¿æŠŠè¿™ä¸ªå‚æ•°ä¼ åˆ°å‰ç«¯é¡µé¢ä¸­ã€‚ å‰ç«¯é¡µé¢æ ¹æ®è¿™ä¸ªå‚æ•°è½®è¯¢ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼ˆä¹Ÿå¯ä½¿ç”¨ socketï¼‰ã€‚ ç”¨æˆ·æ‰«ç å…³æ³¨åä¼šæ¨é€ä¸€ä¸ªå…³æ³¨äº‹ä»¶åˆ°æœåŠ¡ç«¯ï¼Œä¹Ÿä¼šæŠŠè‡ªå®šä¹‰å‚æ•°å¸¦å…¥åˆ°äº‹ä»¶ä¸­ã€‚ æ ¹æ® openid åˆ›å»ºç”¨æˆ·åï¼Œç„¶ååœ¨ Redis ä¸­å­˜å‚¨ Key ä¸ºåœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å‚æ•°ï¼‰ Value ä¸ºç”¨æˆ·åˆ›å»ºåçš„ idã€‚ å‰ç«¯è½®è¯¢æ–¹æ³•ä¸­å¦‚æœåœ¨ Redis ä¸­è·å–åˆ° Id åï¼ŒAuth ç™»é™†ï¼Œé¡µé¢å†é‡è½½ä¸€ä¸‹ï¼Œæµç¨‹å®Œæ¯•ã€‚ è¿˜æœ‰ä¸€ç§æ˜¯ç”¨äºæœ‰è´¦å·çš„ç”¨æˆ·ï¼Œå…ˆè´¦å·å¯†ç ç™»å½•ï¼Œå†æ‰«ç ï¼ˆä½¿ç”¨è¿‡ï¼‰ï¼š
ç”Ÿæˆå¸¦loginå‚æ•°çš„ä¸´æ—¶äºŒç»´ç çš„æ—¶å€™ï¼Œå°†äºŒç»´ç çš„ticketæ›´æ–°åˆ°æ•°æ®åº“è¯¥ç”¨æˆ·ä¸‹ï¼Œé»˜è®¤çŠ¶æ€ä¸ºæœªä½¿ç”¨ ç”¨æˆ·æ‰«ç ï¼Œå¾®ä¿¡ä¼šæ¨é€ä¸€ä¸ªæ‰«ç äº‹ä»¶ï¼Œä¹Ÿä¼šæŠŠè‡ªå®šä¹‰å‚æ•°loginå¸¦åˆ°äº‹ä»¶ä¸­ï¼Œæ”¹å˜äºŒç»´ç çŠ¶æ€ä¸ºå·²ä½¿ç”¨ å‰ç«¯è¿›åˆ°æ‰«ç é¡µé¢çš„åŒæ—¶å°±å¼€å§‹è½®è¯¢æ‰«æç»“æœæ¥å£ï¼ŒçŠ¶æ€ä¸ºå·²ä½¿ç”¨åˆ™æ‰«ç ç™»å½•æˆåŠŸ æœªå…³æ³¨çš„ç”¨æˆ·ï¼Œä¼šå…ˆæ ¹æ®openidè·å–ç”¨æˆ·ä¿¡æ¯å¹¶å†™å…¥æ•°æ®åº“ï¼Œå…³æ³¨è¿‡çš„åˆ™æ•°æ®åº“æœ‰æ•°æ®ï¼Œåšç›¸å…³æ›´æ–°æ“ä½œã€‚ æœ€åé€ä¸ªè‡ªå·±ğŸ’ª
å…¨ä¸–ç•Œå°±ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ä½ ï¼Œè¯·ä¸€å®šï¼šçœŸè¯šåšäººï¼ŒåŠªåŠ›åšäº‹ï¼ä½ æƒ³è¦çš„ï¼Œå²æœˆéƒ½ä¼šç»™ä½ ã€‚</description>
			<content type="html"><![CDATA[<p>å¤§æ¦‚æµç¨‹æ˜¯ï¼šç‚¹å‡»å¾®ä¿¡ç™»å½•ï¼Œç½‘ç«™è‡ªå·±å¼¹å‡ºä¸€ä¸ªäºŒç»´ç ã€æ‰«æäºŒç»´ç åå¼¹å‡ºå…¬ä¼—å·çš„å…³æ³¨ç•Œé¢ã€åªè¦ä¸€å…³æ³¨å…¬ä¼—å·ç½‘ç«™è‡ªåŠ¨ç™»å½•ã€ç¬¬äºŒæ¬¡æ‰«æç™»å½•çš„æ—¶å€™ç½‘ç«™ç›´æ¥ç™»å½•ã€‚è¿™ç§æ‰«ç ç™»å½•çš„æ–¹å¼ä¸ªäººè§‰å¾—éå¸¸åˆ©äºæ¨å¹¿å…¬ä¼—å·ã€‚</p>
<p>å¤§å®¶å¯ä»¥ä½“éªŒä¸€ä¸‹ <a href="http://90sheji.com">ã€Œè¿™ç§ç™»å½•æ–¹å¼ã€</a></p>
<h3 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡</h3>
<ul>
<li>æœåŠ¡å·ï¼ˆæˆ–è€…å¾®ä¿¡æµ‹è¯•è´¦å·ï¼‰</li>
<li>EasyWeChat æ‰©å±•åŒ…</li>
</ul>
<h3 id="ç†è§£">ç†è§£</h3>
<p><strong>ç®€å•çš„è§£é‡Šä¸€ä¸‹æ‰«æè¿™ä¸ªå¸¦å‚äºŒç»´ç æœ‰ä»€ä¹ˆä¸åŒï¼š</strong></p>
<ul>
<li>æ‰«æäºŒç»´ç ï¼Œå¦‚æœç”¨æˆ·è¿˜æœªå…³æ³¨å…¬ä¼—å·ï¼Œåˆ™ç”¨æˆ·å¯ä»¥å…³æ³¨å…¬ä¼—å·ï¼Œå…³æ³¨åå¾®ä¿¡ä¼šå°†å¸¦åœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å€¼ï¼‰å…³æ³¨äº‹ä»¶æ¨é€ç»™å¼€å‘è€…ã€‚</li>
<li>æ‰«æäºŒç»´ç ï¼Œå¦‚æœç”¨æˆ·å·²ç»å…³æ³¨å…¬ä¼—å·ï¼Œåœ¨ç”¨æˆ·æ‰«æåä¼šè‡ªåŠ¨è¿›å…¥ä¼šè¯ï¼Œå¾®ä¿¡ä¹Ÿä¼šå°†å¸¦åœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å€¼ï¼‰æ‰«ç äº‹ä»¶æ¨é€ç»™å¼€å‘è€…ã€‚</li>
</ul>
<h3 id="æ¢³ç†">æ¢³ç†</h3>
<p><strong>çœ‹åˆ°è¿™é‡Œç›¸ä¿¡ä½ å·²ç»æ˜ç™½äº†ï¼Œæ¢³ç†ä¸€ä¸‹ï¼š</strong></p>
<ul>
<li>ç”ŸæˆäºŒç»´ç çš„æ—¶å€™ä½ è‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°åˆ°äºŒç»´ç ä¸­ï¼Œé¡ºä¾¿æŠŠè¿™ä¸ªå‚æ•°ä¼ åˆ°å‰ç«¯é¡µé¢ä¸­ã€‚</li>
<li>å‰ç«¯é¡µé¢æ ¹æ®è¿™ä¸ªå‚æ•°è½®è¯¢ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼ˆä¹Ÿå¯ä½¿ç”¨ socketï¼‰ã€‚</li>
<li>ç”¨æˆ·æ‰«ç å…³æ³¨åä¼šæ¨é€ä¸€ä¸ªå…³æ³¨äº‹ä»¶åˆ°æœåŠ¡ç«¯ï¼Œä¹Ÿä¼šæŠŠè‡ªå®šä¹‰å‚æ•°å¸¦å…¥åˆ°äº‹ä»¶ä¸­ã€‚</li>
<li>æ ¹æ® openid åˆ›å»ºç”¨æˆ·åï¼Œç„¶ååœ¨ Redis ä¸­å­˜å‚¨ Key ä¸ºåœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å‚æ•°ï¼‰ Value ä¸ºç”¨æˆ·åˆ›å»ºåçš„ idã€‚</li>
<li>å‰ç«¯è½®è¯¢æ–¹æ³•ä¸­å¦‚æœåœ¨ Redis ä¸­è·å–åˆ° Id åï¼ŒAuth ç™»é™†ï¼Œé¡µé¢å†é‡è½½ä¸€ä¸‹ï¼Œæµç¨‹å®Œæ¯•ã€‚</li>
</ul>
<p><strong>è¿˜æœ‰ä¸€ç§æ˜¯ç”¨äºæœ‰è´¦å·çš„ç”¨æˆ·ï¼Œå…ˆè´¦å·å¯†ç ç™»å½•ï¼Œå†æ‰«ç ï¼ˆä½¿ç”¨è¿‡ï¼‰ï¼š</strong></p>
<ul>
<li>ç”Ÿæˆå¸¦loginå‚æ•°çš„ä¸´æ—¶äºŒç»´ç çš„æ—¶å€™ï¼Œå°†äºŒç»´ç çš„ticketæ›´æ–°åˆ°æ•°æ®åº“è¯¥ç”¨æˆ·ä¸‹ï¼Œé»˜è®¤çŠ¶æ€ä¸ºæœªä½¿ç”¨</li>
<li>ç”¨æˆ·æ‰«ç ï¼Œå¾®ä¿¡ä¼šæ¨é€ä¸€ä¸ªæ‰«ç äº‹ä»¶ï¼Œä¹Ÿä¼šæŠŠè‡ªå®šä¹‰å‚æ•°loginå¸¦åˆ°äº‹ä»¶ä¸­ï¼Œæ”¹å˜äºŒç»´ç çŠ¶æ€ä¸ºå·²ä½¿ç”¨</li>
<li>å‰ç«¯è¿›åˆ°æ‰«ç é¡µé¢çš„åŒæ—¶å°±å¼€å§‹è½®è¯¢æ‰«æç»“æœæ¥å£ï¼ŒçŠ¶æ€ä¸ºå·²ä½¿ç”¨åˆ™æ‰«ç ç™»å½•æˆåŠŸ</li>
<li>æœªå…³æ³¨çš„ç”¨æˆ·ï¼Œä¼šå…ˆæ ¹æ®openidè·å–ç”¨æˆ·ä¿¡æ¯å¹¶å†™å…¥æ•°æ®åº“ï¼Œå…³æ³¨è¿‡çš„åˆ™æ•°æ®åº“æœ‰æ•°æ®ï¼Œåšç›¸å…³æ›´æ–°æ“ä½œã€‚</li>
</ul>
<p><strong>æœ€åé€ä¸ªè‡ªå·±ğŸ’ª</strong></p>
<blockquote>
<p>å…¨ä¸–ç•Œå°±ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ä½ ï¼Œè¯·ä¸€å®šï¼šçœŸè¯šåšäººï¼ŒåŠªåŠ›åšäº‹ï¼ä½ æƒ³è¦çš„ï¼Œå²æœˆéƒ½ä¼šç»™ä½ ã€‚</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>ä»DockeræŠ˜è…¾åˆ°LaradockğŸŒˆâ€</title>
			<link>https://blog.gookm.cn/posts/2020/20200102-laradock/</link>
			<pubDate>Thu, 02 Jan 2020 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2020/20200102-laradock/</guid>
			<description>ä»€ä¹ˆæ˜¯Dockerï¼Ÿ Docker åœ¨å®¹å™¨çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œäº’è”åˆ°è¿›ç¨‹éš”ç¦»ç­‰ç­‰ï¼Œæå¤§çš„ç®€åŒ–äº†å®¹å™¨çš„åˆ›å»ºå’Œç»´æŠ¤ã€‚ä½¿å¾— Docker æŠ€æœ¯æ¯”è™šæ‹ŸæœºæŠ€æœ¯æ›´ä¸ºè½»ä¾¿ã€å¿«æ·ã€‚
ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Šå†è¿è¡Œæ‰€éœ€åº”ç”¨è¿›ç¨‹ï¼›è€Œå®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ç›´æ¥è¿è¡Œäºå®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨å†…æ²¡æœ‰è‡ªå·±çš„å†…æ ¸ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿã€‚å› æ­¤å®¹å™¨è¦æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚
ä¸ºä»€ä¹ˆè¦ç”¨Dockerï¼Ÿ
æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´ ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ æŒç»­äº¤ä»˜å’Œéƒ¨ç½² æ›´è½»æ¾çš„è¿ç§» æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‰©å±• å¯¹æ¯”è™šæ‹Ÿæœºçš„æ€»ç»“ï¼š
ç‰¹æ€§ å®¹å™¨ è™šæ‹Ÿæœº å¯åŠ¨ ç§’çº§ åˆ†é’Ÿçº§ ç¡¬ç›˜ä½¿ç”¨ ä¸€èˆ¬ä¸º MB ä¸€èˆ¬ä¸º GB æ€§èƒ½ æ¥è¿‘åŸç”Ÿ å¼±äº ç³»ç»Ÿæ”¯æŒé‡ å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨ ä¸€èˆ¬å‡ åä¸ª åŸºæœ¬æ¦‚å¿µï¼š
Docker åŒ…æ‹¬ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ
é•œåƒï¼ˆImageï¼‰ å®¹å™¨ï¼ˆContainerï¼‰ ä»“åº“ï¼ˆRepositoryï¼‰ ç†è§£äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œå°±ç†è§£äº† Docker çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚
Dockeræ–‡æ¡£ç›´é€šè½¦ ğŸ‘
ä»€ä¹ˆæ˜¯Laradockï¼Ÿ ä¸€å¥—å®Œæ•´çš„åŸºäºDockerçš„PHPå¼€å‘ç¯å¢ƒã€‚
åŒ…å«äº†é¢„å…ˆæ‰“åŒ…çš„Dockeré•œåƒï¼Œæ‰€æœ‰é¢„å…ˆé…ç½®éƒ½æ˜¯ä¸ºäº†æä¾›ä¸€ä¸ªå®Œç¾çš„PHPå¼€å‘ç¯å¢ƒã€‚
Laradockæ˜¯åœ¨laravelç¤¾åŒºä¼—æ‰€å‘¨çŸ¥çš„ï¼Œå› ä¸ºè¿™ä¸ªé¡¹ç›®æœ€å¼€å§‹åªå…³æ³¨åœ¨Dockerä¸Šè¿è¡Œçš„laravelé¡¹ç›®ã€‚åæ¥ï¼Œç”±äºPHPç¤¾åŒºçš„å¤§é‡ä½¿ç”¨ï¼Œå®ƒå¼€å§‹æ”¯æŒæ¯”å¦‚Symfonyã€CodeIgniterã€WordPressã€Drupalç­‰å…¶ä»–çš„PHPé¡¹ç›®ã€‚
Laradockç›´é€šè½¦ â¤
å®‰è£…ï¼ˆCentOS å®‰è£… Docker CEï¼‰ï¼š 1.å¸è½½æ—§ç‰ˆæœ¬ æ—§ç‰ˆæœ¬çš„ Docker ç§°ä¸º docker æˆ–è€… docker-engineï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¸è½½æ—§ç‰ˆæœ¬ï¼š $ sudo yum remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest \ docker-latest-logrotate \ docker-logrotate \ docker-selinux \ docker-engine-selinux \ docker-engine 2.</description>
			<content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯docker">ä»€ä¹ˆæ˜¯Dockerï¼Ÿ</h3>
<blockquote>
<p>Docker åœ¨å®¹å™¨çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œäº’è”åˆ°è¿›ç¨‹éš”ç¦»ç­‰ç­‰ï¼Œæå¤§çš„ç®€åŒ–äº†å®¹å™¨çš„åˆ›å»ºå’Œç»´æŠ¤ã€‚ä½¿å¾— Docker æŠ€æœ¯æ¯”è™šæ‹ŸæœºæŠ€æœ¯æ›´ä¸ºè½»ä¾¿ã€å¿«æ·ã€‚</p>
<p>ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Šå†è¿è¡Œæ‰€éœ€åº”ç”¨è¿›ç¨‹ï¼›è€Œå®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ç›´æ¥è¿è¡Œäºå®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨å†…æ²¡æœ‰è‡ªå·±çš„å†…æ ¸ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿã€‚å› æ­¤å®¹å™¨è¦æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆè¦ç”¨Dockerï¼Ÿ</p>
<ul>
<li>æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº</li>
<li>æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´</li>
<li>ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ</li>
<li>æŒç»­äº¤ä»˜å’Œéƒ¨ç½²</li>
<li>æ›´è½»æ¾çš„è¿ç§»</li>
<li>æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‰©å±•</li>
</ul>
<p>å¯¹æ¯”è™šæ‹Ÿæœºçš„æ€»ç»“ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>å®¹å™¨</th>
<th>è™šæ‹Ÿæœº</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯åŠ¨</td>
<td>ç§’çº§</td>
<td>åˆ†é’Ÿçº§</td>
</tr>
<tr>
<td>ç¡¬ç›˜ä½¿ç”¨</td>
<td>ä¸€èˆ¬ä¸º MB</td>
<td>ä¸€èˆ¬ä¸º GB</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>æ¥è¿‘åŸç”Ÿ</td>
<td>å¼±äº</td>
</tr>
<tr>
<td>ç³»ç»Ÿæ”¯æŒé‡</td>
<td>å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨</td>
<td>ä¸€èˆ¬å‡ åä¸ª</td>
</tr>
</tbody>
</table>
<p>åŸºæœ¬æ¦‚å¿µï¼š</p>
<blockquote>
<p>Docker åŒ…æ‹¬ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ</p>
<ul>
<li>é•œåƒï¼ˆImageï¼‰</li>
<li>å®¹å™¨ï¼ˆContainerï¼‰</li>
<li>ä»“åº“ï¼ˆRepositoryï¼‰</li>
</ul>
<p>ç†è§£äº†è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œå°±ç†è§£äº† Docker çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p>
</blockquote>
<p><a href="https://yeasy.gitbooks.io/docker_practice/introduction/">Dockeræ–‡æ¡£ç›´é€šè½¦</a> ğŸ‘</p>
<h3 id="ä»€ä¹ˆæ˜¯laradock">ä»€ä¹ˆæ˜¯Laradockï¼Ÿ</h3>
<blockquote>
<p>ä¸€å¥—å®Œæ•´çš„åŸºäºDockerçš„PHPå¼€å‘ç¯å¢ƒã€‚</p>
<p>åŒ…å«äº†é¢„å…ˆæ‰“åŒ…çš„Dockeré•œåƒï¼Œæ‰€æœ‰é¢„å…ˆé…ç½®éƒ½æ˜¯ä¸ºäº†æä¾›ä¸€ä¸ªå®Œç¾çš„PHPå¼€å‘ç¯å¢ƒã€‚</p>
<p>Laradockæ˜¯åœ¨laravelç¤¾åŒºä¼—æ‰€å‘¨çŸ¥çš„ï¼Œå› ä¸ºè¿™ä¸ªé¡¹ç›®æœ€å¼€å§‹åªå…³æ³¨åœ¨Dockerä¸Šè¿è¡Œçš„laravelé¡¹ç›®ã€‚åæ¥ï¼Œç”±äºPHPç¤¾åŒºçš„å¤§é‡ä½¿ç”¨ï¼Œå®ƒå¼€å§‹æ”¯æŒæ¯”å¦‚Symfonyã€CodeIgniterã€WordPressã€Drupalç­‰å…¶ä»–çš„PHPé¡¹ç›®ã€‚</p>
</blockquote>
<p><a href="https://laradock-docs.linganmin.cn/">Laradockç›´é€šè½¦</a> â¤</p>
<ul>
<li>å®‰è£…ï¼ˆCentOS å®‰è£… Docker CEï¼‰ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.å¸è½½æ—§ç‰ˆæœ¬
</span></span><span class="line"><span class="cl">æ—§ç‰ˆæœ¬çš„ Docker ç§°ä¸º docker æˆ–è€… docker-engineï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¸è½½æ—§ç‰ˆæœ¬ï¼š
</span></span><span class="line"><span class="cl">$ sudo yum remove docker \
</span></span><span class="line"><span class="cl">                  docker-client \
</span></span><span class="line"><span class="cl">                  docker-client-latest \
</span></span><span class="line"><span class="cl">                  docker-common \
</span></span><span class="line"><span class="cl">                  docker-latest \
</span></span><span class="line"><span class="cl">                  docker-latest-logrotate \
</span></span><span class="line"><span class="cl">                  docker-logrotate \
</span></span><span class="line"><span class="cl">                  docker-selinux \
</span></span><span class="line"><span class="cl">                  docker-engine-selinux \
</span></span><span class="line"><span class="cl">                  docker-engine
</span></span><span class="line"><span class="cl">                  
</span></span><span class="line"><span class="cl">2.ä½¿ç”¨ yum å®‰è£…
</span></span><span class="line"><span class="cl">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–åŒ…ï¼š
</span></span><span class="line"><span class="cl">$ sudo yum install -y yum-utils \
</span></span><span class="line"><span class="cl">           device-mapper-persistent-data \
</span></span><span class="line"><span class="cl">           lvm2
</span></span><span class="line"><span class="cl">é‰´äºå›½å†…ç½‘ç»œé—®é¢˜ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨å›½å†…æºï¼Œå®˜æ–¹æºè¯·åœ¨æ³¨é‡Šä¸­æŸ¥çœ‹ã€‚
</span></span><span class="line"><span class="cl">æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ·»åŠ  yum è½¯ä»¶æºï¼š    
</span></span><span class="line"><span class="cl">$ sudo yum-config-manager \
</span></span><span class="line"><span class="cl">    --add-repo \
</span></span><span class="line"><span class="cl">    https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo
</span></span><span class="line"><span class="cl"># å®˜æ–¹æº
</span></span><span class="line"><span class="cl"># $ sudo yum-config-manager \
</span></span><span class="line"><span class="cl">#     --add-repo \
</span></span><span class="line"><span class="cl">#     https://download.docker.com/linux/centos/docker-ce.repo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.å®‰è£… Docker CE
</span></span><span class="line"><span class="cl">æ›´æ–° yum è½¯ä»¶æºç¼“å­˜ï¼Œå¹¶å®‰è£… docker-ceã€‚
</span></span><span class="line"><span class="cl">$ sudo yum makecache fast
</span></span><span class="line"><span class="cl">$ sudo yum install docker-ce
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.å¯åŠ¨ Docker CE
</span></span><span class="line"><span class="cl">$ sudo systemctl enable docker
</span></span><span class="line"><span class="cl">$ sudo systemctl start docker
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5.å»ºç«‹ docker ç”¨æˆ·ç»„
</span></span><span class="line"><span class="cl">å»ºç«‹ docker ç»„ï¼š$ sudo groupadd docker
</span></span><span class="line"><span class="cl">å°†å½“å‰ç”¨æˆ·åŠ å…¥ docker ç»„ï¼š$ sudo usermod -aG docker $USER
</span></span><span class="line"><span class="cl">é€€å‡ºå½“å‰ç»ˆç«¯å¹¶é‡æ–°ç™»å½•ï¼Œè¿›è¡Œå¦‚ä¸‹æµ‹è¯•ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6.æµ‹è¯• Docker æ˜¯å¦å®‰è£…æ­£ç¡®
</span></span><span class="line"><span class="cl">$ docker run hello-world
</span></span><span class="line"><span class="cl">è‹¥èƒ½æ­£å¸¸è¾“å‡ºä»¥ä¸Šä¿¡æ¯ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">7.é•œåƒåŠ é€Ÿå™¨
</span></span><span class="line"><span class="cl">è¯·åœ¨ /etc/docker/daemon.json ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹:
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;registry-mirrors&#34;: [
</span></span><span class="line"><span class="cl">    &#34;https://dockerhub.azk8s.cn&#34;,
</span></span><span class="line"><span class="cl">    &#34;https://hub-mirror.c.163.com&#34;
</span></span><span class="line"><span class="cl">  ]
</span></span><span class="line"><span class="cl">}æˆ–
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;registry-mirrors&#34;: [
</span></span><span class="line"><span class="cl">       &#34;https://registry.docker-cn.com&#34;
</span></span><span class="line"><span class="cl">  ]
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">ä¹‹åé‡æ–°å¯åŠ¨æœåŠ¡ã€‚
</span></span><span class="line"><span class="cl">$ sudo systemctl daemon-reload
</span></span><span class="line"><span class="cl">$ sudo systemctl restart docker
</span></span><span class="line"><span class="cl">æ£€æŸ¥åŠ é€Ÿå™¨æ˜¯å¦ç”Ÿæ•ˆ
</span></span><span class="line"><span class="cl">æ‰§è¡Œ $ docker infoï¼Œå¦‚æœä»ç»“æœä¸­çœ‹åˆ°äº†å¦‚ä¸‹å†…å®¹ï¼Œè¯´æ˜é…ç½®æˆåŠŸã€‚
</span></span><span class="line"><span class="cl">Registry Mirrors:
</span></span><span class="line"><span class="cl"> https://dockerhub.azk8s.cn/
</span></span></code></pre></div><ul>
<li>å®‰è£…Laradockï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.å°† repository å…‹éš†åˆ°ä½ æœºå™¨çš„ä»»æ„ä½ç½®:
</span></span><span class="line"><span class="cl">git clone https://github.com/laradock/laradock.git
</span></span><span class="line"><span class="cl">æ–‡ä»¶å¤¹ç»“æ„å¦‚ä¸‹
</span></span><span class="line"><span class="cl">+laradock
</span></span><span class="line"><span class="cl">+zkproject
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.è¿›å…¥ laradock æ–‡ä»¶å¤¹å¹¶å¤åˆ¶ env-example to .env
</span></span><span class="line"><span class="cl">cp env-example .env
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3. åœ¨é¡¶éƒ¨ï¼Œä¿®æ”¹ APP_CODE_PATH_HOST å˜é‡ä¸ºä½ çš„é¡¹ç›®è·¯å¾„.
</span></span><span class="line"><span class="cl">APP_CODE_PATH_HOST=../zkproject
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.è¿è¡Œ docker-compose æ¥æ„å»ºç¯å¢ƒ
</span></span><span class="line"><span class="cl">docker-compose up -d nginx php-fpm mysql workspace
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5.è¿›å…¥ Workspace å®¹å™¨ï¼Œæ‰§è¡Œæ¯”å¦‚ (Artisan, Composer, PHPUnit, Gulp, ...) ç­‰å‘½ä»¤
</span></span><span class="line"><span class="cl">docker-compose exec workspace bash
</span></span><span class="line"><span class="cl">å¯ä»¥çœ‹åˆ° /var/www ç›®å½•å°±æ˜¯ test æ˜ å°„æ¥çš„ã€‚å†å»æ‰¾ nginx é…ç½®æ–‡ä»¶ï¼Œåœ¨ laradock/nginx/sites é‡Œå¯ä»¥çœ‹åˆ°æœ‰å‡ ä¸ªæ ·æœ¬æ–‡ä»¶ï¼Œä¸€ä¸ª default.conf æ–‡ä»¶ï¼Œdefault æ–‡ä»¶çš„ root é»˜è®¤æ˜¯ /var/www/publicã€‚æ‰€ä»¥ï¼Œå¯ä»¥çœ‹å‡ºæƒ³é…ç½®å¤šä¸ªé¡¹ç›®çš„è¯ï¼Œä¿®æ”¹ nginx é…ç½®æ–‡ä»¶åŠå¯¹åº”çš„æ–‡ä»¶ç»“æ„å³å¯ã€‚
</span></span><span class="line"><span class="cl">+laradock
</span></span><span class="line"><span class="cl">+zkproject
</span></span><span class="line"><span class="cl">++project_one
</span></span><span class="line"><span class="cl">++project_two
</span></span><span class="line"><span class="cl">è¿™æ˜¯æˆ‘çš„ç›®å½•ç»“æ„ï¼Œé…ç½®å¥½åè®°å¾—æŠŠæœ¬æœº hosts ä¿®æ”¹ä¸‹ã€‚ç„¶åé‡å¯ docker å³å¯ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6.navicatè¿æ¥mysql
</span></span><span class="line"><span class="cl">docker-compose exec mysql bash
</span></span><span class="line"><span class="cl">mysql -uroot -proot
</span></span><span class="line"><span class="cl">ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;
</span></span><span class="line"><span class="cl">ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;
</span></span><span class="line"><span class="cl">FLUSH PRIVILEGES;
</span></span><span class="line"><span class="cl">æ‰“å¼€Laravelé¡¹ç›®ä¸­çš„.env æ–‡ä»¶å¹¶è®¾ç½®ï¼š
</span></span><span class="line"><span class="cl">DB_HOST=mysql (ç”¨ 127.0.0.1 è®¿é—®çš„æ˜¯ php å®¹å™¨ï¼Œphp å®¹å™¨é‡Œæ²¡æœ‰ mysql )
</span></span><span class="line"><span class="cl">REDIS_HOST=redis
</span></span></code></pre></div><h3 id="å¸¸ç”¨çš„éƒ¨åˆ†å‘½ä»¤">å¸¸ç”¨çš„éƒ¨åˆ†å‘½ä»¤</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">systemctl start docker
</span></span><span class="line"><span class="cl">systemctl stop docker
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker images
</span></span><span class="line"><span class="cl">docker rmi ID
</span></span><span class="line"><span class="cl">docker ps -a
</span></span><span class="line"><span class="cl">docker container ls -a
</span></span><span class="line"><span class="cl">docker rm -f ID
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">docker rm -f `docker ps -a -q`
</span></span><span class="line"><span class="cl">docker rmi `docker images -q`
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker-compose up -d nginx php-fpm mysql workspace
</span></span><span class="line"><span class="cl">docker-compose exec workspace bash
</span></span><span class="line"><span class="cl">docker-compose exec mysql bash
</span></span><span class="line"><span class="cl">mysql -uroot -proot
</span></span></code></pre></div><p>æœ€åé€ç»™è‡ªå·± ğŸ’ª</p>
<blockquote>
<p>å¤±å»çš„ä¸å†æ¥ï¼Œä¸èƒ½æ”¾å¼ƒ</p>
<p>é‚£ä¾¿ç»§ç»­å‘ç€æœªæ¥å‰è¿›</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>å¤šå…¬ä¼—å·ç®¡ç†ğŸš¥â€</title>
			<link>https://blog.gookm.cn/posts/2019/20191216-multiple-mp/</link>
			<pubDate>Mon, 16 Dec 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20191216-multiple-mp/</guid>
			<description>ä½¿ç”¨ EasyWechat æ‰©å±•åŒ…è¿›è¡Œå¤šå…¬ä¼—å·ç®¡ç†ï¼Œå…·ä½“æ­¥éª¤åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š
æ–°å»ºå…¬ä¼—å·æ•°æ®è¡¨ åˆ›å»ºè¾…åŠ©å‡½æ•° åˆ›å»ºå¾®ä¿¡æ§åˆ¶å™¨ é…ç½®è·¯ç”± è®¾ç½®è·¯ç”±å¿½ç•¥ å¼€å§‹ä½¿ç”¨ å…¬ä¼—å·æ•°æ®è¡¨ åˆ›å»ºæ¨¡å‹ php artisan make:model Models/WechatMp -m //wechat_mps åœ¨ç”Ÿæˆçš„ wechat_mps çš„ migration æ–‡ä»¶é‡Œå†™å…¥å¾®ä¿¡ç›¸å…³æ•°æ®å­—æ®µï¼š public function up() { Schema::create(&amp;#39;wechats&amp;#39;, function (Blueprint $table) { $table-&amp;gt;increments(&amp;#39;id&amp;#39;); //å¾®ä¿¡å…¬ä¼—å·åŸºæœ¬å‚æ•° $table-&amp;gt;string(&amp;#39;user_id&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;name&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;type&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;status&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;logo&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;is_use&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;is_connect&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;wechat_app_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡å…¬ä¼—å·è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;wechat_secret&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;wechat_token&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;wechat_aes_key&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;pay_mch_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡æ”¯ä»˜è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;pay_api_key&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;pay_cert_path&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;pay_key_path&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;op_app_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡å¼€æ”¾å¹³å°è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;op_secret&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;op_token&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;op_aes_key&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;work_corp_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡ä¼ä¸šå·è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;work_agent_id&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;work_secret&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;timestamps(); }); } åˆ›å»ºè¾…åŠ©å‡½æ•° æ¥ä¸‹æ¥åœ¨ App\Handlers åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•° WechatConfigHandler.php æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š &amp;lt;?php namespace App\Handlers; use App\Models\WechatMp; use EasyWeChat\Factory; class WechatConfigHandler { //[1-1]å¾®ä¿¡å…¬ä¼—å·è®¾ç½® public function app_config($account) { $wechat = WechatMp::where(&amp;#39;id&amp;#39;,$account)-&amp;gt;first(); if (!</description>
			<content type="html"><![CDATA[<p>ä½¿ç”¨ EasyWechat æ‰©å±•åŒ…è¿›è¡Œå¤šå…¬ä¼—å·ç®¡ç†ï¼Œå…·ä½“æ­¥éª¤åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>æ–°å»ºå…¬ä¼—å·æ•°æ®è¡¨</li>
<li>åˆ›å»ºè¾…åŠ©å‡½æ•°</li>
<li>åˆ›å»ºå¾®ä¿¡æ§åˆ¶å™¨</li>
<li>é…ç½®è·¯ç”±</li>
<li>è®¾ç½®è·¯ç”±å¿½ç•¥</li>
<li>å¼€å§‹ä½¿ç”¨</li>
</ol>
<h3 id="å…¬ä¼—å·æ•°æ®è¡¨">å…¬ä¼—å·æ•°æ®è¡¨</h3>
<ul>
<li>åˆ›å»ºæ¨¡å‹</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:model Models/WechatMp -m  //wechat_mps
</span></span></code></pre></div><ul>
<li>åœ¨ç”Ÿæˆçš„ <code>wechat_mps</code> çš„ <code>migration</code> æ–‡ä»¶é‡Œå†™å…¥å¾®ä¿¡ç›¸å…³æ•°æ®å­—æ®µï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;wechats&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>   <span class="c1">//å¾®ä¿¡å…¬ä¼—å·åŸºæœ¬å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;logo&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;is_use&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;is_connect&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_app_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span> <span class="c1">//å¾®ä¿¡å…¬ä¼—å·è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_token&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_aes_key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_mch_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>  <span class="c1">//å¾®ä¿¡æ”¯ä»˜è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_api_key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_cert_path&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_key_path&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_app_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>  <span class="c1">//å¾®ä¿¡å¼€æ”¾å¹³å°è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_token&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_aes_key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;work_corp_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>  <span class="c1">//å¾®ä¿¡ä¼ä¸šå·è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;work_agent_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;work_secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="åˆ›å»ºè¾…åŠ©å‡½æ•°">åˆ›å»ºè¾…åŠ©å‡½æ•°</h3>
<ul>
<li>æ¥ä¸‹æ¥åœ¨ <code>App\Handlers</code> åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•° <code>WechatConfigHandler.php</code> æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Handlers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\WechatMp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">EasyWeChat\Factory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WechatConfigHandler</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//[1-1]å¾®ä¿¡å…¬ä¼—å·è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">app_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">WechatMp</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;app_id&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_app_id</span><span class="p">,</span>      <span class="c1">// AppID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;secret&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_secret</span><span class="p">,</span>      <span class="c1">// AppSecret
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;token&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_token</span><span class="p">,</span>       <span class="c1">// Token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;aes_key&#39;</span> <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_aes_key</span><span class="p">,</span>     <span class="c1">// EncodingAESKeyï¼Œå…¼å®¹ä¸å®‰å…¨æ¨¡å¼ä¸‹è¯·ä¸€å®šè¦å¡«å†™ï¼ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;oauth&#39;</span>   <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//&#39;scopes&#39;   =&gt; array_map(&#39;trim&#39;, explode(&#39;,&#39;, env(&#39;WECHAT_OFFICIAL_ACCOUNT_OAUTH_SCOPES&#39;, &#39;snsapi_userinfo&#39;))),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="s1">&#39;scopes&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;snsapi_userinfo&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//&#39;callback&#39; =&gt; env(&#39;WECHAT_OFFICIAL_ACCOUNT_OAUTH_CALLBACK&#39;, &#39;/oauth_callback&#39;),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="s1">&#39;callback&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/oauth_callback/&#39;</span><span class="o">.</span><span class="nv">$account</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;log&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;level&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;file&#39;</span> <span class="o">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;logs/wechat.log&#39;</span><span class="p">),</span>  <span class="c1">//è¿™ä¸ªå¿…é¡»è¦æœ‰ï¼Œè¦ä¸è°ƒè¯•æœ‰é—®é¢˜ï¼Œä½ éƒ½ä¼šæ‰¾ä¸åˆ°åŸå› 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//[1-2]ç”Ÿæˆå¾®ä¿¡å…¬ä¼—å·ç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$app</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">officialAccount</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$app</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//[2-1]å¾®ä¿¡æ”¯ä»˜è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">pay_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;app_id&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_app_id</span><span class="p">,</span>      <span class="c1">// AppID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;secret&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_secret</span><span class="p">,</span>      <span class="c1">// AppSecret
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;mch_id&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_mch_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;key&#39;</span>         <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_api_key</span><span class="p">,</span>   <span class="c1">// API å¯†é’¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// å¦‚éœ€ä½¿ç”¨æ•æ„Ÿæ¥å£ï¼ˆå¦‚é€€æ¬¾ã€å‘é€çº¢åŒ…ç­‰ï¼‰éœ€è¦é…ç½® API è¯ä¹¦è·¯å¾„(ç™»å½•å•†æˆ·å¹³å°ä¸‹è½½ API è¯ä¹¦)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;cert_path&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_api_key</span><span class="p">,</span> <span class="c1">// XXX: ç»å¯¹è·¯å¾„ï¼ï¼ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;key_path&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_api_key</span><span class="p">,</span>      <span class="c1">// XXX: ç»å¯¹è·¯å¾„ï¼ï¼ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;notify_url&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;é»˜è®¤çš„è®¢å•å›è°ƒåœ°å€&#39;</span><span class="p">,</span>     <span class="c1">// ä½ ä¹Ÿå¯ä»¥åœ¨ä¸‹å•æ—¶å•ç‹¬è®¾ç½®æ¥æƒ³è¦†ç›–å®ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//[2-2]ç”Ÿæˆå¾®ä¿¡æ”¯ä»˜ç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">pay</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$pay</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">payment</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pay_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$pay</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//[3-1]å¾®ä¿¡å°ç¨‹åºè®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">mini_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;app_id&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_app_id</span><span class="p">,</span>         <span class="c1">// AppID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;secret&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_secret</span><span class="p">,</span>     <span class="c1">// AppSecret
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//[3-2]å¾®ä¿¡å°ç¨‹åºç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">miniProgram</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$miniProgram</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">miniProgram</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mini_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$miniProgram</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//[4-1]å¾®ä¿¡å¼€æ”¾å¹³å°è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">opconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;app_id&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_app_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;secret&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_secret</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;token&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;aes_key&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_aes_key</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//[4-2]å¾®ä¿¡å¼€æ”¾å¹³å°ç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">openPlatform</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$openPlatform</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">openPlatform</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">opconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$openPlatform</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//[5-1]å¾®ä¿¡ä¼ä¸šå·è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">workconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;corp_id&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">work_corp_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;agent_id&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">work_agent_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;secret&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">work_secret</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//[5-2]å¾®ä¿¡ä¼ä¸šå·ç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">work</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$work</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">work</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">workconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$work</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="åˆ›å»ºå¾®ä¿¡æ§åˆ¶å™¨">åˆ›å»ºå¾®ä¿¡æ§åˆ¶å™¨</h3>
<ul>
<li>åˆ›å»ºä¸€ä¸ªå¾®ä¿¡æ§åˆ¶å™¨ï¼Œè¿›è¡Œå¾®ä¿¡å…¬ä¼—å¹³å°å¯¹æ¥ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:controller Api/WechatController
</span></span></code></pre></div><ul>
<li>å¹¶å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Controllers\Api</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Handlers\WechatConfigHandler</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WeChatController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$wechat</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$app</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">WechatConfigHandler</span> <span class="nv">$wechat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span> <span class="o">=</span> <span class="nv">$wechat</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * å¤„ç†å¾®ä¿¡çš„è¯·æ±‚æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return string
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">     <span class="k">public</span> <span class="k">function</span> <span class="nf">serve</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å¾®ä¿¡å‘æ¥é…ç½®GETè¯·æ±‚ï¼Œå¯ä»¥åœ¨æ­¤å¤„æ›´æ”¹is_connectçŠ¶æ€ä¸ºå·²è¿æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$account</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">switch</span> <span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;MsgType&#39;</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">case</span> <span class="s1">&#39;event&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$account</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">case</span> <span class="s1">&#39;text&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;Content&#39;</span><span class="p">],</span> <span class="nv">$account</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">case</span> <span class="s1">&#39;image&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°å›¾ç‰‡æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">case</span> <span class="s1">&#39;voice&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°è¯­éŸ³æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">case</span> <span class="s1">&#39;video&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°è§†é¢‘æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">case</span> <span class="s1">&#39;location&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°åæ ‡æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">case</span> <span class="s1">&#39;link&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°é“¾æ¥æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">case</span> <span class="s1">&#39;file&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°æ–‡ä»¶æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// ... å…¶å®ƒæ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°å…¶å®ƒæ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">serve</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1">//å¾®ä¿¡ç™»å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">oauth_callback</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">oauth</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">session</span><span class="p">([</span><span class="s1">&#39;wechat.oauth_user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">()]);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ä¸ç®¡åœ¨å“ªä¸ªé¡µé¢æ£€æµ‹ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼Œéƒ½è¦å†™å…¥sessionå€¼ï¼štarget_url
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$targetUrl</span> <span class="o">=</span> <span class="nx">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;target_url&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">session</span><span class="p">(</span><span class="s1">&#39;target_url&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;/&#39;</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//header(&#39;location:&#39;. $targetUrl);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$targetUrl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–jssdké…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getJSSDKConfig</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$arr</span> <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;apis&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$debug</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span> <span class="o">?</span> <span class="k">true</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$json</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span> <span class="o">?</span> <span class="k">true</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;params error&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$app</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;wechat.official_account&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">jssdk</span><span class="o">-&gt;</span><span class="na">setUrl</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$config</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">jssdk</span><span class="o">-&gt;</span><span class="na">buildConfig</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$debug</span><span class="p">,</span> <span class="nv">$json</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="é…ç½®è·¯ç”±">é…ç½®è·¯ç”±ï¼š</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//web.php 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">any</span><span class="p">(</span><span class="s1">&#39;/wechat/{account}&#39;</span><span class="p">,</span> <span class="s1">&#39;Api\WeChatController@serve&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">any</span><span class="p">(</span><span class="s1">&#39;/oauth_callback/{account}&#39;</span><span class="p">,</span><span class="s1">&#39;WechatController@oauth_callback&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/wechat/jssdkconfig&#39;</span><span class="p">,</span> <span class="s1">&#39;Api\WeChatController@getJSSDKConfig&#39;</span><span class="p">);</span>
</span></span></code></pre></div><h3 id="è®¾ç½®è·¯ç”±å¿½ç•¥">è®¾ç½®è·¯ç”±å¿½ç•¥</h3>
<ul>
<li>è¿™ä¸€æ­¥åƒä¸‡ä¸èƒ½å¿˜è®°ï¼Œä¸­é—´é”® <code>Middleware</code> æ–‡ä»¶å¤¹é‡Œ <code>VerifyCsrfToken.php</code> ä¿®æ”¹è·¯ç”±å¿½ç•¥ï¼Œå› ä¸ºå¾®ä¿¡å‘è¿‡æ¥çš„è¯·æ±‚æ–¹å¼ä¸å®šï¼Œä¸€ä¸‹ <code>GET</code> ï¼Œä¸€ä¸‹ <code>POST</code> ï¼Œ<code>POST</code> å°±è¦æ’é™¤ <code>access_token</code> é™åˆ¶ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$except</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;/admin/wangeditor/upload&#34;</span><span class="p">,</span><span class="s2">&#34;wechat/*&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div><h3 id="å¼€å§‹ä½¿ç”¨">å¼€å§‹ä½¿ç”¨</h3>
<ul>
<li>ç„¶ååœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//å…¬ä¼—å·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">pay</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//å¾®ä¿¡æ”¯ä»˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">miniProgram</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//å¾®ä¿¡å°ç¨‹åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">work</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//ä¼ä¸šå·åº”ç”¨
</span></span></span></code></pre></div><ul>
<li>å¾®ä¿¡å…¬ä¼—å¹³å°å¼€å‘è€…é€‰é¡¹é‡Œ URL è¦è®¾ç½®ä¸ºï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">http://www.xxx.com/wechat/1     //å…¶ä¸­çš„ 1 å°±ä¸ºä¼ è¿‡æ¥çš„å…¬ä¼—å·id $accountå‚æ•°
</span></span></code></pre></div><p>æœ€åé€ç»™è‡ªå·±ğŸ’ª</p>
<blockquote>
<p>æ—¶é—´ï¼Œä¼šå¸¦æ¥æƒŠå–œã€‚åªè¦æˆ‘ä»¬è‚¯è®¤çœŸåœ°ï¼Œæœ‰å¸Œæœ›åœ°ï¼Œèµ°è¿‡æ¯ä¸€å¤©ã€‚</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>Laravelçš„å¾®ä¿¡å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æ¨é€ğŸ“¨</title>
			<link>https://blog.gookm.cn/posts/2019/20191127-wechat-pushmsg/</link>
			<pubDate>Wed, 27 Nov 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20191127-wechat-pushmsg/</guid>
			<description>å®‰è£…ä¸€ä¸ªçº¯å‡€çš„laravelæ¡†æ¶ composer create-project --prefer-dist laravel/laravel blog &amp;#34;5.7.*&amp;#34; å®‰è£…å¾®ä¿¡æ‰©å±•åŒ…EasyWeChat å®‰è£…å¥½ç”¨çš„å¾®ä¿¡æ‰©å±•åŒ…EasyWeChatï¼Œè¿™é‡Œä½¿ç”¨ laravel-wechat
# Laravel &amp;lt; 5.8 composer require &amp;#34;overtrue/laravel-wechat:~4.0&amp;#34; ç®¡ç†å¤šå…¬ä¼—å· Laravel ä½¿ç”¨ EasyWechat ç®¡ç†å¤šå…¬ä¼—å·
åˆ›å»ºæ•°æ®è¡¨ php artisan make:model Wechat -m $table-&amp;gt;increments(&amp;#39;id&amp;#39;); $table-&amp;gt;string(&amp;#39;aid&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;wechat_app_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡å…¬ä¼—å·è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;wechat_secret&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;wechat_token&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;wechat_aes_key&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;pay_mch_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡æ”¯ä»˜è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;pay_api_key&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;pay_cert_path&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;pay_key_path&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;op_app_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡å¼€æ”¾å¹³å°è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;op_secret&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;op_token&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;op_aes_key&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;work_corp_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡ä¼ä¸šå·è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;work_agent_id&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;work_secret&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;timestamps(); åœ¨ App\Handlers åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•° WechatConfigHandler.php æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š &amp;lt;?php /** * Created by PhpStorm. * User: zhukang. * Date: 2019/11/9. * Time: 11:54. */ namespace App\Handlers; use App\Models\Wechat; use EasyWeChat\Factory; class WechatConfigHandler { //[1-1]å¾®ä¿¡å…¬ä¼—å·è®¾ç½® public function app_config($account) { $wechat = Wechat::where(&amp;#39;id&amp;#39;,$account)-&amp;gt;first(); if (!</description>
			<content type="html"><![CDATA[<h3 id="å®‰è£…ä¸€ä¸ªçº¯å‡€çš„laravelæ¡†æ¶">å®‰è£…ä¸€ä¸ªçº¯å‡€çš„laravelæ¡†æ¶</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer create-project --prefer-dist laravel/laravel blog <span class="s2">&#34;5.7.*&#34;</span>
</span></span></code></pre></div><h3 id="å®‰è£…å¾®ä¿¡æ‰©å±•åŒ…easywechat">å®‰è£…å¾®ä¿¡æ‰©å±•åŒ…EasyWeChat</h3>
<p>å®‰è£…å¥½ç”¨çš„å¾®ä¿¡æ‰©å±•åŒ…EasyWeChatï¼Œè¿™é‡Œä½¿ç”¨ laravel-wechat</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># Laravel &lt; 5.8</span>
</span></span><span class="line"><span class="cl">composer require <span class="s2">&#34;overtrue/laravel-wechat:~4.0&#34;</span>
</span></span></code></pre></div><h3 id="ç®¡ç†å¤šå…¬ä¼—å·">ç®¡ç†å¤šå…¬ä¼—å·</h3>
<p>Laravel ä½¿ç”¨ EasyWechat ç®¡ç†å¤šå…¬ä¼—å·</p>
<ol>
<li>åˆ›å»ºæ•°æ®è¡¨</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:model Wechat -m
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_app_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span> <span class="c1">//å¾®ä¿¡å…¬ä¼—å·è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_token&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_aes_key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_mch_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>  <span class="c1">//å¾®ä¿¡æ”¯ä»˜è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_api_key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_cert_path&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_key_path&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_app_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>  <span class="c1">//å¾®ä¿¡å¼€æ”¾å¹³å°è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_token&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_aes_key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;work_corp_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>  <span class="c1">//å¾®ä¿¡ä¼ä¸šå·è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;work_agent_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;work_secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
</span></span></code></pre></div><ol start="2">
<li>åœ¨ <code>App\Handlers</code> åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•° <code>WechatConfigHandler.php</code> æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">* Created by PhpStorm.
</span></span></span><span class="line"><span class="cl"><span class="sd">* User: zhukang.
</span></span></span><span class="line"><span class="cl"><span class="sd">* Date: 2019/11/9.
</span></span></span><span class="line"><span class="cl"><span class="sd">* Time: 11:54.
</span></span></span><span class="line"><span class="cl"><span class="sd">*/</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Handlers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\Wechat</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">EasyWeChat\Factory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WechatConfigHandler</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//[1-1]å¾®ä¿¡å…¬ä¼—å·è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">app_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;app_id&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_app_id</span><span class="p">,</span>      <span class="c1">// AppID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;secret&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_secret</span><span class="p">,</span>      <span class="c1">// AppSecret
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;token&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_token</span><span class="p">,</span>       <span class="c1">// Token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;aes_key&#39;</span> <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_aes_key</span><span class="p">,</span>     <span class="c1">// EncodingAESKeyï¼Œå…¼å®¹ä¸å®‰å…¨æ¨¡å¼ä¸‹è¯·ä¸€å®šè¦å¡«å†™ï¼ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;log&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;level&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="s1">&#39;file&#39;</span> <span class="o">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;logs/wechat.log&#39;</span><span class="p">),</span>  <span class="c1">//è¿™ä¸ªå¿…é¡»è¦æœ‰ï¼Œè¦ä¸è°ƒè¯•æœ‰é—®é¢˜ï¼Œä½ éƒ½ä¼šæ‰¾ä¸åˆ°åŸå› 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">];</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//[1-2]ç”Ÿæˆå¾®ä¿¡å…¬ä¼—å·ç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$app</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">officialAccount</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$app</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//[2-1]å¾®ä¿¡æ”¯ä»˜è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">pay_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;app_id&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_app_id</span><span class="p">,</span>      <span class="c1">// AppID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;secret&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_secret</span><span class="p">,</span>      <span class="c1">// AppSecret
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;mch_id&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_mch_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;key&#39;</span>         <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_api_key</span><span class="p">,</span>   <span class="c1">// API å¯†é’¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="c1">// å¦‚éœ€ä½¿ç”¨æ•æ„Ÿæ¥å£ï¼ˆå¦‚é€€æ¬¾ã€å‘é€çº¢åŒ…ç­‰ï¼‰éœ€è¦é…ç½® API è¯ä¹¦è·¯å¾„(ç™»å½•å•†æˆ·å¹³å°ä¸‹è½½ API è¯ä¹¦)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;cert_path&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_api_key</span><span class="p">,</span> <span class="c1">// XXX: ç»å¯¹è·¯å¾„ï¼ï¼ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;key_path&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_api_key</span><span class="p">,</span>      <span class="c1">// XXX: ç»å¯¹è·¯å¾„ï¼ï¼ï¼ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;notify_url&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;é»˜è®¤çš„è®¢å•å›è°ƒåœ°å€&#39;</span><span class="p">,</span>     <span class="c1">// ä½ ä¹Ÿå¯ä»¥åœ¨ä¸‹å•æ—¶å•ç‹¬è®¾ç½®æ¥æƒ³è¦†ç›–å®ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>       <span class="p">];</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//[2-2]ç”Ÿæˆå¾®ä¿¡æ”¯ä»˜ç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">pay</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$pay</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">payment</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pay_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$pay</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//[3-1]å¾®ä¿¡å°ç¨‹åºè®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">mini_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;app_id&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_app_id</span><span class="p">,</span>         <span class="c1">// AppID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;secret&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_secret</span><span class="p">,</span>     <span class="c1">// AppSecret
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="p">];</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//[3-2]å¾®ä¿¡å°ç¨‹åºç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">miniProgram</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$miniProgram</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">miniProgram</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mini_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$miniProgram</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//[4-1]å¾®ä¿¡å¼€æ”¾å¹³å°è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">opconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;app_id&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_app_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;secret&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_secret</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;token&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;aes_key&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_aes_key</span>
</span></span><span class="line"><span class="cl">       <span class="p">];</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//[4-2]å¾®ä¿¡å¼€æ”¾å¹³å°ç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">openPlatform</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$openPlatform</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">openPlatform</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">opconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$openPlatform</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//[5-1]å¾®ä¿¡ä¼ä¸šå·è®¾ç½®å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">workconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;corp_id&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">work_corp_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;agent_id&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">work_agent_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;secret&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">work_secret</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="p">];</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//[5-2]å¾®ä¿¡ä¼ä¸šå·ç›¸å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">work</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$work</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">work</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">workconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$work</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ol start="3">
<li>åˆ›å»ºä¸€ä¸ªå¾®ä¿¡æ§åˆ¶å™¨ï¼Œè¿›è¡Œå¾®ä¿¡å…¬ä¼—å¹³å°å¯¹æ¥</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:controller WechatController
</span></span></code></pre></div><p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Controllers\Api</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Handlers\WechatConfigHandler</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\SubscribeReplay</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\Wechat</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\WechatKeyword</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\WechatRule</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\WechatUser</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">EasyWeChat\Factory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WeChatController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="cm">/*public function serve()
</span></span></span><span class="line"><span class="cl"><span class="cm">   {
</span></span></span><span class="line"><span class="cl"><span class="cm">       $app=app(&#39;wechat.official_account&#39;);
</span></span></span><span class="line"><span class="cl"><span class="cm">       return $app-&gt;server-&gt;serve();
</span></span></span><span class="line"><span class="cl"><span class="cm">   }*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">protected</span> <span class="nv">$wechat</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">protected</span> <span class="nv">$app</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">WechatConfigHandler</span> <span class="nv">$wechat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span> <span class="o">=</span> <span class="nv">$wechat</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">    * å¤„ç†å¾®ä¿¡çš„è¯·æ±‚æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="sd">    * @return string
</span></span></span><span class="line"><span class="cl"><span class="sd">    */</span>
</span></span><span class="line"><span class="cl">   <span class="k">public</span> <span class="k">function</span> <span class="nf">serve</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$account</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">           <span class="k">switch</span> <span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;MsgType&#39;</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="k">case</span> <span class="s1">&#39;event&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="nv">$account</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">               <span class="k">case</span> <span class="s1">&#39;text&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°æ–‡å­—æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">               <span class="k">case</span> <span class="s1">&#39;image&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°å›¾ç‰‡æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">               <span class="k">case</span> <span class="s1">&#39;voice&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°è¯­éŸ³æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">               <span class="k">case</span> <span class="s1">&#39;video&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°è§†é¢‘æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">               <span class="k">case</span> <span class="s1">&#39;location&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°åæ ‡æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">               <span class="k">case</span> <span class="s1">&#39;link&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°é“¾æ¥æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">               <span class="k">case</span> <span class="s1">&#39;file&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°æ–‡ä»¶æ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">               <span class="c1">// ... å…¶å®ƒæ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>               <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°å…¶å®ƒæ¶ˆæ¯&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">           <span class="p">}</span>
</span></span><span class="line"><span class="cl">       <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">serve</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    *äº‹ä»¶
</span></span></span><span class="line"><span class="cl"><span class="cm">    */</span>
</span></span><span class="line"><span class="cl">   <span class="k">protected</span> <span class="k">function</span> <span class="nf">event</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">switch</span> <span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;Event&#39;</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">           <span class="c1">//å…³æ³¨äº‹ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="k">case</span> <span class="s1">&#39;subscribe&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">               <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">welcome</span><span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;FromUserName&#39;</span><span class="p">],</span><span class="nv">$account</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">               <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">           <span class="k">case</span> <span class="s1">&#39;unsubscribe&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">               <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unsubscribe</span><span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;FromUserName&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">               <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">EventKey</span><span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;EventKey&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    *å…³æ³¨äº‹ä»¶å›å¤
</span></span></span><span class="line"><span class="cl"><span class="cm">    */</span>
</span></span><span class="line"><span class="cl">   <span class="k">public</span> <span class="k">function</span> <span class="nf">welcome</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="o">.</span><span class="s1">&#39;&lt;å…³æ³¨&gt;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$rule</span><span class="o">=</span><span class="nx">WechatRule</span><span class="o">::</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;wechat_id&#39;</span><span class="o">=&gt;</span><span class="nv">$account</span><span class="p">,</span><span class="s1">&#39;event&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;subscribe&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$reply_content</span><span class="o">=</span><span class="p">(</span><span class="nx">WechatKeyword</span><span class="o">::</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;wechat_id&#39;</span><span class="o">=&gt;</span><span class="nv">$account</span><span class="p">,</span><span class="s1">&#39;keyword&#39;</span><span class="o">=&gt;</span><span class="nv">$rule</span><span class="o">-&gt;</span><span class="na">keyword</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">reply_content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">       <span class="nv">$is_exist</span><span class="o">=</span><span class="nx">WechatUser</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;openid&#39;</span><span class="p">,</span><span class="nv">$FromUserName</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span><span class="p">(</span><span class="nv">$is_exist</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">           <span class="nx">WechatUser</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">       <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nv">$is_exist</span><span class="o">-&gt;</span><span class="na">subscribe</span> <span class="o">==</span> <span class="mi">2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">           <span class="nv">$is_exist</span><span class="o">-&gt;</span><span class="na">subscribe</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">           <span class="nv">$is_exist</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nv">$replayTemp</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;[toUserName]&#39;</span><span class="p">,</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">],</span><span class="nv">$reply_content</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="nv">$replayTemp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">   *å–æ¶ˆå…³æ³¨äº‹ä»¶å›å¤
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">   <span class="k">public</span> <span class="k">function</span> <span class="nf">unsubscribe</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="o">.</span><span class="s1">&#39;&lt;å–æ¶ˆå…³æ³¨&gt;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">       <span class="nx">WechatUser</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;openid&#39;</span><span class="p">,</span><span class="nv">$FromUserName</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;subscribe&#39;</span><span class="o">=&gt;</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ol start="4">
<li>ä¸­é—´é”®<code> Middleware</code> æ–‡ä»¶å¤¹é‡Œ <code>VerifyCsrfToken.php</code> ä¿®æ”¹è·¯ç”±å¿½ç•¥</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$except</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">   <span class="s1">&#39;wechat/*&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span> 
</span></span></code></pre></div><ol start="5">
<li>ç„¶ååœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·å†™</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//å…¬ä¼—å·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">pay</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//å¾®ä¿¡æ”¯ä»˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">miniProgram</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//å¾®ä¿¡å°ç¨‹åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">work</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//ä¼ä¸šå·åº”ç”¨
</span></span></span></code></pre></div><ol start="6">
<li>å…¶ä»–</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//å¾®ä¿¡å…¬ä¼—å¹³å°å¼€å‘è€…é€‰é¡¹é‡Œè¦è®¾ç½®ä¸ºï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1">//http://www.xxx.com/wechat/1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//é…ç½®è·¯ç”±(web.php):
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">any</span><span class="p">(</span><span class="s1">&#39;/wechat/{account}&#39;</span><span class="p">,</span> <span class="s1">&#39;Api\WeChatController@serve&#39;</span><span class="p">);</span>       
</span></span></code></pre></div><h3 id="æµ‹è¯•å¹³å°">æµ‹è¯•å¹³å°</h3>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20191127-wechat-pushmsg01.jpg" alt="æµ‹è¯•å¹³å°"></p>
<h3 id="å¢åŠ æ¶ˆæ¯æ¨¡æ¿">å¢åŠ æ¶ˆæ¯æ¨¡æ¿</h3>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20191127-wechat-pushmsg02.jpg" alt="å¢åŠ æ¶ˆæ¯æ¨¡æ¿"></p>
<h3 id="æ–°å»ºæ¨¡æ¿æ¶ˆæ¯æ§åˆ¶å™¨">æ–°å»ºæ¨¡æ¿æ¶ˆæ¯æ§åˆ¶å™¨</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:controller Api/WechatTemplateMsgController
</span></span></code></pre></div><p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Controllers\Api</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\WechatUser</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WechatTemplateMsgController</span> <span class="k">extends</span> <span class="nx">ApiController</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å‘é€æ¨¡æ¿æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendTemplateMsg</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$users</span><span class="o">=</span><span class="nx">WechatUser</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;subscribe&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;subscribe&#39;</span><span class="p">,</span><span class="s1">&#39;openid&#39;</span><span class="p">,</span><span class="s1">&#39;nickname&#39;</span><span class="p">,</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span><span class="s1">&#39;city&#39;</span><span class="p">,</span><span class="s1">&#39;province&#39;</span><span class="p">,</span><span class="s1">&#39;country&#39;</span><span class="p">,</span><span class="s1">&#39;subscribe_time&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$msg_content_data</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;first&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¨é€ğŸ˜„&#39;</span><span class="p">,</span>  <span class="c1">// ä¸éœ€è¦æŒ‡å®šé¢œè‰²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="s1">&#39;nickname&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">nickname</span><span class="p">,</span> <span class="s1">&#39;#F00&#39;</span><span class="p">],</span> <span class="c1">// æŒ‡å®šä¸ºçº¢è‰²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="s1">&#39;sex&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">sex</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;ç”·&#39;</span> <span class="o">:</span> <span class="s1">&#39;å¥³&#39;</span><span class="p">,</span> <span class="c1">// ä¸ç¬¬äºŒ`ç§ä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="s1">&#39;city&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">city</span><span class="p">,</span> <span class="c1">// ä¸ç¬¬ä¸€ç§ä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="s1">&#39;province&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">province</span><span class="p">,</span> <span class="c1">// ä¸ç¬¬ä¸€ç§ä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="s1">&#39;country&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">country</span><span class="p">,</span> <span class="c1">// ä¸ç¬¬ä¸€ç§ä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="s1">&#39;subscribe_time&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="nx">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">,</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscribe_time</span><span class="p">),</span><span class="s1">&#39;#F00&#39;</span><span class="p">],</span> <span class="c1">// ä¸ç¬¬ä¸€ç§ä¸€æ ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$msg_content</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;touser&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">openid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;template_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cn27K9GkTx0O0xxxxxxxxxxxxxxQl-OmA&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://www.xxxxx.com&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nv">$msg_content_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$res</span><span class="o">=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">template_message</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$msg_content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">([</span><span class="s1">&#39;template_message&#39;</span><span class="o">=&gt;</span><span class="nv">$res</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;errcode&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">selfMessage</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;errcode&#39;</span><span class="p">],</span> <span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;errmsg&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">selfMessage</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="mi">1010</span><span class="p">,</span> <span class="s1">&#39;æ¨¡æ¿æ¶ˆæ¯å‘é€æˆåŠŸï¼&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="è·¯ç”±apiphp">è·¯ç”±(api.php)</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//å‘é€æ¨¡æ¿æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;wechat/send_template_msg&#39;</span><span class="p">,</span> <span class="s1">&#39;WechatTemplateMsgController@sendTemplateMsg&#39;</span><span class="p">);</span>
</span></span></code></pre></div><h4 id="æµ‹è¯•">æµ‹è¯•</h4>
<p>Postmanè°ƒç”¨å‘é€æ¨¡æ¿æ¶ˆæ¯æ¥å£ï¼š
<img src="https://qiniu.zkilm.cn/blog/posts/2019/20191127-wechat-pushmsg03.jpg" alt="Postmanè°ƒç”¨å‘é€æ¨¡æ¿æ¶ˆæ¯æ¥å£"></p>
<p>æ•ˆæœå›¾ï¼š
<img src="https://qiniu.zkilm.cn/blog/posts/2019/20191127-wechat-pushmsg04.jpg" alt="æ•ˆæœå›¾"></p>
]]></content>
		</item>
		
		<item>
			<title>GitBookåˆè¯•ğŸº</title>
			<link>https://blog.gookm.cn/posts/2019/20190826-try-gitbook/</link>
			<pubDate>Mon, 26 Aug 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190826-try-gitbook/</guid>
			<description>å®Œæˆåçš„æˆæœé¢„è§ˆåœ°å€ï¼šhttps://zkbook.zam9.com/
å®‰è£… npm install gitbook-cli -g æŠ¥é”™ï¼š
npm WARN checkPermissions Missing write access to /usr/lib/node_modules åŸå› ï¼šå®‰è£…å…¨å±€çš„åŒ…ï¼Œæ²¡æœ‰æƒé™
è§£å†³åŠæ³•ï¼šåœ¨å®‰è£…å‘½ä»¤å‰åŠ ä¸Š sudo ,è¾“å…¥ç”¨æˆ·çš„ç™»é™†å¯†ç ï¼Œæå‡æƒé™è¿›è¡Œå®‰è£…ã€‚
sudo npm install gitbook-cli -g åˆå§‹åŒ– æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚ gitbook ï¼Œcd åˆ° gitbook ï¼Œç„¶åï¼š
gitbook init - README.md: ä¹¦çš„ä»‹ç»æ–‡å­—ï¼Œå¦‚å‰è¨€ã€ç®€ä»‹ï¼Œåœ¨ç« èŠ‚ä¸­ä¹Ÿå¯åšä¸ºç« èŠ‚çš„ç®€ä»‹ã€‚ - SUMMARY.md: å®šåˆ¶ä¹¦ç±çš„ç« èŠ‚ç»“æ„å’Œé¡ºåºã€‚ å¼€å§‹ç¼–å†™ä½ çš„ç›®å½•åŠæ–‡ä»¶ å¦‚ä½ å¯ä»¥åœ¨ gitbook ä¸‹æ–°å»ºä¸€ä¸ª part01 ç›®å½•ä¸ README.md å’Œ SUMMARY.md åŒçº§ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹æ–°å»º md æ–‡ä»¶å³å¯ã€‚
SUMMARY.md æ–‡ä»¶ä½œä¸ºä¹¦ç±çš„ç›®å½•ç»“æ„:
#Summary - [Introduction](README.md) - Part I - [ç™»å½•æµç¨‹ä»‹ç»](part01/login.md) - [test01](part01/test01.md) - [test02 å‚è€ƒ](part01/test02.md) - [æ¦‚è§ˆ](part01/test.md) - [Test](part01/Test.</description>
			<content type="html"><![CDATA[<blockquote>
<p>å®Œæˆåçš„æˆæœé¢„è§ˆåœ°å€ï¼šhttps://zkbook.zam9.com/</p>
</blockquote>
<h3 id="å®‰è£…">å®‰è£…</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install gitbook-cli -g
</span></span></code></pre></div><p>æŠ¥é”™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm WARN checkPermissions Missing write access to /usr/lib/node_modules
</span></span></code></pre></div><p>åŸå› ï¼šå®‰è£…å…¨å±€çš„åŒ…ï¼Œæ²¡æœ‰æƒé™</p>
<p>è§£å†³åŠæ³•ï¼šåœ¨å®‰è£…å‘½ä»¤å‰åŠ ä¸Š sudo ,è¾“å…¥ç”¨æˆ·çš„ç™»é™†å¯†ç ï¼Œæå‡æƒé™è¿›è¡Œå®‰è£…ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo npm install gitbook-cli -g
</span></span></code></pre></div><h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚ gitbook ï¼Œcd åˆ° gitbook ï¼Œç„¶åï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gitbook init
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">- README.md: ä¹¦çš„ä»‹ç»æ–‡å­—ï¼Œå¦‚å‰è¨€ã€ç®€ä»‹ï¼Œåœ¨ç« èŠ‚ä¸­ä¹Ÿå¯åšä¸ºç« èŠ‚çš„ç®€ä»‹ã€‚
</span></span><span class="line"><span class="cl">- SUMMARY.md: å®šåˆ¶ä¹¦ç±çš„ç« èŠ‚ç»“æ„å’Œé¡ºåºã€‚
</span></span></code></pre></div><h3 id="å¼€å§‹ç¼–å†™ä½ çš„ç›®å½•åŠæ–‡ä»¶">å¼€å§‹ç¼–å†™ä½ çš„ç›®å½•åŠæ–‡ä»¶</h3>
<p>å¦‚ä½ å¯ä»¥åœ¨ gitbook ä¸‹æ–°å»ºä¸€ä¸ª part01 ç›®å½•ä¸ README.md å’Œ SUMMARY.md åŒçº§ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹æ–°å»º md æ–‡ä»¶å³å¯ã€‚</p>
<p>SUMMARY.md  æ–‡ä»¶ä½œä¸ºä¹¦ç±çš„ç›®å½•ç»“æ„:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#Summary</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">- <span class="o">[</span>Introduction<span class="o">](</span>README.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">- Part I
</span></span><span class="line"><span class="cl">    - <span class="o">[</span>ç™»å½•æµç¨‹ä»‹ç»<span class="o">](</span>part01/login.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">    - <span class="o">[</span>test01<span class="o">](</span>part01/test01.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">    - <span class="o">[</span>test02 å‚è€ƒ<span class="o">](</span>part01/test02.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">        - <span class="o">[</span>æ¦‚è§ˆ<span class="o">](</span>part01/test.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">        - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">        - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">        - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">- Part II
</span></span><span class="line"><span class="cl">    - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">    - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
</span></span><span class="line"><span class="cl">    - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
</span></span></code></pre></div><h3 id="é¢„è§ˆ">é¢„è§ˆ</h3>
<ul>
<li>æ‰§è¡Œå‘½ä»¤ gitbook serve ï¼Œgitbook ä¼šå¯åŠ¨ä¸€ä¸ª 4000 ç«¯å£ç”¨äºé¢„è§ˆã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gitbook serve
</span></span></code></pre></div><ul>
<li>ç¬¬äºŒç§é¢„è§ˆæ–¹å¼ï¼Œè¿è¡Œ gitbook build å‘½ä»¤åä¼šåœ¨ä¹¦ç±çš„æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸€ä¸ª _book æ–‡ä»¶å¤¹, é‡Œé¢çš„å†…å®¹å³ä¸ºç”Ÿæˆçš„ html æ–‡ä»¶. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ¥ç”Ÿæˆç½‘é¡µè€Œä¸å¼€å¯æœåŠ¡å™¨ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gitbook build
</span></span></code></pre></div><h3 id="å…³äºç”Ÿæˆé™æ€htmlä¾§è¾¹æ æ— æ³•ç‚¹å‡»é—®é¢˜">å…³äºç”Ÿæˆé™æ€HTMLä¾§è¾¹æ æ— æ³•ç‚¹å‡»é—®é¢˜</h3>
<p>ç™¾åº¦åˆ°çš„ç»“æœæ˜¯ï¼šä» 3.0.0 ç‰ˆèµ·, gitbook build ç”Ÿæˆçš„ website å°±ä¸æ”¯æŒ local æ‰“å¼€äº†, å¿…éœ€è¦ webserver å¼€å¯;å®åœ¨è¦å®Œå…¨é™æ€çš„, å°±å®‰è£… 2.6.7 ç‰ˆå§ã€‚ä½¿ç”¨2.6.7ç‰ˆæœ¬ï¼Œä¼šè‡ªåŠ¨å®‰è£…å¹¶ç”Ÿæˆï¼Œå·¦ä¾§ç›®å½•å¯ç‚¹å‡»ï¼ŒFirefoxã€Chromeæš‚æ— ä»»ä½•é—®é¢˜</p>
<p>è§£å†³åŠæ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#ç”Ÿæˆå¯¹åº”ç‰ˆæœ¬çš„ï¼Œæœ¬åœ°æ— æ­¤ç‰ˆæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½</span>
</span></span><span class="line"><span class="cl">gitbook build --gitbook<span class="o">=</span>2.6.7   
</span></span></code></pre></div><p>ä½†æ˜¯åˆç¢°åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Error loading version latest: Error: Cannot find module <span class="s1">&#39;internal/util/types&#39;</span>
</span></span></code></pre></div><p>è§£å†³ï¼šå°† node ç‰ˆæœ¬é™ä½</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 1.å®‰è£…nodeç®¡ç† n</span>
</span></span><span class="line"><span class="cl">sudo npm install -g n 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. é™ä½ç‰ˆæœ¬ï¼Œæ›´æ–°npm</span>
</span></span><span class="line"><span class="cl">sudo n <span class="m">6</span>
</span></span><span class="line"><span class="cl">sudo npm install npm -g
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3.æ­¤æ—¶è¿è¡Œgitbook2.6.7çš„å‘½ä»¤å³å¯ã€‚</span>
</span></span><span class="line"><span class="cl">gitbook build --gitbook<span class="o">=</span>2.6.7
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 4. å¾…è½¬æ¢å®Œæˆåï¼Œå°†npmç‰ˆæœ¬ï¼ˆä¾‹å¦‚9.10.0ï¼‰åˆ‡å›æ¥å³å¯,ä»¥å…å½±å“å…¶ä»–æ¨¡å—</span>
</span></span><span class="line"><span class="cl">sudo n 8.16.1
</span></span></code></pre></div><h3 id="å…³äºä¾§è¾¹æ æŠ˜å é—®é¢˜å’Œåº•éƒ¨æ‰“èµåŠŸèƒ½">å…³äºä¾§è¾¹æ æŠ˜å é—®é¢˜å’Œåº•éƒ¨æ‰“èµåŠŸèƒ½</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å¦‚æœæœ‰å¤šä¸ªç›®å½•ï¼ŒGitbook åœ¨æµè§ˆå™¨ä¸Šæ‰“å¼€æ—¶ï¼Œé»˜è®¤æ‰€æœ‰çš„ç›®å½•éƒ½ä¼šæ‰“å¼€ï¼Œå½“ç›®å½•æ¯”è¾ƒå¤šæ—¶ï¼Œå…¨éƒ¨æ˜¾ç¤ºä¸åˆ©äºé˜…è¯»ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¯ä»¥ä½¿ç”¨æ’ä»¶é…ç½®ç›®å½•æŠ˜å ï¼Œä½¿å¾—æ‰“å¼€æµè§ˆå™¨æ—¶è¿™äº›ç›®å½•é»˜è®¤æ˜¯å…³é—­çš„ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">åœ¨æ‰§è¡Œ gitbook init ä¸»ç›®å½•ä¸‹å¢åŠ  book.json æ–‡ä»¶åšå®šåˆ¶åŒ–é…ç½®
</span></span></code></pre></div><p>é…ç½®ç›®å½•æŠ˜å åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;plugins&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;expandable-chapters&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;donate&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;pluginsConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;donate&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;wechat&#34;</span><span class="p">:</span> <span class="s2">&#34;https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/images/123444.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;alipay&#34;</span><span class="p">:</span> <span class="s2">&#34;https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/images/662.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;button&#34;</span><span class="p">:</span> <span class="s2">&#34;Donate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;alipayText&#34;</span><span class="p">:</span> <span class="s2">&#34;æ”¯ä»˜å®æèµ &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;wechatText&#34;</span><span class="p">:</span> <span class="s2">&#34;å¾®ä¿¡æèµ &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç„¶åï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gitbook install
</span></span></code></pre></div><p>GitBookæ’ä»¶åœ°å€ï¼š<a href="https://plugins.gitbook.com/">https://plugins.gitbook.com/</a></p>
]]></content>
		</item>
		
		<item>
			<title>Laravelè§£å†³è·¨åŸŸè¯·æ±‚ğŸƒâ€</title>
			<link>https://blog.gookm.cn/posts/2019/20190725-cross-request/</link>
			<pubDate>Thu, 25 Jul 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190725-cross-request/</guid>
			<description>ä»Šå¤©å…¬å¸å‰ç«¯çªç„¶è¯´è¯·æ±‚è·¨åŸŸäº†ï¼Œé‚£ä¹ˆå°±è§£å†³ä¸‹å’¯ï¼
åˆ›å»ºä¸­é—´ä»¶ é¦–å…ˆåˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶
php artisan make:middleware EnableCrossRequestMiddleware ç¼–å†™ä¸­é—´ä»¶ ç„¶ååœ¨ä¸­é—´ä»¶ EnableCrossRequestMiddleware.php ç¼–å†™
&amp;lt;?php namespace App\Http\Middleware; use Closure; class EnableCrossRequestMiddleware { /** * Handle an incoming request. * * @param \Illuminate\Http\Request $request * @param \Closure $next * @return mixed */ public function handle($request, Closure $next) { $response = $next($request); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Origin&amp;#39;, &amp;#39;*&amp;#39;); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Headers&amp;#39;, &amp;#39;Origin, Content-Type, Cookie, Accept&amp;#39;); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Methods&amp;#39;, &amp;#39;GET, POST, PATCH, PUT, OPTIONS&amp;#39;); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Credentials&amp;#39;, &amp;#39;true&amp;#39;); //essionå…±äº«çš„éœ€æ±‚æ‰ç”¨åˆ° return $response; } } æ³¨å†Œä¸­é—´ä»¶ æ·»åŠ åˆ°å…¨å±€ä¸­é—´ä»¶ Kernel.php ç»„ä¸­</description>
			<content type="html"><![CDATA[<p>ä»Šå¤©å…¬å¸å‰ç«¯çªç„¶è¯´è¯·æ±‚è·¨åŸŸäº†ï¼Œé‚£ä¹ˆå°±è§£å†³ä¸‹å’¯ï¼</p>
<h3 id="åˆ›å»ºä¸­é—´ä»¶">åˆ›å»ºä¸­é—´ä»¶</h3>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:middleware EnableCrossRequestMiddleware
</span></span></code></pre></div><h3 id="ç¼–å†™ä¸­é—´ä»¶">ç¼–å†™ä¸­é—´ä»¶</h3>
<p>ç„¶ååœ¨ä¸­é—´ä»¶ <code>EnableCrossRequestMiddleware.php</code> ç¼–å†™</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EnableCrossRequestMiddleware</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Handle an incoming request.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param  \Illuminate\Http\Request  $request
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param  \Closure  $next
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;Origin, Content-Type, Cookie, Accept&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">,</span> <span class="s1">&#39;GET, POST, PATCH, PUT, OPTIONS&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">);</span>  <span class="c1">//essionå…±äº«çš„éœ€æ±‚æ‰ç”¨åˆ°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="æ³¨å†Œä¸­é—´ä»¶">æ³¨å†Œä¸­é—´ä»¶</h3>
<p>æ·»åŠ åˆ°å…¨å±€ä¸­é—´ä»¶ <code>Kernel.php</code> ç»„ä¸­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$middleware</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="nx">\App\Http\Middleware\EnableCrossRequestMiddleware</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div><p>å¯èƒ½ç¢°åˆ°çš„é—®é¢˜ï¼ˆiosä¸è¯†åˆ«*ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;Origin, Content-Type, Cookie, X-CSRF-TOKEN, Accept, Authorization, token&#39;</span><span class="p">);</span><span class="c1">// å¼€æ”¾å“ªäº›è‡ªå®šä¹‰å¤´(ios ä¸è¯†åˆ«*)
</span></span></span></code></pre></div><p>æˆ–è€…é€‰æ‹© laravel-cors  <a href="https://github.com/barryvdh/laravel-cors">https://github.com/barryvdh/laravel-cors</a></p>
<p>å‚è€ƒï¼š<a href="http://www.ptbird.cn/laravel-cors-to-cors-laravel-app.html">http://www.ptbird.cn/laravel-cors-to-cors-laravel-app.html</a></p>
]]></content>
		</item>
		
		<item>
			<title>å¾®ä¿¡çš„H5åˆ†äº«ï¼ˆåŸºäº Laravel-Wechatï¼‰ğŸ˜¶</title>
			<link>https://blog.gookm.cn/posts/2019/20190610-wechat-h5/</link>
			<pubDate>Mon, 10 Jun 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190610-wechat-h5/</guid>
			<description>ä¸€ã€ç¼˜ç”± ä»€ä¹ˆéƒ½ä¸åšçš„æƒ…å†µä¸‹ï¼Œåœ¨å¾®ä¿¡åˆ†äº«H5é¡µé¢çš„æ—¶å€™ï¼Œåˆ†äº«åæ˜¯è¿™æ ·çš„ï¼š
ä½†æ˜¯ï¼Œç°åœ¨éœ€æ±‚æ˜¯ï¼Œåˆ†äº«åä¸ºä¸‹é¢è¿™æ ·ï¼š
æ²¡åŠæ³•ï¼Œè‡ªå·±å¼€å‘çš„H5è¦æƒ³åœ¨å¾®ä¿¡ä¸­è¿›è¡Œä¼ æ’­ï¼Œä½¿ç”¨å¾®ä¿¡ JSSDK æ˜¯å¿…ä¸å¯å°‘çš„ç¯èŠ‚ã€‚è€Œ JSSDK è™½ç„¶åªæ˜¯ä¸ª js ï¼Œå¯æ˜¯åŠ å¯†å¿…é¡»å¾—åœ¨æœåŠ¡ç«¯è¿›è¡Œã€‚
äºŒã€åŸºæœ¬æµç¨‹ 1.è®¾ç½®JSæ¥å£å®‰å…¨åŸŸå
è¿›å…¥å¾®ä¿¡å…¬ä¼—å·å¹³å° â€”&amp;gt; å…¬ä¼—å·è®¾ç½® â€”&amp;gt; åŠŸèƒ½è®¾ç½® â€”&amp;gt; JSæ¥å£å®‰å…¨åŸŸåï¼ˆ`test.zks.design`ï¼‰ è®¾ç½®çš„æ—¶å€™ï¼Œå¾®ä¿¡æœ‰æ•™ä½ å¦‚ä½•å»è®¾ç½®ï¼Œå°†ä¸‹è½½çš„æ–‡ä»¶ï¼ˆMP_verify_acUZIwvhxMREbXNt.txtï¼‰æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•å°±å¯ä»¥äº†ã€‚ 2.é…ç½®ä¸€ä¸ªåŸºç¡€ url ç”¨äºè·å– jssdk çš„ config å†…å®¹
ä½¿ç”¨çš„ url æ˜¯ http://test.zks.design/jssdkconfig
3.H5 é™æ€é¡µé¢å­˜æ”¾åœ¨ public/h5/ æ–‡ä»¶å¤¹ä¸‹
å› æ­¤åœ¨è®¿é—® H5 çš„æ—¶å€™ï¼Œéœ€è¦è®¿é—®åŸŸå `http://test.zks.design/h5/xxxx/` å› ä¸º H5 ä¸»è¦æ˜¯åˆ†äº«ï¼Œè€Œä¸æ˜¯åŸŸåè®¿é—®ï¼Œå› æ­¤è¿™ä¸ªåŸŸåæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ H5 å‡ç›´æ¥å†™é™æ€é¡µé¢ï¼Œå¹¶ä¸ä½¿ç”¨ laravel çš„ blade æ¨¡æ¿å»å†™H5ã€‚ 4.é€šè¿‡ ajax è·å– config é…ç½®
åœ¨éœ€è¦è°ƒç”¨åˆ†äº«çš„é¡µé¢ä¸Šï¼Œè¿›è¡Œ config é…ç½®çš„æ—¶å€™ï¼Œé¦–å…ˆé€šè¿‡ ajax å°†åŸºæœ¬å‚æ•°ä¼ é€ç»™æœåŠ¡ç«¯urlï¼ˆ`http://test.zks.design/jssdkconfig`ï¼‰ã€‚ ä¸€äº›éœ€è¦çš„å‚æ•°å¯èƒ½å¦‚ä¸‹ï¼š å¯ä»¥å‚ç…§ EasyWechat çš„æ–‡æ¡£ https://www.easywechat.com/docs/4.1/basic-services/jssdk å…¶ä¸­å»ºè®® $app-&amp;gt;jssdk-&amp;gt;setUrl($url) è®¾ç½®å½“å‰URL ä¸€å®šæ˜¯è‡ªå·±å‰ç«¯çš„é¡µé¢çš„ urlã€‚ 5.å°†è·å–åˆ°çš„ config ç›´æ¥æ”¾åœ¨ js ä¸­</description>
			<content type="html"><![CDATA[<h3 id="ä¸€ç¼˜ç”±">ä¸€ã€ç¼˜ç”±</h3>
<p>ä»€ä¹ˆéƒ½ä¸åšçš„æƒ…å†µä¸‹ï¼Œåœ¨å¾®ä¿¡åˆ†äº«H5é¡µé¢çš„æ—¶å€™ï¼Œåˆ†äº«åæ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190610-wechat-h501.png" alt="Before"></p>
<p>ä½†æ˜¯ï¼Œç°åœ¨éœ€æ±‚æ˜¯ï¼Œåˆ†äº«åä¸ºä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190610-wechat-h502.png" alt="After"></p>
<p>æ²¡åŠæ³•ï¼Œè‡ªå·±å¼€å‘çš„H5è¦æƒ³åœ¨å¾®ä¿¡ä¸­è¿›è¡Œä¼ æ’­ï¼Œä½¿ç”¨å¾®ä¿¡ JSSDK æ˜¯å¿…ä¸å¯å°‘çš„ç¯èŠ‚ã€‚è€Œ JSSDK è™½ç„¶åªæ˜¯ä¸ª js ï¼Œå¯æ˜¯åŠ å¯†å¿…é¡»å¾—åœ¨æœåŠ¡ç«¯è¿›è¡Œã€‚</p>
<h3 id="äºŒåŸºæœ¬æµç¨‹">äºŒã€åŸºæœ¬æµç¨‹</h3>
<p><strong>1.è®¾ç½®JSæ¥å£å®‰å…¨åŸŸå</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">è¿›å…¥å¾®ä¿¡å…¬ä¼—å·å¹³å° â€”&gt; å…¬ä¼—å·è®¾ç½® â€”&gt;  åŠŸèƒ½è®¾ç½® â€”&gt;  JSæ¥å£å®‰å…¨åŸŸåï¼ˆ`test.zks.design`ï¼‰
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è®¾ç½®çš„æ—¶å€™ï¼Œå¾®ä¿¡æœ‰æ•™ä½ å¦‚ä½•å»è®¾ç½®ï¼Œå°†ä¸‹è½½çš„æ–‡ä»¶ï¼ˆMP_verify_acUZIwvhxMREbXNt.txtï¼‰æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•å°±å¯ä»¥äº†ã€‚
</span></span></code></pre></div><p><strong>2.é…ç½®ä¸€ä¸ªåŸºç¡€ url ç”¨äºè·å– jssdk çš„ config å†…å®¹</strong></p>
<p>ä½¿ç”¨çš„ url æ˜¯ <code>http://test.zks.design/jssdkconfig</code></p>
<p><strong>3.H5 é™æ€é¡µé¢å­˜æ”¾åœ¨ public/h5/ æ–‡ä»¶å¤¹ä¸‹</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å› æ­¤åœ¨è®¿é—® H5 çš„æ—¶å€™ï¼Œéœ€è¦è®¿é—®åŸŸå `http://test.zks.design/h5/xxxx/`
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å› ä¸º H5 ä¸»è¦æ˜¯åˆ†äº«ï¼Œè€Œä¸æ˜¯åŸŸåè®¿é—®ï¼Œå› æ­¤è¿™ä¸ªåŸŸåæ²¡ä»€ä¹ˆé—®é¢˜ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">H5 å‡ç›´æ¥å†™é™æ€é¡µé¢ï¼Œå¹¶ä¸ä½¿ç”¨ laravel çš„ blade æ¨¡æ¿å»å†™H5ã€‚
</span></span></code></pre></div><p><strong>4.é€šè¿‡ ajax è·å– config é…ç½®</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">åœ¨éœ€è¦è°ƒç”¨åˆ†äº«çš„é¡µé¢ä¸Šï¼Œè¿›è¡Œ config é…ç½®çš„æ—¶å€™ï¼Œé¦–å…ˆé€šè¿‡ ajax å°†åŸºæœ¬å‚æ•°ä¼ é€ç»™æœåŠ¡ç«¯urlï¼ˆ`http://test.zks.design/jssdkconfig`ï¼‰ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¸€äº›éœ€è¦çš„å‚æ•°å¯èƒ½å¦‚ä¸‹ï¼š
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¯ä»¥å‚ç…§ EasyWechat çš„æ–‡æ¡£ https://www.easywechat.com/docs/4.1/basic-services/jssdk
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å…¶ä¸­å»ºè®® $app-&gt;jssdk-&gt;setUrl($url) è®¾ç½®å½“å‰URL ä¸€å®šæ˜¯è‡ªå·±å‰ç«¯çš„é¡µé¢çš„ urlã€‚
</span></span></code></pre></div><p><strong>5.å°†è·å–åˆ°çš„ config ç›´æ¥æ”¾åœ¨ js ä¸­</strong></p>
<p>åœ¨H5é¡µé¢å¼•å…¥jsæ–‡ä»¶ï¼Œå¦åˆ™ wx.config ä¹‹ç±»æ— æ³•ä½¿ç”¨ï¼šhttp://res.wx.qq.com/open/js/jweixin-1.4.0.js</p>
<h3 id="ä¸‰å®ç°">ä¸‰ã€å®ç°</h3>
<p><strong>1ã€å®‰è£…å¹¶é…ç½® laravel-wechat</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require <span class="s2">&#34;overtrue/laravel-wechat:~4.0&#34;</span>
</span></span></code></pre></div><p>å¹¶å‘å¸ƒé…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan vendor:publish --provider<span class="o">=</span><span class="s2">&#34;Overtrue\LaravelWeChat\ServiceProvider&#34;</span>
</span></span></code></pre></div><p><strong>2.å®ç°æœåŠ¡å™¨ token éªŒè¯é€»è¾‘(åªæ˜¯åˆ†äº«çš„è¯ï¼Œè¿™æ­¥å¯ä»¥é€‰æ‹©çœç•¥)</strong></p>
<p>è¦å®ç°æœåŠ¡å™¨ token éªŒè¯ï¼Œé™¤äº†å¡«å†™å¾®ä¿¡å…¬ä¼—å·çš„é…ç½®ä¹‹å¤–ï¼Œè¿˜éœ€è¦é…ç½® config/wechat.phpã€‚å…ˆåœ¨æœåŠ¡å™¨ä»£ç å¡«å†™tokenå’ŒEncodingAESKeyï¼ˆtokenè‡ªå·±éšä¾¿å¡«ï¼‰ï¼Œç„¶åå†åœ¨å…¬ä¼—å·æœåŠ¡å™¨é…ç½®å¤„ç‚¹å‡»æäº¤ï¼ˆæ³¨æ„ä¸¤å¤„tokenä¿æŒä¸€è‡´ï¼‰</p>
<p>ä¹‹åæ˜¯éœ€è¦å¯¹ <code>http://test.zks.design/wechat </code>è¿›è¡Œç¼–ç å®ŒæˆéªŒè¯ã€‚ï¼ˆè¿™é‡Œä¸æ¶‰åŠæ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¹Ÿåœ¨è¿™é‡Œé¢è½¬å‘æˆ–å¤„ç†å³å¯ï¼‰ã€‚</p>
<p>è·¯ç”±æˆ‘æ˜¯ç›´æ¥é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// å¾®ä¿¡æ–¹é¢çš„è·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">namespace</span><span class="p">(</span><span class="s2">&#34;Wechat&#34;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="k">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Route</span><span class="o">::</span><span class="na">any</span><span class="p">(</span><span class="s1">&#39;/wechat&#39;</span><span class="p">,</span><span class="s1">&#39;WechatController@index&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Route</span><span class="o">::</span><span class="na">any</span><span class="p">(</span><span class="s1">&#39;/jssdkconfig&#39;</span><span class="p">,</span><span class="s1">&#39;WechatController@getJSSDKConfig&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p>Wechatæ§åˆ¶å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:controller Wechat/WechatController
</span></span></code></pre></div><p>å…¶ä¸­ index å‡½æ•°å¦‚ä¸‹ï¼š</p>
<p>éå¸¸ç®€å•ï¼Œè¿™ä¸ªå®Œæˆä¹‹åï¼Œå°±èƒ½å¤Ÿå®ç°å¾®ä¿¡å…¬ä¼—å·çš„ token è®¤è¯ ï¼ˆæ³¨æ„ï¼Œéœ€è¦å¯¹ config/wechat é…ç½®å’Œå…¬ä¼—å·çš„ç›¸å…³å‚æ•°åŒ¹é…æ­£ç¡®æ‰è¡Œ ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// tokenè®¤è¯åŠä¿¡æ¯ä¼ è¾“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;request arrived.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$app</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;wechat.official_account&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">serve</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>3.å®ç° jssdkConfig ä¿¡æ¯è·å–çš„é€»è¾‘</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// è·å–jssdké…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">getJSSDKConfig</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// dump(explode(&#39;,&#39;,$request-&gt;get(&#39;apis&#39;)));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$arr</span> <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;apis&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$debug</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span> <span class="o">===</span><span class="s1">&#39;true&#39;</span> <span class="o">?</span> <span class="k">true</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$json</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span> <span class="o">===</span><span class="s1">&#39;true&#39;</span> <span class="o">?</span> <span class="k">true</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$url</span> <span class="o">=</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//dump($request-&gt;get(&#39;url&#39;));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// check
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$url</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;status&#39;</span><span class="o">=&gt;</span><span class="k">false</span><span class="p">,</span><span class="s1">&#39;msg&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;params error&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$app</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;wechat.official_account&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">jssdk</span><span class="o">-&gt;</span><span class="na">setUrl</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$config</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">jssdk</span><span class="o">-&gt;</span><span class="na">buildConfig</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span><span class="nv">$debug</span><span class="p">,</span><span class="nv">$json</span><span class="p">,</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨äº† GET çš„è¯·æ±‚æ–¹å¼ã€‚</p>
<p>åŒæ—¶ä¸»è¦çš„å‚æ•°æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">- apisï¼š éœ€è¦ä½¿ç”¨çš„æ¥å£åˆ—è¡¨ ä¼ å…¥æ ¼å¼ä¸º &#34;onMenuShareTimeline,onMenuShareAppMessage&#34; è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿åˆ†å‰²æˆæ•°ç»„
</span></span><span class="line"><span class="cl">- debugï¼šä¼ å…¥çš„æ˜¯å­—ç¬¦çš„ true æˆ–è€… false
</span></span><span class="line"><span class="cl">- jsonï¼šä¼ å…¥çš„æ˜¯å­—ç¬¦çš„ true æˆ–è€… false ï¼ˆè¡¨ç¤ºç”Ÿæˆçš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥å‚è€ƒ easyWechat çš„æ–‡æ¡£ï¼‰
</span></span><span class="line"><span class="cl">- urlï¼šéœ€è¦åŠ å¯†çš„ url ï¼ˆä¼ å…¥çš„æ—¶å€™å¿…é¡»å°† &amp; è¿›è¡Œæ›¿æ¢ï¼Œå¦åˆ™ä¼šé€ æˆ config å¤±è´¥ 
</span></span></code></pre></div><p><strong>4.js è·å– config æ•°æ®</strong></p>
<p>åœ¨ H5 ä¸­ç›´æ¥ä½¿ç”¨ config çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨ js ä¸­é€šè¿‡ ajax è¯·æ±‚ url è·å–configå†…å®¹ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢æˆ‘ä½¿ç”¨çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">getjssdkconfig</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">shareLinkUlr</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;#&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// è·å–å½“å‰çš„url å»æ‰ # ä¹‹åçš„éƒ¨åˆ†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">shareLinkUlr</span> <span class="o">=</span> <span class="nx">shareLinkUlr</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\&amp;/g</span><span class="p">,</span> <span class="s1">&#39;%26&#39;</span><span class="p">);</span> <span class="c1">// å°† &amp; æ›¿æ¢æˆ %26
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">apis</span><span class="o">=</span><span class="s2">&#34;onMenuShareTimeline,onMenuShareAppMessage&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">debug</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">json</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">link</span><span class="o">=</span><span class="nx">shareLinkUlr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="s2">&#34;apis=&#34;</span><span class="o">+</span><span class="nx">apis</span><span class="o">+</span><span class="s2">&#34;&amp;debug=&#34;</span><span class="o">+</span><span class="nx">debug</span><span class="o">+</span><span class="s2">&#34;&amp;json=&#34;</span><span class="o">+</span><span class="nx">json</span><span class="o">+</span><span class="s2">&#34;&amp;url=&#34;</span><span class="o">+</span><span class="nx">link</span><span class="p">;</span> <span class="c1">// æ‹¼æ¥ get å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;get&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">url</span><span class="o">:</span><span class="s1">&#39;http://test-api.zam9.com/api/jssdkconfig?&#39;</span><span class="o">+</span><span class="nx">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">success</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">configJsSDKAndDoSomething</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">configJsSDKAndDoSomething</span><span class="p">(</span><span class="nx">config</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">wx</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">wx</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å…¶ä»–çš„ä¸€äº›æ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;æ—å’Œæˆ35é€±å¹´å¹¸é‹å¤§è½‰è¼ª&#39;</span><span class="p">,</span> <span class="c1">// åˆ†äº«æ ‡é¢˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">link</span><span class="o">:</span> <span class="s1">&#39;http://test.zam9.com&#39;</span><span class="p">,</span> <span class="c1">// åˆ†äº«é“¾æ¥ï¼Œè®°å¾—ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œä¸èƒ½ç”¨document.URL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">imgUrl</span><span class="o">:</span> <span class="s1">&#39;http://test.zam9.com/images/ettason-share.jpg&#39;</span><span class="p">,</span> <span class="c1">// åˆ†äº«å›¾æ ‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">desc</span><span class="o">:</span> <span class="s1">&#39;2019 Ettason 35th Anniversary Lucky Draw for WeChat&#39;</span><span class="p">,</span> <span class="c1">// åˆ†äº«æè¿°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;åˆ†äº«æˆåŠŸï¼&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// ç”¨æˆ·ç¡®è®¤åˆ†äº«åæ‰§è¡Œçš„å›è°ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">cancel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;å–æ¶ˆåˆ†äº«ï¼&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// ç”¨æˆ·å–æ¶ˆåˆ†äº«åæ‰§è¡Œçš„å›è°ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="nx">wx</span><span class="p">.</span><span class="nx">onMenuShareTimeline</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span> <span class="c1">// åˆ†äº«åˆ°æœ‹å‹åœˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">wx</span><span class="p">.</span><span class="nx">onMenuShareAppMessage</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span> <span class="c1">// åˆ†äº«ç»™æœ‹å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*wx.error(function(error){
</span></span></span><span class="line"><span class="cl"><span class="cm">        console.log(error);
</span></span></span><span class="line"><span class="cl"><span class="cm">    });*/</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é¡µé¢åŠ è½½å®Œä¹‹åè¿›è¡Œæ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ³¨æ„è¿™é‡Œçš„å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// apis ä½¿ç”¨çš„å‚æ•°æ˜¯ å­—ç¬¦ä¸²çš„æ‹¼æ¥ è¿™ä¸ªæ˜¯å’Œ php çš„æ–¹æ³•ä¸­çš„å¤„ç†ç›¸å¯¹åº”çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">getjssdkconfig</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></div><h3 id="å››å…³é”®çš„å‡ ç‚¹">å››ã€å…³é”®çš„å‡ ç‚¹</h3>
<p><strong>1ã€JSON.parse()</strong></p>
<p>åœ¨æ‹¿åˆ°è¿”å›çš„ json æ•°æ®ä¹‹åï¼Œéœ€è¦ JSON.parse()ï¼Œå¦åˆ™æ˜¯ä¸æ­£ç¡®çš„ js å¯¹è±¡ï¼ŒæŠ¥ config:fail é”™è¯¯</p>
<p><strong>2ã€åˆ†äº«å‡ºå»çš„é“¾æ¥ç‚¹å‡»ä¹‹åé…ç½®å¤±è´¥</strong></p>
<p>è¿™ä¸ªä¸»è¦æ˜¯å› ä¸ºåˆ†äº«å‡ºå»ä¹‹åï¼Œç”±äºå¾®ä¿¡åŠ äº†å‡ ä¸ªå‚æ•°ï¼Œå¯¼è‡´å­˜åœ¨é—®é¢˜ã€‚</p>
<p>ç½‘ä¸Šå­˜åœ¨è§£å†³æ–¹æ¡ˆå°±æ˜¯ å°† &amp; è¿›è¡Œæ›¿æ¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">shareLinkUlr</span> <span class="o">=</span> shareLinkUlr.replace<span class="o">(</span>/<span class="se">\&amp;</span>/g, <span class="s1">&#39;%26&#39;</span><span class="o">)</span><span class="p">;</span> // å°† <span class="p">&amp;</span> æ›¿æ¢æˆ %26 
</span></span></code></pre></div><p><strong>3.jsapiListä¸ºç©ºå¹¶ä¸å½±å“åˆ†äº«åŠŸèƒ½ï¼Œåªè¦configä¸ºokå³å¯ã€‚</strong></p>
<h3 id="äº”æ€»ç»“">äº”ã€æ€»ç»“</h3>
<p>å…¶å®å°±æ˜¯åç«¯ç»™ä¸ªæ¥å£ï¼Œè¿”å›å¾®ä¿¡é…ç½®æä¾›ç»™å‰ç«¯å°±å®Œäº‹äº†ã€‚ğŸ˜œ</p>
]]></content>
		</item>
		
		<item>
			<title>PHPOfficeä¹‹WordğŸ­â€</title>
			<link>https://blog.gookm.cn/posts/2019/20190321-phpoffice-word/</link>
			<pubDate>Thu, 21 Mar 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190321-phpoffice-word/</guid>
			<description>å¯¼è¯­ åœ¨åšå®Œæ ¹æ®Excelæ¨¡æ¿å¯¼å‡ºæ•°æ®åï¼Œå°±å¯¹Wordæ¨¡æ¿å¯¼å‡ºäº§ç”Ÿäº†å…´è¶£ã€‚å…¶å®åŸç†å·®ä¸å¤šã€‚æ‰€ä»¥è¿˜æ˜¯é€‰æ‹©çš„PHPOffice å¥—é¤ã€‚
PHPWordæ˜¯ä¸€ä¸ªç”¨çº¯PHPç¼–å†™çš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç”¨äºå†™å…¥å’Œè¯»å–ä¸åŒæ–‡æ¡£æ–‡ä»¶æ ¼å¼çš„ç±»ã€‚å½“å‰ç‰ˆæœ¬çš„PHPWordæ”¯æŒMicrosoft Office Open XMLï¼ˆOOXMLæˆ–OpenXMLï¼‰ï¼ŒOfficeåº”ç”¨ç¨‹åºçš„OASIS Open Document Formatï¼ˆOpenDocumentæˆ–ODFï¼‰å’ŒRTFæ ¼å¼ï¼ˆRTFï¼‰ã€‚
PHPWordæ–‡æ¡£ä¼ é€é—¨
å¼€å§‹ å®‰è£… composer require phpoffice/phpword ä½¿ç”¨ æ‹¿åˆ°åŸå§‹çš„æ¨¡æ¿è¿˜éœ€è¦åšä¸€äº›ç®€å•çš„ä¿®æ”¹ï¼š ä»£ç  &amp;lt;?php namespace App\Http\Controllers; use Illuminate\Http\Request; use PhpOffice\PhpWord\PhpWord; use PhpOffice\PhpWord\TemplateProcessor; class TestController extends Controller { . . //Word public function wordExport(Request $request) { $template = new TemplateProcessor(public_path().&amp;#39;/phpoffice/word_temp.docx&amp;#39;); //è®¾ç½®æ›¿æ¢å€¼ ï¼ˆåªèƒ½æ›¿æ¢çº¯æ–‡æœ¬ï¼‰ $template-&amp;gt;setValue( [&amp;#39;Name&amp;#39;,&amp;#39;Date&amp;#39;,&amp;#39;Address&amp;#39;,&amp;#39;Organizer&amp;#39;,&amp;#39;Activity&amp;#39;], [$request-&amp;gt;name,$request-&amp;gt;start_time,$request-&amp;gt;address,$request-&amp;gt;organizer,$request-&amp;gt;activity] ); $filename = date(&amp;#39;Y-m-d&amp;#39;, time()).rand(1000, 9999). &amp;#34;.docx&amp;#34;; //ä¿å­˜åˆ°é¡¹ç›® $template-&amp;gt;saveAs(public_path().&amp;#39;/phpoffice/&amp;#39;.$filename); //å»ºè®®ï¼šå°†æ•°æ®[&amp;#39;Name&amp;#39;,&amp;#39;Date&amp;#39;,&amp;#39;Address&amp;#39;,&amp;#39;Organizer&amp;#39;,&amp;#39;Activity&amp;#39;]å†™ä¸€ä»½åˆ°æ•°æ®åº“ //TODO return back()-&amp;gt;with([&amp;#39;success&amp;#39;=&amp;gt;&amp;#39;å¯¼å‡ºæˆåŠŸ&amp;#39;,&amp;#39;filename&amp;#39;=&amp;gt;$filename]); } } æ•ˆæœ ç»“æŸè¯­ ç›®å‰æ˜¯å°†æ–‡ä»¶ä¿å­˜åœ¨äº†é¡¹ç›®ï¼Œæƒ³è¦å®‰å…¨ç‚¹å¯ä»¥ä¸¢åˆ°Storageæ–‡ä»¶å¤¹ä¸‹æˆ–è€…ä¸Šä¼ è‡³cosï¼Œoosï¼Œä¸ƒç‰›ç­‰ã€‚ç›´æ¥è¾“å‡ºåˆ°æµè§ˆå™¨æš‚æ—¶è¿˜æ²¡æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚
ä¸åŠªåŠ›ï¼Œä½ èƒŒäº•ç¦»ä¹¡å¹²å˜›ï¼ï¼ŸåŠ æ²¹ï¼ğŸ’ª</description>
			<content type="html"><![CDATA[<h3 id="å¯¼è¯­">å¯¼è¯­</h3>
<p>åœ¨åšå®Œæ ¹æ®Excelæ¨¡æ¿å¯¼å‡ºæ•°æ®åï¼Œå°±å¯¹Wordæ¨¡æ¿å¯¼å‡ºäº§ç”Ÿäº†å…´è¶£ã€‚å…¶å®åŸç†å·®ä¸å¤šã€‚æ‰€ä»¥è¿˜æ˜¯é€‰æ‹©çš„PHPOffice å¥—é¤ã€‚</p>
<blockquote>
<p>PHPWordæ˜¯ä¸€ä¸ªç”¨çº¯PHPç¼–å†™çš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç”¨äºå†™å…¥å’Œè¯»å–ä¸åŒæ–‡æ¡£æ–‡ä»¶æ ¼å¼çš„ç±»ã€‚å½“å‰ç‰ˆæœ¬çš„PHPWordæ”¯æŒMicrosoft Office Open XMLï¼ˆOOXMLæˆ–OpenXMLï¼‰ï¼ŒOfficeåº”ç”¨ç¨‹åºçš„OASIS Open Document Formatï¼ˆOpenDocumentæˆ–ODFï¼‰å’ŒRTFæ ¼å¼ï¼ˆRTFï¼‰ã€‚</p>
</blockquote>
<p><a href="https://phpword.readthedocs.io/en/latest/">PHPWordæ–‡æ¡£ä¼ é€é—¨</a></p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190321-phpoffice-word01.jpg" alt="åŸå§‹æ¨¡æ¿"></p>
<h3 id="å¼€å§‹">å¼€å§‹</h3>
<h4 id="å®‰è£…">å®‰è£…</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require phpoffice/phpword
</span></span></code></pre></div><h4 id="ä½¿ç”¨">ä½¿ç”¨</h4>
<ul>
<li>æ‹¿åˆ°åŸå§‹çš„æ¨¡æ¿è¿˜éœ€è¦åšä¸€äº›ç®€å•çš„ä¿®æ”¹ï¼š</li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190321-phpoffice-word02.jpg" alt="ä¿®æ”¹å"></p>
<h4 id="ä»£ç ">ä»£ç </h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">PhpOffice\PhpWord\PhpWord</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">PhpOffice\PhpWord\TemplateProcessor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TestController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Word
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">wordExport</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$template</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TemplateProcessor</span><span class="p">(</span><span class="nx">public_path</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39;/phpoffice/word_temp.docx&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è®¾ç½®æ›¿æ¢å€¼ ï¼ˆåªèƒ½æ›¿æ¢çº¯æ–‡æœ¬ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">setValue</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;Address&#39;</span><span class="p">,</span><span class="s1">&#39;Organizer&#39;</span><span class="p">,</span><span class="s1">&#39;Activity&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">start_time</span><span class="p">,</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">address</span><span class="p">,</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">organizer</span><span class="p">,</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">activity</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$filename</span> <span class="o">=</span> <span class="nx">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nx">time</span><span class="p">())</span><span class="o">.</span><span class="nx">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">9999</span><span class="p">)</span><span class="o">.</span> <span class="s2">&#34;.docx&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ä¿å­˜åˆ°é¡¹ç›®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">saveAs</span><span class="p">(</span><span class="nx">public_path</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39;/phpoffice/&#39;</span><span class="o">.</span><span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//å»ºè®®ï¼šå°†æ•°æ®[&#39;Name&#39;,&#39;Date&#39;,&#39;Address&#39;,&#39;Organizer&#39;,&#39;Activity&#39;]å†™ä¸€ä»½åˆ°æ•°æ®åº“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//TODO
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">([</span><span class="s1">&#39;success&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;å¯¼å‡ºæˆåŠŸ&#39;</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="o">=&gt;</span><span class="nv">$filename</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="æ•ˆæœ">æ•ˆæœ</h4>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190321-phpoffice-word03.jpg" alt="å®Œæˆæ•ˆæœå›¾"></p>
<h3 id="ç»“æŸè¯­">ç»“æŸè¯­</h3>
<p>ç›®å‰æ˜¯å°†æ–‡ä»¶ä¿å­˜åœ¨äº†é¡¹ç›®ï¼Œæƒ³è¦å®‰å…¨ç‚¹å¯ä»¥ä¸¢åˆ°<code>Storage</code>æ–‡ä»¶å¤¹ä¸‹æˆ–è€…ä¸Šä¼ è‡³<code>cos</code>ï¼Œ<code>oos</code>ï¼Œ<code>ä¸ƒç‰›</code>ç­‰ã€‚ç›´æ¥è¾“å‡ºåˆ°æµè§ˆå™¨æš‚æ—¶è¿˜æ²¡æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>ä¸åŠªåŠ›ï¼Œä½ èƒŒäº•ç¦»ä¹¡å¹²å˜›ï¼ï¼ŸåŠ æ²¹ï¼ğŸ’ª</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>PHPOfficeä¹‹ExcelğŸœ</title>
			<link>https://blog.gookm.cn/posts/2019/20190320-phpoffice-excel/</link>
			<pubDate>Wed, 20 Mar 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190320-phpoffice-excel/</guid>
			<description>å¯¼è¯­ ç®€å•çš„æ•°æ®å¯¼å…¥å¯¼å‡ºå…¶å® Maatwebsite/Laravel-Excel å’Œ box/spout å°±å¤Ÿäº†ï¼Œå¬è¯´spoutåœ¨å¤§é‡æ•°æ®ä¸‹æ•ˆç‡è¾ƒLaravel-Excel å¿«ã€‚è¿™æ¬¡å› ä¸ºè¦æ ¹æ®Excelæ¨¡æ¿å¯¼å‡ºï¼Œåœ¨è¿™ä¸¤ä¸ªåŒ…æ²¡æ‰¾åˆ°æ€ä¹ˆå¼•å…¥æ¨¡æ¿çš„æ–¹æ³•ï¼Œè™½ç„¶å¯ä»¥è®¾ç½®ï¼Œä½†æ˜¯è¿‡äºéº»çƒ¦ï¼Œå°±æ”¾å¼ƒäº†ã€‚æœ€ç»ˆé€‰æ‹©äº† PHPOffice/PhpSpreadsheet ã€‚
PhpSpreadsheetæ˜¯ä¸€ä¸ªç”¨çº¯PHPç¼–å†™çš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç±»ï¼Œå…è®¸æ‚¨è¯»å–å’Œå†™å…¥ä¸åŒçš„ç”µå­è¡¨æ ¼æ–‡ä»¶æ ¼å¼ï¼Œå¦‚Excelå’ŒLibreOffice Calcã€‚
PhpSpreadsheetæ–‡æ¡£ä¼ é€é—¨
å®‰è£… composer require phpoffice/phpspreadsheet ä½¿ç”¨ &amp;lt;?php namespace App\Http\Controllers; use Illuminate\Http\Request; use App\Models\TreasureLog; use Carbon\Carbon; use Illuminate\Support\Facades\Auth; use PhpOffice\PhpSpreadsheet\Spreadsheet; use PhpOffice\PhpSpreadsheet\Writer\Xlsx; //å¯ä»¥ç”Ÿæˆå¤šç§æ ¼å¼ç±» use PhpOffice\PhpSpreadsheet\IOFactory; use PhpOffice\PhpSpreadsheet\Style\Alignment; use PhpOffice\PhpSpreadsheet\Style\Border; class TestController extends Controller{ . . public function excelExport() { $rows=TreasureLog::select(&amp;#39;id&amp;#39;,&amp;#39;user_id&amp;#39;,&amp;#39;product_id&amp;#39;,&amp;#39;product_name&amp;#39;,&amp;#39;type&amp;#39;,&amp;#39;coin_type&amp;#39;)-&amp;gt;limit(100)-&amp;gt;get()-&amp;gt;toArray(); //é€šè¿‡å·¥å‚æ¨¡å¼åˆ›å»ºå†…å®¹ $spreadsheet = IOFactory::load(public_path().&amp;#39;/phpoffice/biser.xlsx&amp;#39;); $worksheet = $spreadsheet-&amp;gt;getActiveSheet(); $worksheet-&amp;gt;setCellValue(&amp;#39;B8&amp;#39;,rand(100000,999999)); $worksheet-&amp;gt;setCellValue(&amp;#39;B9&amp;#39;,Carbon::now()); $worksheet-&amp;gt;setCellValue(&amp;#39;B10&amp;#39;,Auth::user()-&amp;gt;name); $num=12; foreach ($rows as $row){ $num++; $worksheet-&amp;gt;setCellValue(&amp;#39;A&amp;#39;.$num,$row[&amp;#39;id&amp;#39;]); $worksheet-&amp;gt;setCellValue(&amp;#39;B&amp;#39;.$num,$row[&amp;#39;user_id&amp;#39;]); $worksheet-&amp;gt;setCellValue(&amp;#39;D&amp;#39;.$num,$row[&amp;#39;product_id&amp;#39;]); $worksheet-&amp;gt;setCellValue(&amp;#39;F&amp;#39;.$num,$row[&amp;#39;product_name&amp;#39;]); $worksheet-&amp;gt;setCellValue(&amp;#39;H&amp;#39;.</description>
			<content type="html"><![CDATA[<h3 id="å¯¼è¯­">å¯¼è¯­</h3>
<blockquote>
<p>ç®€å•çš„æ•°æ®å¯¼å…¥å¯¼å‡ºå…¶å® <a href="https://github.com/Maatwebsite">Maatwebsite/Laravel-Excel</a> å’Œ <a href="https://github.com/box">box/spout</a> å°±å¤Ÿäº†ï¼Œå¬è¯´<code>spout</code>åœ¨å¤§é‡æ•°æ®ä¸‹æ•ˆç‡è¾ƒ<code>Laravel-Excel</code> å¿«ã€‚è¿™æ¬¡å› ä¸ºè¦æ ¹æ®<code>Excel</code>æ¨¡æ¿å¯¼å‡ºï¼Œåœ¨è¿™ä¸¤ä¸ªåŒ…æ²¡æ‰¾åˆ°æ€ä¹ˆå¼•å…¥æ¨¡æ¿çš„æ–¹æ³•ï¼Œè™½ç„¶å¯ä»¥è®¾ç½®ï¼Œä½†æ˜¯è¿‡äºéº»çƒ¦ï¼Œå°±æ”¾å¼ƒäº†ã€‚æœ€ç»ˆé€‰æ‹©äº† <code>PHPOffice/PhpSpreadsheet</code> ã€‚</p>
</blockquote>
<blockquote>
<p><a href="https://github.com/PHPOffice/PhpSpreadsheet">PhpSpreadsheet</a>æ˜¯ä¸€ä¸ªç”¨çº¯PHPç¼–å†™çš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç±»ï¼Œå…è®¸æ‚¨è¯»å–å’Œå†™å…¥ä¸åŒçš„ç”µå­è¡¨æ ¼æ–‡ä»¶æ ¼å¼ï¼Œå¦‚Excelå’ŒLibreOffice Calcã€‚</p>
</blockquote>
<p><a href="https://phpoffice.github.io/PhpSpreadsheet/master/PhpOffice.html">PhpSpreadsheetæ–‡æ¡£ä¼ é€é—¨</a></p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190320-phpoffice-excel01.jpg" alt="Excelæ¨¡æ¿æ•ˆæœå›¾"></p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require phpoffice/phpspreadsheet
</span></span></code></pre></div><h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\TreasureLog</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\Spreadsheet</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\Writer\Xlsx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å¯ä»¥ç”Ÿæˆå¤šç§æ ¼å¼ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\IOFactory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\Style\Alignment</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\Style\Border</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TestController</span> <span class="k">extends</span> <span class="nx">Controller</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">excelExport</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$rows</span><span class="o">=</span><span class="nx">TreasureLog</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span><span class="s1">&#39;product_name&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;coin_type&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//é€šè¿‡å·¥å‚æ¨¡å¼åˆ›å»ºå†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$spreadsheet</span> <span class="o">=</span> <span class="nx">IOFactory</span><span class="o">::</span><span class="na">load</span><span class="p">(</span><span class="nx">public_path</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39;/phpoffice/biser.xlsx&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$worksheet</span> <span class="o">=</span> <span class="nv">$spreadsheet</span><span class="o">-&gt;</span><span class="na">getActiveSheet</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;B8&#39;</span><span class="p">,</span><span class="nx">rand</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">999999</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;B9&#39;</span><span class="p">,</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;B10&#39;</span><span class="p">,</span><span class="nx">Auth</span><span class="o">::</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$num</span><span class="o">=</span><span class="mi">12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$rows</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$num</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;product_name&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;coin_type&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$styleArray</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;borders&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;outline&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;borderStyle&#39;</span> <span class="o">=&gt;</span> <span class="nx">Border</span><span class="o">::</span><span class="na">BORDER_THIN</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;argb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;00000000&#39;</span><span class="p">],</span>                        <span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;alignment&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;horizontal&#39;</span> <span class="o">=&gt;</span> <span class="nx">Alignment</span><span class="o">::</span><span class="na">HORIZONTAL_CENTER</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$styleArray_</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;borders&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;outline&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;borderStyle&#39;</span> <span class="o">=&gt;</span> <span class="nx">Border</span><span class="o">::</span><span class="na">BORDER_THIN</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;argb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;00000000&#39;</span><span class="p">],</span>                        <span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//è®¾ç½®è¶…å‡ºéƒ¨åˆ†æ ·å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">mergeCells</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:C&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">mergeCells</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:E&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">mergeCells</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:G&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">mergeCells</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:I&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">getRowDimension</span><span class="p">(</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setRowHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:J&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$filename</span> <span class="o">=</span> <span class="nx">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nx">time</span><span class="p">())</span><span class="o">.</span><span class="nx">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">9999</span><span class="p">)</span><span class="o">.</span> <span class="s2">&#34;.xlsx&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ç¬¬ä¸€ç§ä¿å­˜æ–¹å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>       <span class="cm">/* $writer = new Xlsx($spreadsheet);//å†™å…¥ç±»å‹å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="cm">        $filename=public_path().&#39;/phpoffice/&#39;.$filename;//æ–‡ä»¶è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="cm">        $writer-&gt;save($filename);//å†™å…¥*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//ç¬¬äºŒç§ç›´æ¥é¡µé¢ä¸Šæ˜¾ç¤ºä¸‹è½½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Disposition: attachment;filename=&#34;&#39;</span><span class="o">.</span><span class="nv">$filename</span> <span class="o">.</span> <span class="s1">&#39;.xlsx&#34;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Cache-Control: max-age=0&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æ³¨æ„createWriter($spreadsheet, &#39;Xls&#39;) ç¬¬äºŒä¸ªå‚æ•°é¦–å­—æ¯å¿…é¡»å¤§å†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$writer</span> <span class="o">=</span> <span class="nx">IOFactory</span><span class="o">::</span><span class="na">createWriter</span><span class="p">(</span><span class="nv">$spreadsheet</span><span class="p">,</span> <span class="s1">&#39;Xlsx&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$writer</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="s1">&#39;php://output&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//        return response(json_encode([&#39;status&#39;=&gt;1,&#39;msg&#39;=&gt;&#39;å¯¼å‡ºæˆåŠŸ&#39;,&#39;data&#39;=&gt;$rows]));//ajax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="æ•ˆæœ">æ•ˆæœ</h3>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190320-phpoffice-excel02.jpg" alt="å®Œæˆæ•ˆæœå›¾"></p>
<h3 id="ç»“æŸè¯­">ç»“æŸè¯­</h3>
<blockquote>
<p>æ‘†è„±æ‚²è§‚ï¼Œæ‹¥æŠ±æ»¡æº¢è€Œå‡ºçš„å¸Œæœ›ï¼Œæœç€æ¢¦æƒ³ï¼Œå‡†å¤‡å‡ºå‘ã€‚ğŸ€</p>
</blockquote>
<p>å‚è€ƒï¼š</p>
<p><a href="http://www.heibaiketang.com/blog/show/69.html">http://www.heibaiketang.com/blog/show/69.html</a></p>
<p><a href="https://blog.csdn.net/gc258_2767_qq/article/details/81003656">https://blog.csdn.net/gc258_2767_qq/article/details/81003656</a></p>
]]></content>
		</item>
		
		<item>
			<title>Notificationä¹‹çº¢æ ‡è¯†æé†’ğŸš¨â€</title>
			<link>https://blog.gookm.cn/posts/2019/20190315-laravel-notify/</link>
			<pubDate>Fri, 15 Mar 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190315-laravel-notify/</guid>
			<description>å¯¼è¯­ Laravel è‡ªå¸¦äº†ä¸€å¥—æå…·æ‰©å±•æ€§çš„æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿï¼Œå°¤å…¶è¿˜æ”¯æŒå¤šç§é€šçŸ¥é¢‘é“(è¿™é‡Œæˆ‘ç”¨çš„æ˜¯æ•°æ®åº“é€šçŸ¥é¢‘é“)ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨æ­¤å¥—ç³»ç»Ÿæ¥å‘ç”¨æˆ·å‘é€æ¶ˆæ¯æé†’ã€‚
æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
å¼€å§‹ å‡†å¤‡åŸºæœ¬çš„åŠŸèƒ½å¼€å‘ ä¸€ä¸ªç”¨æˆ·ç»™å¦å¤–ä¸€ä¸ªç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå°†ä¿¡æ¯å­˜å…¥æ•°æ®åº“è¡¨ï¼ˆnotify_testsè¡¨ï¼‰
id msg send_id rev_id updated_at created_at 1 å•Šå“ˆå“ˆ	å“ˆ 1 2 2019-03-15 02:34:13 2019-03-15 02:34:13 å‡†å¤‡æ•°æ® é€šçŸ¥æ•°æ®åº“,å­˜å‚¨æ‰€æœ‰é€šçŸ¥ä¿¡æ¯ 1.php artisan notifications:table 2.php artisan migrate è·Ÿè¸ªç”¨æˆ·æœ‰å¤šå°‘æœªè¯»é€šçŸ¥(ç»™userè¡¨åŠ å­—æ®µ) 1.php artisan make:migration add_notification_count_to_users_table --table=users 2.//database/migrations/{$timestamp}_add_notification_count_to_users_table.php public function up() { Schema::table(&amp;#39;users&amp;#39;, function (Blueprint $table) { $table-&amp;gt;integer(&amp;#39;notification_count&amp;#39;)-&amp;gt;unsigned()-&amp;gt;default(0); }); } public function down() { Schema::table(&amp;#39;users&amp;#39;, function (Blueprint $table) { $table-&amp;gt;dropColumn(&amp;#39;notification_count&amp;#39;); }); } 3.php artisan migrate ç”Ÿæˆé€šçŸ¥ç±» php artisan make:notification MessageRecived ä¿®æ”¹æ–‡ä»¶ä¸ºä»¥ä¸‹ï¼šapp/Notifications/TopicReplied.php &amp;lt;?</description>
			<content type="html"><![CDATA[<h3 id="å¯¼è¯­">å¯¼è¯­</h3>
<p>Laravel è‡ªå¸¦äº†ä¸€å¥—æå…·æ‰©å±•æ€§çš„æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿï¼Œå°¤å…¶è¿˜æ”¯æŒå¤šç§é€šçŸ¥é¢‘é“(è¿™é‡Œæˆ‘ç”¨çš„æ˜¯æ•°æ®åº“é€šçŸ¥é¢‘é“)ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨æ­¤å¥—ç³»ç»Ÿæ¥å‘ç”¨æˆ·å‘é€æ¶ˆæ¯æé†’ã€‚</p>
<p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190315-laravel-notify01.png" alt="è¡¨å•æ•ˆæœ"></p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190315-laravel-notify02.png" alt="æ¶ˆæ¯åˆ—è¡¨æ•ˆæœ"></p>
<h3 id="å¼€å§‹">å¼€å§‹</h3>
<h4 id="å‡†å¤‡åŸºæœ¬çš„åŠŸèƒ½å¼€å‘">å‡†å¤‡åŸºæœ¬çš„åŠŸèƒ½å¼€å‘</h4>
<p>ä¸€ä¸ªç”¨æˆ·ç»™å¦å¤–ä¸€ä¸ªç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå°†ä¿¡æ¯å­˜å…¥æ•°æ®åº“è¡¨ï¼ˆ<code>notify_tests</code>è¡¨ï¼‰</p>
<table>
<thead>
<tr>
<th>id</th>
<th>msg</th>
<th>send_id</th>
<th>rev_id</th>
<th>updated_at</th>
<th>created_at</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>å•Šå“ˆå“ˆ	å“ˆ</td>
<td>1</td>
<td>2</td>
<td>2019-03-15 02:34:13</td>
<td>2019-03-15 02:34:13</td>
</tr>
</tbody>
</table>
<h4 id="å‡†å¤‡æ•°æ®">å‡†å¤‡æ•°æ®</h4>
<ul>
<li>é€šçŸ¥æ•°æ®åº“,å­˜å‚¨æ‰€æœ‰é€šçŸ¥ä¿¡æ¯</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.php artisan notifications:table
</span></span><span class="line"><span class="cl">2.php artisan migrate
</span></span></code></pre></div><ul>
<li>è·Ÿè¸ªç”¨æˆ·æœ‰å¤šå°‘æœªè¯»é€šçŸ¥(ç»™<code>user</code>è¡¨åŠ å­—æ®µ)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="mf">1.</span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">add_notification_count_to_users_table</span> <span class="o">--</span><span class="nx">table</span><span class="o">=</span><span class="nx">users</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="mf">2.</span><span class="c1">//database/migrations/{$timestamp}_add_notification_count_to_users_table.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;notification_count&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">unsigned</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">default</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">dropColumn</span><span class="p">(</span><span class="s1">&#39;notification_count&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mf">3.</span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</span></span></code></pre></div><h4 id="ç”Ÿæˆé€šçŸ¥ç±»">ç”Ÿæˆé€šçŸ¥ç±»</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:notification MessageRecived
</span></span></code></pre></div><ul>
<li>ä¿®æ”¹æ–‡ä»¶ä¸ºä»¥ä¸‹ï¼š<code>app/Notifications/TopicReplied.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Notifications</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\NotifyTest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Notifications\Notification</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Notifications\Messages\MailMessage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MessageRecived</span> <span class="k">extends</span> <span class="nx">Notification</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">Queueable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$notifyTest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">NotifyTest</span> <span class="nv">$notifyTest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notifyTest</span><span class="o">=</span><span class="nv">$notifyTest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">via</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">toDatabase</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å­˜å…¥æ•°æ®åº“é‡Œçš„æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$send_name</span><span class="o">=</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notifyTest</span><span class="o">-&gt;</span><span class="na">send_id</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$rev_name</span><span class="o">=</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notifyTest</span><span class="o">-&gt;</span><span class="na">rev_id</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;msg&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notifyTest</span><span class="o">-&gt;</span><span class="na">msg</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;send_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notifyTest</span><span class="o">-&gt;</span><span class="na">send_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;send_name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$send_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;rev_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notifyTest</span><span class="o">-&gt;</span><span class="na">rev_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;rev_name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$rev_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">toMail</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">MailMessage</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">-&gt;</span><span class="na">line</span><span class="p">(</span><span class="s1">&#39;The introduction to the notification.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">-&gt;</span><span class="na">action</span><span class="p">(</span><span class="s1">&#39;Notification Action&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="o">-&gt;</span><span class="na">line</span><span class="p">(</span><span class="s1">&#39;Thank you for using our application!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="è§¦å‘é€šçŸ¥">è§¦å‘é€šçŸ¥</h4>
<ul>
<li>å½“ç”¨æˆ·ç»™å¦å¤–ä¸€ä¸ªç”¨æˆ·å‘é€æ¶ˆæ¯åï¼Œé€šçŸ¥åˆ°æ¥æ”¶ç”¨æˆ·ã€‚æ•…è§¦å‘é€šçŸ¥çš„æ—¶æœºæ˜¯ï¼šã€æ¶ˆæ¯å‘é€æˆåŠŸåã€ï¼Œåœ¨æ¨¡å‹ç›‘æ§å™¨é‡Œï¼ˆ<code>app/Observers/NotifyTestObserver.php</code>ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>created</code> æ–¹æ³•é‡Œå®ç°æ­¤éƒ¨åˆ†ä»£ç ã€‚</li>
</ul>
<p>1.åˆ›å»ºæ–°çš„è§‚å¯Ÿè€…ç±»</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:observer NotifyTestObserver --model<span class="o">=</span>NotifyTest
</span></span></code></pre></div><p>2.<code>app/Observers/NotifyTestObserver.php</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Observers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Notifications\MessageRecived</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\NotifyTest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NotifyTestObserver</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">created</span><span class="p">(</span><span class="nx">NotifyTest</span> <span class="nv">$notifyTest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// é€šçŸ¥è¯¥ç”¨æˆ·æœ‰æ–°çš„æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// User æ¨¡å‹ä¸­ä½¿ç”¨äº† trait â€”â€” Notifiableï¼Œå®ƒåŒ…å«ç€ä¸€ä¸ªå¯ä»¥ç”¨æ¥å‘é€šçŸ¥çš„æ–¹æ³• notify()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$notifyTest</span><span class="o">-&gt;</span><span class="na">rev_id</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">MessageRecived</span><span class="p">(</span><span class="nv">$notifyTest</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>3.<code>app/User.php</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Auth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">Notifiable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">notify</span> <span class="k">as</span> <span class="k">protected</span> <span class="nx">laravelNotify</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">(</span><span class="nv">$instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å¦‚æœè¦é€šçŸ¥çš„äººæ˜¯å½“å‰ç”¨æˆ·ï¼Œå°±ä¸å¿…é€šçŸ¥äº†ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">==</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">id</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// åªæœ‰æ•°æ®åº“ç±»å‹é€šçŸ¥æ‰éœ€æé†’ï¼Œç›´æ¥å‘é€ Email æˆ–è€…å…¶ä»–çš„éƒ½ Pass
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">method_exists</span><span class="p">(</span><span class="nv">$instance</span><span class="p">,</span> <span class="s1">&#39;toDatabase&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">increment</span><span class="p">(</span><span class="s1">&#39;notification_count&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">laravelNotify</span><span class="p">(</span><span class="nv">$instance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="æ¶ˆæ¯åˆ—è¡¨">æ¶ˆæ¯åˆ—è¡¨</h4>
<ul>
<li>æ¸…é™¤æœªè¯»æ¶ˆæ¯æ ‡ç¤ºï¼Œåœ¨ <code>User</code> æ¨¡å‹ä¸­æ–°å¢ <code>markAsRead()</code> æ–¹æ³•</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">markAsRead</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notification_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unreadNotifications</span><span class="o">-&gt;</span><span class="na">markAsRead</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>æ¸…ç©ºæœªè¯»æé†’çš„çŠ¶æ€ï¼Œapp\Http\Controllers\TestController</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//æœªè¯»æ¶ˆæ¯åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">msgList</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$msgLists</span><span class="o">=</span><span class="nx">\Auth</span><span class="o">::</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">notifications</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ ‡è®°ä¸ºå·²è¯»ï¼Œæœªè¯»æ•°é‡æ¸…é›¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">\Auth</span><span class="o">::</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">markAsRead</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;msg_list&#39;</span><span class="p">,</span><span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;msgLists&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>æ¶ˆæ¯æ ‡è¯†htmlä»£ç ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-item notification-badge&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link mr-3 badge badge-pill badge-{{ Auth::user()-&gt;notification_count &gt; 0 ? &#39;hint&#39; : &#39;secondary&#39; }} text-white&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{route(&#39;msgList&#39;)}}&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        {{auth(&#39;web&#39;)-&gt;user()-&gt;notification_count}}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="ç»“æŸè¯­">ç»“æŸè¯­</h3>
<p>é¡¹ç›®å¼€å‘ä¸­é‡åˆ°äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¹ŸèŠ±æ—¶é—´åšäº†ä¸ª<code>DEMO</code>ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>ä»Šå¤©æ˜¯ä½ ä½™ç”Ÿä¸­æœ€å¹´è½»çš„ä¸€å¤©ã€‚ğŸ’ª</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>æ€§èƒ½ä¼˜åŒ–ä¹‹MySQLä¼˜åŒ–ğŸš´â€</title>
			<link>https://blog.gookm.cn/posts/2019/20190309-mysql-opt/</link>
			<pubDate>Sat, 09 Mar 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190309-mysql-opt/</guid>
			<description>SQLè¯­å¥ä¼˜åŒ– æ…¢æŸ¥è¯¢ å¦‚ä½•å‘ç°æœ‰é—®é¢˜çš„SQLï¼Ÿä½¿ç”¨mysqlæ…¢æŸ¥è¯¢æ—¥å¿—å¯¹æœ‰æ•ˆç‡é—®é¢˜çš„SQLè¿›è¡Œç›‘æ§
//æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ show variables like &amp;#39;slow_query_log&amp;#39;; //æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—å­˜å‚¨ä½ç½® show variables like &amp;#39;slow_query_log_file&amp;#39;; //å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿— set global slow_query_log=on; //æŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—å­˜å‚¨ä½ç½® set global show_query_log_file=&amp;#39;/var/lib/mysql/homestead-slow.log&amp;#39;; //è®°å½•æ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„sql set global log_queries_not_using_indexes=on; //è®°å½•æŸ¥è¯¢è¶…è¿‡1sçš„sql set global long_query_time=1; æ…¢æŸ¥è¯¢æ—¥å¿—æ‰€åŒ…å«çš„å†…å®¹ï¼š
#User@Host:root[root] @localhost[]//æ‰§è¡Œsqlçš„ä¸»æœºä¿¡æ¯ #Query_time:0.0000024 Lock_time:0.00 Rows_sent:0 Rows_esamined:0//sqlçš„æ‰§è¡Œä¿¡æ¯ SET timestamp=1402389324//sqlæ‰§è¡Œæ—¶é—´ select * from store; //sqlçš„å†…å®¹ MySQLæ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ä¹‹mysqldumpslowï¼ˆmysqlå®˜æ–¹ï¼‰
å®‰è£…å®ŒMySQLåï¼Œé»˜è®¤å°±å¸¦äº†mysqldumpslowï¼Œå¾ˆå¸¸ç”¨çš„ä¸€ä¸ªå·¥å…·ã€‚
//æŸ¥çœ‹å‚æ•°åˆ—è¡¨ mysqldumpslow -h //åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ä¸­å‰ä¸‰æ¡æ¯”è¾ƒæ…¢çš„sql mysqldumpslow -t 3 /var/lib/mysql/homestead-slow.log | more //è¾“å‡ºæ ·å¼æ•ˆæœ Count:1 Time:0.00s Lock=0.00s Rows=10.0 root[rppt]@localhost select * from store MySQLæ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ä¹‹pt-query-digest
åˆ†æç»“æœæ¯”mysqldumpslowæ›´è¯¦ç»†å…¨é¢
//è¾“å‡ºåˆ°æ–‡ä»¶ pt-query-digest slow-log &amp;gt; slow_log.</description>
			<content type="html"><![CDATA[<h3 id="sqlè¯­å¥ä¼˜åŒ–">SQLè¯­å¥ä¼˜åŒ–</h3>
<h4 id="æ…¢æŸ¥è¯¢">æ…¢æŸ¥è¯¢</h4>
<p>å¦‚ä½•å‘ç°æœ‰é—®é¢˜çš„SQLï¼Ÿä½¿ç”¨mysqlæ…¢æŸ¥è¯¢æ—¥å¿—å¯¹æœ‰æ•ˆç‡é—®é¢˜çš„SQLè¿›è¡Œç›‘æ§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">//æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯
</span></span><span class="line"><span class="cl">show variables like &#39;slow_query_log&#39;;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—å­˜å‚¨ä½ç½®
</span></span><span class="line"><span class="cl">show variables like &#39;slow_query_log_file&#39;;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
</span></span><span class="line"><span class="cl">set global slow_query_log=on;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//æŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—å­˜å‚¨ä½ç½®
</span></span><span class="line"><span class="cl">set global show_query_log_file=&#39;/var/lib/mysql/homestead-slow.log&#39;;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//è®°å½•æ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„sql
</span></span><span class="line"><span class="cl">set global log_queries_not_using_indexes=on;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//è®°å½•æŸ¥è¯¢è¶…è¿‡1sçš„sql
</span></span><span class="line"><span class="cl">set global long_query_time=1;
</span></span></code></pre></div><p>æ…¢æŸ¥è¯¢æ—¥å¿—æ‰€åŒ…å«çš„å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">#User@Host:root[root] @localhost[]//æ‰§è¡Œsqlçš„ä¸»æœºä¿¡æ¯
</span></span><span class="line"><span class="cl">#Query_time:0.0000024 Lock_time:0.00 Rows_sent:0 Rows_esamined:0//sqlçš„æ‰§è¡Œä¿¡æ¯
</span></span><span class="line"><span class="cl">SET timestamp=1402389324//sqlæ‰§è¡Œæ—¶é—´
</span></span><span class="line"><span class="cl">select * from store; //sqlçš„å†…å®¹
</span></span></code></pre></div><p><strong>MySQLæ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ä¹‹mysqldumpslowï¼ˆmysqlå®˜æ–¹ï¼‰</strong></p>
<p>å®‰è£…å®ŒMySQLåï¼Œé»˜è®¤å°±å¸¦äº†mysqldumpslowï¼Œå¾ˆå¸¸ç”¨çš„ä¸€ä¸ªå·¥å…·ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">//æŸ¥çœ‹å‚æ•°åˆ—è¡¨
</span></span><span class="line"><span class="cl">mysqldumpslow -h
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ä¸­å‰ä¸‰æ¡æ¯”è¾ƒæ…¢çš„sql
</span></span><span class="line"><span class="cl">mysqldumpslow -t 3 /var/lib/mysql/homestead-slow.log | more 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//è¾“å‡ºæ ·å¼æ•ˆæœ
</span></span><span class="line"><span class="cl">Count:1 Time:0.00s Lock=0.00s Rows=10.0
</span></span><span class="line"><span class="cl">root[rppt]@localhost
</span></span><span class="line"><span class="cl">select * from store
</span></span></code></pre></div><p><strong>MySQLæ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ä¹‹pt-query-digest</strong></p>
<p>åˆ†æç»“æœæ¯”mysqldumpslowæ›´è¯¦ç»†å…¨é¢</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">//è¾“å‡ºåˆ°æ–‡ä»¶
</span></span><span class="line"><span class="cl">pt-query-digest slow-log &gt; slow_log.report
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//è¾“å‡ºåˆ°æ•°æ®è¡¨
</span></span><span class="line"><span class="cl">pt-query-digest slow.log -review \
</span></span><span class="line"><span class="cl">    h=127.0.0.1,D=test,p=root,P=3306,u=root,t=query_review \
</span></span><span class="line"><span class="cl">    --create-reviewtable \
</span></span><span class="line"><span class="cl">    --review-history t=hostname_slow
</span></span></code></pre></div><p>åŸºæœ¬ä½¿ç”¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">//æŸ¥çœ‹å‚æ•°åˆ—è¡¨
</span></span><span class="line"><span class="cl">pt-query-digest --help
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ä¸­å‰ä¸‰æ¡æ¯”è¾ƒæ…¢çš„sql
</span></span><span class="line"><span class="cl">pt-query-digest /var/lib/mysql/homestead-slow.log | more 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//è¾“å‡ºåˆ†ä¸ºä¸‰éƒ¨åˆ†
</span></span><span class="line"><span class="cl">1.æ˜¾ç¤ºé™¤äº†æ—¥å¿—çš„æ—¶é—´èŒƒå›´ï¼Œä»¥åŠæ€»çš„sqlæ•°é‡å’Œä¸åŒçš„sqlæ•°é‡
</span></span><span class="line"><span class="cl">2.Response Time:å“åº”æ—¶é—´å æ¯” Calls:sqlæ‰§è¡Œæ¬¡æ•°
</span></span><span class="line"><span class="cl">3.sqlçš„å…·ä½“æ—¥å¿—
</span></span></code></pre></div><p>å¦‚ä½•é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—å‘ç°æœ‰é—®é¢˜çš„SQLï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.æŸ¥è¯¢æ¬¡æ•°å¤šä¸”æ¯æ¬¡æŸ¥è¯¢å ç”¨æ—¶é—´é•¿çš„SQL
</span></span><span class="line"><span class="cl">é€šå¸¸ä¸ºpt-query-digeståˆ†æçš„å‰å‡ ä¸ªæŸ¥è¯¢
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.IOå¤§çš„SQLï¼ˆæ•°æ®åº“ä¸»è¦ç“¶é¢ˆå‡ºç°åœ¨IOå±‚æ¬¡ï¼‰
</span></span><span class="line"><span class="cl">æ³¨æ„pt-query-digeståˆ†æä¸­çš„Rows examineé¡¹
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.æœªå‘½ä¸­ç´¢å¼•çš„SQL
</span></span><span class="line"><span class="cl">æ³¨æ„pt-query-digeståˆ†æä¸­çš„Rows examineå’ŒRows Sendçš„å¯¹æ¯”
</span></span></code></pre></div><p>é€šè¿‡explainæŸ¥è¯¢å’Œåˆ†æSQLçš„æ‰§è¡Œè®¡åˆ’</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,,</span><span class="n">first_name</span><span class="p">,</span><span class="n">last_name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">customer</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><table>
<thead>
<tr>
<th>Column 1</th>
<th>Column 2</th>
<th>Column 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td></td>
<td></td>
</tr>
<tr>
<td>select_type</td>
<td>SIMPLE</td>
<td></td>
</tr>
<tr>
<td>table</td>
<td>customer</td>
<td>è¯¥æ•°æ®å…³äºå“ªå¼ è¡¨ã€‚</td>
</tr>
<tr>
<td>type</td>
<td>ALL</td>
<td>ç¤ºè¿æ¥ä½¿ç”¨äº†ä½•ç§ç±»å‹ã€‚ä»å¥½åˆ°å·®const,eq_reg,ref,range,indexå’ŒALLã€‚</td>
</tr>
<tr>
<td>possible_keys</td>
<td>NULL</td>
<td>å¯èƒ½åº”ç”¨åœ¨è¯¥è¡¨çš„ç´¢å¼•ï¼Œç©ºï¼Œæ²¡æœ‰å¯èƒ½çš„ç´¢å¼•ã€‚</td>
</tr>
<tr>
<td>key</td>
<td>NULL</td>
<td>å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚ç©ºï¼Œæ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</td>
</tr>
<tr>
<td>key_len</td>
<td>NULL</td>
<td>ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦ã€‚ä¸æŸå¤±ç²¾åº¦ä¸‹ï¼Œè¶ŠçŸ­è¶Šå¥½ã€‚</td>
</tr>
<tr>
<td>ref</td>
<td>NULL</td>
<td>æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¸¸æ•°ã€‚</td>
</tr>
<tr>
<td>rows</td>
<td>671</td>
<td>mysqlè®¤ä¸ºå¿…é¡»æ£€æŸ¥çš„æ•°æ®çš„è¡Œæ•°ã€‚</td>
</tr>
<tr>
<td>Extra</td>
<td>'</td>
<td>æ³¨æ„ï¼šUsing filesort,Using tempoary</td>
</tr>
</tbody>
</table>
<h4 id="countå’Œmaxçš„ä¼˜åŒ–">Count()å’ŒMax()çš„ä¼˜åŒ–</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">//æŸ¥è¯¢æœ€åæ”¯ä»˜æ—¶é—´--ä¼˜åŒ–max()å‡½æ•°
</span></span><span class="line"><span class="cl">explain select max(payment_date) from payment;
</span></span><span class="line"><span class="cl">create index idx_paydate on payment(payment_data);//ç»™payment_dateå»ºç«‹ç´¢å¼•(è¦†ç›–ç´¢å¼•)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//åœ¨ä¸€æ¡SQLä¸­åŒæ—¶æŸ¥å‡º2006å¹´å’Œ2007å¹´ç”µå½±çš„æ•°é‡--ä¼˜åŒ–Count()å‡½æ•°
</span></span><span class="line"><span class="cl">select count(release_year=&#39;2006&#39; or null) as &#39;2006å¹´ç”µå½±æ•°é‡&#39;ï¼Œcount(release_year=&#39;2007&#39; or null) as &#39;2007å¹´ç”µå½±æ•°é‡&#39; from film;
</span></span><span class="line"><span class="cl">//æœ‰å…³count()å‡½æ•°
</span></span><span class="line"><span class="cl">https://blog.csdn.net/wendychiang1991/article/details/70909958/
</span></span></code></pre></div><h4 id="å­æŸ¥è¯¢ä¼˜åŒ–">å­æŸ¥è¯¢ä¼˜åŒ–</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">é€šå¸¸æƒ…å†µä¸‹ï¼Œéœ€è¦æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸ºjoinæŸ¥è¯¢ï¼Œä½†åœ¨ä¼˜åŒ–æ—¶è¦æ³¨æ„å…³è”é”®æ˜¯å¦æœ‰ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè¦æ³¨æ„é‡å¤æ•°æ®ã€‚(distinctå»é‡)
</span></span><span class="line"><span class="cl">//æŸ¥è¯¢sandraå‡ºæ¼”çš„æ‰€æœ‰å½±ç‰‡
</span></span><span class="line"><span class="cl">explain select title,release_year,LENGTH from film
</span></span><span class="line"><span class="cl">where film_id in (
</span></span><span class="line"><span class="cl">    select film_id from film_actor where actor_id in (
</span></span><span class="line"><span class="cl">        select actor_id from actor where first_name=&#39;sandra&#39;
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">);
</span></span></code></pre></div><h4 id="group-byçš„ä¼˜åŒ–">group byçš„ä¼˜åŒ–</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">//æ”¹å‰ ä¸´æ—¶è¡¨
</span></span><span class="line"><span class="cl">explain select actor.first_name,actor_last_name,count(*) from sakila.film_actor
</span></span><span class="line"><span class="cl">inner join sakila.actor USING(actor_id)
</span></span><span class="line"><span class="cl">group by film_actor.actor_id;
</span></span><span class="line"><span class="cl">//æ”¹å ç»“åˆå­æŸ¥è¯¢ ç´¢å¼•
</span></span><span class="line"><span class="cl">explain select actor.first_name,actor.last_name,c.cnt from sakila.film_actor
</span></span><span class="line"><span class="cl">inner join (
</span></span><span class="line"><span class="cl">select actor_id,count(*) as cnt from sakila.film_actor group by actor_id) as c USING(actor_id);
</span></span></code></pre></div><h4 id="limitä¼˜åŒ–">limitä¼˜åŒ–</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">limitå¸¸ç”¨äºåˆ†é¡µå¤„ç†ï¼Œæ—¶å¸¸ä¼šä¼´éšorder by ä»å¥ä½¿ç”¨ï¼Œå› æ­¤å¤§å¤šæ—¶å€™ä¼šä½¿ç”¨Filesortsè¿™æ ·ä¼šé€ æˆå¤§é‡çš„IOé—®é¢˜ã€‚
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">//æ–‡ä»¶æ’åºï¼ŒIOå¤§
</span></span><span class="line"><span class="cl">explain select film_id,description from sakila.film order by title limit 50,5;
</span></span><span class="line"><span class="cl">1.ä¼˜åŒ–ï¼šä½¿ç”¨æœ‰ç´¢å¼•çš„åˆ—æˆ–ä¸»é”®è¿›è¡Œorder byæ“ä½œï¼ˆorder by film_idï¼‰
</span></span><span class="line"><span class="cl">2.è®°å½•ä¸Šæ¬¡è¿”å›çš„ä¸»é”®ï¼Œåœ¨ä¸‹æ¬¡æŸ¥è¯¢çš„æ—¶å€™ç”¨ä¸»é”®è¿‡æ»¤ï¼Œé¿å…äº†æ•°æ®é‡å¤§æ—¶æ‰«æè¿‡å¤šçš„è®°å½•
</span></span><span class="line"><span class="cl">select film_id,description from sakila.film where film_if&gt;55 and film_id&lt;=60 order by film_id limit 1,5; 
</span></span><span class="line"><span class="cl">é¡µæ•°è¶Šå¤§ï¼ŒIOè¶Šå¤§
</span></span></code></pre></div><h3 id="ç´¢å¼•ä¼˜åŒ–">ç´¢å¼•ä¼˜åŒ–</h3>
<h4 id="å¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ—å»ºç«‹ç´¢å¼•">å¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ—å»ºç«‹ç´¢å¼•ï¼Ÿ</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.åœ¨whereä»å¥ï¼Œgroup byä»å¥ï¼Œorder byä»å¥ï¼Œonä»å¥ä¸­å‡ºç°çš„åˆ—(select)
</span></span><span class="line"><span class="cl">2.ç´¢å¼•å­—æ®µè¶Šå°è¶Šå¥½(è¡¨æ¯é¡µæ•°æ®æ‰ä¼šæ›´å¤šï¼ŒIOæ•ˆç‡ä¼šæ›´é«˜)
</span></span><span class="line"><span class="cl">3.ç¦»æ•£åº¦å¤§çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å‰é¢
</span></span><span class="line"><span class="cl">select * from payment where staff_id=2 and customer_id=584;
</span></span><span class="line"><span class="cl">index(staff_id,customer_id)å¥½ï¼Ÿè¿˜æ˜¯index(customer_id,staff_id)å¥½ï¼Ÿ
</span></span><span class="line"><span class="cl">ç”±äºcustomer_idçš„ç¦»æ•£åº¦æ›´å¤§(é‡å¤ç‡å°,å¯é€‰æ‹©æ€§æ›´å¤§)ï¼Œæ‰€ä»¥åº”è¯¥ä½¿ç”¨index(customer_id,staff_id)
</span></span></code></pre></div><h4 id="ç´¢å¼•ä¼˜åŒ–sqlçš„æ–¹æ³•">ç´¢å¼•ä¼˜åŒ–SQLçš„æ–¹æ³•</h4>
<p>ç´¢å¼•çš„ç»´æŠ¤åŠä¼˜åŒ–&ndash;é‡å¤åŠå†—ä½™ç´¢å¼•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å†—ä½™ç´¢å¼•æ˜¯æŒ‡å¤šä¸ªç´¢å¼•çš„å‰ç¼€åˆ—ç›¸åŒï¼Œæˆ–æ˜¯åœ¨è”åˆç´¢å¼•ä¸­åŒ…å«äº†ä¸»é”®çš„ç´¢å¼•ã€‚å¦‚ä¸‹ï¼škey(name,id)å°±æ˜¯ä¸€ä¸ªå†—ä½™ç´¢å¼•
</span></span><span class="line"><span class="cl">create table test(
</span></span><span class="line"><span class="cl">id int not null primary key,
</span></span><span class="line"><span class="cl">name varchar(10) not null,
</span></span><span class="line"><span class="cl">key(name,id)
</span></span><span class="line"><span class="cl">)engine=innodb;
</span></span><span class="line"><span class="cl">//å¯ä»¥åˆ é™¤å†—ä½™ç´¢å¼•ï¼Œè¾¾åˆ°ä¼˜åŒ–æ•ˆæœã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä½¿ç”¨pt-duplicate-key-checkerå·¥å…·æ£€æŸ¥é‡å¤åŠå†—ä½™ç´¢å¼•
</span></span><span class="line"><span class="cl">pt-duplicate-key-checker \
</span></span><span class="line"><span class="cl">-uroot \
</span></span><span class="line"><span class="cl">-p &#39;&#39; \
</span></span><span class="line"><span class="cl">-h 127.0.0.1
</span></span></code></pre></div><p>ç´¢å¼•ç»´æŠ¤çš„æ–¹æ³•&ndash;åˆ é™¤ä¸ç”¨ç´¢å¼•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®å‰mysqlä¸­è¿˜æ²¡æœ‰è®°å½•ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼Œä½†æ˜¯åœ¨PerconMySQLå’ŒMariaDBä¸­å¯é€šè¿‡INDEX_STATISTICSè¡¨æ¥æŸ¥çœ‹å“ªäº›ç´¢å¼•æœªä½¿ç”¨ï¼Œä½†åœ¨mysqlä¸­ç›®å‰åªèƒ½é€šè¿‡æ…¢æŸ¥æ—¥å¿—é…åˆpt-index-usageå·¥å…·æ¥è¿›è¡Œç´¢å¼•ä½¿ç”¨æƒ…å†µåˆ†æã€‚
</span></span><span class="line"><span class="cl">pt-index-usage \
</span></span><span class="line"><span class="cl">    -uroot -p&#39;&#39; \
</span></span><span class="line"><span class="cl">    mysql-slow.log
</span></span></code></pre></div><h3 id="æ•°æ®åº“è¡¨ç»“æ„ä¼˜åŒ–">æ•°æ®åº“è¡¨ç»“æ„ä¼˜åŒ–</h3>
<h4 id="é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹">é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.ä½¿ç”¨å¯ä»¥å­˜ä¸‹ä½ çš„æ•°æ®çš„æœ€å°çš„æ•°æ®ç±»å‹
</span></span><span class="line"><span class="cl">2.ä½¿ç”¨ç®€å•çš„æ•°æ®ç±»å‹ã€‚intè¦æ¯”varcharç±»å‹åœ¨mysqlå¤„ç†ä¸Šæ›´ç®€å•
</span></span><span class="line"><span class="cl">3.å°½å¯èƒ½çš„ä½¿ç”¨not nullå®šä¹‰å­—æ®µ
</span></span><span class="line"><span class="cl">4.å°½é‡å°‘ç”¨textç±»å‹ï¼Œéç”¨ä¸å¯æ—¶æœ€å¥½è€ƒè™‘åˆ†è¡¨
</span></span><span class="line"><span class="cl">*ä½¿ç”¨intæ¥å­˜å‚¨æ—¥å¿—æ—¶é—´ï¼Œåˆ©ç”¨FROM_UNIXTINE()(å¾—åˆ°æ—¥æœŸ),UNIX_TIMESTAMP()(å¾—åˆ°æ—¶é—´æˆ³)ä¸¤ä¸ªå‡½æ•°æ¥è¿›è¡Œè½¬æ¢
</span></span><span class="line"><span class="cl">*ä½¿ç”¨bigintæ¥å­˜ipåœ°å€ï¼Œåˆ©ç”¨INET_ATON(),INET_NTOA()ä¸¤ä¸ªå‡½æ•°æ¥è¿›è¡Œè½¬æ¢
</span></span></code></pre></div><h4 id="è¡¨çš„èŒƒå¼åŒ–å’ŒåèŒƒå¼åŒ–">è¡¨çš„èŒƒå¼åŒ–å’ŒåèŒƒå¼åŒ–</h4>
<p>èŒƒå¼åŒ–æ˜¯æŒ‡æ•°æ®åº“è®¾è®¡çš„è§„èŒƒï¼Œç›®å‰è¯´åˆ°èŒƒå¼åŒ–ä¸€èˆ¬æ˜¯æŒ‡ç¬¬ä¸‰è®¾è®¡èŒƒå¼ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚æ•°æ®è¡¨ä¸­ä¸å­˜åœ¨éå…³é”®å­—æ®µå¯¹ä»»æ„å€™é€‰å…³é”®å­—æ®µçš„ä¼ é€’å‡½æ•°ä¾èµ–åˆ™ç¬¦åˆç¬¬ä¸‰èŒƒå¼ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ä¸ç¬¦åˆç¬¬ä¸‰èŒƒå¼è¦æ±‚çš„è¡¨å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼š
</span></span><span class="line"><span class="cl">1.æ•°æ®å†—ä½™ï¼šï¼ˆåˆ†ç±»ï¼Œåˆ†ç±»æè¿°ï¼‰å¯¹äºæ¯ä¸€ä¸ªå•†å“éƒ½ä¼šè¿›è¡Œè®°å½•
</span></span><span class="line"><span class="cl">2.æ•°æ®çš„æ’å…¥å¼‚å¸¸
</span></span><span class="line"><span class="cl">3.æ•°æ®çš„æ›´æ–°å¼‚å¸¸
</span></span><span class="line"><span class="cl">4.æ•°æ®çš„åˆ é™¤å¼‚å¸¸
</span></span></code></pre></div><p>åèŒƒå¼åŒ–æ˜¯æŒ‡ä¸ºäº†æŸ¥è¯¢æ•ˆç‡çš„è€ƒè™‘æŠŠåŸæœ¬ç¬¦åˆç¬¬ä¸‰èŒƒå¼çš„è¡¨é€‚å½“çš„å¢åŠ å†—ä½™ï¼Œä»¥è¾¾åˆ°ä¼˜åŒ–æŸ¥è¯¢çš„ç›®çš„ï¼ŒåèŒƒå¼åŒ–æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¥æ¢å–æ—¶é—´çš„æ“ä½œã€‚</p>
<h4 id="è¡¨çš„æ‹†åˆ†">è¡¨çš„æ‹†åˆ†</h4>
<p>å‚ç›´æ‹†åˆ†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">æ‰€è°“çš„å‚ç›´æ‹†åˆ†ï¼Œå°±æ˜¯æŠŠåŸæ¥ä¸€ä¸ªæœ‰å¾ˆå¤šåˆ—çš„è¡¨æ‹†åˆ†æˆå¤šä¸ªè¡¨ï¼Œè¿™è§£å†³äº†è¡¨çš„å®½åº¦é—®é¢˜ã€‚é€šå¸¸å‚ç›´æ‹†åˆ†å¯ä»¥æŒ‰ä»¥ä¸‹åŸåˆ™è¿›è¡Œï¼š
</span></span><span class="line"><span class="cl">1.æŠŠä¸å¸¸ç”¨çš„å­—æ®µå•ç‹¬å­˜æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­
</span></span><span class="line"><span class="cl">2.æŠŠå¤§å­—æ®µç‹¬ç«‹å­˜æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­
</span></span><span class="line"><span class="cl">3.æŠŠç»å¸¸ä¸€èµ·ä½¿ç”¨çš„å­—æ®µæ”¾åˆ°ä¸€èµ·
</span></span></code></pre></div><p>æ°´å¹³æ‹†åˆ†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">è¡¨çš„æ°´å¹³æ‹†åˆ†æ˜¯ä¸ºäº†è§£å†³å•è¡¨çš„æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜ï¼Œæ°´å¹³æ‹†åˆ†çš„è¡¨æ¯ä¸€ä¸ªè¡¨çš„ç»“æ„éƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚
</span></span><span class="line"><span class="cl">å¸¸ç”¨çš„æ°´å¹³æ‹†åˆ†æ–¹æ³•ä¸ºï¼š
</span></span><span class="line"><span class="cl">1.å¯¹idè¿›è¡Œhashè¿ç®—ï¼Œå¦‚æœè¦æ‹†åˆ†æˆ5ä¸ªè¡¨åˆ™ä½¿ç”¨mod(id,5)å»é™¤0-4ä¸ªå€¼
</span></span><span class="line"><span class="cl">2.é’ˆå¯¹ä¸åŒçš„hashIDæŠŠæ•°æ®å­˜åˆ°ä¸åŒçš„è¡¨ä¸­
</span></span></code></pre></div><h3 id="ç³»ç»Ÿé…ç½®ä¼˜åŒ–">ç³»ç»Ÿé…ç½®ä¼˜åŒ–</h3>
<h4 id="æ“ä½œç³»ç»Ÿé…ç½®ä¼˜åŒ–">æ“ä½œç³»ç»Ÿé…ç½®ä¼˜åŒ–</h4>
<p>æ•°æ®åº“æ˜¯åŸºäºæ“ä½œç³»ç»Ÿçš„ï¼Œç›®å‰å¤§å¤šæ•°mysqléƒ½æ˜¯å®‰è£…åœ¨Linuxç³»ç»Ÿä¹‹ä¸Šï¼Œæ‰€ä»¥å¯¹äºæ“ä½œç³»ç»Ÿçš„ä¸€äº›å‚æ•°é…ç½®ä¹Ÿä¼šå½±å“åˆ°MYSQLçš„æ€§èƒ½ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç½‘ç»œæ–¹é¢çš„é…ç½®ï¼Œè¦ä¿®æ”¹/etc/stysctl.confæ–‡ä»¶
</span></span><span class="line"><span class="cl">#å¢åŠ tcpæ”¯æŒçš„é˜Ÿåˆ—æ•°
</span></span><span class="line"><span class="cl">net.ipv4.tcp_max_syn_backlog = 65535
</span></span><span class="line"><span class="cl">#å‡å°‘æ–­å¼€é“¾æ¥æ˜¯ï¼Œèµ„æºå›æ”¶
</span></span><span class="line"><span class="cl">net.ipv4.tcp_max_tw_buckets = 8000
</span></span><span class="line"><span class="cl">net.ipv4.tcp_tw_reuse = 1
</span></span><span class="line"><span class="cl">net.ipv4.tcp_tw_recycle = 1
</span></span><span class="line"><span class="cl">net.ipv4.tcp_fin_timeout = 10
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ‰“å¼€æ–‡ä»¶æ•°çš„é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ulimit -a æŸ¥çœ‹ç›®å½•çš„å„ä½é™åˆ¶ï¼Œå¯ä»¥ä¿®æ”¹/etcsecurity/limitsconfæ–‡ä»¶ï¼Œå¢åŠ ä¸€ä¸‹å†…å®¹ä»¥ä¿®æ”¹æ‰“å¼€æ–‡ä»¶æ•°é‡çš„é™åˆ¶
</span></span><span class="line"><span class="cl">*soft nofile 65535
</span></span><span class="line"><span class="cl">*hard nofile 65535
</span></span><span class="line"><span class="cl">é™¤æ­¤ä¹‹å¤–æœ€å¥½åœ¨mysqlæœåŠ¡å™¨ä¸Šå…³é—­iptablesï¼Œselinuxç­‰é˜²ç«å¢™è½¯ä»¶ã€‚
</span></span></code></pre></div><h4 id="mysqlæ•°æ®åº“ä¼˜åŒ–">MySQLæ•°æ®åº“ä¼˜åŒ–</h4>
<p>MySQLé…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">mysqlå¯ä»¥é€šè¿‡å¯åŠ¨æ—¶æŒ‡å®šé…ç½®å‚æ•°å’Œä½¿ç”¨é…ç½®æ–‡ä»¶ä¸¤ç§æ–¹æ³•è¿›è¡Œé…ç½®ï¼Œåœ¨å¤§æ•°æƒ…å†µä¸‹é…ç½®æ–‡ä»¶ä½äº/etc/my.cnfæˆ–æ˜¯/etc/mysql/my.cnfåœ¨windowsç³»ç»Ÿé…ç½®æ–‡ä»¶å¯ä»¥æ˜¯ä½äºC:/windows/my.iniæ–‡ä»¶ï¼ŒmysqlæŸ¥æ‰¾é…ç½®æ–‡ä»¶çš„é¡ºåºå¯ä»¥é€šè¿‡ä¸€ä¸‹æ–¹æ³•è·å¾—
</span></span><span class="line"><span class="cl">/usr/sbin/mysqld --verbose --help | grep -A 1 &#39; Default options &#39;
</span></span></code></pre></div><p>MySQLé…ç½®æ–‡ä»¶&ndash;å¸¸ç”¨å‚æ•°è¯´æ˜</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.innodb_buffer_pool_size &gt;= total MB
</span></span><span class="line"><span class="cl">éå¸¸é‡è¦çš„ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºé…ç½®innodbçš„ç¼“å†²æ± ï¼Œå¦‚æœæ•°æ®åº“ä¸­åªæœ‰innodbè¡¨ï¼Œåˆ™æ¨èé…ç½®é‡ä¸ºæ€»å†…å­˜çš„75%
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.innodb_buffer_pool__instances
</span></span><span class="line"><span class="cl">MySQL5.5ä¸­æ–°å¢åŠ å‚æ•°ï¼Œå¯ä»¥æ§åˆ¶ç¼“å†²æ± çš„ä¸ªæ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªç¼“å†²æ± ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.innodb_log_buffer_size
</span></span><span class="line"><span class="cl">innodb logç¼“å†²çš„å¤§å°ï¼Œç”±äºæ—¥å¿—æœ€é•¿æ¯ç§’é’Ÿå°±ä¼šåˆ·æ–°æ‰€ä»¥ä¸€èˆ¬ä¸ç”¨å¤ªå¤§ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.innodb_flush_log_at_trx_commit
</span></span><span class="line"><span class="cl">å…³é”®å‚æ•°ï¼Œå¯¹innodbçš„IOæ•ˆç‡å½±å“å¾ˆå¤§ã€‚é»˜è®¤å€¼ä¸º1ï¼Œå¯å–0ï¼Œ1ï¼Œ2ä¸‰ä¸ªå€¼ï¼Œä¸€èˆ¬å»ºè®®ä¸º2ï¼Œä½†å¦‚æœæ•°æ®å®‰å…¨æ€§è¦æ±‚æ¯”è¾ƒé«˜åˆ™ä½¿ç”¨é»˜è®¤å€¼1.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5.innodb_read_io_threads   innodb_write_io_threads
</span></span><span class="line"><span class="cl">ä»¥ä¸Šä¸¤ä¸ªå‚æ•°å†³å®šäº†Innodbè¯»å†™çš„IOè¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º4.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6.innodb_file_per_table
</span></span><span class="line"><span class="cl">å…³é”®å‚æ•°ï¼Œæ§åˆ¶innodbæ¯ä¸€ä¸ªè¡¨ä½¿ç”¨ç‹¬ç«‹çš„è¡¨ç©ºé—´ï¼Œé»˜è®¤ä¸ºoffï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰è¡¨éƒ½ä¼šå»ºç«‹åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">7.innodb_stats_on_metadata
</span></span><span class="line"><span class="cl">å†³å®šäº†mysqlåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šåˆ·æ–°innodbè¡¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚
</span></span></code></pre></div><h4 id="ç¬¬ä¸‰æ–¹é…ç½®å·¥å…·">ç¬¬ä¸‰æ–¹é…ç½®å·¥å…·</h4>
<p>ğŸ”—é“¾æ¥åœ°å€ï¼šhttps://tools.percona.com/wizard</p>
<h3 id="æœåŠ¡å™¨ç¡¬ä»¶ä¼˜åŒ–">æœåŠ¡å™¨ç¡¬ä»¶ä¼˜åŒ–</h3>
<p>å¦‚ä½•é€‰æ‹©cpuï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.mysqlæœ‰ä¸€äº›å·¥ä½œåªèƒ½ä½¿ç”¨åˆ°å•æ ¸cpuï¼ŒReplicate,SQL...
</span></span><span class="line"><span class="cl">2.mysqlå¯¹cpuæ ¸æ•°çš„æ”¯æŒå¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¿«ã€‚mysql5.5ä½¿ç”¨çš„æœåŠ¡å™¨ä¸è¦è¶…è¿‡30æ ¸
</span></span></code></pre></div><p>ç£ç›˜IOä¼˜åŒ–</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å¸¸ç”¨RAIDçº§åˆ«ç®€ä»‹
</span></span><span class="line"><span class="cl">RAID0ï¼šä¹Ÿç§°æ¡å¸¦ï¼Œå°±æ˜¯æŠŠå¤šä¸ªç£ç›˜é“¾æ¥æˆä¸€ä¸ªç¡¬ç›˜ä½¿ç”¨ï¼Œè¿™ä¸ªçº§åˆ«IOæœ€å¥½
</span></span><span class="line"><span class="cl">RAID1ï¼šä¹Ÿç§°é•œåƒï¼Œè¦æ±‚è‡³å°‘æœ‰ä¸¤ä¸ªç£ç›˜ï¼Œæ¯ç»„ç£ç›˜å­˜å‚¨çš„æ•°æ®ç›¸åŒ
</span></span><span class="line"><span class="cl">RAID5ï¼šä¹Ÿæ˜¯æŠŠå¤šä¸ªç¡¬ç›˜åˆå¹¶æˆä¸€ä¸ªé€»è¾‘ç›˜ä½¿ç”¨ï¼Œæ•°æ®è¯»å†™æ—¶ä¼šå»ºç«‹å¥‡å¶æ ¡éªŒä¿¡æ¯ï¼Œåˆ†åˆ«å­˜å‚¨åœ¨ä¸åŒç£ç›˜ä¸Šã€‚
</span></span><span class="line"><span class="cl">RAID1+0ï¼šå°±æ˜¯RAID1å’ŒRAID0çš„ç»“åˆã€‚åŒæ—¶å…·å¤‡ä¸¤ä¸ªçº§åˆ«çš„ä¼˜ç¼ºç‚¹ã€‚ä¸€èˆ¬å»ºè®®æ•°æ®åº“ä½¿ç”¨è¿™ä¸ªçº§åˆ«ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SNAå’ŒNATæ˜¯å¦é€‚åˆæ•°æ®åº“ï¼Ÿ
</span></span><span class="line"><span class="cl">1.å¸¸ç”¨äºé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ
</span></span><span class="line"><span class="cl">2.é¡ºåºè¯»å†™æ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯éšæœºè¯»å†™ä¸å¦‚äººæ„
</span></span><span class="line"><span class="cl">3.æ•°æ®åº“éšæœºè¯»å†™æ¯”ç‡å¾ˆé«˜
</span></span></code></pre></div><p>ğŸ‘‡</p>
<h3 id="ç»“æŸè¯­">ç»“æŸè¯­</h3>
<p>ä»äº”ä¸ªä¸åŒå±‚æ¬¡ä¼˜åŒ–mysqlæ€§èƒ½ï¼Œè¾ƒä¸ºåŸºç¡€ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå®ç”¨ğŸ˜Šã€‚**è¿™ç¯‡æ˜¯åœ¨å­¦ä¹ æ…•è¯¾ç½‘ã€Šæ€§èƒ½ä¼˜åŒ–ä¹‹MySQLä¼˜åŒ–ã€‹è§†é¢‘æ—¶åšçš„ç¬”è®°ï¼Œè§†é¢‘åœ°å€ï¼š**<a href="https://www.imooc.com/learn/194">https://www.imooc.com/learn/194</a></p>
<p>ğŸ“‘ç¬”è®°æ–‡æ¡£ä¸‹è½½åœ°å€ï¼šhttps://pan.baidu.com/s/1YraBQspD-VIrAl4BFaej8A
æå–ç ï¼šbaq5</p>
]]></content>
		</item>
		
		<item>
			<title>ä½¿ç”¨Elasticsearchåšå¼•æ“ï¼ŒScoutå…¨æ–‡æœç´¢ğŸ”</title>
			<link>https://blog.gookm.cn/posts/2019/20190308-laravel-elasticsearch/</link>
			<pubDate>Fri, 08 Mar 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190308-laravel-elasticsearch/</guid>
			<description>ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTful webæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿
å‡†å¤‡ 1ã€å®‰è£…æµ‹è¯•Laravel5.5ç”¨äºæµ‹è¯•
composer create-project --prefer-dist laravel/laravel test &amp;#34;5.5.*&amp;#34; 2ã€å®‰è£…è¿è¡Œes é“¾æ¥åœ°å€ï¼Œç‚¹å¼€é“¾æ¥ï¼Œæ ¹æ®è‡ªå·±çš„ç³»ç»Ÿä¸‹è½½å®‰è£…åŒ…ï¼Œé‡Œé¢å…³äºæ€ä¹ˆæ ·å®‰è£…è¿è¡Œéƒ½è¯´çš„æ¯”è¾ƒæ¸…æ¥šã€‚ä¸‹è½½åè§£å‹ã€‚ç”±äºæˆ‘ç”¨çš„æ˜¯Homesteadç¯å¢ƒï¼Œè‡ªå¸¦äº†esã€‚
cd elasticsearch-6.4.2 //è¿›å…¥åˆ°è§£å‹ç›®å½• ./bin/elasticsearch //æœ¬åœ°è¿è¡Œes Homesteadç¯å¢ƒ sudo systemctl restart elasticsearch.service //å¯åŠ¨ curl http://127.0.0.1:9200/ //æ£€æµ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ sudo /usr/share/elasticsearch/bin/elasticsearch-plugin list //æŸ¥çœ‹elasticsearch-analysis-ik ä¸­æ–‡åˆ†è¯æ’ä»¶ sudo systemctl disable elasticsearch.service //å…³é—­ Elasticsearch å¼€æœºå¯åŠ¨ å¼€å§‹ 1ã€è¿›å…¥é¡¹ç›®ç›®å½•
cd test 2ã€å®‰è£…Laravel scout å…¨æ–‡æœç´¢åŒ…
composer require laravel/scout=5.0 æ³¨æ„ï¼šå®‰è£…5.0ç‰ˆæœ¬éœ€è¦åšå¦‚ä¸‹ä¿®æ”¹ï¼š
/vendor/laravel/scout/src/Searchable.php æœ‰ä¸€ä¸ªgetScoutModelsByIds()æ–¹æ³•çš„è¿™æ®µä»£ç æ³¨é‡Šæ‰å°±å¯ä»¥äº†ã€‚ if ($builder-&amp;gt;queryCallback) { call_user_func($builder-&amp;gt;queryCallback, $query); } å°†laravel/scout 5.0.0ç‰ˆæœ¬æ¢æˆ laravel/scout 5.0.3å³å¯è§£å†³Undefined property: Laravel\Scout\Builder::$queryCallbackæŠ¥é”™é—®é¢˜ã€‚ä¸ç”¨æ‰‹åŠ¨ä¿®æ”¹æºç ã€‚
5.0.3ç‰ˆæœ¬çš„Laravel\Scout\Builderç±»åœ¨5.0.0åŸºç¡€ä¸Šå¢åŠ äº†$queryCallbackå±æ€§å¹¶åšäº†å…¶ä»–ä¿®æ”¹ã€‚
3ã€æ³¨å†ŒæœåŠ¡æä¾›å™¨
&amp;#39;providers&amp;#39; =&amp;gt; [ ... Laravel\Scout\ScoutServiceProvider::class, ], 4ã€ç”Ÿæˆé…ç½®æ–‡ä»¶</description>
			<content type="html"><![CDATA[<blockquote>
<p>ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTful webæ¥å£ã€‚Elasticsearchæ˜¯ç”¨Javaå¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿</p>
</blockquote>
<h3 id="å‡†å¤‡">å‡†å¤‡</h3>
<p>1ã€å®‰è£…æµ‹è¯•<code>Laravel5.5</code>ç”¨äºæµ‹è¯•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer create-project --prefer-dist laravel/laravel <span class="nb">test</span> <span class="s2">&#34;5.5.*&#34;</span>
</span></span></code></pre></div><p>2ã€å®‰è£…è¿è¡Œ<code>es</code> é“¾æ¥åœ°å€ï¼Œç‚¹å¼€é“¾æ¥ï¼Œæ ¹æ®è‡ªå·±çš„ç³»ç»Ÿä¸‹è½½å®‰è£…åŒ…ï¼Œé‡Œé¢å…³äºæ€ä¹ˆæ ·å®‰è£…è¿è¡Œéƒ½è¯´çš„æ¯”è¾ƒæ¸…æ¥šã€‚ä¸‹è½½åè§£å‹ã€‚ç”±äºæˆ‘ç”¨çš„æ˜¯<code>Homestead</code>ç¯å¢ƒï¼Œè‡ªå¸¦äº†<code>es</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> elasticsearch-6.4.2 //è¿›å…¥åˆ°è§£å‹ç›®å½•
</span></span><span class="line"><span class="cl">./bin/elasticsearch //æœ¬åœ°è¿è¡Œes
</span></span></code></pre></div><ul>
<li><code>Homestead</code>ç¯å¢ƒ</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl restart elasticsearch.service //å¯åŠ¨
</span></span><span class="line"><span class="cl">curl http://127.0.0.1:9200/  //æ£€æµ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ
</span></span><span class="line"><span class="cl">sudo /usr/share/elasticsearch/bin/elasticsearch-plugin list //æŸ¥çœ‹elasticsearch-analysis-ik ä¸­æ–‡åˆ†è¯æ’ä»¶
</span></span><span class="line"><span class="cl">sudo systemctl disable elasticsearch.service  //å…³é—­ Elasticsearch å¼€æœºå¯åŠ¨
</span></span></code></pre></div><h3 id="å¼€å§‹">å¼€å§‹</h3>
<p>1ã€è¿›å…¥é¡¹ç›®ç›®å½•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nb">test</span>
</span></span></code></pre></div><p>2ã€å®‰è£…<code>Laravel scout</code> å…¨æ–‡æœç´¢åŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require laravel/scout<span class="o">=</span>5.0
</span></span></code></pre></div><p><strong>æ³¨æ„ï¼šå®‰è£…5.0ç‰ˆæœ¬éœ€è¦åšå¦‚ä¸‹ä¿®æ”¹ï¼š</strong></p>
<ul>
<li><code>/vendor/laravel/scout/src/Searchable.php </code>æœ‰ä¸€ä¸ª<code>getScoutModelsByIds()</code>æ–¹æ³•çš„è¿™æ®µä»£ç æ³¨é‡Šæ‰å°±å¯ä»¥äº†ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">queryCallback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">queryCallback</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>
<p>å°†<code>laravel/scout 5.0.0</code>ç‰ˆæœ¬æ¢æˆ <code>laravel/scout 5.0.3</code>å³å¯è§£å†³<code>Undefined property: Laravel\Scout\Builder::$queryCallback</code>æŠ¥é”™é—®é¢˜ã€‚ä¸ç”¨æ‰‹åŠ¨ä¿®æ”¹æºç ã€‚</p>
</li>
<li>
<p>5.0.3ç‰ˆæœ¬çš„<code>Laravel\Scout\Builder</code>ç±»åœ¨5.0.0åŸºç¡€ä¸Šå¢åŠ äº†<code>$queryCallback</code>å±æ€§å¹¶åšäº†å…¶ä»–ä¿®æ”¹ã€‚</p>
</li>
</ul>
<p>3ã€æ³¨å†ŒæœåŠ¡æä¾›å™¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Laravel\Scout\ScoutServiceProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><p>4ã€ç”Ÿæˆé…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//Laravel 5.5 å…¶å®æˆ‘ä»¬ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼ç›´æ¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ã€‚è¿™æ¡å‘½ä»¤ä¼šç»™ä½ ä¸€ä¸ªlist,è®©ä½ é€‰æ‹©publishå“ªä¸ªé€‰é¡¹ã€‚
</span></span><span class="line"><span class="cl">php artisan vendor:publish
</span></span></code></pre></div><p>5ã€å› ä¸ºè¦ä½¿ç”¨<code>es</code>åšæœç´¢å¼•æ“ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨åˆ°ä¸€ä¸ªå«<code>tamayo/laravel-scout-elastic</code>çš„åŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require tamayo/laravel-scout-elastic<span class="o">=</span>4.0
</span></span></code></pre></div><p>6ã€æ·»åŠ æœåŠ¡æä¾›å™¨åˆ°<code>config/app.php</code>çš„<code>providers</code>æ•°ç»„ä¸­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ScoutEngines\Elasticsearch\ElasticsearchProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><p>7ã€é…ç½®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//åœ¨config/scout.phpæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ã€‚é»˜è®¤ä½¿ç”¨çš„æ˜¯algoliaå¼•æ“ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨esåšå¼•æ“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;algolia&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;ALGOLIA_APP_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;secret&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;ALGOLIA_SECRET&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è¿™é‡Œæ˜¯æ·»åŠ çš„ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s1">&#39;elasticsearch&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;index&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;ELASTICSEARCH_INDEX&#39;</span><span class="p">,</span> <span class="s1">&#39;laravel&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;hosts&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;ELASTICSEARCH_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://127.0.0.1:9200&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"> <span class="p">],</span>
</span></span></code></pre></div><p>8ã€é…ç½®<code>.env</code>æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># scouté…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">SCOUT_DRIVER=elasticsearch  //é€‰æ‹©æœç´¢å¼•æ“</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">SCOUT_PREFIX=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># elasticsearch é…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">ELASTICSEARCH_INDEX=estest  //è®¾ç½®ç´¢å¼•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># elasticsearchæœåŠ¡å™¨åœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">ELASTICSEARCH_HOST=http://127.0.0.1:9200  //æˆ‘ç”¨çš„å°±æ˜¯æœ¬åœ°çš„</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>å› ä¸ºè¿™æ­¥ä¸ä¸¥è°¨é‡åˆ°çš„æŠ¥é”™ï¼ˆ<code>php artisan make:model</code>ï¼‰ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Dotenv</span> <span class="nx">values</span> <span class="nx">containing</span> <span class="nx">spaces</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">surrounded</span> <span class="nx">by</span> <span class="nx">quotes</span><span class="o">.</span>
</span></span></code></pre></div><ul>
<li>è§£å†³ï¼šä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¦‚æœæœ‰ç©ºæ ¼éœ€è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚<code>&quot;ELASTICSEARCH_INDEX=estest&quot;</code></li>
</ul>
<h3 id="åœ¨é¡¹ç›®ä¸­å®ç°æœç´¢åŠŸèƒ½">åœ¨é¡¹ç›®ä¸­å®ç°æœç´¢åŠŸèƒ½</h3>
<p>1ã€è¿›å…¥é¡¹ç›®ï¼Œåˆ›å»º<code>Model</code>æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nb">test</span>
</span></span><span class="line"><span class="cl">php artisan make:model Models/Post
</span></span></code></pre></div><p>2ã€æ‰“å¼€<code>Models/Post.php</code>,è¿›è¡Œè®¾ç½®<code>type</code>,å’Œä½ è¦æœç´¢å¯¹å­—æ®µ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Laravel\Scout\Searchable</span><span class="p">;</span><span class="c1">//è¿™ä¸ªtraitä¸€å®šè¦å¼•ç”¨çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">Searchable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$guarded</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å®šä¹‰ç´¢å¼•é‡Œé¢çš„ç±»å‹ï¼Œä¸Šæ–‡æˆ‘ä»¬è¯´è¿‡ï¼Œå¯ä»¥æŠŠtypeç†è§£æˆä¸€ä¸ªæ•°æ®è¡¨ã€‚æˆ‘ä»¬ç°åœ¨è¦åšçš„å°±æ˜¯æŠŠæˆ‘ä»¬æ‰€æœ‰çš„è¦å…¨æ–‡æœç´¢çš„å­—æ®µéƒ½å­˜å…¥åˆ°esä¸­çš„ä¸€ä¸ªå«&#39;_doc&#39;çš„è¡¨ä¸­ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">searchableAs</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;_doc&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å®šä¹‰æœ‰é‚£äº›å­—æ®µéœ€è¦æœç´¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">toSearchableArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//user_nameåŠ ä¸Šå‰ç¼€ä»¥åŒºåˆ«ã€‚å› ä¸ºä¸åŒçš„è¡¨é‡Œå¯èƒ½ä¼šæœ‰ç›¸åŒçš„å­—æ®µã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//mysqlä¸­çš„å­—æ®µæ˜¯name,email,created_atã€‚åœ¨esä¸­æˆ‘ä»¬å­˜å‚¨çš„user_nameï¼Œuser_email,user_created_atã€‚æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;post_title&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;post_description&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">description</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;post_content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;post_html_content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">html_content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>3ã€æŠŠ<code>mysql</code>ä¸­æ•°æ®åŒæ­¥åˆ°<code>es</code>ä¸­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//æŠŠç°æœ‰çš„æ•°æ®åŒæ­¥esä¸­ä¸€ä¸ªç´¢å¼•å«â€˜estestâ€™ï¼Œç±»å‹å«â€˜_docâ€™
</span></span></span><span class="line"><span class="cl"><span class="c1">//æŠŠUserä¸­åˆ°æ•°æ®åŒæ­¥åˆ°esä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">scout</span><span class="o">:</span><span class="nx">import</span> <span class="s2">&#34;App\Models\Post&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ˜¾ç¤ºå¦‚ä¸‹ï¼Œå³ä¸ºå¯¼å…¥æˆåŠŸï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Imported</span> <span class="p">[</span><span class="nx">App\Models\Post</span><span class="p">]</span> <span class="nx">models</span> <span class="nx">up</span> <span class="nx">to</span> <span class="nx">ID</span><span class="o">:</span> <span class="mi">113</span>
</span></span><span class="line"><span class="cl"><span class="nx">All</span> <span class="p">[</span><span class="nx">App\Models\Post</span><span class="p">]</span> <span class="nx">records</span> <span class="nx">have</span> <span class="nx">been</span> <span class="nx">imported</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//å¦‚æœä½ å·²ç»åšè¿‡åŒæ­¥äº†ï¼Œç„¶åä½ ä¸å°å¿ƒæ‰‹åŠ¨åˆ é™¤æˆ–è€…å¢åŠ äº†mysqlä¸­åˆ°æ•°æ®ï¼Œé‚£ä¹ˆä½ è¦æ¸…ç©ºä¸€ä¸‹esçš„æ•°æ®,å†ä»æ–°å¯¼å…¥æ•°æ®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">scout</span><span class="o">:</span><span class="nx">flush</span> <span class="s2">&#34;App\Models\Post&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ˜¾ç¤ºå¦‚ä¸‹ï¼Œå³ä¸ºæ¸…ç©ºæˆåŠŸï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Flushed</span> <span class="p">[</span><span class="nx">App\Models\Post</span><span class="p">]</span> <span class="nx">models</span> <span class="nx">up</span> <span class="nx">to</span> <span class="nx">ID</span><span class="o">:</span> <span class="mi">116</span>
</span></span><span class="line"><span class="cl"><span class="nx">All</span> <span class="p">[</span><span class="nx">App\Models\Post</span><span class="p">]</span> <span class="nx">records</span> <span class="nx">have</span> <span class="nx">been</span> <span class="nx">flushed</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//é‡æ–°å¯¼å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">scout</span><span class="o">:</span><span class="nx">import</span> <span class="s2">&#34;App\Models\Post&#34;</span>
</span></span></code></pre></div><p>4ã€æœç´¢ä¾‹å­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * è·å–æœç´¢ç»“æœå¹¶è¿”å› TestController
</span></span></span><span class="line"><span class="cl"><span class="cm"> * */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">elasticSearch</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">search</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">([</span><span class="s1">&#39;status&#39;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;msg&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="o">=&gt;</span><span class="nv">$posts</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>5ã€æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190308-laravel-elasticsearch01.png" alt="æœç´¢å‰æ•ˆæœå›¾"></p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190308-laravel-elasticsearch02.png" alt="æœç´¢åæ•ˆæœå›¾"></p>
<h3 id="å‡ ä¸ªåŸºæœ¬çš„æ¦‚å¿µ">å‡ ä¸ªåŸºæœ¬çš„æ¦‚å¿µ</h3>
<table>
<thead>
<tr>
<th>Column 1</th>
<th>Column 2</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Cluster</code></td>
<td>é›†ç¾¤ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæˆ–è€…å¤šä¸ªæœåŠ¡å™¨çš„é›†åˆã€‚ç”¨æ¥ä¿å­˜å’±ä»¬çš„æ•°æ®çš„ã€‚ç¾¤é›†ç”±å”¯ä¸€åç§°æ ‡è¯†ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºâ€œelasticsearchâ€ã€‚</td>
</tr>
<tr>
<td><code>Node</code></td>
<td>èŠ‚ç‚¹ã€‚æ˜¯é›†ç¾¤ä¸­å•ä¸ªçš„æœåŠ¡å™¨ã€‚æœ¬ä¾‹å­ä¸­æˆ‘çš„æœåŠ¡å™¨å°±æ˜¯æœ¬åœ°çš„127.0.0.1ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚</td>
</tr>
<tr>
<td><code>Index</code></td>
<td>ç´¢å¼•ã€‚å¯ä»¥ç†è§£ä¸ºmsyqlä¸­çš„ä¸€ä¸ªæ•°æ®åº“ï¼Œç´¢å¼•ç”±åç§°æ ‡è¯†ï¼ˆå¿…é¡»å…¨éƒ¨å°å†™ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>Type</code></td>
<td>ç±»å‹ã€‚å¯ä»¥ç†è§£ä¸ºmsyqlä¸­çš„ä¸€ä¸ªè¡¨ã€‚æ³¨æ„ï¼š6.0ç‰ˆæœ¬å‰å¯ä»¥æœ‰å¤šä¸ªç±»å‹ã€‚6.0ä»¥åçš„ç‰ˆæœ¬å·²ç»å¼ƒç”¨ã€‚ä¸€ä¸ªindexä¸‹åªèƒ½æœ‰ä¸€ä¸ªtypeã€‚è¿™ä¸ªåœ°æ–¹å½“åˆæ²¡æœ‰çœ‹æ˜ç™½ï¼Œæˆ‘é¡¹ç›®ä¸­å¥½å‡ ä¸ªmodelæ¨¡å‹éƒ½è¦åšå…¨æ–‡æœç´¢ã€‚æ‰€ä»¥åœ¨æ¯ä¸€ä¸ªmodelä¸­éƒ½å®šä¹‰äº†ä¸€ä¸ªtypeã€‚æŸ¥è¯¢è‡ªç„¶æ˜¯ä¸èƒ½æˆåŠŸã€‚æ‰€ä»¥æ˜¯ä¸€ä¸ªå°å‘ã€‚å¸Œæœ›è¯»åˆ°çš„äººä¸è¦é‡å¤è¿™æ ·çš„é”™è¯¯ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æŠŠè¦åšå…¨æ–‡æœç´¢çš„å­—æ®µå­˜è¿›esä¸­ä¸€ä¸ªæ•°æ®åº“åå­—å«indexï¼Œæ•°æ®è¡¨åå­—å«typeçš„è¡¨ä¸­ã€‚ä¸ç®¡ä½ è¦æŸ¥è¯¢çš„å­—æ®µåœ¨å“ªä¸ªmodelæ¨¡å‹ä¸­ã€‚</td>
</tr>
<tr>
<td><code>Document</code></td>
<td>æ–‡æ¡£ã€‚å¯ä»¥ç†è§£ä¸ºä¸€æ¡æ•°æ®ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="ç»“æŸè¯­">ç»“æŸè¯­</h3>
<ul>
<li>åªæ˜¯ç®€å•çš„è¯•ç”¨äº†ä¸‹<code>ElasticSearch</code>çš„<strong>ç®€å•æœç´¢</strong>åŠŸèƒ½ï¼Œå¹¶æ²¡æœ‰åœ¨æ­£å¼é¡¹ç›®ä¸­ç”¨åˆ°è¿‡ï¼Œè‹¥è¦åœ¨æ­£å¼é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè¿˜æœ‰å¾ˆå¤šæ¦‚å¿µä»¥åŠç”¨æ³•éœ€è¦å»æ·±å…¥å­¦ä¹ ã€‚å¦‚è‹¥æœ‰å“ªé‡Œå†™çš„ä¸å¥½ï¼Œæœ›è¯„è®ºæŒ‡å‡ºã€‚ğŸ˜³</li>
</ul>
]]></content>
		</item>
		
		<item>
			<title>LaravelæœåŠ¡ä¹‹ä»»åŠ¡è°ƒåº¦â°</title>
			<link>https://blog.gookm.cn/posts/2019/20190304-laravel-crontab/</link>
			<pubDate>Mon, 04 Mar 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190304-laravel-crontab/</guid>
			<description>åŸºç¡€ç¯‡
Laravel çš„å‘½ä»¤è°ƒåº¦ç¨‹åºå…è®¸ä½ åœ¨ Laravel ä¸­å¯¹å‘½ä»¤è°ƒåº¦è¿›è¡Œæ¸…æ™°æµç•…çš„å®šä¹‰ã€‚å¹¶ä¸”åœ¨ä½¿ç”¨è°ƒåº¦ç¨‹åºæ—¶ï¼Œåªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå¢åŠ ä¸€æ¡ Cron é¡¹ç›®å³å¯ã€‚è°ƒåº¦æ˜¯åœ¨ app/Console/Kernel.php æ–‡ä»¶çš„ schedule æ–¹æ³•ä¸­å®šä¹‰çš„ã€‚ä¸ºäº†æ–¹ä¾¿ä½ å¼€å§‹ï¼Œè¯¥æ–¹æ³•å·²ç»åŒ…å«äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚
å®šä¹‰è°ƒåº¦ 1ã€åœ¨App\Console\Kernelç±»çš„scheduleæ–¹æ³•ä¸­å®šä¹‰æ‰€æœ‰è°ƒåº¦ä»»åŠ¡(Closure)ï¼š
protected function schedule(Schedule $schedule) { $schedule-&amp;gt;call(function () { $saying=str_random(10); Map::where(&amp;#39;id&amp;#39;,32)-&amp;gt;update([&amp;#39;value&amp;#39;=&amp;gt;$saying]); })-&amp;gt;hourly(); $schedule-&amp;gt;call(function () { .. })-&amp;gt;everyMinute(); . . . } 2ã€Artisanå‘½ä»¤è°ƒåº¦ï¼š
é™¤äº†è®¡åˆ’ Closure è°ƒç”¨ï¼Œä½ è¿˜èƒ½è°ƒåº¦ Artisan å‘½ä»¤ å’Œæ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ç»™ command æ–¹æ³•ä¼ é€’å‘½ä»¤åç§°æˆ–è€…ç±»åç§°æ¥è°ƒåº¦ä¸€ä¸ª Artisan å‘½ä»¤ï¼š $schedule-&amp;gt;command(&amp;#39;emails:send --force&amp;#39;)-&amp;gt;-&amp;gt;dailyAt(&amp;#39;13:00&amp;#39;); $schedule-&amp;gt;command(EmailsCommand::class, [&amp;#39;--force&amp;#39;])-&amp;gt;weekly(); 3ã€é˜Ÿåˆ—ä»»åŠ¡è°ƒåº¦ï¼š
job æ–¹æ³•å¯ä»¥ç”¨æ¥è°ƒåº¦ é˜Ÿåˆ—ä»»åŠ¡ã€‚è¿™ä¸ªæ–¹æ³•æä¾›äº†ä¸€ç§å¿«æ·æ–¹å¼æ¥è°ƒåº¦ä»»åŠ¡ï¼Œæ— éœ€ä½¿ç”¨ call æ–¹æ³•æ‰‹åŠ¨åˆ›å»ºé—­åŒ…æ¥è°ƒåº¦ä»»åŠ¡ $schedule-&amp;gt;job(new Heartbeat)-&amp;gt;everyFiveMinutes(); 4ã€Shell å‘½ä»¤è°ƒåº¦ï¼š
exec æ–¹æ³•å¯ç”¨äºå‘æ“ä½œç³»ç»Ÿå‘å‡ºå‘½ä»¤ $shell=&amp;#34;netstat -anp | grep 5200 | grep LISTEN | wc -l&amp;#34;; $shell=&amp;#34;node /home/forge/script.</description>
			<content type="html"><![CDATA[<p><strong>åŸºç¡€ç¯‡</strong></p>
<!-- raw HTML omitted -->
<p>Laravel çš„å‘½ä»¤è°ƒåº¦ç¨‹åºå…è®¸ä½ åœ¨ Laravel ä¸­å¯¹å‘½ä»¤è°ƒåº¦è¿›è¡Œæ¸…æ™°æµç•…çš„å®šä¹‰ã€‚å¹¶ä¸”åœ¨ä½¿ç”¨è°ƒåº¦ç¨‹åºæ—¶ï¼Œåªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå¢åŠ ä¸€æ¡ <code>Cron</code> é¡¹ç›®å³å¯ã€‚è°ƒåº¦æ˜¯åœ¨ <code>app/Console/Kernel.php</code> æ–‡ä»¶çš„ <code>schedule</code> æ–¹æ³•ä¸­å®šä¹‰çš„ã€‚ä¸ºäº†æ–¹ä¾¿ä½ å¼€å§‹ï¼Œè¯¥æ–¹æ³•å·²ç»åŒ…å«äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚</p>
<!-- raw HTML omitted -->
<h3 id="å®šä¹‰è°ƒåº¦">å®šä¹‰è°ƒåº¦</h3>
<p>1ã€åœ¨<code>App\Console\Kernel</code>ç±»çš„<code>schedule</code>æ–¹æ³•ä¸­å®šä¹‰æ‰€æœ‰è°ƒåº¦ä»»åŠ¡(<code>Closure</code>)ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="k">function</span> <span class="nf">schedule</span><span class="p">(</span><span class="nx">Schedule</span> <span class="nv">$schedule</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$saying</span><span class="o">=</span><span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Map</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="o">=&gt;</span><span class="nv">$saying</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span><span class="o">-&gt;</span><span class="na">hourly</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">..</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span><span class="o">-&gt;</span><span class="na">everyMinute</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>2ã€<code>Artisan</code>å‘½ä»¤è°ƒåº¦ï¼š</p>
<ul>
<li>é™¤äº†è®¡åˆ’ Closure è°ƒç”¨ï¼Œä½ è¿˜èƒ½è°ƒåº¦ Artisan å‘½ä»¤ å’Œæ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ç»™ command æ–¹æ³•ä¼ é€’å‘½ä»¤åç§°æˆ–è€…ç±»åç§°æ¥è°ƒåº¦ä¸€ä¸ª Artisan å‘½ä»¤ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">command</span><span class="p">(</span><span class="s1">&#39;emails:send --force&#39;</span><span class="p">)</span><span class="o">-&gt;-&gt;</span><span class="nx">dailyAt</span><span class="p">(</span><span class="s1">&#39;13:00&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">command</span><span class="p">(</span><span class="nx">EmailsCommand</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--force&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">weekly</span><span class="p">();</span>
</span></span></code></pre></div><p>3ã€é˜Ÿåˆ—ä»»åŠ¡è°ƒåº¦ï¼š</p>
<ul>
<li><code>job</code> æ–¹æ³•å¯ä»¥ç”¨æ¥è°ƒåº¦ é˜Ÿåˆ—ä»»åŠ¡ã€‚è¿™ä¸ªæ–¹æ³•æä¾›äº†ä¸€ç§å¿«æ·æ–¹å¼æ¥è°ƒåº¦ä»»åŠ¡ï¼Œæ— éœ€ä½¿ç”¨ call æ–¹æ³•æ‰‹åŠ¨åˆ›å»ºé—­åŒ…æ¥è°ƒåº¦ä»»åŠ¡</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">job</span><span class="p">(</span><span class="k">new</span> <span class="nx">Heartbeat</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">everyFiveMinutes</span><span class="p">();</span>
</span></span></code></pre></div><p>4ã€<code>Shell</code> å‘½ä»¤è°ƒåº¦ï¼š</p>
<ul>
<li>exec æ–¹æ³•å¯ç”¨äºå‘æ“ä½œç³»ç»Ÿå‘å‡ºå‘½ä»¤</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$shell</span><span class="o">=</span><span class="s2">&#34;netstat -anp | grep 5200 | grep LISTEN | wc -l&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$shell</span><span class="o">=</span><span class="s2">&#34;node /home/forge/script.js&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$shell</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">daily</span><span class="p">();</span>
</span></span></code></pre></div><h3 id="å¯åŠ¨è°ƒåº¦å™¨">å¯åŠ¨è°ƒåº¦å™¨</h3>
<p>1ã€æ‰“å¼€<code>cron</code>åˆ—è¡¨æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">crontab -e
</span></span></code></pre></div><p>2ã€æ·»åŠ è¦ç”±<code>cron</code>è¿è¡Œçš„ä»»åŠ¡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">* * * * * php /www/wwwroot/promise/artisan schedule:run &gt;&gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span></code></pre></div><p>3ã€ä¿å­˜ï¼Œæ˜¾ç¤ºä»¥ä¸‹ï¼Œå³æˆåŠŸ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">crontab: installing new crontab
</span></span></code></pre></div><p>4ã€æŸ¥çœ‹åˆ—è¡¨ä»»åŠ¡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">crontab -l
</span></span></code></pre></div><p><strong>æ³¨æ„ï¼šæ¯æ¬¡ä¿®æ”¹ä»»åŠ¡è°ƒåº¦ç›¸å…³ä»£ç ï¼Œéœ€è¦é‡æ–°ç¼–è¾‘å¹¶ä¿å­˜cronåˆ—è¡¨æ–‡ä»¶ã€‚</strong></p>
<h3 id="è°ƒåº¦é¢‘ç‡è®¾ç½®">è°ƒåº¦é¢‘ç‡è®¾ç½®</h3>
<p>å½“ç„¶ï¼Œä½ å¯ä»¥ä¸ºä½ çš„ä»»åŠ¡åˆ†é…å¤šç§è°ƒåº¦è®¡åˆ’ï¼š</p>
<table>
<thead>
<tr>
<th>Column 1</th>
<th>Column 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ–¹æ³•</td>
<td>æè¿°</td>
</tr>
<tr>
<td><code> -&gt;cron('* * * * * *');</code></td>
<td>åœ¨è‡ªå®šä¹‰çš„ Cron æ—¶é—´è¡¨ä¸Šæ‰§è¡Œè¯¥ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;everyMinute();</code></td>
<td>æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;everyFiveMinutes();</code></td>
<td>æ¯äº”åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;everyTenMinutes();</code></td>
<td>æ¯ååˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;everyFifteenMinutes();</code></td>
<td>æ¯åäº”åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;everyThirtyMinutes();</code></td>
<td>æ¯åŠå°æ—¶æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;hourly();</code></td>
<td>æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;hourlyAt(17);</code></td>
<td>æ¯å°æ—¶çš„ç¬¬ 17 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;daily();</code></td>
<td>æ¯å¤©åˆå¤œæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;dailyAt('13:00');</code></td>
<td>æ¯å¤©çš„ 13:00 æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;twiceDaily(1, 13);</code></td>
<td>æ¯å¤©çš„ 1:00 å’Œ 13:00 åˆ†åˆ«æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;monthly();</code></td>
<td>æ¯æœˆæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;monthlyOn(4, '15:00');</code></td>
<td>åœ¨æ¯ä¸ªæœˆçš„ç¬¬å››å¤©çš„ 15:00 æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;quarterly();</code></td>
<td>æ¯å­£åº¦æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;yearly();</code></td>
<td>æ¯å¹´æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</td>
</tr>
<tr>
<td><code>-&gt;timezone('America/New_York');</code></td>
<td>è®¾ç½®æ—¶åŒº</td>
</tr>
</tbody>
</table>
<h3 id="ç®€å•è¿ç”¨">ç®€å•è¿ç”¨</h3>
<p>åœ¨åšå®¢å¤´éƒ¨åŠ äº†ä¸€ä¸ª<code>æ¯å°æ—¶æ›´æ–°ä¸€æ¡åè¨€</code>çš„å°åŠŸèƒ½ã€‚ğŸ¤­
<code>å¤´éƒ¨èƒŒæ™¯</code>ä¹Ÿæ˜¯æ¯å°æ—¶æ›´æ–°çš„ã€‚</p>
]]></content>
		</item>
		
		<item>
			<title>Laravelçš„APIåˆå§‹æ­å»ºä¹‹PassportğŸ˜„</title>
			<link>https://blog.gookm.cn/posts/2019/20190125-laravel-passport/</link>
			<pubDate>Fri, 25 Jan 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190125-laravel-passport/</guid>
			<description>ä»‹ç» åœ¨ Laravelä¸­ï¼Œå®ç°åŸºäºä¼ ç»Ÿè¡¨å•çš„ç™»é™†å’Œæˆæƒå·²ç»éå¸¸ç®€å•ï¼Œä½†æ˜¯å¦‚ä½•æ»¡è¶³ API åœºæ™¯ä¸‹çš„æˆæƒéœ€æ±‚å‘¢ï¼Ÿåœ¨ APIåœºæ™¯é‡Œé€šå¸¸é€šè¿‡ä»¤ç‰Œæ¥å®ç°ç”¨æˆ·æˆæƒï¼Œè€Œéç»´æŠ¤è¯·æ±‚ä¹‹é—´çš„ Session çŠ¶æ€ã€‚åœ¨ Laravel é¡¹ç›®ä¸­ä½¿ç”¨ Passport å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°å®ç° API æˆæƒè®¤è¯ï¼ŒPassport å¯ä»¥åœ¨å‡ åˆ†é’Ÿä¹‹å†…ä¸ºä½ çš„åº”ç”¨ç¨‹åºæä¾›å®Œæ•´çš„ OAuth2 æœåŠ¡ç«¯å®ç°ã€‚Passport æ˜¯åŸºäºç”± Alex Bilbie ç»´æŠ¤çš„ League OAuth2 server å»ºç«‹çš„ã€‚â¤ğŸ·ğŸ˜˜
å®‰è£… 1ã€å®‰è£…ä¸€ä¸ªå…¨æ–° laravel é¡¹ç›®
composer create-project --prefer-dist laravel/laravel passport 2ã€å®‰è£… Laravel Passport åŒ…
Laravel Passport å¯ä»¥åœ¨å‡ åˆ†é’Ÿå†…ä¸ºä½ çš„åº”ç”¨å®ç°ä¸€ä¸ªå®Œæ•´çš„ OAuth2æœåŠ¡å™¨ composer require laravel/passport 3ã€åˆ›å»ºå­˜å‚¨å®¢æˆ·ç«¯å’Œä»¤ç‰Œçš„æ•°æ®è¡¨
Passport æœåŠ¡æä¾›å™¨ä½¿ç”¨æ¡†æ¶æ³¨å†Œè‡ªå·±çš„æ•°æ®åº“è¿ç§»ç›®å½•ï¼Œå› æ­¤åœ¨æ³¨å†Œæä¾›å™¨åï¼Œå°±åº”è¯¥è¿è¡Œ Passport çš„è¿ç§»å‘½ä»¤æ¥è‡ªåŠ¨åˆ›å»ºå­˜å‚¨å®¢æˆ·ç«¯å’Œä»¤ç‰Œçš„æ•°æ®è¡¨ php artisan migrate å¦‚æœä½ ä¸æ‰“ç®—ä½¿ç”¨ Passport çš„é»˜è®¤è¿ç§»ï¼Œä½ åº”è¯¥åœ¨ AppServiceProvider çš„ register æ–¹æ³•ä¸­è°ƒç”¨ Passport::ignoreMigrations æ–¹æ³•ã€‚ ä½ å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤ php artisan vendor:publish --tag=passport-migrations å¯¼å‡ºé»˜è®¤è¿ç§»ã€‚ 4ã€Passporté…ç½®
è¿è¡Œ passport:install å‘½ä»¤æ¥åˆ›å»ºç”Ÿæˆå®‰å…¨è®¿é—®ä»¤ç‰Œæ—¶æ‰€éœ€çš„åŠ å¯†å¯†é’¥ï¼ŒåŒæ—¶ï¼Œè¿™æ¡å‘½ä»¤ä¹Ÿä¼šåˆ›å»ºç”¨äºç”Ÿæˆè®¿é—®ä»¤ç‰Œçš„ã€Œä¸ªäººè®¿é—®ã€å®¢æˆ·ç«¯å’Œã€Œå¯†ç æˆæƒã€å®¢æˆ·ç«¯ï¼š php artisan passport:install ä¸Šé¢å‘½ä»¤æ‰§è¡Œåï¼Œè¯·å°† Laravel\Passport\HasApiTokens Trait æ·»åŠ åˆ° App\User æ¨¡å‹ä¸­ï¼Œè¿™ä¸ª Trait ä¼šç»™ä½ çš„æ¨¡å‹æä¾›ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å·²è®¤è¯ç”¨æˆ·çš„ä»¤ç‰Œå’Œä½¿ç”¨èŒƒå›´ï¼š &amp;lt;?</description>
			<content type="html"><![CDATA[<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>åœ¨ <code>Laravel</code>ä¸­ï¼Œå®ç°åŸºäºä¼ ç»Ÿè¡¨å•çš„ç™»é™†å’Œæˆæƒå·²ç»éå¸¸ç®€å•ï¼Œä½†æ˜¯å¦‚ä½•æ»¡è¶³ <code>API</code> åœºæ™¯ä¸‹çš„æˆæƒéœ€æ±‚å‘¢ï¼Ÿåœ¨ <code>API</code>åœºæ™¯é‡Œé€šå¸¸é€šè¿‡ä»¤ç‰Œæ¥å®ç°ç”¨æˆ·æˆæƒï¼Œè€Œéç»´æŠ¤è¯·æ±‚ä¹‹é—´çš„ <code>Session</code> çŠ¶æ€ã€‚åœ¨ <code>Laravel</code> é¡¹ç›®ä¸­ä½¿ç”¨ <code>Passport</code> å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°å®ç° <code>API</code> æˆæƒè®¤è¯ï¼Œ<code>Passport</code> å¯ä»¥åœ¨å‡ åˆ†é’Ÿä¹‹å†…ä¸ºä½ çš„åº”ç”¨ç¨‹åºæä¾›å®Œæ•´çš„ <code>OAuth2</code> æœåŠ¡ç«¯å®ç°ã€‚<code>Passport</code> æ˜¯åŸºäºç”± Alex Bilbie ç»´æŠ¤çš„ League OAuth2 server å»ºç«‹çš„ã€‚â¤ğŸ·ğŸ˜˜</p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<p>1ã€å®‰è£…ä¸€ä¸ªå…¨æ–° <code>laravel</code> é¡¹ç›®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer create-project --prefer-dist laravel/laravel passport
</span></span></code></pre></div><p>2ã€å®‰è£…  <code>Laravel Passport</code> åŒ…</p>
<ul>
<li><code>Laravel Passport</code> å¯ä»¥åœ¨å‡ åˆ†é’Ÿå†…ä¸ºä½ çš„åº”ç”¨å®ç°ä¸€ä¸ªå®Œæ•´çš„ <code>OAuth2</code>æœåŠ¡å™¨</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require laravel/passport
</span></span></code></pre></div><p>3ã€åˆ›å»ºå­˜å‚¨å®¢æˆ·ç«¯å’Œä»¤ç‰Œçš„æ•°æ®è¡¨</p>
<ul>
<li><code>Passport</code> æœåŠ¡æä¾›å™¨ä½¿ç”¨æ¡†æ¶æ³¨å†Œè‡ªå·±çš„æ•°æ®åº“è¿ç§»ç›®å½•ï¼Œå› æ­¤åœ¨æ³¨å†Œæä¾›å™¨åï¼Œå°±åº”è¯¥è¿è¡Œ <code>Passport</code> çš„è¿ç§»å‘½ä»¤æ¥è‡ªåŠ¨åˆ›å»ºå­˜å‚¨å®¢æˆ·ç«¯å’Œä»¤ç‰Œçš„æ•°æ®è¡¨</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan migrate
</span></span></code></pre></div><ul>
<li>å¦‚æœä½ ä¸æ‰“ç®—ä½¿ç”¨ <code>Passport</code> çš„é»˜è®¤è¿ç§»ï¼Œä½ åº”è¯¥åœ¨ <code>AppServiceProvider</code> çš„ <code>register</code> æ–¹æ³•ä¸­è°ƒç”¨ <code>Passport::ignoreMigrations</code> æ–¹æ³•ã€‚ ä½ å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤ <code>php artisan vendor:publish --tag=passport-migrations</code> å¯¼å‡ºé»˜è®¤è¿ç§»ã€‚</li>
</ul>
<p>4ã€Passporté…ç½®</p>
<ul>
<li>è¿è¡Œ <code>passport:install</code> å‘½ä»¤æ¥åˆ›å»ºç”Ÿæˆå®‰å…¨è®¿é—®ä»¤ç‰Œæ—¶æ‰€éœ€çš„åŠ å¯†å¯†é’¥ï¼ŒåŒæ—¶ï¼Œè¿™æ¡å‘½ä»¤ä¹Ÿä¼šåˆ›å»ºç”¨äºç”Ÿæˆè®¿é—®ä»¤ç‰Œçš„ã€Œä¸ªäººè®¿é—®ã€å®¢æˆ·ç«¯å’Œã€Œå¯†ç æˆæƒã€å®¢æˆ·ç«¯ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan passport:install
</span></span></code></pre></div><ul>
<li>ä¸Šé¢å‘½ä»¤æ‰§è¡Œåï¼Œè¯·å°† <code>Laravel\Passport\HasApiTokens Trait</code> æ·»åŠ åˆ° <code>App\User</code> æ¨¡å‹ä¸­ï¼Œè¿™ä¸ª <code>Trait</code> ä¼šç»™ä½ çš„æ¨¡å‹æä¾›ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å·²è®¤è¯ç”¨æˆ·çš„ä»¤ç‰Œå’Œä½¿ç”¨èŒƒå›´ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Laravel\Passport\HasApiTokens</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>æ¥ä¸‹æ¥ï¼Œåœ¨ <code>AuthServiceProvider</code> çš„ <code>boot</code> æ–¹æ³•ä¸­è°ƒç”¨ <code>Passport::routes</code> å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¼šæ³¨å†Œå‘å‡ºè®¿é—®ä»¤ç‰Œå¹¶æ’¤é”€è®¿é—®ä»¤ç‰Œã€å®¢æˆ·ç«¯å’Œä¸ªäººè®¿é—®ä»¤ç‰Œæ‰€å¿…éœ€çš„è·¯ç”±ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Gate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\AuthServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AuthServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * åº”ç”¨ç¨‹åºçš„ç­–ç•¥æ˜ å°„ã€‚
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @var array
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$policies</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;App\Model&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;App\Policies\ModelPolicy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * æ³¨å†Œä»»ä½•è®¤è¯/æˆæƒæœåŠ¡ã€‚
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return void
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerPolicies</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">Passport</span><span class="o">::</span><span class="na">routes</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>æœ€åï¼Œå°†é…ç½®æ–‡ä»¶ <code>config/auth.php</code> ä¸­æˆæƒçœ‹å®ˆå™¨ <code>guards</code> çš„ <code>api</code> çš„ <code>driver</code> é€‰é¡¹æ”¹ä¸º <code>passport</code>ã€‚æ­¤è°ƒæ•´ä¼šè®©ä½ çš„åº”ç”¨ç¨‹åºåœ¨åœ¨éªŒè¯ä¼ å…¥çš„ <code>API</code> çš„è¯·æ±‚æ—¶ä½¿ç”¨ <code>Passport</code> çš„ <code>TokenGuard</code> æ¥å¤„ç†ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;guards&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;web&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;api&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;passport&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><h3 id="æµ‹è¯•">æµ‹è¯•</h3>
<p>1ã€æ·»åŠ  <code>API</code> è·¯ç”±</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">group</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;auth&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthController@login&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;signup&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthController@signup&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">Route</span><span class="o">::</span><span class="na">group</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;middleware&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;auth:api&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthController@logout&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthController@user&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p>2ã€åˆ›å»º<code>AuthController</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:controller AuthController
</span></span></code></pre></div><p>ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Hash</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Validator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AuthController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ³¨å†Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">signup</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Validator</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">(),</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;max:255&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;max:255&#39;</span><span class="p">,</span> <span class="s1">&#39;unique:users&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;min:6&#39;</span><span class="p">,</span> <span class="s1">&#39;confirmed&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Successfully created user!&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span> <span class="mi">201</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ç™»å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Validator</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">(),</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|email&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;remember_me&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boolean&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$credentials</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Auth</span><span class="o">::</span><span class="na">attempt</span><span class="p">(</span><span class="nv">$credentials</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Unauthorized&#39;</span><span class="p">],</span> <span class="mi">401</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/*$user=User::where(&#39;email&#39;,$request-&gt;email)-&gt;first();
</span></span></span><span class="line"><span class="cl"><span class="cm">    if($user == &#39;&#39;) return response()-&gt;json([&#39;message&#39; =&gt; &#39;é‚®ç®±å·ä¸å­˜åœ¨ï¼&#39;],402);
</span></span></span><span class="line"><span class="cl"><span class="cm">    if(! Hash::check($request-&gt;password,$user-&gt;password)) return response()-&gt;json([&#39;message&#39; =&gt; &#39;å¯†ç ä¸æ­£ç¡®ï¼&#39;],401);*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$tokenResult</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createToken</span><span class="p">(</span><span class="s1">&#39;Personal Access Token&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$tokenResult</span><span class="o">-&gt;</span><span class="na">token</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">remember_me</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$token</span><span class="o">-&gt;</span><span class="na">expires_at</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addWeeks</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$token</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;access_token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$tokenResult</span><span class="o">-&gt;</span><span class="na">accessToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;token_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;expires_at&#39;</span> <span class="o">=&gt;</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">parse</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$tokenResult</span><span class="o">-&gt;</span><span class="na">token</span><span class="o">-&gt;</span><span class="na">expires_at</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//é€€å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">token</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">revoke</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Successfully logged out&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ç™»å½•ç”¨æˆ·ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">user</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></div><h3 id="postmanè°ƒç”¨">Postmanè°ƒç”¨</h3>
<p>1ã€æ³¨å†Œ</p>
<p><code>Headers</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span> <span class="o">:</span> <span class="nx">application</span><span class="o">/</span><span class="nx">json</span>
</span></span></code></pre></div><p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190125-laravel-passport01.jpg" alt="æ³¨å†Œ"></p>
<p>2ã€ç™»å½•</p>
<p><code>Headers</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span> <span class="o">:</span> <span class="nx">application</span><span class="o">/</span><span class="nx">json</span>
</span></span></code></pre></div><p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190125-laravel-passport02.jpg" alt="ç™»å½•"></p>
<p>3ã€é€€å‡º</p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190125-laravel-passport03.jpg" alt="é€€å‡º"></p>
<p>æ³¨æ„ï¼š<code>Bearer</code> å’Œ <code>token</code>ä¹‹é—´æœ‰ä¸ªç©ºæ ¼å“¦ï¼ï¼ï¼ï¼</p>
<p>4ã€ç”¨æˆ·ä¿¡æ¯</p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2019/20190125-laravel-passport04.jpg" alt="ç”¨æˆ·ä¿¡æ¯"></p>
<p>æ³¨æ„ï¼š<code>Bearer</code> å’Œ <code>token</code> ä¹‹é—´æœ‰ä¸ªç©ºæ ¼å“¦ï¼ï¼ï¼ï¼</p>
<p>å‚è€ƒï¼š<a href="https://laravel-china.org/docs/laravel/5.7/passport/2270">https://laravel-china.org/docs/laravel/5.7/passport/2270</a></p>
]]></content>
		</item>
		
		<item>
			<title>Laravelæ¨¡å‹å¸¸ç”¨å±æ€§</title>
			<link>https://blog.gookm.cn/posts/2019/20190111-laravel-eloquent/</link>
			<pubDate>Fri, 11 Jan 2019 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2019/20190111-laravel-eloquent/</guid>
			<description>æ¨¡å‹å¸¸ç”¨å±æ€§ æŒ‡å®šè‡ªå®šä¹‰æ•°æ®è¡¨ protected $table = &amp;#39;users&amp;#39;; ä¸»é”® protected $primaryKey = &amp;#39;id&amp;#39;; éé€’å¢æˆ–è€…éæ•°å€¼çš„ä¸»é”® public $incrementing = false; ä¸»é”®ä¸æ˜¯ä¸€ä¸ªæ•´æ•° protected $keyType = &amp;#39;string&amp;#39;; ä¸æƒ³è®© Eloquent è‡ªåŠ¨ç®¡ç†created_at å’Œ updated_at public $timestamps = false; è‡ªå®šä¹‰æ—¶é—´æˆ³çš„æ ¼å¼ protected $dateFormat = &amp;#39;U&amp;#39;; è‡ªå®šä¹‰å­˜å‚¨æ—¶é—´æˆ³çš„å­—æ®µå const CREATED_AT = &amp;#39;creation_date&amp;#39;; const UPDATED_AT = &amp;#39;last_update&amp;#39;; ä¸ºæ¨¡å‹æŒ‡å®šä¸€ä¸ªä¸åŒçš„è¿æ¥ protected $connection = &amp;#39;connection-name&amp;#39;; å®šä¹‰å“ªäº›æ¨¡å‹å±æ€§æ˜¯å¯ä»¥è¢«æ‰¹é‡èµ‹å€¼çš„(ç™½åå•) protected $fillable = [&amp;#39;name&amp;#39;]; ä¸å…è®¸è¢«æ‰¹é‡èµ‹å€¼(é»‘åå•) protected $guarded = [&amp;#39;price&amp;#39;]; éœ€è¦è½¬æ¢æˆæ—¥æœŸçš„å±æ€§ protected $dates = [&amp;#39;deleted_at&amp;#39;]; æ­¤æ¨¡å‹çš„äº‹ä»¶æ˜ å°„ protected $dispatchesEvents = [ &amp;#39;saved&amp;#39; =&amp;gt; UserSaved::class, &amp;#39;deleted&amp;#39; =&amp;gt; UserDeleted::class, ]; æ¨¡å‹è½¬æ¢ä¸ºæ•°ç»„æ—¶åº”å½“éšè—çš„å­—æ®µ protected $hidden = [&amp;#39;password&amp;#39;, &amp;#39;remember_token&amp;#39;,]; æ•°ç»„ä¸­çš„å±æ€§ä¼šè¢«å±•ç¤º protected $visible = [&amp;#39;username&amp;#39;, &amp;#39;email&amp;#39;]; åŠ è½½æ¨¡å‹å…³è”æ•°æ® protected $with = [&amp;#39;comments&amp;#39;]; åŠ è½½æ¨¡å‹å…³è”æ•°æ®æ•°é‡ protected $withCount = [&amp;#39;comments&amp;#39;]; ç»™å®šå­—æ®µé»˜è®¤å€¼ protected $attributes = [&amp;#39;status&amp;#39; =&amp;gt; self::STATUS_CREATED,]; å­—æ®µè½¬æ¢ä¸ºå¯¹åº”çš„ç±»å‹ protected $casts = [ &amp;#39;id&amp;#39; =&amp;gt; &amp;#39;integer&amp;#39;, &amp;#39;info&amp;#39; =&amp;gt; &amp;#39;array&amp;#39;, &amp;#39;is_online&amp;#39; =&amp;gt; &amp;#39;boolean&amp;#39;, ]; æ¨¡å‹è½¬æ¢ä¸ºæ•°ç»„æ—¶åº”å½“è¿½åŠ çš„è™šæ‹Ÿå­—æ®µ ä¾‹å¦‚è®¿é—®å™¨ protected $appends = [&amp;#39;tag&amp;#39;]; æŒ‡ç¤ºæ¨¡å‹å½“å‰æ˜¯å¦å¼ºåˆ¶åˆ é™¤ protected $forceDeleting = false; é»˜è®¤åˆ†é¡µæ•°é‡ protected $perPage = 20; æ¨¡å‹æ›´æ–°æ—¶åº”å½“ä¸€å¹¶æ›´æ–°çš„å…³è”å…³ç³» protected $touches = [&amp;#39;post&amp;#39;]; </description>
			<content type="html"><![CDATA[<h3 id="æ¨¡å‹å¸¸ç”¨å±æ€§">æ¨¡å‹å¸¸ç”¨å±æ€§</h3>
<ul>
<li>æŒ‡å®šè‡ªå®šä¹‰æ•°æ®è¡¨</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>ä¸»é”®</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$primaryKey</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>éé€’å¢æˆ–è€…éæ•°å€¼çš„ä¸»é”®</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="nv">$incrementing</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>ä¸»é”®ä¸æ˜¯ä¸€ä¸ªæ•´æ•°</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$keyType</span> <span class="o">=</span> <span class="s1">&#39;string&#39;</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>ä¸æƒ³è®© Eloquent è‡ªåŠ¨ç®¡ç†created_at å’Œ updated_at</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="nv">$timestamps</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>è‡ªå®šä¹‰æ—¶é—´æˆ³çš„æ ¼å¼</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$dateFormat</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>è‡ªå®šä¹‰å­˜å‚¨æ—¶é—´æˆ³çš„å­—æ®µå</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">const</span> <span class="no">CREATED_AT</span> <span class="o">=</span> <span class="s1">&#39;creation_date&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="no">UPDATED_AT</span> <span class="o">=</span> <span class="s1">&#39;last_update&#39;</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>ä¸ºæ¨¡å‹æŒ‡å®šä¸€ä¸ªä¸åŒçš„è¿æ¥</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="s1">&#39;connection-name&#39;</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>å®šä¹‰å“ªäº›æ¨¡å‹å±æ€§æ˜¯å¯ä»¥è¢«æ‰¹é‡èµ‹å€¼çš„(ç™½åå•)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
</span></span></code></pre></div><ul>
<li>ä¸å…è®¸è¢«æ‰¹é‡èµ‹å€¼(é»‘åå•)</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$guarded</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">];</span>
</span></span></code></pre></div><ul>
<li>éœ€è¦è½¬æ¢æˆæ—¥æœŸçš„å±æ€§</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deleted_at&#39;</span><span class="p">];</span>
</span></span></code></pre></div><ul>
<li>æ­¤æ¨¡å‹çš„äº‹ä»¶æ˜ å°„</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$dispatchesEvents</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;saved&#39;</span> <span class="o">=&gt;</span> <span class="nx">UserSaved</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;deleted&#39;</span> <span class="o">=&gt;</span> <span class="nx">UserDeleted</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div><ul>
<li>æ¨¡å‹è½¬æ¢ä¸ºæ•°ç»„æ—¶åº”å½“éšè—çš„å­—æ®µ</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;remember_token&#39;</span><span class="p">,];</span>
</span></span></code></pre></div><ul>
<li>æ•°ç»„ä¸­çš„å±æ€§ä¼šè¢«å±•ç¤º</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$visible</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">];</span>
</span></span></code></pre></div><ul>
<li>åŠ è½½æ¨¡å‹å…³è”æ•°æ®</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$with</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">];</span>
</span></span></code></pre></div><ul>
<li>åŠ è½½æ¨¡å‹å…³è”æ•°æ®æ•°é‡</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$withCount</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">];</span>
</span></span></code></pre></div><ul>
<li>ç»™å®šå­—æ®µé»˜è®¤å€¼</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">STATUS_CREATED</span><span class="p">,];</span>
</span></span></code></pre></div><ul>
<li>å­—æ®µè½¬æ¢ä¸ºå¯¹åº”çš„ç±»å‹</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;info&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;is_online&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="p">];</span>
</span></span></code></pre></div><ul>
<li>æ¨¡å‹è½¬æ¢ä¸ºæ•°ç»„æ—¶åº”å½“è¿½åŠ çš„è™šæ‹Ÿå­—æ®µ ä¾‹å¦‚è®¿é—®å™¨</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$appends</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">];</span>
</span></span></code></pre></div><ul>
<li>æŒ‡ç¤ºæ¨¡å‹å½“å‰æ˜¯å¦å¼ºåˆ¶åˆ é™¤</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$forceDeleting</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>é»˜è®¤åˆ†é¡µæ•°é‡</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$perPage</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>æ¨¡å‹æ›´æ–°æ—¶åº”å½“ä¸€å¹¶æ›´æ–°çš„å…³è”å…³ç³»</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$touches</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">];</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>ä½¿ç”¨LaravelSğŸš€</title>
			<link>https://blog.gookm.cn/posts/2018/20181228-laravel-swoole/</link>
			<pubDate>Fri, 28 Dec 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20181228-laravel-swoole/</guid>
			<description>Laravels ä»‹ç» LaravelSæ˜¯ä¸€ä¸ªèƒ¶æ°´é¡¹ç›®ï¼Œç”¨äºå¿«é€Ÿé›†æˆSwooleåˆ°Laravelæˆ–Lumenï¼Œç„¶åèµ‹äºˆå®ƒä»¬æ›´å¥½çš„æ€§èƒ½ã€æ›´å¤šå¯èƒ½æ€§ã€‚ åœ¨ä½¿ç”¨laravelsä¹‹å‰ï¼Œå¿…é¡»å…ˆè£…ä¸Šswooleçš„æ‰©å±•ã€‚
swooleæ–‡æ¡£ï¼šhttps://wiki.swoole.com/wiki/index/prid-1
laravesæ–‡æ¡£ï¼šhttps://github.com/hhxsv5/laravel-s
ç¯å¢ƒï¼šåœ¨VMwareè™šæ‹Ÿæœºä¸­è‡ªå·±æ­çš„ç¯å¢ƒï¼ŒCentos7ï¼ŒPHP7.2.12ï¼ŒNginx1.14.2ï¼ŒMySQL 5.5.60ã€‚
å®‰è£… Swoole æ‰©å±• 1ã€ç›´æ¥ pecl install swoole ,ä¼šæŠ¥é”™ï¼Œå› ä¸ºè£…æœ‰phpè€ç‰ˆæœ¬çš„ä¾èµ–ï¼Œæ‰€ä»¥è¦è£…æ–°çš„
yum install -y php72w-mysqlnd php72w-fpm php70w-pecl-redis php72w-common php72w-pdo php72w php72w-gd php72w-gd php72w-cli php72w-mbstring php72w-devel å› ä¸ºæˆ‘æ˜¯PHP7.2ï¼Œå¦‚æœä½ æ˜¯PHP7.0,å°†ä¸Šé¢çš„php72æ›¿æ¢ä¸ºphp70å³å¯ã€‚
2ã€å¦‚æœæŠ¥é”™ï¼š
PHP Parse error: syntax error, unexpected //&amp;#39;new&amp;#39; (T_NEW) in /usr/share/pear/PEAR/Frontend.php on //line 91 è§£å†³æ–¹æ¡ˆï¼š
å®‰è£…PECL //phpç‰ˆæœ¬ &amp;gt; 7 wget http://pear.php.net/go-pear.phar php go-pear.phar //phpç‰ˆæœ¬ &amp;lt; 7 yum install php-pear 3ã€å®‰è£…swooleåŒ…
1.pecl install swoole 2.WARNING:channel &amp;#34;pecl.php.net&amp;#34; has updated its protocols,use &amp;#34;pecl channel-update pecl.</description>
			<content type="html"><![CDATA[<h3 id="laravels-ä»‹ç»">Laravels ä»‹ç»</h3>
<blockquote>
<p>LaravelSæ˜¯ä¸€ä¸ªèƒ¶æ°´é¡¹ç›®ï¼Œç”¨äºå¿«é€Ÿé›†æˆSwooleåˆ°Laravelæˆ–Lumenï¼Œç„¶åèµ‹äºˆå®ƒä»¬æ›´å¥½çš„æ€§èƒ½ã€æ›´å¤šå¯èƒ½æ€§ã€‚
åœ¨ä½¿ç”¨laravelsä¹‹å‰ï¼Œå¿…é¡»å…ˆè£…ä¸Šswooleçš„æ‰©å±•ã€‚</p>
</blockquote>
<p>swooleæ–‡æ¡£ï¼š<a href="https://wiki.swoole.com/wiki/index/prid-1">https://wiki.swoole.com/wiki/index/prid-1</a></p>
<p>laravesæ–‡æ¡£ï¼š<a href="https://github.com/hhxsv5/laravel-s">https://github.com/hhxsv5/laravel-s</a></p>
<p>ç¯å¢ƒï¼šåœ¨VMwareè™šæ‹Ÿæœºä¸­è‡ªå·±æ­çš„ç¯å¢ƒï¼ŒCentos7ï¼ŒPHP7.2.12ï¼ŒNginx1.14.2ï¼ŒMySQL 5.5.60ã€‚</p>
<h3 id="å®‰è£…-swoole-æ‰©å±•">å®‰è£… Swoole æ‰©å±•</h3>
<p>1ã€ç›´æ¥ <code>pecl install swoole</code> ,ä¼šæŠ¥é”™ï¼Œå› ä¸ºè£…æœ‰phpè€ç‰ˆæœ¬çš„ä¾èµ–ï¼Œæ‰€ä»¥è¦è£…æ–°çš„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yum install -y php72w-mysqlnd php72w-fpm php70w-pecl-redis php72w-common php72w-pdo php72w php72w-gd php72w-gd php72w-cli php72w-mbstring php72w-devel
</span></span></code></pre></div><p>å› ä¸ºæˆ‘æ˜¯PHP7.2ï¼Œå¦‚æœä½ æ˜¯PHP7.0,å°†ä¸Šé¢çš„php72æ›¿æ¢ä¸ºphp70å³å¯ã€‚</p>
<p>2ã€å¦‚æœæŠ¥é”™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">PHP Parse error:  syntax error, unexpected //<span class="s1">&#39;new&#39;</span> <span class="o">(</span>T_NEW<span class="o">)</span> in /usr/share/pear/PEAR/Frontend.php on //line <span class="m">91</span>
</span></span></code></pre></div><p>è§£å†³æ–¹æ¡ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">å®‰è£…PECL
</span></span><span class="line"><span class="cl">//phpç‰ˆæœ¬ &gt; <span class="m">7</span>
</span></span><span class="line"><span class="cl">wget http://pear.php.net/go-pear.phar
</span></span><span class="line"><span class="cl">php go-pear.phar
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//phpç‰ˆæœ¬ &lt; <span class="m">7</span>
</span></span><span class="line"><span class="cl">yum install php-pear
</span></span></code></pre></div><p>3ã€å®‰è£…swooleåŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.pecl install swoole
</span></span><span class="line"><span class="cl">2.WARNING:channel <span class="s2">&#34;pecl.php.net&#34;</span> has updated its protocols,use <span class="s2">&#34;pecl channel-update pecl.php.net&#34;</span> to update.
</span></span><span class="line"><span class="cl">éœ€è¦æ›´æ–°ï¼špecl channel-update pecl.php.net
</span></span><span class="line"><span class="cl">3.æŸ¥æ‰¾ä¸‹php.iniçš„ä½ç½®ï¼šphp -i <span class="p">|</span>grep php.ini
</span></span><span class="line"><span class="cl">4.ç„¶ååœ¨php.iniä¸­å¢åŠ ï¼šextension<span class="o">=</span>swoole.so
</span></span><span class="line"><span class="cl">5.é‡å¯ä¸‹phpï¼šsystemctl restart php
</span></span><span class="line"><span class="cl">6.æŸ¥çœ‹ä¸‹æ˜¯å¦å·²ç»æˆåŠŸåŠ è½½äº†swoole:php -m <span class="p">|</span> grep swoole
</span></span></code></pre></div><p>å¦‚æœè¿˜æ²¡è£…ä¸Šï¼Œæ¨èå‚è€ƒï¼š<a href="https://www.cnblogs.com/phpwechat/p/8417331.html">https://www.cnblogs.com/phpwechat/p/8417331.html</a></p>
<h3 id="ä½¿ç”¨laravels">ä½¿ç”¨LaravelS</h3>
<p>1ã€å®‰è£… <code>laravels</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require <span class="s2">&#34;hhxsv5/laravel-s:~3.3&#34;</span> -vvv
</span></span></code></pre></div><p>2ã€æ³¨å†Œ <code>Service Provider</code>, ä½äº <code>config/app.php</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Hhxsv5\LaravelS\Illuminate\LaravelSServiceProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><p>3ã€å‘å¸ƒé…ç½®å’ŒäºŒè¿›åˆ¶æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan laravels publish
</span></span></code></pre></div><p>4ã€ä¿®æ”¹é…ç½® <code>config/laravels.php</code>ï¼šç›‘å¬çš„IPã€ç«¯å£ç­‰ã€‚</p>
<p>5ã€é…ç½® <code>web.confg</code> æ–‡ä»¶ï¼Œæˆ‘çš„æ˜¯è¿™æ ·</p>
<pre tabindex="0"><code class="language-apacheconfig" data-lang="apacheconfig">map $http_upgrade $connection_upgrade {
    default upgrade;
    &#39;&#39;      close;
}
upstream laravels {
    # é€šè¿‡ IP:Port è¿æ¥
    server 127.0.0.1:5200 weight=5 max_fails=3 fail_timeout=30s;
    # é€šè¿‡ UnixSocket Stream è¿æ¥ï¼Œå°è¯€çªï¼šå°†socketæ–‡ä»¶æ”¾åœ¨/dev/shmç›®å½•ä¸‹ï¼Œå¯è·å¾—æ›´å¥½çš„æ€§èƒ½
    #server unix:/xxxpath/laravel-s-test/storage/laravels.sock weight=5 max_fails=3 fail_timeout=30s;
    #server 192.168.1.1:5200 weight=3 max_fails=3 fail_timeout=30s;
    #server 192.168.1.2:5200 backup;
    keepalive 16;
}
server {
    listen 80;
    # åˆ«å¿˜äº†ç»‘Hostå“Ÿ
    server_name laras.test;
    root /var/www/laras/public;
    #access_log /yyypath/log/nginx/$server_name.access.log  main;
    autoindex off;
    index index.html index.htm;
    # Nginxå¤„ç†é™æ€èµ„æº(å»ºè®®å¼€å¯gzip)ï¼ŒLaravelSå¤„ç†åŠ¨æ€èµ„æºã€‚
    location / {
        index  index.php index.html index.htm;
        try_files $uri $uri/ /index.php?$query_string;
        if (!-e $request_filename){  
            rewrite ^/(.*) /index.php last;  
        } 
    }
    location ~ \.php$ {
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }
    
    location ~* ^.+\.(jpg|jpeg|gif|png|bmp)$ {  
        access_log off;  
        root /var/www/laras/public;  
        expires 30d;  
        break; }
    # å½“è¯·æ±‚PHPæ–‡ä»¶æ—¶ç›´æ¥å“åº”404ï¼Œé˜²æ­¢æš´éœ²public/*.php
    #location ~* \.php$ {
    #    return 404;
    #}
    # Httpå’ŒWebSocketå…±å­˜ï¼ŒNginxé€šè¿‡locationåŒºåˆ†
    # !!! WebSocketè¿æ¥æ—¶è·¯å¾„ä¸º/ws
    # Javascript: var ws = new WebSocket(&#34;ws://laravels.com/ws&#34;);
    location =/ws {
        proxy_http_version 1.1;
        # proxy_connect_timeout 60s;
        # proxy_send_timeout 60s;
        # proxy_read_timeoutï¼šå¦‚æœ60ç§’å†…è¢«ä»£ç†çš„æœåŠ¡å™¨æ²¡æœ‰å“åº”æ•°æ®ç»™Nginxï¼Œé‚£ä¹ˆNginxä¼šå…³é—­å½“å‰è¿æ¥ï¼›åŒæ—¶ï¼ŒSwooleçš„å¿ƒè·³è®¾ç½®ä¹Ÿä¼šå½±å“è¿æ¥çš„å…³é—­
        # proxy_read_timeout 60s;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Real-PORT $remote_port;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header Scheme $scheme;
        proxy_set_header Server-Protocol $server_protocol;
        proxy_set_header Server-Name $server_name;
        proxy_set_header Server-Addr $server_addr;
        proxy_set_header Server-Port $server_port;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        proxy_pass http://laravels;
    }
    location @laravels {
        proxy_http_version 1.1;
        # proxy_connect_timeout 60s;
        # proxy_send_timeout 60s;
        # proxy_read_timeout 60s;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Real-PORT $remote_port;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header Scheme $scheme;
        proxy_set_header Server-Protocol $server_protocol;
        proxy_set_header Server-Name $server_name;
        proxy_set_header Server-Addr $server_addr;
        proxy_set_header Server-Port $server_port;
        proxy_set_header Connection &#34;&#34;;
        proxy_pass http://laravels;
    }
}
</code></pre><p>6ã€æ¯«ç§’çº§å®šæ—¶ä»»åŠ¡ <code>App\Jobs\Timer\TestCronJob</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//å¦‚laravelsæ–‡æ¡£ æˆ‘çš„æ˜¯è¿™æ · ä»…ç”¨äºæµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">client_send</span><span class="p">(</span><span class="s1">&#39;123456789&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Test</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;num&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;66&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//namespace App\Services\WebSocketClientService
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">client_send</span><span class="p">(</span><span class="nv">$msg</span><span class="p">,</span><span class="nv">$url</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="nv">$port</span><span class="o">=</span><span class="mi">5200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocketClientService</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$port</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">         <span class="cm">/*$data = @$client-&gt;recv();
</span></span></span><span class="line"><span class="cl"><span class="cm">        \Log::info($data);*/</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>7ã€å¯ç”¨ <code>WebSocket</code> æœåŠ¡å™¨ <code>App\Services\WebSocketService</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å¦‚ laravels æ–‡æ¡£ 
</span></span><span class="line"><span class="cl">https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md#%E5%90%AF%E7%94%A8websocket%E6%9C%8D%E5%8A%A1%E5%99%A8
</span></span></code></pre></div><p>8ã€è§†å›¾é¡µé¢å¼€å¯ <code>websocket</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">&#34;ws://&#34;</span><span class="o">+</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span><span class="o">+</span><span class="s2">&#34;/ws?c=&#34;</span><span class="o">+</span><span class="s2">&#34;{{ csrf_token() }}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æˆåŠŸè¿æ¥websocçš„æ—¶å€™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ws onopen&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//        ws.send(&#39;client msg&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//è¿æ¥é”™è¯¯çš„æ—¶å€™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">ws</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ws onerror&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></div><p>9ã€å¼€å¯æœåŠ¡
é‡å¯ <code>nginx</code> å’Œ <code>php</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">systemctl</span>  <span class="nx">restart</span> <span class="nx">nginx</span>
</span></span><span class="line"><span class="cl"><span class="nx">systemctl</span>   <span class="nx">restart</span>  <span class="nx">php</span><span class="o">-</span><span class="nx">fpm</span>
</span></span></code></pre></div><p>å¼€å¯ <code>laravels</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">php</span>  <span class="nx">bin</span><span class="o">/</span><span class="nx">laravels</span>  <span class="nx">starts</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>å†æ¬¡å®‰è£… Homestead</title>
			<link>https://blog.gookm.cn/posts/2018/20180929-reinstall-homestead/</link>
			<pubDate>Sat, 29 Sep 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180929-reinstall-homestead/</guid>
			<description>Homestead çš„å®‰è£…è®°å½•
ä¸‹è½½å¹¶å®‰è£… VirtualBox https://pan.baidu.com/s/1v_DiOlOOKZ3TWEjxAo1chw æå¯†ç ï¼šxlcx ä¹‹åæŒ‰ç…§æç¤ºæ“ä½œä¸€æ­¥ä¸€æ­¥è¿›è¡Œå®‰è£…å³å¯ã€‚ å‚è€ƒï¼šæˆ‘çš„å®‰è£…ä½ç½® D:\VirtualBox ubuntuçš„isoæ–‡ä»¶ä¸‹è½½ï¼šhttp://releases.ubuntu.com/18.04/ å‚è€ƒï¼šubuntu-18.04.1-live-server-amd64.iso 2018-07-25 23:39 812MæœåŠ¡å™¨å®‰è£…64ä½PCï¼ˆAMD64ï¼‰è®¡ç®—æœºå›¾åƒï¼ˆæ ‡å‡†ä¸‹è½½ï¼‰ å»ºè®®é‡å¯ç”µè„‘ ä¸‹è½½å¹¶å®‰è£…Vagrant é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zoB04XJmeY1lmhpnLVpnKw æå–ç ï¼šlej9 ç„¶åä¸€æ­¥ä¸€æ­¥æŒ‰ç…§é»˜è®¤å®‰è£…å³å¯ã€‚ å‚è€ƒï¼šæˆ‘çš„å®‰è£…ä½ç½® D:\vagrant å»ºè®®é‡å¯ç”µè„‘ å®‰è£…å’Œä½¿ç”¨ Homestead 1ã€ä¸‹è½½ Homestead è™šæ‹Ÿæœºç›’å­ï¼š
é“¾æ¥ï¼šhttps://pan.baidu.com/s/1fnyCkBC_IrPXjkI2Tw7Zng æå–ç ï¼šjpci å‚è€ƒï¼šæˆ‘çš„å­˜æ”¾ä½ç½®ä½ç½® D:\vagrant\ä¸‹ 2ã€åœ¨è§£å‹ç›®å½•ä¸­ lc-homestead-6.1.1-2018090400 è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯¼å…¥ Boxï¼š
vagrant box add metadata.json 3ã€ä¸‹è½½ Homestead ç®¡ç†è„šæœ¬ï¼š
git clone https://git.coding.net/summerblue/homestead.git Homestead å‚è€ƒï¼šæˆ‘çš„å­˜æ”¾ä½ç½® D:\
4ã€ä¸‹è½½å®Œæˆä¹‹åæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è¡Œè¿›å…¥ Homestead ç›®å½•ï¼Œå†ä½¿ç”¨ Git æ£€å‡ºæˆ‘ä»¬éœ€è¦çš„ Homestead ç‰ˆæœ¬ï¼š
git checkout v7.8.0 æ¥è‡ª laravel-china æ•™ç¨‹ï¼šä¸ºäº†ä¿è¯åç»­è®²è§£çš„æµç•…æ€§ï¼Œè¯·æ³¨æ„ç‰ˆæœ¬çš„ä¸€è‡´æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ v7.8.0
5ã€æ¥ä¸‹æ¥éœ€è¦åˆå§‹åŒ– Homesteadï¼š
bash init.sh #ï¼ˆåœ¨Homesteadä¸‹æ‰§è¡Œï¼‰ ä¼šåœ¨ Homestead ä¸‹å¤šå‡ºä¸‰ä¸ªæ–‡ä»¶ï¼šHomestead.yaml ï¼Œafter.</description>
			<content type="html"><![CDATA[<p><code>Homestead</code> çš„å®‰è£…è®°å½•</p>
<h3 id="ä¸‹è½½å¹¶å®‰è£…-virtualbox">ä¸‹è½½å¹¶å®‰è£… VirtualBox</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">https://pan.baidu.com/s/1v_DiOlOOKZ3TWEjxAo1chw  æå¯†ç ï¼šxlcx
</span></span><span class="line"><span class="cl">ä¹‹åæŒ‰ç…§æç¤ºæ“ä½œä¸€æ­¥ä¸€æ­¥è¿›è¡Œå®‰è£…å³å¯ã€‚
</span></span><span class="line"><span class="cl">å‚è€ƒï¼šæˆ‘çš„å®‰è£…ä½ç½®  D:\VirtualBox
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ubuntuçš„isoæ–‡ä»¶ä¸‹è½½ï¼šhttp://releases.ubuntu.com/18.04/
</span></span><span class="line"><span class="cl">å‚è€ƒï¼šubuntu-18.04.1-live-server-amd64.iso  2018-07-25 23:39 812MæœåŠ¡å™¨å®‰è£…64ä½PCï¼ˆAMD64ï¼‰è®¡ç®—æœºå›¾åƒï¼ˆæ ‡å‡†ä¸‹è½½ï¼‰
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å»ºè®®é‡å¯ç”µè„‘
</span></span></code></pre></div><h3 id="ä¸‹è½½å¹¶å®‰è£…vagrant">ä¸‹è½½å¹¶å®‰è£…Vagrant</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zoB04XJmeY1lmhpnLVpnKw æå–ç ï¼šlej9
</span></span><span class="line"><span class="cl">ç„¶åä¸€æ­¥ä¸€æ­¥æŒ‰ç…§é»˜è®¤å®‰è£…å³å¯ã€‚
</span></span><span class="line"><span class="cl">å‚è€ƒï¼šæˆ‘çš„å®‰è£…ä½ç½®  D:\vagrant
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å»ºè®®é‡å¯ç”µè„‘
</span></span></code></pre></div><h3 id="å®‰è£…å’Œä½¿ç”¨-homestead">å®‰è£…å’Œä½¿ç”¨ Homestead</h3>
<p>1ã€ä¸‹è½½ <code>Homestead</code> è™šæ‹Ÿæœºç›’å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1fnyCkBC_IrPXjkI2Tw7Zng æå–ç ï¼šjpci
</span></span><span class="line"><span class="cl">å‚è€ƒï¼šæˆ‘çš„å­˜æ”¾ä½ç½®ä½ç½®  D:\vagrant\ä¸‹
</span></span></code></pre></div><p>2ã€åœ¨è§£å‹ç›®å½•ä¸­ <code>lc-homestead-6.1.1-2018090400</code> è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯¼å…¥ <code>Box</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">add</span> <span class="nx">metadata</span><span class="o">.</span><span class="nx">json</span>
</span></span></code></pre></div><p>3ã€ä¸‹è½½ <code>Homestead</code> ç®¡ç†è„šæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">git</span> <span class="k">clone</span> <span class="nx">https</span><span class="o">://</span><span class="nx">git</span><span class="o">.</span><span class="nx">coding</span><span class="o">.</span><span class="nx">net</span><span class="o">/</span><span class="nx">summerblue</span><span class="o">/</span><span class="nx">homestead</span><span class="o">.</span><span class="nx">git</span> <span class="nx">Homestead</span>
</span></span></code></pre></div><p>å‚è€ƒï¼šæˆ‘çš„å­˜æ”¾ä½ç½®  D:\</p>
<p>4ã€ä¸‹è½½å®Œæˆä¹‹åæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è¡Œè¿›å…¥ <code>Homestead</code> ç›®å½•ï¼Œå†ä½¿ç”¨ <code>Git</code> æ£€å‡ºæˆ‘ä»¬éœ€è¦çš„ <code>Homestead</code> ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">git</span> <span class="nx">checkout</span> <span class="nx">v7</span><span class="o">.</span><span class="mf">8.0</span>
</span></span></code></pre></div><p>æ¥è‡ª <code>laravel-china</code> æ•™ç¨‹ï¼šä¸ºäº†ä¿è¯åç»­è®²è§£çš„æµç•…æ€§ï¼Œè¯·æ³¨æ„ç‰ˆæœ¬çš„ä¸€è‡´æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <code>v7.8.0</code></p>
<p>5ã€æ¥ä¸‹æ¥éœ€è¦åˆå§‹åŒ– <code>Homestead</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">bash</span> <span class="nx">init</span><span class="o">.</span><span class="nx">sh</span>  <span class="c1">#ï¼ˆåœ¨Homesteadä¸‹æ‰§è¡Œï¼‰
</span></span></span></code></pre></div><p>ä¼šåœ¨ <code>Homestead</code> ä¸‹å¤šå‡ºä¸‰ä¸ªæ–‡ä»¶ï¼š<code>Homestead.yaml</code>  ï¼Œ<code>after.sh</code>   ï¼Œ<code>aliases</code></p>
<h3 id="ssh-ç§˜é’¥ç™»å½•é…ç½®">SSH ç§˜é’¥ç™»å½•é…ç½®</h3>
<p>Homestead.yaml é…ç½®æ–‡ä»¶ä¸‹çš„authorize: ~/.ssh/id_rsa.pubï¼ˆSSH ç§˜é’¥ç™»å½•é…ç½®ï¼‰</p>
<p>1ã€å…ˆä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ä¸»æœºä¸Šæ˜¯å¦å·²ç»ç”Ÿæˆè¿‡ <code>SSH Key</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">ls</span> <span class="o">-</span><span class="nx">al</span> <span class="o">~/.</span><span class="nx">ssh</span>
</span></span></code></pre></div><p>2ã€å¦‚æœå­˜åœ¨ <code>id_rsa</code> å’Œ <code>id_rsa.pub</code> çš„è¯ï¼Œè¯·è·³è¿‡ä»¥ä¸‹ç”Ÿæˆ <code>SSH</code> çš„æ­¥éª¤ç»§ç»­é˜…è¯»å‰©ä¸‹å†…å®¹ã€‚
å¦åˆ™ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ç”Ÿæˆ <code>SSH Key</code>ï¼Œè¯·å°† <code>your_email@example.com</code> æ›¿æ¢ä¸ºä½ çš„é‚®ç®±ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="o">-</span><span class="nx">t</span> <span class="nx">rsa</span> <span class="o">-</span><span class="nx">C</span> <span class="s2">&#34;your_email@example.com&#34;</span>
</span></span></code></pre></div><p>æ³¨æ„ï¼šå…¨éƒ¨é»˜è®¤ <code>Enter</code> å³å¯</p>
<p>3ã€æ£€æŸ¥æ˜¯å¦ç”Ÿæˆï¼š<code>ls -al ~/.ssh</code>ï¼Œä¼šå‘ç°å¤šå‡ºä¸€ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">SSH</span> <span class="nx">ç§˜é’¥çš„ä¸¤ä¸ªæ–‡ä»¶ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="nx">id_rsa</span> <span class="nx">â€”â€”</span> <span class="nx">SSH</span> <span class="nx">ç§˜é’¥çš„</span> <span class="nx">ç§é’¥</span> <span class="p">(</span><span class="k">Private</span> <span class="nx">Key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span> <span class="nx">â€”â€”</span> <span class="nx">SSH</span> <span class="nx">ç§˜é’¥çš„</span> <span class="nx">å…¬é’¥</span> <span class="p">(</span><span class="k">Public</span> <span class="nx">Key</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="homesteadyaml-é…ç½®æ–‡ä»¶">Homestead.yaml é…ç½®æ–‡ä»¶</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">//å‚è€ƒï¼šæˆ‘æ˜¯è¿™æ ·é…ç½®çš„</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;192.168.10.10&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l">virtualbox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">authorize</span><span class="p">:</span><span class="w"> </span><span class="l">~/.ssh/id_rsa.pub</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">keys</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">~/.ssh/id_rsa</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">folders</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">E:/code/homestead  //æœ¬æœºå­˜æ”¾ä»£ç ä½ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/code  //è™šæ‹Ÿæœºå­˜æ”¾ä»£ç ä½ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">sites</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">laravel.test   //é¡¹ç›®è®¿é—®åŸŸåï¼Œè®°å¾—hostsæ–‡ä»¶çš„æ·»åŠ </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/code/laravel/public  //è™šæ‹Ÿæœºé¡¹ç›®è®¿é—®å…¥å£æ–‡ä»¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">xxx   </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/code/xxx  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">databases</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">laravel   //ç¬¬ä¸€ä¸ªé¡¹ç›®æ•°æ®åº“å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">xxx   //æ­¤é¡¹ç›®æ•°æ®åº“å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># blackfire:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     - id: foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       token: bar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       client-id: foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       client-token: bar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ports:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     - send: 50000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       to: 5000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     - send: 7777</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       to: 777</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       protocol: udp</span><span class="w">
</span></span></span></code></pre></div><h3 id="éœ€è¦æ³¨æ„">éœ€è¦æ³¨æ„ï¼š</h3>
<p>éœ€è¦æ³¨æ„ï¼ˆå‡åœ¨æœ¬åœ°çš„Homesteadä¸‹æ“ä½œï¼‰</p>
<p>1ã€åœ¨æˆ‘ä»¬æ¯æ¬¡å¯¹ <code>Homestead.yaml</code> æ–‡ä»¶è¿›è¡Œäº†æ›´æ”¹ä¹‹åï¼Œéƒ½éœ€è¦è¿è¡Œä¸‹é¢å‘½ä»¤æ¥ä½¿å…¶æ›´æ”¹ç”Ÿæ•ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">vagrant</span> <span class="nx">provision</span> <span class="o">&amp;&amp;</span> <span class="nx">vagrant</span> <span class="nx">reload</span>
</span></span></code></pre></div><p>2ã€æ•°æ®åº“ç›¸å…³</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">é»˜è®¤è´¦æˆ·ï¼šhomestead  å¯†ç ï¼šsecret
</span></span><span class="line"><span class="cl">è¿ä¸Šè™šæ‹Ÿæœºï¼šmysql -u homestead -p    è¿›å…¥æ•°æ®åº“
</span></span></code></pre></div><p>3ã€å½“ <code>vagrant up</code> å‡ºç° <code>Vagrant could not detect VirtualBox!</code> æ˜¯å¯èƒ½çš„é—®é¢˜æ˜¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">VBOX_INSTALL_PATHæˆ–VBOX_MSI_INSTALL_PATHç¯å¢ƒå˜é‡ã€‚
</span></span></code></pre></div><p>æˆ‘æ˜¯ç›´æ¥é‡å¯ç”µè„‘å°±å¥½äº†~~~</p>
<p>4ã€<code>vagrant</code> ç›¸å…³å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">vagrant</span> <span class="nx">init</span>	<span class="c1">#åˆå§‹åŒ– vagrant
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vagrant</span> <span class="nx">up</span>	    <span class="c1">#å¯åŠ¨ vagrant
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vagrant</span> <span class="nx">halt</span>	<span class="c1">#å…³é—­ vagrant
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vagrant</span> <span class="nx">ssh</span>	    <span class="c1">#é€šè¿‡SSHç™»å½•vagrantï¼ˆéœ€è¦å…ˆå¯åŠ¨ vagrantï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vagrant</span> <span class="nx">provision</span>	<span class="c1">#é‡æ–°åº”ç”¨æ›´æ”¹ vagrant é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vagrant</span> <span class="nx">destroy</span>	    <span class="c1">#åˆ é™¤ vagrant
</span></span></span></code></pre></div><p>5ã€å¼‚å¸¸é€€å‡ºåï¼Œ<code>vagrant up</code> æŠ¥é”™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">vagrant</span> <span class="nx">haltThere</span> <span class="nx">was</span> <span class="nx">an</span> <span class="nx">error</span> <span class="k">while</span> <span class="nx">executing</span> <span class="sb">`VBoxManage`</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">CLI</span> <span class="nx">used</span> <span class="nx">by</span> <span class="nx">Vagrant</span> <span class="k">for</span> <span class="nx">controlling</span> <span class="nx">VirtualBox</span><span class="o">.</span> <span class="nx">The</span> <span class="nx">command</span> <span class="k">and</span> <span class="nx">std</span> <span class="nx">err</span> <span class="nx">is</span> <span class="nx">shown</span> <span class="nx">below</span><span class="o">.</span>
</span></span></code></pre></div><p>è§£å†³ï¼šé‡å¯ç”µè„‘æˆ–è€…åœ¨ä»»åŠ¡ç®¡ç†å™¨ç»“æŸæ‰€æœ‰ <code>VirtualBox</code> ç›¸å…³è¿›ç¨‹</p>
]]></content>
		</item>
		
		<item>
			<title>Linuxç¯å¢ƒæ­å»º</title>
			<link>https://blog.gookm.cn/posts/2018/20180906-centos-lnmp/</link>
			<pubDate>Thu, 06 Sep 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180906-centos-lnmp/</guid>
			<description>PHPç¯å¢ƒæ­å»º Vmä¸‹è½½åœ°å€ï¼šhttps://www.landiannews.com/archives/40619.html CentOSiso: http://isoredirect.centos.org/centos/7/isos/x86_64/CentOS-7-x86_64-Minimal-1804.iso 1ã€å®‰è£…éœ€è¦çš„åº“ yum -y install rsync net-snmp syslog net-snmp-devel wget patch screen gcc gcc-c++ autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers ImageMagick-devel net-snmp-devel gd xinetd pcre-devel cmake 2ã€é˜²ç«å¢™æ·»åŠ ç«¯å£ firewall-cmd --zone=public --add-port=80/tcp --permanent firewall-cmd --zone=public --add-port=443/tcp --permanent firewall-cmd --zone=public --add-port=3306/tcp --permanent firewall-cmd --reload 3ã€å®‰è£…mysql 3.</description>
			<content type="html"><![CDATA[<h3 id="phpç¯å¢ƒæ­å»º">PHPç¯å¢ƒæ­å»º</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Vmä¸‹è½½åœ°å€ï¼šhttps</span><span class="o">://</span><span class="nx">www</span><span class="o">.</span><span class="nx">landiannews</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">archives</span><span class="o">/</span><span class="mf">40619.</span><span class="nx">html</span>
</span></span><span class="line"><span class="cl"><span class="nx">CentOSiso</span><span class="o">:</span> <span class="nx">http</span><span class="o">://</span><span class="nx">isoredirect</span><span class="o">.</span><span class="nx">centos</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">centos</span><span class="o">/</span><span class="mi">7</span><span class="o">/</span><span class="nx">isos</span><span class="o">/</span><span class="nx">x86_64</span><span class="o">/</span><span class="nx">CentOS</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="nx">x86_64</span><span class="o">-</span><span class="nx">Minimal</span><span class="o">-</span><span class="mf">1804.</span><span class="nx">iso</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="nx">ã€å®‰è£…éœ€è¦çš„åº“</span>
</span></span><span class="line"><span class="cl"><span class="nx">yum</span> <span class="o">-</span><span class="nx">y</span> <span class="nx">install</span> <span class="nx">rsync</span> <span class="nx">net</span><span class="o">-</span><span class="nx">snmp</span> <span class="nx">syslog</span> <span class="nx">net</span><span class="o">-</span><span class="nx">snmp</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">wget</span> <span class="nx">patch</span> <span class="nx">screen</span> <span class="nx">gcc</span> <span class="nx">gcc</span><span class="o">-</span><span class="nx">c</span><span class="o">++</span> <span class="nx">autoconf</span> <span class="nx">libjpeg</span> <span class="nx">libjpeg</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">libpng</span> <span class="nx">libpng</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">freetype</span> <span class="nx">freetype</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">libxml2</span> <span class="nx">libxml2</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">zlib</span> <span class="nx">zlib</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">glibc</span> <span class="nx">glibc</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">glib2</span> <span class="nx">glib2</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">bzip2</span> <span class="nx">bzip2</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">ncurses</span> <span class="nx">ncurses</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">curl</span> <span class="nx">curl</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">e2fsprogs</span> <span class="nx">e2fsprogs</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">krb5</span> <span class="nx">krb5</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">libidn</span> <span class="nx">libidn</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">openssl</span> <span class="nx">openssl</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">openldap</span> <span class="nx">openldap</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">nss_ldap</span> <span class="nx">openldap</span><span class="o">-</span><span class="nx">clients</span> <span class="nx">openldap</span><span class="o">-</span><span class="nx">servers</span> <span class="nx">ImageMagick</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">net</span><span class="o">-</span><span class="nx">snmp</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">gd</span> <span class="nx">xinetd</span> <span class="nx">pcre</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">cmake</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="nx">ã€é˜²ç«å¢™æ·»åŠ ç«¯å£</span>
</span></span><span class="line"><span class="cl"><span class="nx">firewall</span><span class="o">-</span><span class="nx">cmd</span> <span class="o">--</span><span class="nx">zone</span><span class="o">=</span><span class="k">public</span> <span class="o">--</span><span class="nx">add</span><span class="o">-</span><span class="nx">port</span><span class="o">=</span><span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span> <span class="o">--</span><span class="nx">permanent</span>
</span></span><span class="line"><span class="cl"><span class="nx">firewall</span><span class="o">-</span><span class="nx">cmd</span> <span class="o">--</span><span class="nx">zone</span><span class="o">=</span><span class="k">public</span> <span class="o">--</span><span class="nx">add</span><span class="o">-</span><span class="nx">port</span><span class="o">=</span><span class="mi">443</span><span class="o">/</span><span class="nx">tcp</span> <span class="o">--</span><span class="nx">permanent</span>
</span></span><span class="line"><span class="cl"><span class="nx">firewall</span><span class="o">-</span><span class="nx">cmd</span> <span class="o">--</span><span class="nx">zone</span><span class="o">=</span><span class="k">public</span> <span class="o">--</span><span class="nx">add</span><span class="o">-</span><span class="nx">port</span><span class="o">=</span><span class="mi">3306</span><span class="o">/</span><span class="nx">tcp</span> <span class="o">--</span><span class="nx">permanent</span>
</span></span><span class="line"><span class="cl"><span class="nx">firewall</span><span class="o">-</span><span class="nx">cmd</span> <span class="o">--</span><span class="nx">reload</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">3</span><span class="nx">ã€å®‰è£…mysql</span>
</span></span><span class="line"><span class="cl"><span class="mf">3.1</span><span class="nx">ã€yumÂ install</span> <span class="o">-</span><span class="nx">yÂ mariadb</span> <span class="nx">mariadb</span><span class="o">-</span><span class="nx">server</span> <span class="nx">mariadb</span><span class="o">-</span><span class="nx">libs</span> <span class="nx">mariadb</span><span class="o">-</span><span class="nx">devel</span>
</span></span><span class="line"><span class="cl"><span class="mf">3.2</span><span class="nx">ã€systemctl</span> <span class="nx">start</span> <span class="nx">mariadb</span>
</span></span><span class="line"><span class="cl"><span class="mf">3.3</span><span class="nx">ã€systemctl</span> <span class="nx">enable</span> <span class="nx">mariadb</span>
</span></span><span class="line"><span class="cl"><span class="mf">3.4</span><span class="nx">ã€https</span><span class="o">://</span><span class="nx">www</span><span class="o">.</span><span class="nx">cnblogs</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">me80</span><span class="o">/</span><span class="nx">p</span><span class="o">/</span><span class="mf">7218883.</span><span class="nx">html</span>
</span></span><span class="line"><span class="cl"><span class="mf">3.5</span><span class="nx">ã€è®¾ç½®è¿œç¨‹é“¾æ¥ï¼Œæ‰€æœ‰rootè´¦å·é“¾æ¥çš„è¿œç¨‹ç”¨æˆ·ï¼Œè®¾ç½®å…¶å¯†ç ä¸º123456</span>
</span></span><span class="line"><span class="cl"><span class="nx">grant</span> <span class="nx">all</span> <span class="nx">privileges</span> <span class="nx">on</span> <span class="o">*.*</span> <span class="nx">to</span> <span class="nx">root</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="nx">identified</span> <span class="nx">by</span> <span class="s1">&#39;123456&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">flush</span> <span class="nx">privileges</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="nx">ã€å®‰è£…php7</span>
</span></span><span class="line"><span class="cl"><span class="mf">4.1</span><span class="nx">ã€å®‰è£…æºï¼š</span>
</span></span><span class="line"><span class="cl"><span class="nx">rpm</span> <span class="o">-</span><span class="nx">Uvh</span> <span class="nx">https</span><span class="o">://</span><span class="nx">dl</span><span class="o">.</span><span class="nx">fedoraproject</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">pub</span><span class="o">/</span><span class="nx">epel</span><span class="o">/</span><span class="nx">epel</span><span class="o">-</span><span class="nx">release</span><span class="o">-</span><span class="nx">latest</span><span class="o">-</span><span class="mf">7.</span><span class="nx">noarch</span><span class="o">.</span><span class="nx">rpm</span>
</span></span><span class="line"><span class="cl"><span class="nx">rpm</span> <span class="o">-</span><span class="nx">Uvh</span> <span class="nx">https</span><span class="o">://</span><span class="nx">mirror</span><span class="o">.</span><span class="nx">webtatic</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">yum</span><span class="o">/</span><span class="nx">el7</span><span class="o">/</span><span class="nx">webtatic</span><span class="o">-</span><span class="nx">release</span><span class="o">.</span><span class="nx">rpm</span>
</span></span><span class="line"><span class="cl"><span class="nx">ä¸‹è½½å¯¹åº”å½“å‰ç³»ç»Ÿç‰ˆæœ¬çš„nginxåŒ…</span><span class="p">(</span><span class="nx">package</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># wget Â http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">å»ºç«‹nginxçš„yumä»“åº“</span>
</span></span><span class="line"><span class="cl"><span class="c1"># rpm -ivh nginx-release-centos-7-0.el7.ngx.noarch.rpm
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">ä¸‹è½½å¹¶å®‰è£…nginx</span>
</span></span><span class="line"><span class="cl"><span class="c1"># yum -y install nginx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">å¯åŠ¨nginxæœåŠ¡</span>
</span></span><span class="line"><span class="cl"><span class="nx">systemctl</span> <span class="nx">start</span> <span class="nx">nginx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">systemctl</span> <span class="nx">enable</span> <span class="nx">nginx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">å¯åŠ¨php</span><span class="o">-</span><span class="nx">fpm</span> Â 
</span></span><span class="line"><span class="cl"><span class="nx">systemctlÂ startÂ php</span><span class="o">-</span><span class="nx">fpm</span> Â 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">php7</span><span class="o">.</span><span class="mi">2</span><span class="nx">ä¾èµ–åŒ…</span>
</span></span><span class="line"><span class="cl"><span class="nx">yum</span> <span class="o">-</span><span class="nx">y</span> <span class="nx">remove</span> <span class="nx">php</span><span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">yum</span> <span class="o">-</span><span class="nx">y</span> <span class="nx">install</span> <span class="nx">php72w</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">cli</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">common</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">devel</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">embedded</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">fpm</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">gd</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">mbstring</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">mysqlnd</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">opcache</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">pdo</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">xml</span> <span class="nx">php72w</span><span class="o">-</span><span class="nx">bcmath</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">curl</span> <span class="o">-</span><span class="nx">sS</span> <span class="nx">https</span><span class="o">://</span><span class="nx">getcomposer</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">installer</span> <span class="o">|</span> <span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">mv</span> <span class="nx">composer</span><span class="o">.</span><span class="nx">phar</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">composer</span>
</span></span><span class="line"><span class="cl"><span class="nx">composer</span> <span class="nx">config</span> <span class="o">-</span><span class="nx">g</span> <span class="nx">repo</span><span class="o">.</span><span class="nx">packagist</span> <span class="nx">composer</span> <span class="nx">https</span><span class="o">://</span><span class="nx">packagist</span><span class="o">.</span><span class="nx">phpcomposer</span><span class="o">.</span><span class="nx">com</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Â <span class="nx">fastcgi_param</span> Â <span class="nx">SCRIPT_FILENAME</span> Â <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">vi</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">selinux</span><span class="o">/</span><span class="nx">config</span> <span class="c1">#SELINUX=enforcing #æ³¨é‡Šæ‰ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">SELINUX</span><span class="o">=</span><span class="nx">disabled</span> <span class="c1">#å¢åŠ  :wq! #ä¿å­˜é€€å‡º 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">setenforce</span> <span class="mi">0</span> <span class="c1">#ä½¿é…ç½®ç«‹å³ç”Ÿæ•ˆ
</span></span></span></code></pre></div><h3 id="nginxé…ç½®">Nginxé…ç½®</h3>
<ul>
<li>/root/etc/nginx/conf.d</li>
</ul>
<pre tabindex="0"><code class="language-apacheconfig" data-lang="apacheconfig">server {
    listen       80;
    server_name  local.laravel.test;
    location / {
        root   /var/www/laravel/public;
        index  index.php index.html index.htm;
        try_files $uri $uri/ /index.php?$query_string;
        if (!-e $request_filename){
            rewrite ^/(.*) /index.php last;
        }
    }
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /var/www/laravel/public;
    }
    location ~ \.php$ {
        root           /var/www/laravel/public;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }
}
</code></pre><h3 id="phpnginxå¯åŠ¨">PHP/Nginxå¯åŠ¨</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">systemctl</span> <span class="nx">enable</span> <span class="nx">nginx</span>
</span></span><span class="line"><span class="cl"><span class="nx">systemctl</span> <span class="nx">enable</span> <span class="nx">php</span><span class="o">-</span><span class="nx">fpm</span>
</span></span><span class="line"><span class="cl"><span class="nx">systemctl</span> <span class="nx">restart</span> <span class="nx">nginx</span>
</span></span><span class="line"><span class="cl"><span class="nx">systemctl</span> <span class="nx">restart</span> <span class="nx">php</span><span class="o">-</span><span class="nx">fpm</span>
</span></span></code></pre></div><h3 id="æ›´æ”¹æƒé™">æ›´æ”¹æƒé™</h3>
<ul>
<li>åˆ›å»ºå®Œlaravelé¡¹ç›®åï¼Œæ›´æ”¹æƒé™</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">chmod</span> <span class="o">-</span><span class="nx">R</span> <span class="mo">0777</span> <span class="nx">storage</span>
</span></span><span class="line"><span class="cl"><span class="nx">chmod</span> <span class="o">-</span><span class="nx">R</span> <span class="mo">0777</span> <span class="k">public</span>
</span></span><span class="line"><span class="cl"><span class="nx">chmod</span> <span class="o">-</span><span class="nx">R</span> <span class="mo">0777</span> <span class="nx">bootstrap</span>
</span></span></code></pre></div><h3 id="svnæäº¤é—®é¢˜è§£å†³">SVNæäº¤é—®é¢˜è§£å†³</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">å®‰è£…svnï¼šyum</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">y</span> <span class="nx">subversion</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nx">addï¼š</span>
</span></span><span class="line"><span class="cl"><span class="nx">svn</span> <span class="nx">add</span> <span class="err">$</span><span class="p">(</span><span class="nx">svn</span> <span class="nx">st</span> <span class="o">|</span> <span class="nx">grep</span> <span class="o">?</span> <span class="o">|</span> <span class="nx">sed</span> <span class="s1">&#39;s/\?//g&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">svn</span> <span class="nx">st</span> <span class="o">|</span> <span class="nx">awk</span> <span class="s1">&#39;{if ( $1 == &#34;?&#34;) { print $2}}&#39;</span> <span class="o">|</span> <span class="nx">xargs</span> <span class="nx">svn</span> <span class="nx">add</span>
</span></span><span class="line"><span class="cl"><span class="nx">svn</span> <span class="nx">status</span><span class="o">|</span><span class="nx">grep</span> <span class="o">?</span> <span class="o">|</span><span class="nx">awk</span> <span class="s1">&#39;{print $2}&#39;</span><span class="o">|</span><span class="nx">xargs</span> <span class="nx">svn</span> <span class="nx">add</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">del</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="nx">svn</span> <span class="nx">status</span><span class="o">|</span><span class="nx">grep</span> <span class="o">!</span> <span class="o">|</span><span class="nx">awk</span> <span class="s1">&#39;{print $2}&#39;</span><span class="o">|</span><span class="nx">xargs</span> <span class="nx">svn</span> <span class="nx">del</span>
</span></span><span class="line"><span class="cl"><span class="nx">svnã€€resolved</span> <span class="nx">è·¯å¾„</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>è…¾è®¯äº‘å­˜å‚¨çš„ç®€å•ä½¿ç”¨ğŸš—</title>
			<link>https://blog.gookm.cn/posts/2018/20180806-tencent-cos/</link>
			<pubDate>Mon, 06 Aug 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180806-tencent-cos/</guid>
			<description>å¯¼è¯­ å°†ä¸€äº›å›¾ç‰‡æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°ï¼ŒåŠ è½½æ…¢ï¼Œè€—èµ„æºã€‚å¯ä»¥é€‰æ‹©å°†æ–‡ä»¶ä¸Šä¼ è‡³äº‘ç«¯ï¼Œä¾‹å¦‚ä¸ƒç‰›äº‘ï¼Œé˜¿é‡Œäº‘ï¼Œè…¾è®¯äº‘ç­‰éƒ½å¯ä»¥ä½œä¸ºé€‰æ‹©æ–¹æ¡ˆï¼Œç®€å•è®°å½•ä¸‹å°†å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ è‡³è…¾è®¯äº‘å­˜å‚¨çš„è¿‡ç¨‹ã€‚
å¯¹è±¡å­˜å‚¨ COS ç®€ä»‹
å¯¹è±¡å­˜å‚¨ï¼ˆCloud Object Storageï¼Œç®€ç§°ï¼šCOSï¼‰æ˜¯è…¾è®¯äº‘æä¾›çš„ä¸€ç§å­˜å‚¨æµ·é‡æ–‡ä»¶çš„åˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡ï¼Œç”¨æˆ·å¯é€šè¿‡ç½‘ç»œéšæ—¶å­˜å‚¨å’ŒæŸ¥çœ‹æ•°æ®ã€‚è…¾è®¯äº‘ COS ä½¿æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½ä½¿ç”¨å…·å¤‡é«˜æ‰©å±•æ€§ã€ä½æˆæœ¬ã€å¯é å’Œå®‰å…¨çš„æ•°æ®å­˜å‚¨æœåŠ¡ã€‚
æ–‡æ¡£åœ°å€ï¼šhttps://cloud.tencent.com/document/product/436/11365
ä¸Šä¼ å‰å‡†å¤‡ å¿«é€Ÿå…¥é—¨æµç¨‹å›¾ï¼š
åœ¨æ³¨å†Œå®Œå¹¶åˆ›å»ºå¥½å­˜å‚¨æ¡¶åï¼Œéœ€è¦æ‹¿åˆ°ç›¸å…³é…ç½®ä¿¡æ¯ï¼ŒAPPIDï¼ŒSecretIdï¼ŒSecretKeyï¼ˆå¯†é’¥ç®¡ç†ï¼‰ï¼Œåœ¨å­˜å‚¨æ¡¶ä¸‹åˆ›å»ºä¸€ä¸ªtestæ–‡ä»¶å¤¹ï¼Œæœ¬æ¬¡æµ‹è¯•å›¾ç‰‡å…¨éƒ¨ä¸Šä¼ åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸åˆ›å»ºï¼Œå­˜å‚¨æ¡¶æ£€æµ‹åˆ°æ²¡æœ‰è¯¥æ–‡ä»¶å¤¹ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚æœ¬æ¬¡è®°å½•åªæ˜¯èµ°åˆ°äº†ä¸Šä¼ å¯¹è±¡ ã€‚
æµ‹è¯•è¿‡ç¨‹ 1ã€composerè…¾è®¯äº‘COSå¯¹è±¡å­˜å‚¨ V5åŒ…
composer require freyo/flysystem-qcloud-cos-v5 2ã€åœ¨config/app.phpçš„providersä¸‹æ·»åŠ 
Freyo\Flysystem\QcloudCOSv5\ServiceProvider::class, 3ã€åœ¨app/filesystems.phpä¸­çš„disksé‡Œä¸‹æ·»åŠ 
&amp;#39;disks&amp;#39;=&amp;gt;[ // ... &amp;#39;cosv5&amp;#39; =&amp;gt; [ &amp;#39;driver&amp;#39; =&amp;gt; &amp;#39;cosv5&amp;#39;, &amp;#39;region&amp;#39; =&amp;gt; env(&amp;#39;COSV5_REGION&amp;#39;, &amp;#39;ap-guangzhou&amp;#39;), &amp;#39;credentials&amp;#39; =&amp;gt; [ &amp;#39;appId&amp;#39; =&amp;gt; env(&amp;#39;COSV5_APP_ID&amp;#39;), &amp;#39;secretId&amp;#39; =&amp;gt; env(&amp;#39;COSV5_SECRET_ID&amp;#39;), &amp;#39;secretKey&amp;#39; =&amp;gt; env(&amp;#39;COSV5_SECRET_KEY&amp;#39;), ], &amp;#39;timeout&amp;#39; =&amp;gt; env(&amp;#39;COSV5_TIMEOUT&amp;#39;, 60), &amp;#39;connect_timeout&amp;#39; =&amp;gt; env(&amp;#39;COSV5_CONNECT_TIMEOUT&amp;#39;, 60), &amp;#39;bucket&amp;#39; =&amp;gt; env(&amp;#39;COSV5_BUCKET&amp;#39;), &amp;#39;cdn&amp;#39; =&amp;gt; env(&amp;#39;COSV5_CDN&amp;#39;), &amp;#39;scheme&amp;#39; =&amp;gt; env(&amp;#39;COSV5_SCHEME&amp;#39;, &amp;#39;https&amp;#39;), ], ], 4ã€åœ¨.</description>
			<content type="html"><![CDATA[<h3 id="å¯¼è¯­">å¯¼è¯­</h3>
<p>å°†ä¸€äº›å›¾ç‰‡æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°ï¼ŒåŠ è½½æ…¢ï¼Œè€—èµ„æºã€‚å¯ä»¥é€‰æ‹©å°†æ–‡ä»¶ä¸Šä¼ è‡³äº‘ç«¯ï¼Œä¾‹å¦‚ä¸ƒç‰›äº‘ï¼Œé˜¿é‡Œäº‘ï¼Œè…¾è®¯äº‘ç­‰éƒ½å¯ä»¥ä½œä¸ºé€‰æ‹©æ–¹æ¡ˆï¼Œç®€å•è®°å½•ä¸‹å°†å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ è‡³è…¾è®¯äº‘å­˜å‚¨çš„è¿‡ç¨‹ã€‚</p>
<p>å¯¹è±¡å­˜å‚¨ COS ç®€ä»‹</p>
<blockquote>
<p>å¯¹è±¡å­˜å‚¨ï¼ˆCloud Object Storageï¼Œç®€ç§°ï¼šCOSï¼‰æ˜¯è…¾è®¯äº‘æä¾›çš„ä¸€ç§å­˜å‚¨æµ·é‡æ–‡ä»¶çš„åˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡ï¼Œç”¨æˆ·å¯é€šè¿‡ç½‘ç»œéšæ—¶å­˜å‚¨å’ŒæŸ¥çœ‹æ•°æ®ã€‚è…¾è®¯äº‘ COS ä½¿æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½ä½¿ç”¨å…·å¤‡é«˜æ‰©å±•æ€§ã€ä½æˆæœ¬ã€å¯é å’Œå®‰å…¨çš„æ•°æ®å­˜å‚¨æœåŠ¡ã€‚</p>
</blockquote>
<p>æ–‡æ¡£åœ°å€ï¼š<a href="https://cloud.tencent.com/document/product/436/11365">https://cloud.tencent.com/document/product/436/11365</a></p>
<h3 id="ä¸Šä¼ å‰å‡†å¤‡">ä¸Šä¼ å‰å‡†å¤‡</h3>
<p>å¿«é€Ÿå…¥é—¨æµç¨‹å›¾ï¼š</p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/20180806-tencent-cos01.png" alt="æµç¨‹"></p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/20180806-tencent-cos02.jpg" alt="å­˜å‚¨æ¡¶åˆ—è¡¨"></p>
<p>åœ¨æ³¨å†Œå®Œå¹¶åˆ›å»ºå¥½å­˜å‚¨æ¡¶åï¼Œéœ€è¦æ‹¿åˆ°ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œ<code>APPID</code>ï¼Œ<code>SecretId</code>ï¼Œ<code>SecretKey</code>ï¼ˆå¯†é’¥ç®¡ç†ï¼‰ï¼Œåœ¨å­˜å‚¨æ¡¶ä¸‹åˆ›å»ºä¸€ä¸ªtestæ–‡ä»¶å¤¹ï¼Œæœ¬æ¬¡æµ‹è¯•å›¾ç‰‡å…¨éƒ¨ä¸Šä¼ åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸åˆ›å»ºï¼Œå­˜å‚¨æ¡¶æ£€æµ‹åˆ°æ²¡æœ‰è¯¥æ–‡ä»¶å¤¹ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚æœ¬æ¬¡è®°å½•åªæ˜¯èµ°åˆ°äº†ä¸Šä¼ å¯¹è±¡ ã€‚</p>
<h3 id="æµ‹è¯•è¿‡ç¨‹">æµ‹è¯•è¿‡ç¨‹</h3>
<p>1ã€<code>composer</code>è…¾è®¯äº‘COSå¯¹è±¡å­˜å‚¨ V5åŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require freyo/flysystem-qcloud-cos-v5
</span></span></code></pre></div><p>2ã€åœ¨<code>config/app.php</code>çš„<code>providers</code>ä¸‹æ·»åŠ </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Freyo\Flysystem\QcloudCOSv5\ServiceProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span></code></pre></div><p>3ã€åœ¨<code>app/filesystems.php</code>ä¸­çš„<code>disks</code>é‡Œä¸‹æ·»åŠ </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;disks&#39;</span><span class="o">=&gt;</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;cosv5&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cosv5&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;region&#39;</span>          <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_REGION&#39;</span><span class="p">,</span> <span class="s1">&#39;ap-guangzhou&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;credentials&#39;</span>     <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;appId&#39;</span>     <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_APP_ID&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;secretId&#39;</span>  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_SECRET_ID&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;secretKey&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_SECRET_KEY&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;timeout&#39;</span>         <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_TIMEOUT&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;connect_timeout&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_CONNECT_TIMEOUT&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;bucket&#39;</span>          <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_BUCKET&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;cdn&#39;</span>             <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_CDN&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;scheme&#39;</span>          <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_SCHEME&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><p>4ã€åœ¨<code>.env</code>ä¸­æ·»åŠ ç›¸å…³é…ç½®æ•°æ®</p>
<pre tabindex="0"><code class="language-dotenv" data-lang="dotenv"># cosv5
FILESYSTEM_DRIVER=cosv5    //æˆ–åœ¨app/filesystems.phpä¿®æ”¹&#39;default&#39; =&gt; &#39;cosv5&#39;,
COSV5_REGION=ap-guangzhou
COSV5_APP_ID=125600****
COSV5_SECRET_ID=AKIDPFwZahxVA60j**********JTO8lDTHiaL
COSV5_SECRET_KEY=kT7MVUKsJYeZ********CTcaMzazEH8q
COSV5_TIMEOUT=60
COSV5_CONNECT_TIMEOUT=60
COSV5_BUCKET=test1-1256003521
COSV5_CDN=https://test1-1256003521.cos.ap-guangzhou.myqcloud.com
COSV5_SCHEME=https
</code></pre><p>5ã€ç›¸å…³è·¯ç”±</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//è…¾è®¯äº‘å­˜å‚¨æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/cos&#39;</span><span class="p">,</span> <span class="s1">&#39;TestController@cos&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;cos&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/cos/put&#39;</span><span class="p">,</span> <span class="s1">&#39;TestController@filePut&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;cos.put&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>6ã€<code>TestController</code>ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * è…¾è®¯äº‘å­˜å‚¨è¡¨å•é¡µ
</span></span></span><span class="line"><span class="cl"><span class="cm"> * */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">cos</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$imgs</span><span class="o">=</span><span class="nx">CosImage</span><span class="o">::</span><span class="na">latest</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;cos.cos&#39;</span><span class="p">,</span><span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;imgs&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å°†æ¥æ”¶åˆ°çš„å›¾ç‰‡èµ„æºä¼ åˆ°è…¾è®¯äº‘COS
</span></span></span><span class="line"><span class="cl"><span class="cm"> * */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">filePut</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$fileContents</span><span class="o">=</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$path</span><span class="o">=</span><span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;cosv5&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="nv">$fileContents</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$path</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="nv">$result</span><span class="o">=</span><span class="nx">CosImage</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;url_img&#39;</span><span class="o">=&gt;</span><span class="nv">$path</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$result</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span><span class="s1">&#39;ä¸Šä¼ æˆåŠŸ&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="ç»“æœ">ç»“æœ</h3>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/20180806-tencent-cos03.jpg" alt="æ–‡ä»¶åˆ—è¡¨"></p>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/20180806-tencent-cos04.jpg" alt="æ•ˆæœå›¾"></p>
<p><strong>åªæ˜¯åšäº†ç®€å•çš„å¯¹è±¡ä¸Šä¼ ï¼Œåé¢çš„åŒ…æ‹¬ä¸‹è½½å¯¹è±¡ï¼Œä¸Šä¼ å¯¹è±¡ï¼Œåˆ é™¤å­˜å‚¨æ¡¶ç­‰å¹¶æ²¡æœ‰åšï¼ï¼ï¼</strong></p>
]]></content>
		</item>
		
		<item>
			<title>è…¾è®¯äº‘çŸ­ä¿¡çš„ç®€å•ä½¿ç”¨</title>
			<link>https://blog.gookm.cn/posts/2018/20180805-tencent-sms/</link>
			<pubDate>Sun, 05 Aug 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180805-tencent-sms/</guid>
			<description>å¯¼è¯­ è¯•è¿‡äº‘ç‰‡å’Œèšåˆçš„çŸ­ä¿¡ï¼Œç”±äºä¸€äº›åŸå› ï¼Œå®¡æ ¸éƒ½æ²¡é€šè¿‡ï¼Œäºæ˜¯å°±è½¬æˆ˜äº†è…¾è®¯äº‘çš„çŸ­ä¿¡æœåŠ¡ï¼Œéš¾é“æ˜¯å› ä¸ºæœ¬äººä½¿ç”¨çš„æ˜¯è…¾è®¯äº‘æœåŠ¡å™¨ï¼Œæ‰€ä»¥æäº¤ä¸åˆ°ä¸€ä¸ªå°æ—¶å°±å®¡æ ¸é€šè¿‡äº†ï¼Ÿå“ˆå“ˆå“ˆ&amp;hellip;..
è…¾è®¯äº‘æ–‡æ¡£å¹³å°
å‘é€å‰å‡†å¤‡ https://cloud.tencent.com/document/product/382/18071#.E5.8F.91.E9.80.81.E5.89.8D.E5.87.86.E5.A4.87
å¤§è‡´æµç¨‹ï¼šæ·»åŠ åº”ç”¨-&amp;gt;ç‚¹å‡»æ–°å¢çš„åº”ç”¨-&amp;gt;å›½å†…çŸ­ä¿¡-&amp;gt;çŸ­ä¿¡å†…å®¹é…ç½®-&amp;gt;çŸ­ä¿¡ç­¾åå’ŒçŸ­ä¿¡æ­£æ–‡ çŸ­ä¿¡ç­¾åå›¾ï¼ˆæ³¨æ„è¿™é‡Œçš„ç­¾åå†…å®¹é¡»ä¸º ICPå¤‡æ¡ˆçš„è´Ÿè´£äººåç§°+ç½‘ç«™åç§°ï¼‰ï¼š çŸ­ä¿¡æ­£æ–‡å³æ¨¡æ¿å›¾ï¼š ä¸‹é¢è®°å½•ä¸€ä¸‹æµ‹è¯•è¿‡ç¨‹ 1ã€composeräº†ä¸€ä¸ªå…¨æ–°çš„laravelæ¡†æ¶5.7ï¼š
composer create-project --prefer-dist laravel/laravel test 2ã€æ²¡æœ‰ä»å®˜æ–¹ä¸‹è½½SDKï¼Œç›´æ¥composerä¸€ä¸ªå¾ˆå¥½ç”¨çš„åŒ…ï¼ˆå› ä¸ºæ˜¯overtrueå‡ºå“ï¼‰ï¼š
composer require &amp;#34;overtrue/easy-sms&amp;#34; 3ã€ç”±äºè¯¥ç»„ä»¶è¿˜æ²¡æœ‰ Laravel çš„ ServiceProviderï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å°è£…ä¸€ä¸‹ã€‚
é¦–å…ˆåœ¨ config ç›®å½•ä¸­å¢åŠ  easysms.php æ–‡ä»¶ touch config/easysms.php config/easysms.php , å¡«å…¥å¦‚ä¸‹å†…å®¹ &amp;lt;?php return [ // HTTP è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ &amp;#39;timeout&amp;#39; =&amp;gt; 5.0, // é»˜è®¤å‘é€é…ç½® &amp;#39;default&amp;#39; =&amp;gt; [ // ç½‘å…³è°ƒç”¨ç­–ç•¥ï¼Œé»˜è®¤ï¼šé¡ºåºè°ƒç”¨ &amp;#39;strategy&amp;#39; =&amp;gt; \Overtrue\EasySms\Strategies\OrderStrategy::class, // é»˜è®¤å¯ç”¨çš„å‘é€ç½‘å…³ &amp;#39;gateways&amp;#39; =&amp;gt; [&amp;#39;qcloud&amp;#39;,], ], // å¯ç”¨çš„ç½‘å…³é…ç½® &amp;#39;gateways&amp;#39; =&amp;gt; [ &amp;#39;errorlog&amp;#39; =&amp;gt; [&amp;#39;file&amp;#39; =&amp;gt; &amp;#39;/tmp/easy-sms.log&amp;#39;,], &amp;#39;qcloud&amp;#39; =&amp;gt; [ &amp;#39;sdk_app_id&amp;#39; =&amp;gt; env(&amp;#39;QCLOUD_SMS_SDK_APP_ID&amp;#39;), &amp;#39;app_key&amp;#39; =&amp;gt; env(&amp;#39;QCLOUD_SMS_APP_KEY&amp;#39;), ], ], ]; .</description>
			<content type="html"><![CDATA[<h3 id="å¯¼è¯­">å¯¼è¯­</h3>
<p>è¯•è¿‡<code>äº‘ç‰‡</code>å’Œ<code>èšåˆ</code>çš„çŸ­ä¿¡ï¼Œç”±äºä¸€äº›åŸå› ï¼Œå®¡æ ¸éƒ½æ²¡é€šè¿‡ï¼Œäºæ˜¯å°±è½¬æˆ˜äº†<code>è…¾è®¯äº‘</code>çš„çŸ­ä¿¡æœåŠ¡ï¼Œéš¾é“æ˜¯å› ä¸ºæœ¬äººä½¿ç”¨çš„æ˜¯è…¾è®¯äº‘æœåŠ¡å™¨ï¼Œæ‰€ä»¥æäº¤ä¸åˆ°ä¸€ä¸ªå°æ—¶å°±å®¡æ ¸é€šè¿‡äº†ï¼Ÿå“ˆå“ˆå“ˆ&hellip;..</p>
<p><a href="https://cloud.tencent.com/document/product">è…¾è®¯äº‘æ–‡æ¡£å¹³å°</a></p>
<!-- raw HTML omitted -->
<h3 id="å‘é€å‰å‡†å¤‡">å‘é€å‰å‡†å¤‡</h3>
<p><a href="https://cloud.tencent.com/document/product/382/18071#.E5.8F.91.E9.80.81.E5.89.8D.E5.87.86.E5.A4.87">https://cloud.tencent.com/document/product/382/18071#.E5.8F.91.E9.80.81.E5.89.8D.E5.87.86.E5.A4.87</a></p>
<!-- raw HTML omitted -->
<pre tabindex="0"><code>å¤§è‡´æµç¨‹ï¼šæ·»åŠ åº”ç”¨-&gt;ç‚¹å‡»æ–°å¢çš„åº”ç”¨-&gt;å›½å†…çŸ­ä¿¡-&gt;çŸ­ä¿¡å†…å®¹é…ç½®-&gt;çŸ­ä¿¡ç­¾åå’ŒçŸ­ä¿¡æ­£æ–‡
</code></pre><ul>
<li>çŸ­ä¿¡ç­¾åå›¾ï¼ˆæ³¨æ„è¿™é‡Œçš„ç­¾åå†…å®¹é¡»ä¸º <code>ICPå¤‡æ¡ˆçš„è´Ÿè´£äººåç§°</code>+<code>ç½‘ç«™åç§°</code>ï¼‰ï¼š</li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/20180805-tencent-sms01.jpg" alt="ç­¾å"></p>
<ul>
<li>çŸ­ä¿¡æ­£æ–‡å³æ¨¡æ¿å›¾ï¼š</li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/20180805-tencent-sms02.jpg" alt="æ¨¡æ¿"></p>
<h3 id="ä¸‹é¢è®°å½•ä¸€ä¸‹æµ‹è¯•è¿‡ç¨‹">ä¸‹é¢è®°å½•ä¸€ä¸‹æµ‹è¯•è¿‡ç¨‹</h3>
<p>1ã€<code>composer</code>äº†ä¸€ä¸ªå…¨æ–°çš„<code>laravel</code>æ¡†æ¶5.7ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer create-project --prefer-dist laravel/laravel <span class="nb">test</span>
</span></span></code></pre></div><p>2ã€æ²¡æœ‰ä»å®˜æ–¹ä¸‹è½½SDKï¼Œç›´æ¥<code>composer</code>ä¸€ä¸ªå¾ˆå¥½ç”¨çš„åŒ…ï¼ˆå› ä¸ºæ˜¯overtrueå‡ºå“ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require <span class="s2">&#34;overtrue/easy-sms&#34;</span>
</span></span></code></pre></div><p>3ã€ç”±äºè¯¥ç»„ä»¶è¿˜æ²¡æœ‰ <code>Laravel</code> çš„ <code>ServiceProvider</code>ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å°è£…ä¸€ä¸‹ã€‚</p>
<ul>
<li>é¦–å…ˆåœ¨ <code>config</code> ç›®å½•ä¸­å¢åŠ  <code>easysms.php</code> æ–‡ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">touch config/easysms.php
</span></span></code></pre></div><ul>
<li><code>config/easysms.php</code> , å¡«å…¥å¦‚ä¸‹å†…å®¹</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// HTTP è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mf">5.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// é»˜è®¤å‘é€é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç½‘å…³è°ƒç”¨ç­–ç•¥ï¼Œé»˜è®¤ï¼šé¡ºåºè°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;strategy&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Overtrue\EasySms\Strategies\OrderStrategy</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// é»˜è®¤å¯ç”¨çš„å‘é€ç½‘å…³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;gateways&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;qcloud&#39;</span><span class="p">,],</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¯ç”¨çš„ç½‘å…³é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;gateways&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;errorlog&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;file&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/tmp/easy-sms.log&#39;</span><span class="p">,],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;qcloud&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;sdk_app_id&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;QCLOUD_SMS_SDK_APP_ID&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;app_key&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;QCLOUD_SMS_APP_KEY&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div><ul>
<li><code>.env</code>é…ç½®</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># qcloud sms</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">QCLOUD_SMS_SDK_APP_ID=140018xxxx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">QCLOUD_SMS_APP_KEY=9a88180e4a4004520610434f40fxxxxx</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>ç„¶ååˆ›å»ºä¸€ä¸ª <code>ServiceProvider</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:provider EasySmsServiceProvider
</span></span></code></pre></div><ul>
<li>ä¿®æ”¹æ–‡ä»¶ <code>app/providers/EasySmsServiceProvider.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Overtrue\EasySms\EasySms</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Support\ServiceProvider</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EasySmsServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Bootstrap the application services.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return void
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * Register the application services.
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return void
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="nx">EasySms</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="k">new</span> <span class="nx">EasySms</span><span class="p">(</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;easysms&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">alias</span><span class="p">(</span><span class="nx">EasySms</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;easysms&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>æœ€å æ‰“å¼€<code>config/app.php</code> åœ¨ <code>providers</code> ä¸­å¢åŠ  <code>App\Providers\EasySmsServiceProvider::class</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">App\Providers\EasySmsServiceProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span></code></pre></div><p>4ã€å†™å¥½è·¯ç”±ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è…¾è®¯äº‘çŸ­ä¿¡æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/sms&#39;</span><span class="p">,</span> <span class="s1">&#39;TestController@sms&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;sms&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/sms_send&#39;</span><span class="p">,</span> <span class="s1">&#39;TestController@smsSend&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;sms.send&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/sms_validate&#39;</span><span class="p">,</span> <span class="s1">&#39;TestController@validateSmsCode&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;sms.validate&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/sms_success&#39;</span><span class="p">,</span> <span class="s1">&#39;TestController@validateSmsCode&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;sms.success&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>5ã€å¼€å§‹çŸ­ä¿¡çš„åŸºç¡€é¡µé¢å’Œé€»è¾‘ï¼š</p>
<ul>
<li>å‘é€çŸ­ä¿¡è¡¨å•é¡µé¢</li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/20180805-tencent-sms03.jpg" alt="çŸ­ä¿¡è¡¨å•"></p>
<ul>
<li><code>TestController</code>æ‹¿åˆ°<code>phone</code>ï¼Œç„¶åå»è°ƒç”¨è…¾è®¯äº‘çŸ­ä¿¡æœåŠ¡ï¼Œåƒè¯¥æ‰‹æœºå·å‘é€çŸ­ä¿¡éªŒè¯ç </li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Overtrue\EasySms\EasySms</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * è°ƒç”¨è…¾è®¯äº‘å‘é€çŸ­ä¿¡éªŒè¯ç 
</span></span></span><span class="line"><span class="cl"><span class="cm"> * */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">smsSend</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$easySms</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;easysms&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$expire_minutes</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$code</span> <span class="o">=</span> <span class="nx">str_pad</span><span class="p">(</span><span class="nx">random_int</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9999</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">STR_PAD_LEFT</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$data</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;code&#39;</span><span class="o">=&gt;</span><span class="nv">$code</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;phone&#39;</span><span class="o">=&gt;</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">phoneNum</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;sms_content&#39;</span> <span class="o">=&gt;</span> <span class="s2">&#34; </span><span class="si">{</span><span class="nv">$code</span><span class="si">}</span><span class="s2">ä¸ºæ‚¨çš„ç™»å½•éªŒè¯ç ï¼Œè¯·äº</span><span class="si">{</span><span class="nv">$expire_minutes</span><span class="si">}</span><span class="s2">åˆ†é’Ÿå†…å¡«å†™ã€‚å¦‚éæœ¬äººæ“ä½œï¼Œè¯·å¿½ç•¥æœ¬çŸ­ä¿¡ã€‚ &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$res</span><span class="o">=</span><span class="nv">$easySms</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">phoneNum</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;sms_content&#39;</span><span class="p">],]);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;qcloud&#39;</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;success&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">SmsMessage</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$expired_at</span> <span class="o">=</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addMinutes</span><span class="p">(</span><span class="nv">$expire_minutes</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// ç¼“å­˜éªŒè¯ç  10 åˆ†é’Ÿè¿‡æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">\Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;smsKey_&#39;</span><span class="o">.</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">phoneNum</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;phone&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">phoneNum</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="nv">$code</span><span class="p">],</span> <span class="nv">$expired_at</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;msg&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;å·²å‘é€&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="o">=&gt;</span><span class="nv">$res</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;msg&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;å‘é€å¼‚å¸¸&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="o">=&gt;</span><span class="nv">$data</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="nx">NoGatewayAvailableException</span> <span class="nv">$e</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getResults</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>ç„¶åç®€å•éªŒè¯ä¸€ä¸‹ï¼Œè¿™é‡Œåªæ˜¯åšä¸ªæµ‹è¯•</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">* çŸ­ä¿¡éªŒè¯ç éªŒè¯
</span></span></span><span class="line"><span class="cl"><span class="cm">* */</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">validateSmsCode</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nx">cache</span><span class="p">(</span><span class="s1">&#39;smsKey_&#39;</span><span class="o">.</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">phoneNum</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">cache</span><span class="p">(</span><span class="s1">&#39;smsKey_&#39;</span><span class="o">.</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">phoneNum</span><span class="p">)[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;sms_success&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">([</span><span class="s1">&#39;sms_validate&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;éªŒè¯å¤±è´¥&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">withInput</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="ç»“æœ">ç»“æœ</h4>
<ul>
<li>æ‰‹æœºæ”¶åˆ°çš„æ•ˆæœï¼š</li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/20180805-tencent-sms04.jpg" alt="æ•ˆæœ"></p>
<ul>
<li>ç®€å•ç™»å½•åï¼š</li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/20180805-tencent-sms05.jpg" alt="é¦–é¡µ"></p>
<!-- raw HTML omitted -->
<p><strong>åªæ˜¯åšäº†æµ‹è¯•çŸ­ä¿¡çš„å‘é€æ˜¯å¦æˆåŠŸï¼Œåç»­çš„ç™»å½•éªŒè¯å¹¶æ²¡æœ‰åšï¼ï¼ï¼ï¼</strong></p>
]]></content>
		</item>
		
		<item>
			<title>Laravelä¹‹å‡æ•°æ®ï¼ˆSeederï¼‰</title>
			<link>https://blog.gookm.cn/posts/2018/20180718-laravel-seeder/</link>
			<pubDate>Wed, 18 Jul 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180718-laravel-seeder/</guid>
			<description>Laravel åŒ…å«ä¸€ä¸ªå¡«å……ç±»å¯ä»¥ä¸ºä½ çš„æ•°æ®åº“å¡«å……æµ‹è¯•æ•°æ®ã€‚æ‰€æœ‰çš„å¡«å……ç±»éƒ½æ”¾åœ¨ database/seeds ç›®å½•ä¸‹. ä½ å¯ä»¥éšæ„ä¸ºå¡«å……ç±»å‘½åï¼Œ ä½†æ˜¯æ›´å»ºè®®æ‚¨éµå®ˆç±»ä¼¼ UsersTableSeeder çš„å‘½åè§„èŒƒã€‚é€šå¸¸ï¼Œ Laravel é»˜è®¤å®šä¹‰äº†ä¸€ä¸ªDatabaseSeeder ç±»ã€‚é€šè¿‡è¿™ä¸ªç±»ï¼Œä½ å¯ä»¥ç”¨ call æ–¹æ³•æ¥è¿è¡Œå…¶å®ƒçš„ seed ç±»ä»è€Œæ§åˆ¶æ•°æ®å¡«å……çš„é¡ºåºã€‚
å‘½ä»¤åˆ›å»º php artisan make:model Models/Product -mf -fm å‚æ•°ä»£è¡¨åŒæ—¶ç”Ÿæˆ factory å·¥å‚æ–‡ä»¶å’Œ migration æ•°æ®åº“è¿ç§»æ–‡ä»¶ ç”Ÿæˆproductæ¨¡å‹æ–‡ä»¶ï¼šapp/Models/Product.php -mç”Ÿæˆproductçš„è¿ç§»æ–‡ä»¶ï¼šdatabase/migrations/&amp;lt; your_date &amp;gt;_create_products_table.php -fç”Ÿæˆproductçš„å·¥å‚æ–‡ä»¶ï¼šdatabase/factories/ModelsProductFactory.php æ›´æ–°è‡ªåŠ¨åŠ è½½ é‡å‘½åå·¥å‚æ–‡ä»¶ä¹‹åéœ€è¦æ‰§è¡Œ composer dumpautoloadï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°å¯¹åº”çš„å·¥å‚æ–‡ä»¶ã€‚ å°†å·¥å‚æ–‡ä»¶é‡å‘½åï¼š &amp;gt; mv database/factories/ModelsProductFactory.php database/factories/ProductFactory.php &amp;gt; composer dumpautoload ä»‹ç»å·¥å‚æ–‡ä»¶ æ¨¡å‹æ–‡ä»¶å’Œè¿ç§»æ–‡ä»¶å†™æ³•å°±ä¸ä»‹ç»äº†ï¼Œä»‹ç»ä¸‹å·¥å‚æ–‡ä»¶çš„ä¾‹å­ï¼š factory å·¥å‚æ–‡ä»¶ä¼šä½¿ç”¨ faker æ¥è‡ªåŠ¨ç”Ÿæˆå­—æ®µçš„å†…å®¹ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯è‹±æ–‡ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸­æ–‡ï¼š //config/app.php &amp;#39;faker_locale&amp;#39; =&amp;gt; &amp;#39;zh_CN&amp;#39;, ä»£ç  &amp;lt;?php use Faker\Generator as Faker; $factory-&amp;gt;define(App\Models\Product::class, function (Faker $faker) { $image = $faker-&amp;gt;randomElement([ &amp;#34;https://lccdn.phphub.org/uploads/images/201806/01/5320/7kG1HekGK6.jpg&amp;#34;, &amp;#34;https://lccdn.</description>
			<content type="html"><![CDATA[<blockquote>
<p>Laravel åŒ…å«ä¸€ä¸ªå¡«å……ç±»å¯ä»¥ä¸ºä½ çš„æ•°æ®åº“å¡«å……æµ‹è¯•æ•°æ®ã€‚æ‰€æœ‰çš„å¡«å……ç±»éƒ½æ”¾åœ¨ database/seeds ç›®å½•ä¸‹. ä½ å¯ä»¥éšæ„ä¸ºå¡«å……ç±»å‘½åï¼Œ ä½†æ˜¯æ›´å»ºè®®æ‚¨éµå®ˆç±»ä¼¼ UsersTableSeeder çš„å‘½åè§„èŒƒã€‚é€šå¸¸ï¼Œ Laravel é»˜è®¤å®šä¹‰äº†ä¸€ä¸ªDatabaseSeeder ç±»ã€‚é€šè¿‡è¿™ä¸ªç±»ï¼Œä½ å¯ä»¥ç”¨ call æ–¹æ³•æ¥è¿è¡Œå…¶å®ƒçš„ seed ç±»ä»è€Œæ§åˆ¶æ•°æ®å¡«å……çš„é¡ºåºã€‚</p>
</blockquote>
<h3 id="å‘½ä»¤åˆ›å»º">å‘½ä»¤åˆ›å»º</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:model Models/Product -mf
</span></span></code></pre></div><ul>
<li>-fm å‚æ•°ä»£è¡¨åŒæ—¶ç”Ÿæˆ factory å·¥å‚æ–‡ä»¶å’Œ migration æ•°æ®åº“è¿ç§»æ–‡ä»¶</li>
<li>ç”Ÿæˆproductæ¨¡å‹æ–‡ä»¶ï¼šapp/Models/Product.php</li>
<li>-mç”Ÿæˆproductçš„è¿ç§»æ–‡ä»¶ï¼šdatabase/migrations/&lt; your_date &gt;_create_products_table.php</li>
<li>-fç”Ÿæˆproductçš„å·¥å‚æ–‡ä»¶ï¼šdatabase/factories/ModelsProductFactory.php</li>
</ul>
<h3 id="æ›´æ–°è‡ªåŠ¨åŠ è½½">æ›´æ–°è‡ªåŠ¨åŠ è½½</h3>
<ul>
<li>é‡å‘½åå·¥å‚æ–‡ä»¶ä¹‹åéœ€è¦æ‰§è¡Œ <code>composer dumpautoload</code>ï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°å¯¹åº”çš„å·¥å‚æ–‡ä»¶ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å°†å·¥å‚æ–‡ä»¶é‡å‘½åï¼š
</span></span><span class="line"><span class="cl">&gt; mv database/factories/ModelsProductFactory.php database/factories/ProductFactory.php
</span></span><span class="line"><span class="cl">&gt; composer dumpautoload
</span></span></code></pre></div><h3 id="ä»‹ç»å·¥å‚æ–‡ä»¶">ä»‹ç»å·¥å‚æ–‡ä»¶</h3>
<ul>
<li>æ¨¡å‹æ–‡ä»¶å’Œè¿ç§»æ–‡ä»¶å†™æ³•å°±ä¸ä»‹ç»äº†ï¼Œä»‹ç»ä¸‹å·¥å‚æ–‡ä»¶çš„ä¾‹å­ï¼š
factory å·¥å‚æ–‡ä»¶ä¼šä½¿ç”¨ faker æ¥è‡ªåŠ¨ç”Ÿæˆå­—æ®µçš„å†…å®¹ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯è‹±æ–‡ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸­æ–‡ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//config/app.php     
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s1">&#39;faker_locale&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;zh_CN&#39;</span><span class="p">,</span>
</span></span></code></pre></div><ul>
<li>ä»£ç </li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Faker\Generator</span> <span class="k">as</span> <span class="nx">Faker</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">define</span><span class="p">(</span><span class="nx">App\Models\Product</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Faker</span> <span class="nv">$faker</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$image</span> <span class="o">=</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="na">randomElement</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://lccdn.phphub.org/uploads/images/201806/01/5320/7kG1HekGK6.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://lccdn.phphub.org/uploads/images/201806/01/5320/1B3n0ATKrn.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://lccdn.phphub.org/uploads/images/201806/01/5320/r3BNRe4zXG.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;title&#39;</span>        <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="na">word</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;description&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="na">sentence</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;image&#39;</span>        <span class="o">=&gt;</span> <span class="nv">$image</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;on_sale&#39;</span>      <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;rating&#39;</span>       <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="na">numberBetween</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;sold_count&#39;</span>   <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;review_count&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;price&#39;</span>        <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><h3 id="åˆ›å»ºseeder">åˆ›å»ºSeeder</h3>
<ul>
<li>ç„¶ååˆ›å»ºä¸€ä¸ª Seeder æ–‡ä»¶ç”¨æ¥æ‰¹é‡åˆ›å»ºå•†å“ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:seeder ProductsSeeder
</span></span></code></pre></div><ul>
<li><code>database/seeds/ProductsSeeder.php</code>,å†™æ³•ä¾‹å­ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»º 30 ä¸ªå•†å“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$products</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">\App\Models\Product</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="æœ€åæ‰§è¡Œè¿™ä¸ªseeder">æœ€åæ‰§è¡Œè¿™ä¸ªSeeder</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan db:seed --class<span class="o">=</span>ProductsSeeder
</span></span></code></pre></div><h3 id="seederæ–‡ä»¶æ³¨å†Œ">Seederæ–‡ä»¶æ³¨å†Œ</h3>
<ul>
<li>æˆ–è€…å¯ä»¥æŠŠ Seeder æ–‡ä»¶(<code>database/seeds/DatabaseSeeder.php</code>)æ³¨å†Œåˆ° DatabaseSeeder ä¸­ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DatabaseSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="nx">UsersSeeder</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="nx">ProductsSeeder</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="è¿è¡Œæ‰€æœ‰seeder">è¿è¡Œæ‰€æœ‰Seeder</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//è¿™ä¸ªå‘½ä»¤ä¼šæ‰§è¡Œä½ å†™åœ¨DatabaseSeeder.phpé‡Œé¢æ‰€æœ‰çš„ç±»çš„runå‡½æ•°
</span></span><span class="line"><span class="cl">php artisan db:seed
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>GitåŸºç¡€æ“ä½œğŸ‘£</title>
			<link>https://blog.gookm.cn/posts/2018/20180710-git-study/</link>
			<pubDate>Tue, 10 Jul 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180710-git-study/</guid>
			<description>GitåŸºç¡€å‘½ä»¤ğŸ§ æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ git branch æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯ git branch -a åˆ›å»ºåˆ†æ”¯ git branch [åˆ†æ”¯å] åˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¿™ä¸ªåˆ†æ”¯ä¸‹ git checkout -b [åˆ†æ”¯å] ä»è¿œç¨‹åˆ†æ”¯ä¸Šåˆ›å»ºæŸä¸ªåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¿™ä¸ªåˆ†æ”¯ä¸‹ // ç¤ºä¾‹: git checkout -b test origin/test git checkout -b åˆ†æ”¯å/[è¿œç¨‹åˆ†æ”¯å] åˆ é™¤ä¸€ä¸ªå·²è¢«ç»ˆæ­¢çš„åˆ†æ”¯ git branch -d &amp;lt;branch_name&amp;gt; åˆ é™¤ä¸€ä¸ªæ­£æ‰“å¼€çš„åˆ†æ”¯ git branch -D &amp;lt;branch_name&amp;gt; /æ¢å¤è¢«åˆ é™¤çš„åˆ†æ”¯ git branch &amp;lt;branch_name&amp;gt; &amp;lt;hash_val&amp;gt; åˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ git merge [åˆ†æ”¯å] æ¨é€æœ¬åœ°æŸä¸ªåˆ†æ”¯åˆ°è¿œç¨‹æŸä¸ªåˆ†æ”¯ // ç¤ºä¾‹: git push è¿œç¨‹ä¸»æœºå:[è¿œç¨‹åˆ†æ”¯å] git push origin master:master æ‹‰å–è¿œç¨‹æŸä¸ªåˆ†æ”¯åˆ°æœ¬åœ°æŸä¸ªåˆ†æ”¯ // ç¤ºä¾‹: git pull è¿œç¨‹ä¸»æœºå:[æœ¬åœ°åˆ†æ”¯å] git pull origin master:master å‚¨è—å½“å‰å·¥ä½œçŠ¶æ€ï¼ˆå¯å¤šæ¬¡ï¼‰æ–°å»ºçš„æ–‡ä»¶é¡»å…ˆaddå†stash git stash //ç®€å†™ git stash save &amp;#34;message&amp;#34; //å¤‡æ³¨ æŸ¥çœ‹å½“å‰å‚¨è— git stash list æ¢å¤æŸä¸€å‚¨è—ç‰ˆæœ¬ // ç¤ºä¾‹: git stash apply stash@{0} git stash apply [stash@{0}] åˆ é™¤æŸä¸€å‚¨è—ç‰ˆæœ¬ // ç¤ºä¾‹: git stash drop stash@{0} git stash drop [stash@{0}] æ¢å¤æœ€æ–°çš„å‚¨è—ï¼Œå¹¶æŠŠæœ€æ–°çš„å‚¨è—åˆ æ‰ git stash pop å¾…ç»­ .</description>
			<content type="html"><![CDATA[<h3 id="gitåŸºç¡€å‘½ä»¤">GitåŸºç¡€å‘½ä»¤ğŸ§</h3>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2018/git_workflow.jpg" alt="GitåŸºç¡€æµç¨‹"></p>
<ul>
<li>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git branch
</code></pre><ul>
<li>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git branch -a
</code></pre><ul>
<li>åˆ›å»ºåˆ†æ”¯</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git branch [åˆ†æ”¯å]
</code></pre><ul>
<li>åˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¿™ä¸ªåˆ†æ”¯ä¸‹</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git checkout -b [åˆ†æ”¯å]
</code></pre><ul>
<li>ä»è¿œç¨‹åˆ†æ”¯ä¸Šåˆ›å»ºæŸä¸ªåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¿™ä¸ªåˆ†æ”¯ä¸‹</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">// ç¤ºä¾‹: git checkout -b test origin/test
git checkout -b åˆ†æ”¯å/[è¿œç¨‹åˆ†æ”¯å]
</code></pre><ul>
<li>åˆ é™¤ä¸€ä¸ªå·²è¢«ç»ˆæ­¢çš„åˆ†æ”¯</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git branch -d &lt;branch_name&gt;
</code></pre><ul>
<li>åˆ é™¤ä¸€ä¸ªæ­£æ‰“å¼€çš„åˆ†æ”¯</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git branch -D &lt;branch_name&gt;
</code></pre><ul>
<li>/æ¢å¤è¢«åˆ é™¤çš„åˆ†æ”¯</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git branch &lt;branch_name&gt; &lt;hash_val&gt;
</code></pre><ul>
<li>åˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git merge [åˆ†æ”¯å]
</code></pre><ul>
<li>æ¨é€æœ¬åœ°æŸä¸ªåˆ†æ”¯åˆ°è¿œç¨‹æŸä¸ªåˆ†æ”¯</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">// ç¤ºä¾‹: git push è¿œç¨‹ä¸»æœºå:[è¿œç¨‹åˆ†æ”¯å]
git push origin master:master
</code></pre><ul>
<li>æ‹‰å–è¿œç¨‹æŸä¸ªåˆ†æ”¯åˆ°æœ¬åœ°æŸä¸ªåˆ†æ”¯</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">// ç¤ºä¾‹: git pull è¿œç¨‹ä¸»æœºå:[æœ¬åœ°åˆ†æ”¯å]
git pull origin master:master
</code></pre><ul>
<li>å‚¨è—å½“å‰å·¥ä½œçŠ¶æ€ï¼ˆå¯å¤šæ¬¡ï¼‰æ–°å»ºçš„æ–‡ä»¶é¡»å…ˆ<code>add</code>å†<code>stash</code></li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git stash  //ç®€å†™
git stash save &#34;message&#34; //å¤‡æ³¨
</code></pre><ul>
<li>æŸ¥çœ‹å½“å‰å‚¨è—</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git stash list 
</code></pre><ul>
<li>æ¢å¤æŸä¸€å‚¨è—ç‰ˆæœ¬</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">// ç¤ºä¾‹: git stash apply stash@{0}
 git stash apply [stash@{0}]
</code></pre><ul>
<li>åˆ é™¤æŸä¸€å‚¨è—ç‰ˆæœ¬</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">// ç¤ºä¾‹: git stash drop stash@{0}
git stash drop [stash@{0}] 
</code></pre><ul>
<li>æ¢å¤æœ€æ–°çš„å‚¨è—ï¼Œå¹¶æŠŠæœ€æ–°çš„å‚¨è—åˆ æ‰</li>
</ul>
<pre tabindex="0"><code class="language-git" data-lang="git">git stash pop
</code></pre><p>å¾…ç»­ . . .</p>
]]></content>
		</item>
		
		<item>
			<title>Laravelä¹‹å¼‚å¸¸å¤„ç†ï¼ˆExceptionï¼‰</title>
			<link>https://blog.gookm.cn/posts/2018/20180703-laravel-exception/</link>
			<pubDate>Tue, 03 Jul 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180703-laravel-exception/</guid>
			<description>å½“ä½ å¯åŠ¨ä¸€ä¸ªæ–°çš„ Laravel é¡¹ç›®æ—¶ï¼Œé”™è¯¯åŠå¼‚å¸¸å¤„ç†æ˜¯å·²ä¸ºä½ é…ç½®å¥½äº†çš„ã€‚App\Exceptions\Handler ç±»è´Ÿè´£è®°å½•åº”ç”¨ç¨‹åºè§¦å‘çš„æ‰€æœ‰å¼‚å¸¸å¹¶å‘ˆç°ç»™ç”¨æˆ·ã€‚åœ¨æœ¬æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨è¿™ä¸ªç±»ã€‚
åˆ›å»ºå¼‚å¸¸å¤„ç†ç±»ï¼š php artisan make:exception InvalidRequestException ç¼–å†™ä»£ç  ç¼–å†™ app/Exceptions/InvalidRequestException.php æ–‡ä»¶ &amp;lt;?php namespace App\Exceptions; use Exception; use Illuminate\Http\Request; class InvalidRequestException extends Exception { public function __construct(string $message = &amp;#34;&amp;#34;, int $code = 400) { parent::__construct($message, $code); } public function render(Request $request) { if ($request-&amp;gt;expectsJson()) { // json() æ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ Http è¿”å›ç  return response()-&amp;gt;json([&amp;#39;msg&amp;#39; =&amp;gt; $this-&amp;gt;message], $this-&amp;gt;code); } return view(&amp;#39;pages.error&amp;#39;, [&amp;#39;msg&amp;#39; =&amp;gt; $this-&amp;gt;message]); } } Laravel 5.5 ä¹‹åæ”¯æŒåœ¨å¼‚å¸¸ç±»ä¸­å®šä¹‰ render() æ–¹æ³•ï¼Œè¯¥å¼‚å¸¸è¢«è§¦å‘æ—¶ç³»ç»Ÿä¼šè°ƒç”¨ render() æ–¹æ³•æ¥è¾“å‡ºï¼Œæˆ‘ä»¬åœ¨ render() é‡Œåˆ¤æ–­å¦‚æœæ˜¯ AJAX è¯·æ±‚åˆ™è¿”å› JSON æ ¼å¼çš„æ•°æ®ï¼Œå¦åˆ™å°±è¿”å›ä¸€ä¸ªé”™è¯¯é¡µé¢ã€‚ åˆ›å»ºè¿™ä¸ªé”™è¯¯é¡µé¢ åˆ›å»ºæ–‡ä»¶touch resources/views/pages/error.</description>
			<content type="html"><![CDATA[<blockquote>
<p>å½“ä½ å¯åŠ¨ä¸€ä¸ªæ–°çš„ Laravel é¡¹ç›®æ—¶ï¼Œé”™è¯¯åŠå¼‚å¸¸å¤„ç†æ˜¯å·²ä¸ºä½ é…ç½®å¥½äº†çš„ã€‚App\Exceptions\Handler ç±»è´Ÿè´£è®°å½•åº”ç”¨ç¨‹åºè§¦å‘çš„æ‰€æœ‰å¼‚å¸¸å¹¶å‘ˆç°ç»™ç”¨æˆ·ã€‚åœ¨æœ¬æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨è¿™ä¸ªç±»ã€‚</p>
</blockquote>
<h3 id="åˆ›å»ºå¼‚å¸¸å¤„ç†ç±»">åˆ›å»ºå¼‚å¸¸å¤„ç†ç±»ï¼š</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:exception InvalidRequestException
</span></span></code></pre></div><h3 id="ç¼–å†™ä»£ç ">ç¼–å†™ä»£ç </h3>
<ul>
<li>ç¼–å†™ <code>app/Exceptions/InvalidRequestException.php</code> æ–‡ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Exception</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">InvalidRequestException</span> <span class="k">extends</span> <span class="nx">Exception</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$message</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$code</span> <span class="o">=</span> <span class="mi">400</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$code</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">expectsJson</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// json() æ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ Http è¿”å›ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;msg&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;pages.error&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;msg&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>Laravel 5.5 ä¹‹åæ”¯æŒåœ¨å¼‚å¸¸ç±»ä¸­å®šä¹‰ render() æ–¹æ³•ï¼Œè¯¥å¼‚å¸¸è¢«è§¦å‘æ—¶ç³»ç»Ÿä¼šè°ƒç”¨ render() æ–¹æ³•æ¥è¾“å‡ºï¼Œæˆ‘ä»¬åœ¨ render() é‡Œåˆ¤æ–­å¦‚æœæ˜¯ AJAX è¯·æ±‚åˆ™è¿”å› JSON æ ¼å¼çš„æ•°æ®ï¼Œå¦åˆ™å°±è¿”å›ä¸€ä¸ªé”™è¯¯é¡µé¢ã€‚</li>
</ul>
<h3 id="åˆ›å»ºè¿™ä¸ªé”™è¯¯é¡µé¢">åˆ›å»ºè¿™ä¸ªé”™è¯¯é¡µé¢</h3>
<ul>
<li>åˆ›å»ºæ–‡ä»¶<code>touch resources/views/pages/error.blade.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-default&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>é”™è¯¯<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body text-center&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ $msg }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-primary&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ route(&#39;root&#39;) }}&#34;</span><span class="p">&gt;</span>è¿”å›é¦–é¡µ<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="å±è”½å¼‚å¸¸ä¿¡æ¯å†™å…¥æ—¥å¿—">å±è”½å¼‚å¸¸ä¿¡æ¯å†™å…¥æ—¥å¿—</h3>
<ul>
<li>å½“å¼‚å¸¸è§¦å‘æ—¶ Laravel é»˜è®¤ä¼šæŠŠå¼‚å¸¸çš„ä¿¡æ¯å’Œè°ƒç”¨æ ˆæ‰“å°åˆ°æ—¥å¿—é‡Œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©å±è”½æ­¤ç±»å¼‚å¸¸ä¿¡æ¯å†™å…¥æ—¥å¿—</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">app</span><span class="o">/</span><span class="nx">Exceptions</span><span class="o">/</span><span class="nx">Handler</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$dontReport</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="nx">InvalidRequestException</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div><h3 id="ä¸€èˆ¬è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ªç³»ç»Ÿå¼‚å¸¸">ä¸€èˆ¬è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ªç³»ç»Ÿå¼‚å¸¸</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:exception InternalException
</span></span></code></pre></div><h3 id="ç³»ç»Ÿå¼‚å¸¸">ç³»ç»Ÿå¼‚å¸¸</h3>
<ul>
<li>æ•æ‰ç³»ç»Ÿå¼‚å¸¸ <code>app/Exceptions/InternalException.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Exceptions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Exception</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">InternalException</span> <span class="k">extends</span> <span class="nx">Exception</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$msgForUser</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$message</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$msgForUser</span> <span class="o">=</span> <span class="s1">&#39;ç³»ç»Ÿå†…éƒ¨é”™è¯¯&#39;</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$code</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$code</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">msgForUser</span> <span class="o">=</span> <span class="nv">$msgForUser</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">expectsJson</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;msg&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">msgForUser</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;pages.error&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;msg&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">msgForUser</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>ç³»ç»Ÿå¼‚å¸¸å°±è®©å®ƒå†™å…¥æ—¥å¿—</li>
</ul>
<h3 id="ç”¨æ³•">ç”¨æ³•</h3>
<ul>
<li>å¦‚ <code>InvalidRequestException</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$email</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$token</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidRequestException</span><span class="p">(</span><span class="s1">&#39;éªŒè¯é“¾æ¥ä¸æ­£ç¡®&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>æ¨¡å‹æ–‡ä»¶ä¸­è®¿é—®å™¨&amp;ä¿®æ”¹å™¨çš„ç”¨æ³•ğŸº</title>
			<link>https://blog.gookm.cn/posts/2018/20180623-laravel-attr/</link>
			<pubDate>Sat, 23 Jun 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180623-laravel-attr/</guid>
			<description>å½“ä½ åœ¨ Eloquent æ¨¡å‹å®ä¾‹ä¸­è·å–æˆ–è®¾ç½®æŸäº›å±æ€§å€¼çš„æ—¶å€™ï¼Œè®¿é—®å™¨å’Œä¿®æ”¹å™¨å…è®¸ä½ å¯¹ Eloquent å±æ€§å€¼è¿›è¡Œæ ¼å¼åŒ–ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦ä½¿ç”¨ Laravel åŠ å¯†å™¨ æ¥åŠ å¯†ä¸€ä¸ªå³å°†è¢«ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„å€¼ï¼Œè€Œä» Eloquent æ¨¡å‹è®¿é—®è¯¥å±æ€§æ—¶è‡ªåŠ¨è§£å¯†å…¶å€¼
è®¿é—®å™¨ è®¿é—®å™¨ï¼šè‹¥è¦å®šä¹‰ä¸€ä¸ªè®¿é—®å™¨ï¼Œåˆ™é¡»åœ¨ä½ çš„æ¨¡å‹ä¸Šåˆ›å»ºä¸€ä¸ª getFooAttribute æ–¹æ³•ã€‚è¦è®¿é—®çš„ Foo å­—æ®µéœ€ä½¿ç”¨ã€Œé©¼å³°å¼ã€æ¥å‘½åã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¸º first_name å±æ€§å®šä¹‰ä¸€ä¸ªè®¿é—®å™¨ã€‚å½“ Eloquent å°è¯•è·å– first_name çš„å€¼æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨è°ƒç”¨æ­¤è®¿é—®å™¨ï¼š
1ã€åœ¨æ¨¡å‹æ–‡ä»¶ä¸­ app/Models/UserAddress.php
public function getFullAddressAttribute() { return &amp;#34;{$this-&amp;gt;province}{$this-&amp;gt;city}{$this-&amp;gt;district}{$this-&amp;gt;address}&amp;#34;; } 2ã€public function getFullAddressAttribute() åˆ›å»ºäº†ä¸€ä¸ªè®¿é—®å™¨ï¼Œåœ¨ä¹‹åçš„ä»£ç é‡Œå¯ä»¥ç›´æ¥é€šè¿‡ $address-&amp;gt;full_address æ¥è·å–å®Œæ•´çš„åœ°å€ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½å»æ‹¼æ¥
ä¿®æ”¹å™¨ ä¿®æ”¹å™¨ï¼šè‹¥è¦å®šä¹‰ä¸€ä¸ªä¿®æ”¹å™¨ï¼Œåˆ™é¡»åœ¨æ¨¡å‹ä¸Šå®šä¹‰ä¸€ä¸ª setFooAttribute æ–¹æ³•ã€‚è¦è®¿é—®çš„ Foo å­—æ®µéœ€ä½¿ç”¨ã€Œé©¼å³°å¼ã€å‘½åã€‚è®©æˆ‘ä»¬å†æ¥å®šä¹‰ä¸€ä¸ª first_name å±æ€§çš„ä¿®æ”¹å™¨ã€‚å½“æˆ‘ä»¬å°è¯•åœ¨æ¨¡å‹ä¸Šè®¾ç½® first_name çš„å€¼æ—¶ï¼Œè¯¥ä¿®æ”¹å™¨å°†è¢«è‡ªåŠ¨è°ƒç”¨ï¼š
1ã€åœ¨æ¨¡å‹æ–‡ä»¶ä¸­ app/Models/UserAddress.php
public function setFirstNameAttribute($value) { $this-&amp;gt;attributes[&amp;#39;first_name&amp;#39;] = strtolower($value); } 2ã€public function setFirstNameAttribute() åˆ›å»ºäº†ä¸€ä¸ªä¿®æ”¹å™¨ï¼Œåœ¨ä¹‹åçš„ä»£ç é‡Œå¯ä»¥ç›´æ¥é€šè¿‡ $user-&amp;gt;first_name æ¥è·å–é¦–å­—æ¯å°å†™çš„åå­—ã€‚</description>
			<content type="html"><![CDATA[<blockquote>
<p>å½“ä½ åœ¨ Eloquent æ¨¡å‹å®ä¾‹ä¸­è·å–æˆ–è®¾ç½®æŸäº›å±æ€§å€¼çš„æ—¶å€™ï¼Œè®¿é—®å™¨å’Œä¿®æ”¹å™¨å…è®¸ä½ å¯¹ Eloquent å±æ€§å€¼è¿›è¡Œæ ¼å¼åŒ–ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦ä½¿ç”¨ Laravel åŠ å¯†å™¨ æ¥åŠ å¯†ä¸€ä¸ªå³å°†è¢«ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„å€¼ï¼Œè€Œä» Eloquent æ¨¡å‹è®¿é—®è¯¥å±æ€§æ—¶è‡ªåŠ¨è§£å¯†å…¶å€¼</p>
</blockquote>
<h3 id="è®¿é—®å™¨">è®¿é—®å™¨</h3>
<blockquote>
<p>è®¿é—®å™¨ï¼šè‹¥è¦å®šä¹‰ä¸€ä¸ªè®¿é—®å™¨ï¼Œåˆ™é¡»åœ¨ä½ çš„æ¨¡å‹ä¸Šåˆ›å»ºä¸€ä¸ª getFooAttribute æ–¹æ³•ã€‚è¦è®¿é—®çš„ Foo å­—æ®µéœ€ä½¿ç”¨ã€Œé©¼å³°å¼ã€æ¥å‘½åã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¸º first_name å±æ€§å®šä¹‰ä¸€ä¸ªè®¿é—®å™¨ã€‚å½“ Eloquent å°è¯•è·å– first_name çš„å€¼æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨è°ƒç”¨æ­¤è®¿é—®å™¨ï¼š</p>
</blockquote>
<p>1ã€åœ¨æ¨¡å‹æ–‡ä»¶ä¸­ <code>app/Models/UserAddress.php</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">getFullAddressAttribute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">province</span><span class="si">}{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">city</span><span class="si">}{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">district</span><span class="si">}{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">address</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></div><p>2ã€<code>public function getFullAddressAttribute()</code> åˆ›å»ºäº†ä¸€ä¸ªè®¿é—®å™¨ï¼Œåœ¨ä¹‹åçš„ä»£ç é‡Œå¯ä»¥ç›´æ¥é€šè¿‡ <code>$address-&gt;full_address</code> æ¥è·å–å®Œæ•´çš„åœ°å€ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½å»æ‹¼æ¥</p>
<h3 id="ä¿®æ”¹å™¨">ä¿®æ”¹å™¨</h3>
<blockquote>
<p>ä¿®æ”¹å™¨ï¼šè‹¥è¦å®šä¹‰ä¸€ä¸ªä¿®æ”¹å™¨ï¼Œåˆ™é¡»åœ¨æ¨¡å‹ä¸Šå®šä¹‰ä¸€ä¸ª setFooAttribute æ–¹æ³•ã€‚è¦è®¿é—®çš„ Foo å­—æ®µéœ€ä½¿ç”¨ã€Œé©¼å³°å¼ã€å‘½åã€‚è®©æˆ‘ä»¬å†æ¥å®šä¹‰ä¸€ä¸ª first_name å±æ€§çš„ä¿®æ”¹å™¨ã€‚å½“æˆ‘ä»¬å°è¯•åœ¨æ¨¡å‹ä¸Šè®¾ç½® first_name çš„å€¼æ—¶ï¼Œè¯¥ä¿®æ”¹å™¨å°†è¢«è‡ªåŠ¨è°ƒç”¨ï¼š</p>
</blockquote>
<p>1ã€åœ¨æ¨¡å‹æ–‡ä»¶ä¸­ <code>app/Models/UserAddress.php</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">setFirstNameAttribute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>2ã€<code>public function setFirstNameAttribute()</code> åˆ›å»ºäº†ä¸€ä¸ªä¿®æ”¹å™¨ï¼Œåœ¨ä¹‹åçš„ä»£ç é‡Œå¯ä»¥ç›´æ¥é€šè¿‡ <code>$user-&gt;first_name</code> æ¥è·å–é¦–å­—æ¯å°å†™çš„åå­—ã€‚</p>
]]></content>
		</item>
		
		<item>
			<title>Laravelä¹‹ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰ğŸŒ¼</title>
			<link>https://blog.gookm.cn/posts/2018/20180614-laravel-middlleware02/</link>
			<pubDate>Thu, 14 Jun 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180614-laravel-middlleware02/</guid>
			<description> å¸Œæœ›ç”¨æˆ·åœ¨éªŒè¯é‚®ç®±ä¹‹åæ‰èƒ½æ­£å¸¸ä½¿ç”¨ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œå½“ç”¨æˆ·å°šæœªéªŒè¯é‚®ç®±æ—¶ï¼Œè®¿é—®å…¶ä»–é¡µé¢éƒ½ä¼šè¢«é‡å®šå‘åˆ°ä¸€ä¸ªæç¤ºéªŒè¯é‚®ç®±çš„é¡µé¢ã€‚å¯¹äºè¿™ç§éœ€æ±‚å¯ä»¥é€šè¿‡ä¸­é—´ä»¶æ¥è§£å†³ï¼ŒæŠŠéœ€è¦éªŒè¯é‚®ç®±çš„è·¯ç”±æ”¾åˆ°æ‹¥æœ‰è¿™ä¸ªä¸­é—´ä»¶çš„è·¯ç”±ç»„ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®è¿™äº›è·¯ç”±æ—¶ä¼šå…ˆæ‰§è¡Œä¸­é—´ä»¶æ£€æŸ¥æ˜¯å¦éªŒè¯äº†é‚®ç®±ã€‚
åˆ›å»ºä¸­é—´ä»¶ é€šè¿‡ make:middleware å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶ php artisan make:middleware CheckIfEmailVerified ç¼–å†™ä»£ç  app/Http/Middleware/CheckIfEmailVerified.php public function handle($request, Closure $next) { if (!$request-&amp;gt;user()-&amp;gt;email_verified) { // å¦‚æœæ˜¯ AJAX è¯·æ±‚ï¼Œåˆ™é€šè¿‡ JSON è¿”å› if ($request-&amp;gt;expectsJson()) { return response()-&amp;gt;json([&amp;#39;msg&amp;#39; =&amp;gt; &amp;#39;è¯·å…ˆéªŒè¯é‚®ç®±&amp;#39;], 400); } return redirect(route(&amp;#39;email_verify_notice&amp;#39;)); } return $next($request); } å½“ä¸­é—´ä»¶è¢«æ‰§è¡Œæ—¶ï¼ŒLaravel ä¼šè°ƒç”¨ä¸­é—´ä»¶çš„ handle æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½“å‰è¯·æ±‚å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„é—­åŒ…å‡½æ•°ã€‚$next($request) ä»£è¡¨æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚
æ³¨å†Œä¸­é—´ä»¶ æœ€åå†åœ¨ Kernel ä¸­æ³¨å†Œæˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ä¸­é—´ä»¶ app/Http/Kernel.php protected $routeMiddleware = [ &amp;#39;email_verified&amp;#39; =&amp;gt; \App\Http\Middleware\CheckIfEmailVerified::class, ]; æµ‹è¯• Route::group([&amp;#39;middleware&amp;#39; =&amp;gt; &amp;#39;auth&amp;#39;], function() { Route::group([&amp;#39;middleware&amp;#39; =&amp;gt; &amp;#39;email_verified&amp;#39;], function() { Route::get(&amp;#39;/test&amp;#39;, function() { return &amp;#39;Your email is verified&amp;#39;; }); }); }); </description>
			<content type="html"><![CDATA[<blockquote>
<p>å¸Œæœ›ç”¨æˆ·åœ¨éªŒè¯é‚®ç®±ä¹‹åæ‰èƒ½æ­£å¸¸ä½¿ç”¨ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œå½“ç”¨æˆ·å°šæœªéªŒè¯é‚®ç®±æ—¶ï¼Œè®¿é—®å…¶ä»–é¡µé¢éƒ½ä¼šè¢«é‡å®šå‘åˆ°ä¸€ä¸ªæç¤ºéªŒè¯é‚®ç®±çš„é¡µé¢ã€‚å¯¹äºè¿™ç§éœ€æ±‚å¯ä»¥é€šè¿‡ä¸­é—´ä»¶æ¥è§£å†³ï¼ŒæŠŠéœ€è¦éªŒè¯é‚®ç®±çš„è·¯ç”±æ”¾åˆ°æ‹¥æœ‰è¿™ä¸ªä¸­é—´ä»¶çš„è·¯ç”±ç»„ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®è¿™äº›è·¯ç”±æ—¶ä¼šå…ˆæ‰§è¡Œä¸­é—´ä»¶æ£€æŸ¥æ˜¯å¦éªŒè¯äº†é‚®ç®±ã€‚</p>
</blockquote>
<h3 id="åˆ›å»ºä¸­é—´ä»¶">åˆ›å»ºä¸­é—´ä»¶</h3>
<ul>
<li>é€šè¿‡ <code>make:middleware</code> å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:middleware CheckIfEmailVerified
</span></span></code></pre></div><h3 id="ç¼–å†™ä»£ç ">ç¼–å†™ä»£ç </h3>
<ul>
<li><code>app/Http/Middleware/CheckIfEmailVerified.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">email_verified</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å¦‚æœæ˜¯ AJAX è¯·æ±‚ï¼Œåˆ™é€šè¿‡ JSON è¿”å›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">expectsJson</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;msg&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;è¯·å…ˆéªŒè¯é‚®ç®±&#39;</span><span class="p">],</span> <span class="mi">400</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;email_verify_notice&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å½“ä¸­é—´ä»¶è¢«æ‰§è¡Œæ—¶ï¼ŒLaravel ä¼šè°ƒç”¨ä¸­é—´ä»¶çš„ handle æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½“å‰è¯·æ±‚å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„é—­åŒ…å‡½æ•°ã€‚$next($request) ä»£è¡¨æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</p>
<h3 id="æ³¨å†Œä¸­é—´ä»¶">æ³¨å†Œä¸­é—´ä»¶</h3>
<ul>
<li>æœ€åå†åœ¨ <code>Kernel</code> ä¸­æ³¨å†Œæˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ä¸­é—´ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">app</span><span class="o">/</span><span class="nx">Http</span><span class="o">/</span><span class="nx">Kernel</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;email_verified&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\CheckIfEmailVerified</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div><h3 id="æµ‹è¯•">æµ‹è¯•</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;middleware&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;auth&#39;</span><span class="p">],</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;middleware&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;email_verified&#39;</span><span class="p">],</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s1">&#39;Your email is verified&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"> <span class="p">});</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>ç¬¬ä¸‰æ–¹ç™»å½•ä¹‹Github</title>
			<link>https://blog.gookm.cn/posts/2018/20180519-socialite-github/</link>
			<pubDate>Sat, 19 May 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180519-socialite-github/</guid>
			<description>å¯¼è¯­ æ‰€è°“çš„ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œå°±æ˜¯åˆ©ç”¨ç”¨æˆ·åœ¨ç¬¬ä¸‰æ–¹å¹³å°ä¸Šå·²æœ‰çš„è´¦å·æ¥å¿«é€Ÿå®Œæˆè‡ªå·±åº”ç”¨çš„ç™»å½•æˆ–è€…æ³¨å†Œçš„åŠŸèƒ½ï¼Œå¸¸ç”¨çš„åè®®ä¸º OAuth 2.0ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ª APPï¼Œéƒ½ä¼šé›†æˆå¾®ä¿¡ï¼Œå¾®åšç­‰ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿçš„ç™»å½•å¹¶å¼€å§‹ä½¿ç”¨ã€‚
å…³äº OAuth 2.0 åè®®ï¼Œå¯ä»¥å…ˆå‚è€ƒé˜®ä¸€å³°çš„ ç†è§£OAuth 2.0 äº†è§£ä¸€ä¸‹ OAuth 2.0 çš„æ¦‚å¿µã€‚OAuth 2.0 çš„æˆæƒæ¨¡å¼ä¸€å…±æœ‰4ç§ï¼Œå¸¸ç”¨çš„æ¨¡å¼ä¸º æˆæƒç æ¨¡å¼ã€‚
ç®€å•çš„è§£é‡Šä¸€ä¸‹æµç¨‹ğŸ‘‡
1. å®¢æˆ·ç«¯ï¼ˆapp/æµè§ˆå™¨ï¼‰å°†ç”¨æˆ·å¯¼å‘ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡å™¨ 2. ç”¨æˆ·åœ¨ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡å™¨ï¼Œé€‰æ‹©æ˜¯å¦ç»™äºˆå®¢æˆ·ç«¯æˆæƒ 3. ç”¨æˆ·åŒæ„æˆæƒåï¼Œè®¤è¯æœåŠ¡å™¨å°†ç”¨æˆ·å¯¼å‘å®¢æˆ·ç«¯äº‹å…ˆæŒ‡å®šçš„ é‡å®šå‘URIï¼ŒåŒæ—¶é™„ä¸Šä¸€ä¸ªæˆæƒç ã€‚ 4. å®¢æˆ·ç«¯å°†æˆæƒç å‘é€è‡³æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é€šè¿‡æˆæƒç ä»¥åŠ APP_SECRET å‘ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ç”³è¯· access_token 5. æœåŠ¡å™¨é€šè¿‡ access_tokenï¼Œå‘ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ç”³è¯·ç”¨æˆ·æ•°æ®ï¼Œå®Œæˆç™»å½•æµç¨‹ ä»¥ä¸Šæ˜¯ä¸€ä¸ªåŸºæœ¬æµç¨‹ï¼Œæ— è®ºæ˜¯ç½‘é¡µåº”ç”¨ï¼Œè¿˜æ˜¯æ‰‹æœºåº”ç”¨ï¼Œæµç¨‹éƒ½åŸºæœ¬ç›¸åŒã€‚
é…ç½® ä½¿ç”¨ overtrue/laravel-socialite æ¥å®ç° Github ç™»å½•ï¼Œæ”¯æŒå›½å†…åº”ç”¨çš„ Laravel æ‰©å±•åŒ…ï¼Œæ¯”å¦‚å¾®ä¿¡ã€QQã€å¾®åšç­‰ã€‚å½“ç„¶ï¼Œä½ ç”¨laravel/socialiteåŒ…ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡å¯¹QQï¼Œå¾®åšç­‰å›½å†…çš„å°±ä¸æ”¯æŒäº†ã€‚
1ã€å®‰è£…Laravelæ‰©å±•åŒ…
composer require &amp;#34;overtrue/laravel-socialite:~2.0&amp;#34; 2ã€æ³¨å†ŒæœåŠ¡ (config/app.php)
&amp;#39;providers&amp;#39; =&amp;gt; [ // Other service providers... Overtrue\LaravelSocialite\ServiceProvider::class, ], 3ã€æŠŠ Socialite facade åŠ å…¥åˆ° aliases æ•°ç»„ä¸­ config/app.php
&amp;#39;Socialite&amp;#39; =&amp;gt; Laravel\Socialite\Facades\Socialite::class, 4ã€æ·»åŠ ä¸Šåº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„ OAuth æœåŠ¡çš„å‡­è¯(config/services.</description>
			<content type="html"><![CDATA[<h3 id="å¯¼è¯­">å¯¼è¯­</h3>
<blockquote>
<p>æ‰€è°“çš„ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œå°±æ˜¯åˆ©ç”¨ç”¨æˆ·åœ¨ç¬¬ä¸‰æ–¹å¹³å°ä¸Šå·²æœ‰çš„è´¦å·æ¥å¿«é€Ÿå®Œæˆè‡ªå·±åº”ç”¨çš„ç™»å½•æˆ–è€…æ³¨å†Œçš„åŠŸèƒ½ï¼Œå¸¸ç”¨çš„åè®®ä¸º OAuth 2.0ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ª APPï¼Œéƒ½ä¼šé›†æˆå¾®ä¿¡ï¼Œå¾®åšç­‰ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿçš„ç™»å½•å¹¶å¼€å§‹ä½¿ç”¨ã€‚</p>
</blockquote>
<ul>
<li>
<p>å…³äº OAuth 2.0 åè®®ï¼Œå¯ä»¥å…ˆå‚è€ƒé˜®ä¸€å³°çš„ <a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">ç†è§£OAuth 2.0</a> äº†è§£ä¸€ä¸‹ OAuth 2.0 çš„æ¦‚å¿µã€‚OAuth 2.0 çš„æˆæƒæ¨¡å¼ä¸€å…±æœ‰4ç§ï¼Œå¸¸ç”¨çš„æ¨¡å¼ä¸º æˆæƒç æ¨¡å¼ã€‚</p>
</li>
<li>
<p>ç®€å•çš„è§£é‡Šä¸€ä¸‹æµç¨‹ğŸ‘‡</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1. å®¢æˆ·ç«¯ï¼ˆapp/æµè§ˆå™¨ï¼‰å°†ç”¨æˆ·å¯¼å‘ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡å™¨
</span></span><span class="line"><span class="cl">2. ç”¨æˆ·åœ¨ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡å™¨ï¼Œé€‰æ‹©æ˜¯å¦ç»™äºˆå®¢æˆ·ç«¯æˆæƒ
</span></span><span class="line"><span class="cl">3. ç”¨æˆ·åŒæ„æˆæƒåï¼Œè®¤è¯æœåŠ¡å™¨å°†ç”¨æˆ·å¯¼å‘å®¢æˆ·ç«¯äº‹å…ˆæŒ‡å®šçš„ é‡å®šå‘URIï¼ŒåŒæ—¶é™„ä¸Šä¸€ä¸ªæˆæƒç ã€‚
</span></span><span class="line"><span class="cl">4. å®¢æˆ·ç«¯å°†æˆæƒç å‘é€è‡³æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é€šè¿‡æˆæƒç ä»¥åŠ APP_SECRET å‘ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ç”³è¯· access_token
</span></span><span class="line"><span class="cl">5. æœåŠ¡å™¨é€šè¿‡ access_tokenï¼Œå‘ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ç”³è¯·ç”¨æˆ·æ•°æ®ï¼Œå®Œæˆç™»å½•æµç¨‹
</span></span></code></pre></div><p>ä»¥ä¸Šæ˜¯ä¸€ä¸ªåŸºæœ¬æµç¨‹ï¼Œæ— è®ºæ˜¯ç½‘é¡µåº”ç”¨ï¼Œè¿˜æ˜¯æ‰‹æœºåº”ç”¨ï¼Œæµç¨‹éƒ½åŸºæœ¬ç›¸åŒã€‚</p>
<h3 id="é…ç½®">é…ç½®</h3>
<p>ä½¿ç”¨ <code>overtrue/laravel-socialite</code> æ¥å®ç° Github ç™»å½•ï¼Œæ”¯æŒå›½å†…åº”ç”¨çš„ Laravel æ‰©å±•åŒ…ï¼Œæ¯”å¦‚å¾®ä¿¡ã€QQã€å¾®åšç­‰ã€‚å½“ç„¶ï¼Œä½ ç”¨laravel/socialiteåŒ…ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡å¯¹QQï¼Œå¾®åšç­‰å›½å†…çš„å°±ä¸æ”¯æŒäº†ã€‚</p>
<p>1ã€å®‰è£…Laravelæ‰©å±•åŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require <span class="s2">&#34;overtrue/laravel-socialite:~2.0&#34;</span>
</span></span></code></pre></div><p>2ã€æ³¨å†ŒæœåŠ¡ (<code>config/app.php</code>)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Other service providers...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Overtrue\LaravelSocialite\ServiceProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><p>3ã€æŠŠ <code>Socialite facade</code> åŠ å…¥åˆ° <code>aliases</code> æ•°ç»„ä¸­ <code>config/app.php</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;Socialite&#39;</span> <span class="o">=&gt;</span> <span class="nx">Laravel\Socialite\Facades\Socialite</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span></code></pre></div><p>4ã€æ·»åŠ ä¸Šåº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„ OAuth æœåŠ¡çš„å‡­è¯(<code>config/services.php</code>)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;github&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;d53ab19b1c64d0f7****&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;client_secret&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;3d90bf64d4fa2aa4*****ecc67646651cec32491&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;redirect&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://test.test/login/github/callback&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><p>5ã€Githubç”³è¯·åº”ç”¨</p>
<p>ç‚¹å‡»<a href="https://github.com/settings/applications/new">é“¾æ¥</a>åˆ°ç”³è¯·é¡µé¢ï¼š</p>
<table>
<thead>
<tr>
<th>Column 1</th>
<th>Column 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>Application name</td>
<td>test</td>
</tr>
<tr>
<td>Homepage URL</td>
<td><a href="http://test.test/">http://test.test/</a></td>
</tr>
<tr>
<td>Application description</td>
<td>æµ‹è¯•GitHubç™»å½•</td>
</tr>
<tr>
<td>Authorization callback URL</td>
<td><a href="http://test.test/login/github/callback">http://test.test/login/github/callback</a> ï¼ˆæ³¨æ„ï¼‰</td>
</tr>
</tbody>
</table>
<p>ç”³è¯·åä¼šæ‹¿åˆ°<code>Client ID</code>å’Œ<code>Client Secret</code>ã€‚</p>
<h3 id="å®ç°githubç™»å½•">å®ç°GitHubç™»å½•</h3>
<p>1ã€éœ€è¦ä¸¤ä¸ªè·¯ç”±ï¼šä¸€ä¸ªé‡å®šå‘ç”¨æˆ·åˆ° Github æˆæƒï¼Œå¦ä¸€ä¸ªåœ¨ Github éªŒè¯ä¹‹åæ¥æ”¶å›è°ƒ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//ç¬¬ä¸‰æ–¹ç™»å½•æµ‹è¯•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;login/github&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\LoginController@redirectToProvider&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;githubLogin&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;login/github/callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\LoginController@handleProviderCallback&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>2ã€æ¥ä¸‹æ¥ç»™ <code>LoginControlle</code>r æ§åˆ¶æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œ<code>redirectToProvider</code> æ–¹æ³•é‡å®šå‘åˆ° Github æˆæƒé¡µé¢ï¼Œ<code>handleProviderCallback</code>æ–¹æ³•åœ¨ Github éªŒè¯ä¹‹åæ¥æ”¶å›è°ƒ(<code>Auth\LoginControllrt.php</code>)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//é‡å®šå‘åˆ° Github æˆæƒé¡µé¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">redirectToProvider</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">Socialite</span><span class="o">::</span><span class="na">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">// åœ¨ Github éªŒè¯ä¹‹åæ¥æ”¶å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">protected</span> <span class="nv">$github_user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">handleProviderCallback</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$github_user</span> <span class="o">=</span> <span class="nx">Socialite</span><span class="o">::</span><span class="na">driver</span><span class="p">(</span><span class="s1">&#39;github&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user</span><span class="o">=</span><span class="nx">User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;github_name&#39;</span><span class="p">,</span><span class="nv">$github_user</span><span class="o">-&gt;</span><span class="na">nickname</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$user</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$user</span><span class="o">=</span><span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;name&#39;</span><span class="o">=&gt;</span><span class="nv">$github_user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;email&#39;</span><span class="o">=&gt;</span><span class="nv">$github_user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;github_name&#39;</span><span class="o">=&gt;</span><span class="nv">$github_user</span><span class="o">-&gt;</span><span class="na">nickname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;avatar&#39;</span><span class="o">=&gt;</span><span class="nv">$github_user</span><span class="o">-&gt;</span><span class="na">avatar</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;verified&#39;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">\Auth</span><span class="o">::</span><span class="na">login</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">Redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">guest</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="ç»“æŸè¯­">ç»“æŸè¯­</h3>
<blockquote>
<p>å³ä½¿ç”Ÿæ´»æ˜¯ä¸€ç‰‡æ²™æ¼ ğŸœï¼Œä¹Ÿè¦åœ¨æ²™æ¼ ä¸­å¼€å‡ºèŠ±æœµğŸŒ¼ã€‚</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>Laravelçš„APIåˆå§‹æ­å»ºä¹‹JWT</title>
			<link>https://blog.gookm.cn/posts/2018/20180505-api-jwt/</link>
			<pubDate>Sat, 05 May 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180505-api-jwt/</guid>
			<description>å†™æ¥å£å¥½å†™ï¼Œä½†éº»çƒ¦çš„æ˜¯èµ·æ­¥ï¼Œéœ€è¦åšä¸€äº›å®‰å…¨çš„æªæ–½ï¼Œä¸‹é¢å°±è®°å½•ä¸€ä¸‹Laravelçš„åˆå§‹APIæ­å»ºæ­¥éª¤ï¼ï¼ï¼
å®‰è£…laravelï¼ˆ5.5ï¼‰ å¯¹äº LTS ç‰ˆæœ¬ï¼Œä¾‹å¦‚ Laravel 5.1ï¼Œæä¾›ä¸¤å¹´çš„é”™è¯¯ä¿®å¤å’Œä¸‰å¹´çš„å®‰å…¨ä¿®å¤ã€‚è¿™äº›ç‰ˆæœ¬æä¾›æœ€é•¿æ—¶é—´çš„æ”¯æŒå’Œç»´æŠ¤ã€‚å¯¹äºä¸€èˆ¬ç‰ˆæœ¬ï¼Œåˆ™åªæ˜¯æä¾›å…­ä¸ªæœˆçš„é”™è¯¯ä¿®å¤å’Œä¸ºæœŸä¸€å¹´çš„å®‰å…¨ä¿®å¤ã€‚
composer create-project --prefer-dist laravel/laravel blog &amp;#34;5.5.*&amp;#34; å®‰è£…DingoAPIï¼ˆå‚è€ƒæ–‡æ¡£ï¼‰ dingo/api æ˜¯ä¸€ä¸ª Lumen å’Œ Laravel éƒ½å¯ç”¨çš„ RestFul å·¥å…·åŒ…ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„å¼€å§‹æ„å»º RestFul Apiã€‚æ›´å¤šçš„åŠŸèƒ½ï¼Œè¿˜éœ€è¦ä»”ç»†é˜…è¯» DingoApi çš„ æ–‡æ¡£ æ¥æ·±å…¥çš„å­¦ä¹ å’Œç†è§£ã€‚
Laravel 5.5 çš„é€‚é…ç‰ˆæœ¬ä¸ºdingo/api:v2.0.0-alpha2ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…è¿™ä¸ª tag composer require dingo/api:2.0.0-alpha2 ä¼šæŠ¥é”™ï¼šYou requirements could not be resolved to an installable set of packages åŸå› ï¼šdingo çš„æ–‡æ¡£ä¸­æœ‰è¯´æ˜ï¼Œç°åœ¨è¿™ä¸ªåŒ…è¿˜å¤„åœ¨å¼€å‘é˜¶æ®µï¼Œæ²¡æœ‰ä¸€ä¸ªç¨³å®šçš„ release ç‰ˆæœ¬ï¼Œ dingo/api ä¾èµ–çš„ dingo/blueprint ä¸ phpunit éƒ½ä¾èµ–äº† phpdocumentor/reflection-docblock ä½†æ˜¯ä¾èµ–çš„ç‰ˆæœ¬ä¸åŒï¼Œ å¯¼è‡´å‡ºç°äº†å†²çªã€‚ä½†æ˜¯æˆ‘ä»¬å‘ç° dingo/blueprint çš„å¼€å‘ç‰ˆæœ¬ dev-master è§£å†³äº†å†²çªï¼Œå¯ä»¥æ­£å¸¸å®‰è£…ï¼› è§£å†³ï¼šä¿®æ”¹ä¸€ä¸‹ composer.json &amp;#34;config&amp;#34;: { &amp;#34;preferred-install&amp;#34;: &amp;#34;dist&amp;#34;, &amp;#34;sort-packages&amp;#34;: true, &amp;#34;optimize-autoloader&amp;#34;: true }, &amp;#34;minimum-stability&amp;#34; : &amp;#34;dev&amp;#34;, &amp;#34;prefer-stable&amp;#34; : true, minimum-stability&amp;#34; : &amp;#34;dev&amp;#34; #è®¾å®šçš„æœ€ä½ç¨³å®šæ€§çš„ç‰ˆæœ¬ä¸º dev ä¹Ÿå°±æ˜¯å¯ä»¥ä¾èµ–å¼€å‘ç‰ˆæœ¬çš„æ‰©å±•åŒ…ï¼› &amp;#34;prefer-stable&amp;#34; : true â€”â€” Composer ä¼˜å…ˆä½¿ç”¨æ›´ç¨³å®šçš„åŒ…ç‰ˆæœ¬ã€‚ dingo çš„é…ç½®æ–‡ä»¶ publish å‡ºæ¥ï¼š php artisan vendor:publish 4ã€åœ¨.</description>
			<content type="html"><![CDATA[<p><strong>å†™æ¥å£å¥½å†™ï¼Œä½†éº»çƒ¦çš„æ˜¯èµ·æ­¥ï¼Œéœ€è¦åšä¸€äº›å®‰å…¨çš„æªæ–½ï¼Œä¸‹é¢å°±è®°å½•ä¸€ä¸‹Laravelçš„åˆå§‹APIæ­å»ºæ­¥éª¤ï¼ï¼ï¼</strong></p>
<h3 id="å®‰è£…laravel55">å®‰è£…laravelï¼ˆ5.5ï¼‰</h3>
<p>å¯¹äº LTS ç‰ˆæœ¬ï¼Œä¾‹å¦‚ Laravel 5.1ï¼Œæä¾›ä¸¤å¹´çš„é”™è¯¯ä¿®å¤å’Œä¸‰å¹´çš„å®‰å…¨ä¿®å¤ã€‚è¿™äº›ç‰ˆæœ¬æä¾›æœ€é•¿æ—¶é—´çš„æ”¯æŒå’Œç»´æŠ¤ã€‚å¯¹äºä¸€èˆ¬ç‰ˆæœ¬ï¼Œåˆ™åªæ˜¯æä¾›å…­ä¸ªæœˆçš„é”™è¯¯ä¿®å¤å’Œä¸ºæœŸä¸€å¹´çš„å®‰å…¨ä¿®å¤ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer create-project --prefer-dist laravel/laravel blog <span class="s2">&#34;5.5.*&#34;</span>
</span></span></code></pre></div><h3 id="å®‰è£…dingoapiå‚è€ƒæ–‡æ¡£">å®‰è£…DingoAPIï¼ˆå‚è€ƒæ–‡æ¡£ï¼‰</h3>
<blockquote>
<p>dingo/api æ˜¯ä¸€ä¸ª Lumen å’Œ Laravel éƒ½å¯ç”¨çš„ RestFul å·¥å…·åŒ…ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„å¼€å§‹æ„å»º RestFul Apiã€‚æ›´å¤šçš„åŠŸèƒ½ï¼Œè¿˜éœ€è¦ä»”ç»†é˜…è¯» DingoApi çš„ æ–‡æ¡£ æ¥æ·±å…¥çš„å­¦ä¹ å’Œç†è§£ã€‚</p>
</blockquote>
<ul>
<li>Laravel 5.5 çš„é€‚é…ç‰ˆæœ¬ä¸ºdingo/api:v2.0.0-alpha2ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…è¿™ä¸ª tag</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require dingo/api:2.0.0-alpha2
</span></span></code></pre></div><ul>
<li>ä¼šæŠ¥é”™ï¼šYou requirements could not be resolved to an installable set of packages</li>
<li>åŸå› ï¼šdingo çš„æ–‡æ¡£ä¸­æœ‰è¯´æ˜ï¼Œç°åœ¨è¿™ä¸ªåŒ…è¿˜å¤„åœ¨å¼€å‘é˜¶æ®µï¼Œæ²¡æœ‰ä¸€ä¸ªç¨³å®šçš„ release ç‰ˆæœ¬ï¼Œ
dingo/api ä¾èµ–çš„ dingo/blueprint ä¸ phpunit éƒ½ä¾èµ–äº† phpdocumentor/reflection-docblock ä½†æ˜¯ä¾èµ–çš„ç‰ˆæœ¬ä¸åŒï¼Œ
å¯¼è‡´å‡ºç°äº†å†²çªã€‚ä½†æ˜¯æˆ‘ä»¬å‘ç° dingo/blueprint çš„å¼€å‘ç‰ˆæœ¬ dev-master è§£å†³äº†å†²çªï¼Œå¯ä»¥æ­£å¸¸å®‰è£…ï¼›</li>
<li>è§£å†³ï¼šä¿®æ”¹ä¸€ä¸‹ composer.json</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s2">&#34;config&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;preferred-install&#34;</span><span class="o">:</span> <span class="s2">&#34;dist&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sort-packages&#34;</span><span class="o">:</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;optimize-autoloader&#34;</span><span class="o">:</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;minimum-stability&#34;</span> <span class="o">:</span> <span class="s2">&#34;dev&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;prefer-stable&#34;</span> <span class="o">:</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nx">minimum</span><span class="o">-</span><span class="nx">stability</span><span class="s2">&#34; : &#34;</span><span class="nx">dev</span><span class="s2">&#34; #è®¾å®šçš„æœ€ä½ç¨³å®šæ€§çš„ç‰ˆæœ¬ä¸º dev ä¹Ÿå°±æ˜¯å¯ä»¥ä¾èµ–å¼€å‘ç‰ˆæœ¬çš„æ‰©å±•åŒ…ï¼›
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;</span><span class="nx">prefer</span><span class="o">-</span><span class="nx">stable</span><span class="s2">&#34; : true â€”â€” Composer ä¼˜å…ˆä½¿ç”¨æ›´ç¨³å®šçš„åŒ…ç‰ˆæœ¬ã€‚
</span></span></span></code></pre></div><ul>
<li>dingo çš„é…ç½®æ–‡ä»¶ publish å‡ºæ¥ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan vendor:publish
</span></span></code></pre></div><p>4ã€åœ¨.envä¸­å¢åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">API_STANDARDS_TREE=prs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">API_SUBTYPE=laraapi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">API_PREFIX=api</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">API_VERSION=v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">API_DEBUG=true</span><span class="w">
</span></span></span></code></pre></div><p>æ³¨é‡Šï¼š
prsï¼šæœªå¯¹å¤–å‘å¸ƒçš„ï¼Œæä¾›ç»™å…¬å¸ appï¼Œå•é¡µåº”ç”¨ï¼Œæ¡Œé¢åº”ç”¨ç­‰ï¼ˆx,vndï¼‰
API_SUBTYPE ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æˆ‘ä»¬é¡¹ç›®çš„ç®€ç§°ï¼Œæˆ‘ä»¬çš„é¡¹ç›®å«laraapi
Accept: application/&lt;API_STANDARDS_TREE&gt;.&lt;API_SUBTYPE&gt;.v1+jsonï¼ˆä½¿ç”¨ Accept å¤´æ¥æŒ‡å®šæˆ‘ä»¬éœ€è¦è®¿é—®çš„ API ç‰ˆï¼‰</p>
<h3 id="æµ‹è¯•">æµ‹è¯•</h3>
<ul>
<li>è·¯ç”±æ–‡ä»¶ï¼ˆapi.phpï¼‰ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$api</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;Dingo\Api\Routing\Router&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$api</span><span class="o">-&gt;</span><span class="na">version</span><span class="p">(</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$api</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$api</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;this is version v1&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><ul>
<li>åœ¨postmanä¸­è¯·æ±‚ä¼šè¿”å›this is version v1ï¼ˆé»˜è®¤v1ï¼‰
<a href="http://jwt.test/api/version">http://jwt.test/api/version</a></li>
</ul>
<h3 id="èŠ‚æµå¤„ç†é˜²æ­¢æ”»å‡»">èŠ‚æµå¤„ç†é˜²æ­¢æ”»å‡»</h3>
<ul>
<li><code>routes/api.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$api</span><span class="o">-&gt;</span><span class="na">version</span><span class="p">(</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;App\Http\Controllers\Api&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span> <span class="k">function</span><span class="p">(</span><span class="nv">$api</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$api</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;middleware&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;api.throttle&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;limit&#39;</span> <span class="o">=&gt;</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;api.rate_limits.sign.limit&#39;</span><span class="p">),</span><span class="c1">//æ€»åˆ†é’Ÿä¸‹æ€»å¤šå°‘æ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;expires&#39;</span> <span class="o">=&gt;</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;api.rate_limits.sign.expires&#39;</span><span class="p">),</span><span class="c1">//æ€»åˆ†é’Ÿæ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">],</span> <span class="k">function</span><span class="p">(</span><span class="nv">$api</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç”¨æˆ·æ³¨å†Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$api</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController@store&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;api.users.store&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><ul>
<li>å†™æˆé…ç½®ï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„æ§åˆ¶è°ƒç”¨é¢‘ç‡ï¼ˆconfig/api.phpï¼‰ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ¥å£é¢‘ç‡é™åˆ¶
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;rate_limits&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¿é—®é¢‘ç‡é™åˆ¶ï¼Œæ¬¡æ•°/åˆ†é’Ÿ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;access&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;expires&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RATE_LIMITS_EXPIRES&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;limit&#39;</span>  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RATE_LIMITS&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç™»å½•ç›¸å…³ï¼Œæ¬¡æ•°/åˆ†é’Ÿ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;sign&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;expires&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;SIGN_RATE_LIMITS_EXPIRES&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;limit&#39;</span>  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;SIGN_RATE_LIMITS&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><ul>
<li>å¢åŠ äº†ä¸¤ç§é™åˆ¶ï¼Œä¸€ç§ç™»å½•ç›¸å…³çš„ï¼Œä¸€åˆ†é’Ÿå¯ä»¥è°ƒç”¨10æ¬¡ï¼Œä¸€ç§æ˜¯è®¿é—®ç›¸å…³çš„ï¼Œä¸€åˆ†é’Ÿè°ƒç”¨60æ¬¡ã€‚</li>
</ul>
<h3 id="ç™»å½•apiè·å–jwtä»¤ç‰Œ">ç™»å½•APIè·å–JWTä»¤ç‰Œ</h3>
<ul>
<li>å‚è€ƒæ–‡æ¡£</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl"> JWT æ˜¯ JSON Web Token çš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªéå¸¸è½»å·§çš„è§„èŒƒï¼Œ
</span></span><span class="line"><span class="cl"> è¿™ä¸ªè§„èŒƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ JWT åœ¨ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’å®‰å…¨å¯é çš„ä¿¡æ¯ã€‚
</span></span><span class="line"><span class="cl"> JWT ç”±å¤´éƒ¨ï¼ˆheaderï¼‰ã€è½½è·ï¼ˆpayloadï¼‰ä¸ç­¾åï¼ˆsignatureï¼‰ç»„æˆã€‚
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> JWT æœ€åæ˜¯é€šè¿‡ Base64 ç¼–ç çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥è¢«ç¿»è¯‘å›åŸæ¥çš„æ ·å­æ¥çš„ã€‚æ‰€ä»¥ä¸è¦åœ¨ JWT ä¸­å­˜æ”¾ä¸€äº›æ•æ„Ÿä¿¡æ¯ã€‚
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> Token éªŒè¯
</span></span><span class="line"><span class="cl"> æœ‰äº† token ä¹‹åè¯¥å¦‚ä½•éªŒè¯ token çš„æœ‰æ•ˆæ€§ï¼Œå¹¶å¾—åˆ° token å¯¹åº”çš„ç”¨æˆ·å‘¢ï¼Ÿ
</span></span><span class="line"><span class="cl"> å…¶å®åŸç†å¾ˆç®€å•ï¼ŒDingoApi ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½äº† api.auth è¿™ä¸ªä¸­é—´ä»¶
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> - è·å–å®¢æˆ·ç«¯æäº¤çš„ token
</span></span><span class="line"><span class="cl"> - æ£€æµ‹ token ä¸­çš„ç­¾å signature æ˜¯å¦æ­£ç¡®
</span></span><span class="line"><span class="cl"> - åˆ¤æ–­ payload æ•°æ®ä¸­çš„ expï¼Œæ˜¯å¦å·²ç»è¿‡æœŸ
</span></span><span class="line"><span class="cl"> - æ ¹æ® payload æ•°æ®ä¸­çš„ subï¼Œå–æ•°æ®åº“ä¸­éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
</span></span><span class="line"><span class="cl"> - ä¸Šè¿°æ£€æµ‹ä¸æ­£ç¡®ï¼Œåˆ™æŠ›å‡ºç›¸åº”å¼‚å¸¸
</span></span></code></pre></div><ul>
<li>å®‰è£…</li>
</ul>
<p>1ã€å®‰è£… jwt-auth</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">composer</span> <span class="k">require</span> <span class="nx">tymon</span><span class="o">/</span><span class="nx">jwt</span><span class="o">-</span><span class="nx">auth</span><span class="o">:</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="nx">rc</span><span class="o">.</span><span class="mi">2</span>
</span></span></code></pre></div><p>2ã€éœ€è¦è®¾ç½®ä¸€ä¸‹ JWT çš„ secretï¼Œè¿™ä¸ª secret å¾ˆé‡è¦ï¼Œç”¨äºæœ€åçš„ç­¾åï¼Œæ›´æ¢è¿™ä¸ªsecret ä¼šå¯¼è‡´ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰ token æ— æ•ˆã€‚
<code>php artisan jwt:secret</code> ï¼ˆå¯ä»¥çœ‹åˆ°åœ¨ .env æ–‡ä»¶ä¸­ï¼Œå¢åŠ äº†ä¸€è¡Œ JWT_SECRETï¼‰</p>
<p>3ã€ä¿®æ”¹ <code>config/auth.php</code>ï¼Œå°† api guard çš„ driver æ”¹ä¸º jwt</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;guards&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;web&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;api&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jwt&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><p>4ã€ä¿®æ”¹ <code>config/api.php</code>ï¼Œauth ä¸­å¢åŠ  JWT ç›¸å…³çš„é…ç½®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;auth&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;jwt&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Dingo\Api\Auth\Provider\JWT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">],</span>
</span></span></code></pre></div><p>5ã€<code>user(app\Models\User.php)</code> æ¨¡å‹éœ€è¦ç»§æ‰¿ <code>Tymon\JWTAuth\Contracts\JWTSubject</code> æ¥å£ï¼Œå¹¶å®ç°æ¥å£çš„ä¸¤ä¸ªæ–¹æ³• <code>getJWTIdentifier()</code> å’Œ <code>getJWTCustomClaims()</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Tymon\JWTAuth\Contracts\JWTSubject</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Auth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span> <span class="k">implements</span> <span class="nx">JWTSubject</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Rest omitted for brevity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getJWTIdentifier</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getKey</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getJWTCustomClaims</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="æµ‹è¯•-1">æµ‹è¯•</h3>
<p><code>php artisan tinker</code> åšå¦‚ä¸‹æµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$user</span> <span class="o">=</span> <span class="nx">App\Models\User</span><span class="o">::</span><span class="na">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">Auth</span><span class="o">::</span><span class="na">guard</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">fromUser</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span></span></code></pre></div><h3 id="ç”¨æˆ·ç™»å½•æµ‹è¯•">ç”¨æˆ·ç™»å½•æµ‹è¯•</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="mi">1</span><span class="nx">ã€å¢åŠ è·¯ç”±</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç™»å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$api</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;authorizations&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthorizationsController@store&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;api.authorizations.store&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="nx">ã€åˆ›å»ºç™»å½•çš„</span> <span class="nx">request</span>
</span></span><span class="line"><span class="cl"><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">request</span> <span class="nx">Api</span><span class="o">/</span><span class="nx">AuthorizationRequest</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|min:6&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">3</span><span class="nx">ã€app</span><span class="o">/</span><span class="nx">Http</span><span class="o">/</span><span class="nx">Controllers</span><span class="o">/</span><span class="nx">Api</span><span class="o">/</span><span class="nx">AuthorizationsController</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">AuthorizationRequest</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$credentials</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$credentials</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$token</span> <span class="o">=</span> <span class="nx">\Auth</span><span class="o">::</span><span class="na">guard</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">attempt</span><span class="p">(</span><span class="nv">$credentials</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">errorUnauthorized</span><span class="p">(</span><span class="s1">&#39;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">array</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;access_token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;token_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;expires_in&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Auth</span><span class="o">::</span><span class="na">guard</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTTL</span><span class="p">()</span> <span class="o">*</span> <span class="mi">60</span>
</span></span><span class="line"><span class="cl">    <span class="p">])</span><span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"> <span class="mi">4</span><span class="nx">ã€åˆ›å»ºapp\Http\Controllers\Api\Controller</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"> <span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Controllers\Api</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Dingo\Api\Routing\Helpers</span><span class="p">;</span><span class="c1">//é‡ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span> <span class="k">as</span> <span class="nx">BaseController</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Controller</span> <span class="k">extends</span> <span class="nx">BaseController</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">use</span> <span class="nx">Helpers</span><span class="p">;</span><span class="c1">//é‡ç‚¹ç›®çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><h3 id="åˆ·æ–°åˆ é™¤-token">åˆ·æ–°/åˆ é™¤ token</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="mi">1</span><span class="nx">ã€é¦–å…ˆå¢åŠ è·¯ç”±routes</span><span class="o">/</span><span class="nx">api</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ·æ–°token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$api</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;authorizations/current&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthorizationsController@update&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;api.authorizations.update&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ é™¤token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$api</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;authorizations/current&#39;</span><span class="p">,</span> <span class="s1">&#39;AuthorizationsController@destroy&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;api.authorizations.destroy&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="nx">ã€app</span><span class="o">/</span><span class="nx">Http</span><span class="o">/</span><span class="nx">Controllers</span><span class="o">/</span><span class="nx">Api</span><span class="o">/</span><span class="nx">AuthorizationsController</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$token</span> <span class="o">=</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">guard</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">refresh</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">respondWithToken</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Auth</span><span class="o">::</span><span class="na">guard</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">logout</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">noContent</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">protected</span> <span class="k">function</span> <span class="nf">respondWithToken</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">array</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;access_token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;token_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;expires_in&#39;</span> <span class="o">=&gt;</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">guard</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTTL</span><span class="p">()</span> <span class="o">*</span> <span class="mi">60</span>
</span></span><span class="line"><span class="cl">        <span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><h3 id="å…¶ä»–">å…¶ä»–</h3>
<ul>
<li>artisan è·å– token</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="mi">1</span><span class="nx">ã€å¢åŠ ä¸€ä¸ªArtisan</span> <span class="nx">å‘½ä»¤</span>
</span></span><span class="line"><span class="cl"><span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">command</span> <span class="nx">GenerateToken</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="nx">ã€ä¿®æ”¹æ–‡ä»¶app</span><span class="o">/</span><span class="nx">Console</span><span class="o">/</span><span class="nx">Commands</span><span class="o">/</span><span class="nx">GenerateToken</span><span class="o">.</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Console\Commands</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Console\Command</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GenerateToken</span> <span class="k">extends</span> <span class="nx">Command</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">&#39;laraapi:generate-token&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">&#39;å¿«é€Ÿä¸ºç”¨æˆ·ç”Ÿæˆ token&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$userId</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ask</span><span class="p">(</span><span class="s1">&#39;è¾“å…¥ç”¨æˆ· id&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$userId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s1">&#39;ç”¨æˆ·ä¸å­˜åœ¨&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä¸€å¹´ä»¥åè¿‡æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$ttl</span> <span class="o">=</span> <span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="nx">\Auth</span><span class="o">::</span><span class="na">guard</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setTTL</span><span class="p">(</span><span class="nv">$ttl</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">fromUser</span><span class="p">(</span><span class="nv">$user</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Vagrantå®‰è£…ä¹‹æ—…ğŸ˜ˆ</title>
			<link>https://blog.gookm.cn/posts/2018/20180425-install-vagrant/</link>
			<pubDate>Wed, 25 Apr 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180425-install-vagrant/</guid>
			<description>è®°vagrantå®‰è£…ä¹‹æ—…
æ€è€ƒ é¦–å…ˆï¼Œvagrantæ˜¯ä»€ä¹ˆï¼Ÿ
Vagrantç›®å‰æ˜¯å›½å†…äº’è”ç½‘å…¬å¸åº”ç”¨æœ€å¤šçš„å†…éƒ¨å¼€å‘ç¯å¢ƒå·¥å…·ã€‚Vagrantæ˜¯æˆ‘ä»¬å¼€å‘è€…çš„ç¦éŸ³ï¼Œä½¿æˆ‘ä»¬å®Œå…¨æ‘†è„±äº†é‡å¤é…ç½®ç¯å¢ƒçš„å¤„å¢ƒã€‚Vagrantç®€å•çš„é…ç½®ï¼Œä¸°å¯Œçš„è‡ªåŠ¨åŒ–è„šæœ¬èµ„æºä»¥åŠåˆ†äº«çš„ä¾¿æ·æ€§éƒ½æ˜¯æˆ‘ä»¬åº”è¯¥å­¦ä¹ çš„æ€æƒ³ï¼ŒèŠ‚çœå¼€å‘äººå‘˜çš„å¤§é‡å‡†å¤‡å·¥ä½œæ—¶é—´,ä½¿å¼€å‘äººå‘˜æ›´ä¸“æ³¨å…¬å¸ä¸šåŠ¡å¼€å‘ã€‚
å¼€å§‹ 1ã€ä¸‹è½½VirtualBox 5.1.38 x86/AMD64 ä¸‹è½½åœ°å€ï¼šhttps://www.virtualbox.org/wiki/Download_Old_Builds_5_1 2ã€ä¸‹è½½Vagrant 1.8.6.msi ä¸‹è½½åœ°å€ï¼šhttps://releases.hashicorp.com/vagrant/1.8.6/ 3ã€ä¸‹è½½boxï¼Œæˆ‘é€‰çš„æ˜¯ä»¥ubuntuä½œä¸ºç³»ç»Ÿé•œåƒ ä¸‹è½½åœ°å€ï¼šhttps://pan.baidu.com/s/1nS_12Vccdiara-iLAnht5w å¯†ç ï¼šktjw 4ã€ç„¶åå‚»ç“œå¼å®‰è£…è¿™ä¸¤ä¸ªè½¯ä»¶ï¼Œvagrantå®‰è£…å®Œåéœ€è¦é‡å¯ç”µè„‘ 5ã€æ–°å»ºç›®å½• å¦‚code/boxesï¼Œå°†ubuntu-14.04-amd64.boxæ”¾åœ¨boxesä¸‹ 6ã€æ·»åŠ æ‰“é€ å±äºè‡ªå·±çš„boxï¼Œvagrant box add ubuntu1404 ubuntu-14.04-amd64.box 7ã€åˆå§‹åŒ–boxï¼Œvagrant init ubuntu1404ï¼Œæ­¤æ—¶ä¼šåœ¨boxesä¸‹ç”ŸæˆVagrantfileé…ç½®æ–‡ä»¶ 8ã€æ­¤æ—¶æ‰§è¡Œvagrant up å¯åŠ¨è™šæ‹Ÿæœºï¼Œç„¶åvagrant ssh è¿›å…¥è™šæ‹Ÿæœº 9ã€è¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥åœ¨è¯¥è™šæ‹Ÿæœºä¸Šé…ç½®ä½ è‡ªå·±æƒ³è¦çš„ç³»ç»Ÿç¯å¢ƒï¼Œæ¯”å¦‚å®‰è£…nginx PHP MySQL redisç­‰ç­‰ 10ã€å¯¼å‡ºè‡ªå·±çš„boxï¼Œvagrant package --output ubuntu1404_testbox --base ubuntu1404 11ã€Vagrantfileç›¸å…³é…ç½® config.vm.box=&amp;#34;ubuntu1404&amp;#34; //box åç§° config.vm.hostname=&amp;#34;lnmp&amp;#34; //é…ç½®hostname config.vm.network &amp;#34;private_network&amp;#34;,ip:&amp;#34;192.168.22.20&amp;#34; //é…ç½®ç§æœ‰ç½‘ç»œip vb.customize [&amp;#34;modifyvm&amp;#34;,:id,&amp;#34;--memory&amp;#34;,&amp;#34;1024&amp;#34;] //ä¿®æ”¹å†…å­˜ vb.name=&amp;#34;testname&amp;#34; //ä¿®æ”¹virtualboxçš„åç§° 12ã€vagrant up å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š Vagrant was unable to mount VirtualBox shared folders. This is usually because the filesystem &amp;#34;vboxsf&amp;#34; is not available.</description>
			<content type="html"><![CDATA[<p><strong>è®°vagrantå®‰è£…ä¹‹æ—…</strong></p>
<h3 id="æ€è€ƒ">æ€è€ƒ</h3>
<p>é¦–å…ˆï¼Œvagrantæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>Vagrantç›®å‰æ˜¯å›½å†…äº’è”ç½‘å…¬å¸åº”ç”¨æœ€å¤šçš„å†…éƒ¨å¼€å‘ç¯å¢ƒå·¥å…·ã€‚Vagrantæ˜¯æˆ‘ä»¬å¼€å‘è€…çš„ç¦éŸ³ï¼Œä½¿æˆ‘ä»¬å®Œå…¨æ‘†è„±äº†é‡å¤é…ç½®ç¯å¢ƒçš„å¤„å¢ƒã€‚Vagrantç®€å•çš„é…ç½®ï¼Œä¸°å¯Œçš„è‡ªåŠ¨åŒ–è„šæœ¬èµ„æºä»¥åŠåˆ†äº«çš„ä¾¿æ·æ€§éƒ½æ˜¯æˆ‘ä»¬åº”è¯¥å­¦ä¹ çš„æ€æƒ³ï¼ŒèŠ‚çœå¼€å‘äººå‘˜çš„å¤§é‡å‡†å¤‡å·¥ä½œæ—¶é—´,ä½¿å¼€å‘äººå‘˜æ›´ä¸“æ³¨å…¬å¸ä¸šåŠ¡å¼€å‘ã€‚</p>
</blockquote>
<h3 id="å¼€å§‹">å¼€å§‹</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="mi">1</span><span class="nx">ã€ä¸‹è½½VirtualBox</span> <span class="mf">5.1</span><span class="o">.</span><span class="mi">38</span>  <span class="nx">x86</span><span class="o">/</span><span class="nx">AMD64</span>
</span></span><span class="line"><span class="cl"><span class="nx">ä¸‹è½½åœ°å€ï¼šhttps</span><span class="o">://</span><span class="nx">www</span><span class="o">.</span><span class="nx">virtualbox</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">wiki</span><span class="o">/</span><span class="nx">Download_Old_Builds_5_1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="nx">ã€ä¸‹è½½Vagrant</span> <span class="mf">1.8</span><span class="o">.</span><span class="mf">6.</span><span class="nx">msi</span>
</span></span><span class="line"><span class="cl"><span class="nx">ä¸‹è½½åœ°å€ï¼šhttps</span><span class="o">://</span><span class="nx">releases</span><span class="o">.</span><span class="nx">hashicorp</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">vagrant</span><span class="o">/</span><span class="mf">1.8</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">3</span><span class="nx">ã€ä¸‹è½½boxï¼Œæˆ‘é€‰çš„æ˜¯ä»¥ubuntuä½œä¸ºç³»ç»Ÿé•œåƒ</span>
</span></span><span class="line"><span class="cl"><span class="nx">ä¸‹è½½åœ°å€ï¼šhttps</span><span class="o">://</span><span class="nx">pan</span><span class="o">.</span><span class="nx">baidu</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">s</span><span class="o">/</span><span class="mi">1</span><span class="nx">nS_12Vccdiara</span><span class="o">-</span><span class="nx">iLAnht5w</span>  <span class="nx">å¯†ç ï¼šktjw</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="nx">ã€ç„¶åå‚»ç“œå¼å®‰è£…è¿™ä¸¤ä¸ªè½¯ä»¶ï¼Œvagrantå®‰è£…å®Œåéœ€è¦é‡å¯ç”µè„‘</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">5</span><span class="nx">ã€æ–°å»ºç›®å½•</span> <span class="nx">å¦‚code</span><span class="o">/</span><span class="nx">boxesï¼Œå°†ubuntu</span><span class="o">-</span><span class="mf">14.04</span><span class="o">-</span><span class="nx">amd64</span><span class="o">.</span><span class="nx">boxæ”¾åœ¨boxesä¸‹</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">6</span><span class="nx">ã€æ·»åŠ æ‰“é€ å±äºè‡ªå·±çš„boxï¼Œvagrant</span> <span class="nx">box</span> <span class="nx">add</span> <span class="nx">ubuntu1404</span> <span class="nx">ubuntu</span><span class="o">-</span><span class="mf">14.04</span><span class="o">-</span><span class="nx">amd64</span><span class="o">.</span><span class="nx">box</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">7</span><span class="nx">ã€åˆå§‹åŒ–boxï¼Œvagrant</span> <span class="nx">init</span> <span class="nx">ubuntu1404ï¼Œæ­¤æ—¶ä¼šåœ¨boxesä¸‹ç”ŸæˆVagrantfileé…ç½®æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">8</span><span class="nx">ã€æ­¤æ—¶æ‰§è¡Œvagrant</span> <span class="nx">up</span> <span class="nx">å¯åŠ¨è™šæ‹Ÿæœºï¼Œç„¶åvagrant</span> <span class="nx">ssh</span> <span class="nx">è¿›å…¥è™šæ‹Ÿæœº</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">9</span><span class="nx">ã€è¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥åœ¨è¯¥è™šæ‹Ÿæœºä¸Šé…ç½®ä½ è‡ªå·±æƒ³è¦çš„ç³»ç»Ÿç¯å¢ƒï¼Œæ¯”å¦‚å®‰è£…nginx</span> <span class="nx">PHP</span> <span class="nx">MySQL</span> <span class="nx">redisç­‰ç­‰</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">10</span><span class="nx">ã€å¯¼å‡ºè‡ªå·±çš„boxï¼Œvagrant</span> <span class="nx">package</span> <span class="o">--</span><span class="nx">output</span> <span class="nx">ubuntu1404_testbox</span>  <span class="o">--</span><span class="nx">base</span> <span class="nx">ubuntu1404</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="mi">11</span><span class="nx">ã€Vagrantfileç›¸å…³é…ç½®</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span><span class="o">.</span><span class="nx">vm</span><span class="o">.</span><span class="nx">box</span><span class="o">=</span><span class="s2">&#34;ubuntu1404&#34;</span> <span class="c1">//box åç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">config</span><span class="o">.</span><span class="nx">vm</span><span class="o">.</span><span class="nx">hostname</span><span class="o">=</span><span class="s2">&#34;lnmp&#34;</span>   <span class="c1">//é…ç½®hostname
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">config</span><span class="o">.</span><span class="nx">vm</span><span class="o">.</span><span class="nx">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span><span class="nx">ip</span><span class="o">:</span><span class="s2">&#34;192.168.22.20&#34;</span>  <span class="c1">//é…ç½®ç§æœ‰ç½‘ç»œip
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">vb</span><span class="o">.</span><span class="nx">customize</span> <span class="p">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span><span class="o">:</span><span class="nx">id</span><span class="p">,</span><span class="s2">&#34;--memory&#34;</span><span class="p">,</span><span class="s2">&#34;1024&#34;</span><span class="p">]</span>  <span class="c1">//ä¿®æ”¹å†…å­˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">vb</span><span class="o">.</span><span class="nx">name</span><span class="o">=</span><span class="s2">&#34;testname&#34;</span>  <span class="c1">//ä¿®æ”¹virtualboxçš„åç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl"><span class="mi">12</span><span class="nx">ã€vagrant</span> <span class="nx">up</span> <span class="nx">å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="nx">Vagrant</span> <span class="nx">was</span> <span class="nx">unable</span> <span class="nx">to</span> <span class="nx">mount</span> <span class="nx">VirtualBox</span> <span class="nx">shared</span> <span class="nx">folders</span><span class="o">.</span> <span class="k">This</span> <span class="nx">is</span> <span class="nx">usually</span>
</span></span><span class="line"><span class="cl"><span class="nx">because</span> <span class="nx">the</span> <span class="nx">filesystem</span> <span class="s2">&#34;vboxsf&#34;</span> <span class="nx">is</span> <span class="k">not</span> <span class="nx">available</span><span class="o">.</span> <span class="k">This</span> <span class="nx">filesystem</span> <span class="nx">is</span>
</span></span><span class="line"><span class="cl"><span class="nx">made</span> <span class="nx">available</span> <span class="nx">via</span> <span class="nx">the</span> <span class="nx">VirtualBox</span> <span class="nx">Guest</span> <span class="nx">Additions</span> <span class="k">and</span> <span class="nx">kernel</span> <span class="nx">module</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="nx">Please</span> <span class="nx">verify</span> <span class="nx">that</span> <span class="nx">these</span> <span class="nx">guest</span> <span class="nx">additions</span> <span class="nx">are</span> <span class="nx">properly</span> <span class="nx">installed</span> <span class="nx">in</span> <span class="nx">the</span>
</span></span><span class="line"><span class="cl"><span class="nx">guest</span><span class="o">.</span> <span class="k">This</span> <span class="nx">is</span> <span class="k">not</span> <span class="nx">a</span> <span class="nx">bug</span> <span class="nx">in</span> <span class="nx">Vagrant</span> <span class="k">and</span> <span class="nx">is</span> <span class="nx">usually</span> <span class="nx">caused</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">faulty</span>
</span></span><span class="line"><span class="cl"><span class="nx">Vagrant</span> <span class="nx">box</span><span class="o">.</span> <span class="k">For</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">command</span> <span class="nx">attempted</span> <span class="nx">was</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">mount</span> <span class="o">-</span><span class="nx">t</span> <span class="nx">vboxsf</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="nx">gid</span><span class="o">=</span><span class="mi">1000</span> <span class="nx">vagrant</span> <span class="o">/</span><span class="nx">vagrant</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">The</span> <span class="nx">error</span> <span class="nx">output</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">command</span> <span class="nx">was</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">mount</span><span class="o">:</span> <span class="nx">unknown</span> <span class="nx">filesystem</span> <span class="nx">type</span> <span class="s1">&#39;vboxsf&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nx">ä»¥ä¸Šä¸ºæ‰§è¡Œvagrant</span> <span class="nx">up</span> <span class="nx">æ—¶çš„æŠ¥é”™ï¼Œè¯´æ˜¯Vagrantæ— æ³•æŒ‚è½½VirtualBoxå…±äº«æ–‡ä»¶å¤¹ï¼Œ</span>
</span></span><span class="line"><span class="cl"><span class="nx">è§£å†³æ–¹æ³•æ˜¯æ‰§è¡Œvagrant</span> <span class="nx">plugin</span> <span class="nx">install</span> <span class="nx">vagrant</span><span class="o">-</span><span class="nx">vbguestï¼Œç„¶åå†å°è¯•vagrant</span> <span class="nx">up</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="mi">13</span><span class="nx">ã€èµ„æºæ¨èï¼š</span>
</span></span><span class="line"><span class="cl">  <span class="nx">æ…•è¯¾åœ¨çº¿è§†é¢‘ï¼šhttps</span><span class="o">://</span><span class="nx">www</span><span class="o">.</span><span class="nx">imooc</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">learn</span><span class="o">/</span><span class="mi">805</span>
</span></span><span class="line"><span class="cl">  <span class="nx">è§†é¢‘å¯¹åº”èµ„æ–™ï¼šhttps</span><span class="o">://</span><span class="nx">github</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">apanly</span><span class="o">/</span><span class="nx">mooc</span><span class="o">/</span><span class="nx">tree</span><span class="o">/</span><span class="nx">master</span><span class="o">/</span><span class="nx">vagrant</span>
</span></span><span class="line"><span class="cl">  <span class="nx">vagrant</span> <span class="nx">upè§£å†³ï¼šhttps</span><span class="o">://</span><span class="nx">blog</span><span class="o">.</span><span class="nx">csdn</span><span class="o">.</span><span class="nx">net</span><span class="o">/</span><span class="nx">changjiangwang</span><span class="o">/</span><span class="nx">article</span><span class="o">/</span><span class="nx">details</span><span class="o">/</span><span class="mi">79129510</span>
</span></span><span class="line"><span class="cl">                <span class="nx">https</span><span class="o">://</span><span class="nx">github</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">scotch</span><span class="o">-</span><span class="nx">io</span><span class="o">/</span><span class="nx">scotch</span><span class="o">-</span><span class="nx">box</span><span class="o">/</span><span class="nx">issues</span><span class="o">/</span><span class="mi">296</span>
</span></span><span class="line"><span class="cl">  <span class="nx">vagrantå­¦ä¹ æ‰‹å†Œï¼šhttps</span><span class="o">://</span><span class="nx">www</span><span class="o">.</span><span class="nx">vagrantup</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">intro</span><span class="o">/</span><span class="nx">getting</span><span class="o">-</span><span class="nx">started</span><span class="o">/</span><span class="nx">index</span><span class="o">.</span><span class="nx">html</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">14</span><span class="nx">ã€å¸¸ç”¨å‘½ä»¤ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="nx">vagrant</span> <span class="o">-</span><span class="nx">v</span>        <span class="c1"># æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">init</span>      <span class="c1"># åˆå§‹åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">up</span>        <span class="c1"># å¯åŠ¨è™šæ‹Ÿæœº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">halt</span>      <span class="c1"># å…³é—­è™šæ‹Ÿæœº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">reload</span>    <span class="c1"># é‡å¯è™šæ‹Ÿæœº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">ssh</span>       <span class="c1"># SSH è‡³è™šæ‹Ÿæœº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">suspend</span>   <span class="c1"># æŒ‚èµ·è™šæ‹Ÿæœº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">resume</span>    <span class="c1"># å”¤é†’è™šæ‹Ÿæœº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">status</span>    <span class="c1"># æŸ¥çœ‹è™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">destroy</span>   <span class="c1"># é”€æ¯å½“å‰è™šæ‹Ÿæœº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">status</span>    <span class="c1"># æŸ¥çœ‹VMå½“å‰çš„çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#boxç®¡ç†å‘½ä»¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">box</span> <span class="k">list</span>    <span class="c1"># æŸ¥çœ‹æœ¬åœ°boxåˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">add</span> <span class="nx">boxname</span> <span class="nx">ç³»ç»Ÿé•œåƒå</span>    <span class="c1"># æ·»åŠ boxåˆ°åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">$</span> <span class="nx">vagrant</span> <span class="nx">box</span> <span class="nx">remove</span> <span class="nx">boxname</span>  <span class="c1"># ä»boxåˆ—è¡¨ç§»é™¤
</span></span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Gogs</title>
			<link>https://blog.gookm.cn/posts/2018/20180410-gogs/</link>
			<pubDate>Tue, 10 Apr 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180410-gogs/</guid>
			<description>æˆæœä½“éªŒåœ°å€
centos7å®‰è£…éƒ¨ç½²gogs å‰ææ˜¯mysqlã€gitéƒ½å·²ç»å®‰è£…å¥½äº†ï¼Œå¯ä»¥ç›´æ¥å¾€ä¸‹èµ°ï¼š 1.ä¸‹è½½gogoå‹ç¼©åŒ… https://dl.gogs.io/ é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ä¸‹è½½ æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯gogs_v0.9.141_linux_amd64.tar.gz 2.ä¸Šä¼ åˆ°æœåŠ¡å™¨å¯¹åº”çš„ç›®å½• å¹¶è§£å‹ æˆ‘è¿™é‡Œä¸Šä¼ çš„æ˜¯åœ¨/homeä¸‹ ç„¶åtar -zxvf gogs_v0.9.141_linux_amd64.tar.gz 3.å¼€å¯æœåŠ¡./gogo web åå°è¿è¡Œ nohup ./gogs web &amp;amp; 4.å¼€æ”¾æ”¾è¡Œ3000ç«¯å£ æˆ–å…³é—­é˜²ç«å¢™ ç„¶åè¿è¡Œhttp://æœåŠ¡å™¨å…¬ç½‘ip:3000/installè¿›è¡Œå®‰è£… windowsä¸‹å®‰è£…éƒ¨ç½²gogs -å‰ææ˜¯mysqlã€gitéƒ½å·²ç»å®‰è£…å¥½äº†ï¼Œå¯ä»¥ç›´æ¥å¾€ä¸‹èµ°ï¼š
1.ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬ï¼Œæˆ‘ä¸‹çš„æ˜¯windows amd64 https://gogs.io/docs/installation/install_from_binary 2.å¼€å§‹å®‰è£… a.è§£å‹ä¸‹è½½åˆ°çš„gogsï¼Œå°†gogsæ–‡ä»¶å¤¹ç§»åŠ¨åˆ°ä¸€ä¸ªç£ç›˜ï¼Œå¦‚Eç›˜ b.åœ¨gogsæ–‡ä»¶å¤¹å†…è¿›è¡Œæ·»åŠ æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ åœ¨gogs ç›®å½•ä¸‹æ–°å»º custom å’Œ log ç›®å½• åœ¨custom ç›®å½•ä¸‹å†æ–°å»ºconf ç›®å½• åœ¨conf ç›®å½•ä¸‹æ–°å»º app.ini æ–‡ä»¶ åœ¨app.iniæ–‡ä»¶é‡ŒåŠ å…¥å¦‚ä¸‹å†…å®¹ [repository] ROOT = D:/GitProject [database] PATH = 127.0.0.1:3306 åœ¨log ç›®å½•ä¸‹æ–°å»ºgogs.log æ–‡ä»¶ è¦æ³¨æ„ log ç›®å½•è¦ç»™ä¸å½“å‰ç³»ç»Ÿçš„ç™»å½•ç”¨æˆ·æ·»åŠ ã€ç¼–è¾‘æƒé™ c.åœ¨mysqlä¸­æ–°å»ºgogsæ•°æ®åº“ 3.cmdä¸­è¿›å…¥åˆ°gogsæ–‡ä»¶å¤¹ æ‰§è¡Œgogs.exe webå¼€å¯æœåŠ¡ åœ¨æµè§ˆå™¨ä¸­http://127.0.0.1:3000/installå¼€å§‹é…ç½®å®‰è£… æ­¤æ—¶å…³é—­cmdæœåŠ¡å°±ä¼šåœæ­¢ï¼Œè¦æƒ³æ·»åŠ ä¸ºwindowsæœåŠ¡ï¼Œéœ€è¦ä¸‹è½½nssmï¼Œå¹¶æ·»åŠ ç¯å¢ƒå˜é‡ ç›¸å…³çš„è®¿é—®urlåŠå…¶ä»–çš„ä¸€äº›é…ç½®ä¿¡æ¯éƒ½åœ¨ custom/conf/app.ini é‡Œé¢
æˆæœä½“éªŒåœ°å€ å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥è¿›è¿™ä¸ªåœ°å€ï¼ŒæŠŠè¿™ä¸ªå½“ä½ çš„ä¸ªäººä»“åº“ä½¿ç”¨ã€‚</description>
			<content type="html"><![CDATA[<p><a href="http://118.25.43.60:3000/">æˆæœä½“éªŒåœ°å€</a></p>
<h3 id="centos7å®‰è£…éƒ¨ç½²gogs">centos7å®‰è£…éƒ¨ç½²gogs</h3>
<ul>
<li>å‰ææ˜¯mysqlã€gitéƒ½å·²ç»å®‰è£…å¥½äº†ï¼Œå¯ä»¥ç›´æ¥å¾€ä¸‹èµ°ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.ä¸‹è½½gogoå‹ç¼©åŒ…  https://dl.gogs.io/
</span></span><span class="line"><span class="cl">é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ä¸‹è½½  æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯gogs_v0.9.141_linux_amd64.tar.gz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.ä¸Šä¼ åˆ°æœåŠ¡å™¨å¯¹åº”çš„ç›®å½• å¹¶è§£å‹
</span></span><span class="line"><span class="cl">æˆ‘è¿™é‡Œä¸Šä¼ çš„æ˜¯åœ¨/homeä¸‹  ç„¶åtar -zxvf gogs_v0.9.141_linux_amd64.tar.gz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.å¼€å¯æœåŠ¡./gogo web  åå°è¿è¡Œ   nohup ./gogs web &amp;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.å¼€æ”¾æ”¾è¡Œ3000ç«¯å£ æˆ–å…³é—­é˜²ç«å¢™ ç„¶åè¿è¡Œhttp://æœåŠ¡å™¨å…¬ç½‘ip:3000/installè¿›è¡Œå®‰è£…
</span></span></code></pre></div><h3 id="windowsä¸‹å®‰è£…éƒ¨ç½²gogs">windowsä¸‹å®‰è£…éƒ¨ç½²gogs</h3>
<p>-å‰ææ˜¯mysqlã€gitéƒ½å·²ç»å®‰è£…å¥½äº†ï¼Œå¯ä»¥ç›´æ¥å¾€ä¸‹èµ°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬ï¼Œæˆ‘ä¸‹çš„æ˜¯windows amd64
</span></span><span class="line"><span class="cl">https://gogs.io/docs/installation/install_from_binary
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.å¼€å§‹å®‰è£…
</span></span><span class="line"><span class="cl">a.è§£å‹ä¸‹è½½åˆ°çš„gogsï¼Œå°†gogsæ–‡ä»¶å¤¹ç§»åŠ¨åˆ°ä¸€ä¸ªç£ç›˜ï¼Œå¦‚Eç›˜
</span></span><span class="line"><span class="cl">b.åœ¨gogsæ–‡ä»¶å¤¹å†…è¿›è¡Œæ·»åŠ æ–‡ä»¶å¤¹å’Œæ–‡ä»¶
</span></span><span class="line"><span class="cl">åœ¨gogs ç›®å½•ä¸‹æ–°å»º custom å’Œ log ç›®å½•
</span></span><span class="line"><span class="cl">åœ¨custom ç›®å½•ä¸‹å†æ–°å»ºconf ç›®å½•
</span></span><span class="line"><span class="cl">åœ¨conf ç›®å½•ä¸‹æ–°å»º app.ini æ–‡ä»¶
</span></span><span class="line"><span class="cl">åœ¨app.iniæ–‡ä»¶é‡ŒåŠ å…¥å¦‚ä¸‹å†…å®¹
</span></span><span class="line"><span class="cl">[repository]
</span></span><span class="line"><span class="cl">ROOT = D:/GitProject
</span></span><span class="line"><span class="cl">[database]
</span></span><span class="line"><span class="cl">PATH = 127.0.0.1:3306
</span></span><span class="line"><span class="cl">åœ¨log ç›®å½•ä¸‹æ–°å»ºgogs.log æ–‡ä»¶
</span></span><span class="line"><span class="cl">è¦æ³¨æ„ log ç›®å½•è¦ç»™ä¸å½“å‰ç³»ç»Ÿçš„ç™»å½•ç”¨æˆ·æ·»åŠ ã€ç¼–è¾‘æƒé™
</span></span><span class="line"><span class="cl">c.åœ¨mysqlä¸­æ–°å»ºgogsæ•°æ®åº“
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.cmdä¸­è¿›å…¥åˆ°gogsæ–‡ä»¶å¤¹  æ‰§è¡Œgogs.exe webå¼€å¯æœåŠ¡
</span></span><span class="line"><span class="cl">åœ¨æµè§ˆå™¨ä¸­http://127.0.0.1:3000/installå¼€å§‹é…ç½®å®‰è£…
</span></span><span class="line"><span class="cl">æ­¤æ—¶å…³é—­cmdæœåŠ¡å°±ä¼šåœæ­¢ï¼Œè¦æƒ³æ·»åŠ ä¸ºwindowsæœåŠ¡ï¼Œéœ€è¦ä¸‹è½½nssmï¼Œå¹¶æ·»åŠ ç¯å¢ƒå˜é‡
</span></span></code></pre></div><p>ç›¸å…³çš„è®¿é—®urlåŠå…¶ä»–çš„ä¸€äº›é…ç½®ä¿¡æ¯éƒ½åœ¨ <code>custom/conf/app.ini</code> é‡Œé¢</p>
<p><a href="http://118.25.43.60:3000/">æˆæœä½“éªŒåœ°å€</a>  å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥è¿›è¿™ä¸ªåœ°å€ï¼ŒæŠŠè¿™ä¸ªå½“ä½ çš„ä¸ªäººä»“åº“ä½¿ç”¨ã€‚</p>
]]></content>
		</item>
		
		<item>
			<title>æ¨¡å‹è§‚å¯Ÿè€…è§¦å‘é‚®ä»¶é€šçŸ¥</title>
			<link>https://blog.gookm.cn/posts/2018/20180402-observer-email/</link>
			<pubDate>Mon, 02 Apr 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180402-observer-email/</guid>
			<description>æ¨¡å‹è§‚å¯Ÿè€…(observer)è§¦å‘é‚®ä»¶é€šçŸ¥
æ€è€ƒ éœ€è¦æ€è€ƒçš„æ˜¯ï¼Œå½“æˆ‘ä»¬éœ€è¦å‘é€ä¸€ä¸ªé‚®ä»¶é€šçŸ¥çš„æ—¶å€™ï¼Œä½•æ—¶è§¦å‘è¿™ä¸ªé€šçŸ¥å‘¢ï¼Ÿ
å®ç° è¿™é‡Œç”¨çš„æ˜¯è§‚å¯Ÿè€…æ¨¡å‹ï¼Œä¾‹å¦‚ App\Abservers\EmailObserver.php ï¼Œåœ¨è¯¥è§‚å¯Ÿæ¨¡å‹ä¸‹ç¼–å†™created()æ–¹æ³•ï¼Œå³å½“æ•°æ®å…¥åº“æˆåŠŸåè§¦å‘è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ AppServiceProvider çš„ boot æ–¹æ³•ä¸­æ³¨å†Œè§‚å¯Ÿè€…ï¼Œ Email::observe(EmailObserver::class); ï¼Œæ¥ä¸‹æ¥å°†é‚®ä»¶é€šçŸ¥çš„é€»è¾‘å†™åœ¨å¯¹åº”çš„è§‚å¯Ÿè€…å¯¹åº”çš„æ–¹æ³•ä¸­ï¼Œä¾‹å¦‚ï¼š
public function created(Email $email) { Mail::to($email)-&amp;gt;send(new EmailSend($email)); } to($email)ä¸­çš„$emailä¸ºemailæ•°æ®é›†åˆï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ä¸ªæ•°æ®é›†åˆä¸­å¿…é¡»è¦åŒ…å«æœ‰emailå­—æ®µçš„æ•°æ®ï¼ˆæ”¶ä»¶äººé‚®ç®±ï¼‰ï¼Œè€Œsend(new EmailSend($email))åˆ™ä¸ºå‘é€çš„é‚®ä»¶å†…å®¹ï¼Œè¿™é‡Œæ˜¯å°†ä¸€æ•´æ¡emailæ•°æ®é›†åˆä½œä¸ºæ•°æ®å‘é€äº†ã€‚
åˆ©ç”¨Markdown æ ¼å¼çš„ Mailable ç±»ï¼Œä¸ºæ¶ˆæ¯ä½“æ¸²æŸ“å‡ºæ¼‚äº®ã€å“åº”å¼çš„ HTML æ¨¡æ¿ï¼Œä¹Ÿèƒ½è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªçº¯æ–‡æœ¬çš„å‰¯æœ¬ã€‚
php artisan make:mail EmailSend --markdown=email.template åœ¨ç”Ÿæˆçš„EmailSend.phpä¸­çš„build()æ–¹æ³•ä¸­ï¼š
public function build() { return $this-&amp;gt;markdown(&amp;#39;email.template&amp;#39;); } æ—¢ç„¶æ˜¯å‘é€é‚®ä»¶ï¼Œå½“ç„¶éœ€è¦ä¿®æ”¹.envä¸­å…³äºé‚®ç®±çš„é…ç½®ä¿¡æ¯äº†ï¼š
MAIL_DRIVER=smtp MAIL_HOST=smtp.qq.com MAIL_PORT=587 MAIL_USERNAME=xxxxxxx@qq.com//å‘ä»¶äººé‚®ç®± MAIL_FROM_ADDRESS=xxxxxxx@qq.com//è¿™ä¸ªéœ€è¦è‡ªå·±åŠ ä¸Šï¼Œé»˜è®¤æ²¡æœ‰ MAIL_PASSWORD=æˆæƒç  MAIL_ENCRYPTION=tls </description>
			<content type="html"><![CDATA[<p><strong>æ¨¡å‹è§‚å¯Ÿè€…(observer)è§¦å‘é‚®ä»¶é€šçŸ¥</strong></p>
<h3 id="æ€è€ƒ">æ€è€ƒ</h3>
<p>éœ€è¦æ€è€ƒçš„æ˜¯ï¼Œå½“æˆ‘ä»¬éœ€è¦å‘é€ä¸€ä¸ªé‚®ä»¶é€šçŸ¥çš„æ—¶å€™ï¼Œä½•æ—¶è§¦å‘è¿™ä¸ªé€šçŸ¥å‘¢ï¼Ÿ</p>
<h3 id="å®ç°">å®ç°</h3>
<p>è¿™é‡Œç”¨çš„æ˜¯è§‚å¯Ÿè€…æ¨¡å‹ï¼Œä¾‹å¦‚ <code>App\Abservers\EmailObserver.php</code>  ï¼Œåœ¨è¯¥è§‚å¯Ÿæ¨¡å‹ä¸‹ç¼–å†™<code>created()</code>æ–¹æ³•ï¼Œå³å½“æ•°æ®å…¥åº“æˆåŠŸåè§¦å‘è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ <code>AppServiceProvider</code> çš„ <code>boot</code> æ–¹æ³•ä¸­æ³¨å†Œè§‚å¯Ÿè€…ï¼Œ  <code>Email::observe(EmailObserver::class);</code> ï¼Œæ¥ä¸‹æ¥å°†é‚®ä»¶é€šçŸ¥çš„é€»è¾‘å†™åœ¨å¯¹åº”çš„è§‚å¯Ÿè€…å¯¹åº”çš„æ–¹æ³•ä¸­ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">created</span><span class="p">(</span><span class="nx">Email</span> <span class="nv">$email</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Mail</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">EmailSend</span><span class="p">(</span><span class="nv">$email</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>to($email)</code>ä¸­çš„<code>$email</code>ä¸º<code>email</code>æ•°æ®é›†åˆï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ä¸ªæ•°æ®é›†åˆä¸­å¿…é¡»è¦åŒ…å«æœ‰<code>email</code>å­—æ®µçš„æ•°æ®ï¼ˆæ”¶ä»¶äººé‚®ç®±ï¼‰ï¼Œè€Œ<code>send(new EmailSend($email))</code>åˆ™ä¸ºå‘é€çš„é‚®ä»¶å†…å®¹ï¼Œè¿™é‡Œæ˜¯å°†ä¸€æ•´æ¡<code>email</code>æ•°æ®é›†åˆä½œä¸ºæ•°æ®å‘é€äº†ã€‚</p>
<p>åˆ©ç”¨Markdown æ ¼å¼çš„ Mailable ç±»ï¼Œä¸ºæ¶ˆæ¯ä½“æ¸²æŸ“å‡ºæ¼‚äº®ã€å“åº”å¼çš„ HTML æ¨¡æ¿ï¼Œä¹Ÿèƒ½è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªçº¯æ–‡æœ¬çš„å‰¯æœ¬ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:mail EmailSend --markdown<span class="o">=</span>email.template
</span></span></code></pre></div><p>åœ¨ç”Ÿæˆçš„<code>EmailSend.php</code>ä¸­çš„<code>build()</code>æ–¹æ³•ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">build</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">markdown</span><span class="p">(</span><span class="s1">&#39;email.template&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ—¢ç„¶æ˜¯å‘é€é‚®ä»¶ï¼Œå½“ç„¶éœ€è¦ä¿®æ”¹<code>.env</code>ä¸­å…³äºé‚®ç®±çš„é…ç½®ä¿¡æ¯äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">MAIL_DRIVER</span><span class="o">=</span><span class="nx">smtp</span>
</span></span><span class="line"><span class="cl"><span class="nx">MAIL_HOST</span><span class="o">=</span><span class="nx">smtp</span><span class="o">.</span><span class="nx">qq</span><span class="o">.</span><span class="nx">com</span>
</span></span><span class="line"><span class="cl"><span class="nx">MAIL_PORT</span><span class="o">=</span><span class="mi">587</span>
</span></span><span class="line"><span class="cl"><span class="nx">MAIL_USERNAME</span><span class="o">=</span><span class="nx">xxxxxxx</span><span class="o">@</span><span class="nx">qq</span><span class="o">.</span><span class="nx">com</span><span class="c1">//å‘ä»¶äººé‚®ç®±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">MAIL_FROM_ADDRESS</span><span class="o">=</span><span class="nx">xxxxxxx</span><span class="o">@</span><span class="nx">qq</span><span class="o">.</span><span class="nx">com</span><span class="c1">//è¿™ä¸ªéœ€è¦è‡ªå·±åŠ ä¸Šï¼Œé»˜è®¤æ²¡æœ‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">MAIL_PASSWORD</span><span class="o">=</span><span class="nx">æˆæƒç </span>
</span></span><span class="line"><span class="cl"><span class="nx">MAIL_ENCRYPTION</span><span class="o">=</span><span class="nx">tls</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Supervisoré…ç½®,æ¯æ¬¡éƒ½ä¼šè¸©å¥½å¤šå‘</title>
			<link>https://blog.gookm.cn/posts/2018/20180326-install-supervisor/</link>
			<pubDate>Mon, 26 Mar 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180326-install-supervisor/</guid>
			<description>åŸºæœ¬æ¯æ¬¡éƒ½ä¼šèŠ±å¥½å¤šçš„æ—¶é—´å»è¸©ä¸åŒçš„å‘ï¼Œç´¢æ€§ä»Šå¤©å°±èŠ±ç‚¹æ—¶é—´è®°å½•ä¸‹è¸©çš„å‘å§ï¼
Supervisorï¼ˆhttp://supervisord.org/ï¼‰æ˜¯ç”¨Pythonå¼€å‘çš„ä¸€ä¸ªclient/serveræœåŠ¡ï¼Œæ˜¯Linux/Unixç³»ç»Ÿä¸‹çš„ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œä¸æ”¯æŒWindowsç³»ç»Ÿã€‚å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›‘å¬ã€å¯åŠ¨ã€åœæ­¢ã€é‡å¯ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚ç”¨Supervisorç®¡ç†çš„è¿›ç¨‹ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹æ„å¤–è¢«æ€æ­»ï¼Œsupervisortç›‘å¬åˆ°è¿›ç¨‹æ­»åï¼Œä¼šè‡ªåŠ¨å°†å®ƒé‡æ–°æ‹‰èµ·ï¼Œå¾ˆæ–¹ä¾¿çš„åšåˆ°è¿›ç¨‹è‡ªåŠ¨æ¢å¤çš„åŠŸèƒ½ï¼Œä¸å†éœ€è¦è‡ªå·±å†™shellè„šæœ¬æ¥æ§åˆ¶ã€‚
æ—¢ç„¶æ˜¯ç”¨Pythonå¼€å‘çš„ä¸€ä¸ªclient/serveræœåŠ¡ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©é—´æ¥çš„é€šè¿‡pythonæ¥å®‰è£…supervisor
å®‰è£… å…ˆå®‰è£… Python çš„ easy_installï¼Œå†é€šè¿‡ easy_install å®‰è£… supervisor # yum install python-setuptools # easy_install supervisor é…ç½®æ–‡ä»¶ ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œå¹¶å»ºç«‹ç›¸åº”ç›®å½•ï¼Œç®¡ç† supervisor å¯åŠ¨è¿›ç¨‹ # echo_supervisord_conf &amp;gt; /etc/supervisord.conf # mkdir -p /etc/supervisor/conf.d/ 1 2 ç¼–è¾‘ /etc/supervisord.confï¼Œä¿®æ”¹ [include] åŒºå—å†…å®¹ï¼š [include] files = /etc/supervisor/conf.d/*.conf 1 2 è¿™æ ·ï¼Œ supervisor ä¼šåŠ è½½ /etc/supervisor/conf.d/ ä¸‹çš„æ‰€æœ‰ .conf æ–‡ä»¶ è‡ªåŠ¨å¯åŠ¨ åœ¨ https://github.com/Supervisor/initscripts ä¸‹è½½ CentOS ä½¿ç”¨çš„è‡ªåŠ¨å¯åŠ¨æœåŠ¡è„šæœ¬ centos-systemd-etcs # wget -O /usr/lib/systemd/system/supervisord.service https://github.com/Supervisor/initscripts/raw/master/centos-systemd-etcs å°† supervisord æœåŠ¡è®¾ä¸ºè‡ªå¯åŠ¨ # systemctl enable supervisord.service è¾“å…¥ supervisorctl å‘½ä»¤å¯ä»¥è¿›å…¥ supervisor æ§åˆ¶å° è®¾ç½® Laravel é˜Ÿåˆ— [program:laravel-worker] process_name=%(program_name)s_%(process_num)02d command=/usr/local/php/bin/php /data/wwwroot/app.</description>
			<content type="html"><![CDATA[<p>åŸºæœ¬æ¯æ¬¡éƒ½ä¼šèŠ±å¥½å¤šçš„æ—¶é—´å»è¸©ä¸åŒçš„å‘ï¼Œç´¢æ€§ä»Šå¤©å°±èŠ±ç‚¹æ—¶é—´è®°å½•ä¸‹è¸©çš„å‘å§ï¼</p>
<blockquote>
<p>Supervisorï¼ˆhttp://supervisord.org/ï¼‰æ˜¯ç”¨Pythonå¼€å‘çš„ä¸€ä¸ªclient/serveræœåŠ¡ï¼Œæ˜¯Linux/Unixç³»ç»Ÿä¸‹çš„ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œä¸æ”¯æŒWindowsç³»ç»Ÿã€‚å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›‘å¬ã€å¯åŠ¨ã€åœæ­¢ã€é‡å¯ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚ç”¨Supervisorç®¡ç†çš„è¿›ç¨‹ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹æ„å¤–è¢«æ€æ­»ï¼Œsupervisortç›‘å¬åˆ°è¿›ç¨‹æ­»åï¼Œä¼šè‡ªåŠ¨å°†å®ƒé‡æ–°æ‹‰èµ·ï¼Œå¾ˆæ–¹ä¾¿çš„åšåˆ°è¿›ç¨‹è‡ªåŠ¨æ¢å¤çš„åŠŸèƒ½ï¼Œä¸å†éœ€è¦è‡ªå·±å†™shellè„šæœ¬æ¥æ§åˆ¶ã€‚</p>
</blockquote>
<p>æ—¢ç„¶æ˜¯ç”¨Pythonå¼€å‘çš„ä¸€ä¸ªclient/serveræœåŠ¡ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©é—´æ¥çš„é€šè¿‡pythonæ¥å®‰è£…supervisor</p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å…ˆå®‰è£… Python çš„ easy_installï¼Œå†é€šè¿‡ easy_install å®‰è£… supervisor
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># yum install python-setuptools
</span></span><span class="line"><span class="cl"># easy_install supervisor
</span></span></code></pre></div><h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œå¹¶å»ºç«‹ç›¸åº”ç›®å½•ï¼Œç®¡ç† supervisor å¯åŠ¨è¿›ç¨‹
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"># echo_supervisord_conf &gt; /etc/supervisord.conf
</span></span><span class="line"><span class="cl"># mkdir -p /etc/supervisor/conf.d/
</span></span><span class="line"><span class="cl">1
</span></span><span class="line"><span class="cl">2
</span></span><span class="line"><span class="cl">ç¼–è¾‘ /etc/supervisord.confï¼Œä¿®æ”¹ [include] åŒºå—å†…å®¹ï¼š
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[include]
</span></span><span class="line"><span class="cl">files = /etc/supervisor/conf.d/*.conf
</span></span><span class="line"><span class="cl">1
</span></span><span class="line"><span class="cl">2
</span></span><span class="line"><span class="cl">è¿™æ ·ï¼Œ supervisor ä¼šåŠ è½½ /etc/supervisor/conf.d/ ä¸‹çš„æ‰€æœ‰ .conf æ–‡ä»¶
</span></span></code></pre></div><h3 id="è‡ªåŠ¨å¯åŠ¨">è‡ªåŠ¨å¯åŠ¨</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">åœ¨ https://github.com/Supervisor/initscripts ä¸‹è½½ CentOS ä½¿ç”¨çš„è‡ªåŠ¨å¯åŠ¨æœåŠ¡è„šæœ¬ centos-systemd-etcs
</span></span><span class="line"><span class="cl"># wget -O /usr/lib/systemd/system/supervisord.service  https://github.com/Supervisor/initscripts/raw/master/centos-systemd-etcs
</span></span><span class="line"><span class="cl">å°† supervisord æœåŠ¡è®¾ä¸ºè‡ªå¯åŠ¨
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># systemctl enable supervisord.service
</span></span><span class="line"><span class="cl">è¾“å…¥ supervisorctl å‘½ä»¤å¯ä»¥è¿›å…¥ supervisor æ§åˆ¶å°
</span></span></code></pre></div><h3 id="è®¾ç½®-laravel-é˜Ÿåˆ—">è®¾ç½® Laravel é˜Ÿåˆ—</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[program:laravel-worker]</span>
</span></span><span class="line"><span class="cl"><span class="na">process_name</span><span class="o">=</span><span class="s">%(program_name)s_%(process_num)02d</span>
</span></span><span class="line"><span class="cl"><span class="na">command</span><span class="o">=</span><span class="s">/usr/local/php/bin/php /data/wwwroot/app.com/artisan queue:work database --sleep=3 --tries=3 --daemon</span>
</span></span><span class="line"><span class="cl"><span class="na">autostart</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl"><span class="na">autorestart</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl"><span class="na">user</span><span class="o">=</span><span class="s">www</span>
</span></span><span class="line"><span class="cl"><span class="na">numprocs</span><span class="o">=</span><span class="s">8</span>
</span></span><span class="line"><span class="cl"><span class="na">redirect_stderr</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl"><span class="na">stdout_logfile</span><span class="o">=</span><span class="s">/data/wwwroot/app.com/storage/logs/queue.log</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="na">//æ³¨æ„ï¼šæ£€æŸ¥ä½ çš„phpæ‰€åœ¨ç›®å½•å’Œé¡¹ç›®æ‰€åœ¨ç›®å½•  æ˜¯å¦å¯¹åº”</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="na">è¿™é‡Œå¼€å¯äº† 8 ä¸ª queue:work è¿›ç¨‹ï¼Œå¹¶ç›‘è§†ä»–ä»¬ï¼Œå¦‚æœå¤±è´¥çš„è¯ï¼Œè‡ªåŠ¨é‡å¯ï¼›åœ¨é¡¹ç›®çš„ storage/logs/queue.log è®°å½•æ—¥å¿—ã€‚</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="na">å¯åŠ¨ supervisor æœåŠ¡ï¼š</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># supervisord</span>
</span></span><span class="line"><span class="cl"><span class="na">1</span>
</span></span><span class="line"><span class="cl"><span class="na">è‡³æ­¤ï¼Œ supervisor å®‰è£…åŠ Laravel é˜Ÿåˆ—è®¾ç½®å®Œæ¯•</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="na">å¦‚æœä»¥åé…ç½®æ–‡ä»¶æœ‰ä¿®æ”¹ï¼Œæˆ–è€…æ–°å¢ï¼Œè¿›å…¥ supervisor æ§åˆ¶å°ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># supervisorctl</span>
</span></span><span class="line"><span class="cl"><span class="na">supervisorctl&gt; reread</span>
</span></span><span class="line"><span class="cl"><span class="na">supervisorctl&gt; update</span>
</span></span><span class="line"><span class="cl"><span class="na">supervisorctl&gt; start laravel-worker:*</span>
</span></span></code></pre></div><h3 id="é‡åˆ°çš„ä¸€äº›å‘">é‡åˆ°çš„ä¸€äº›å‘</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.unix:///tmp/supervisor.sock no such fileé—®é¢˜
</span></span><span class="line"><span class="cl">é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶ echo_supervisord_conf&gt; /etc/supervisord.conf
</span></span><span class="line"><span class="cl">æŒ‰ä¸Šé¢æ­¥éª¤ä¿®æ”¹é…ç½®
</span></span><span class="line"><span class="cl">supervisord -c/etc/supervisord.conf
</span></span><span class="line"><span class="cl">è¿˜æœ‰ä¸€ç§è¯´æ³•æ˜¯å°†supervisord.confä¸­çš„/tmp  è¯¥ä¸º/varä¸‹ï¼Œå…·ä½“è¯·çœ‹https://blog.csdn.net/qq_28885149/article/details/79364685
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.laravel-worker-ui:laravel-worker-ui_00   FATAL     can&#39;t find command &#39;/usr/local/php/bin/php&#39;
</span></span><span class="line"><span class="cl">æ£€æŸ¥supervisord.confä¸­çš„phpç›®å½•æ˜¯å¦æ­£ç¡®
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.åœ¨ä½¿ç”¨å‘½ä»¤supervisorctl start allå¯åŠ¨æ§åˆ¶è¿›ç¨‹æ—¶ï¼Œé‡åˆ°å¦‚ä¸‹é”™è¯¯
</span></span><span class="line"><span class="cl">unix:///tmp/supervisor.sock no such file
</span></span><span class="line"><span class="cl">å‡ºç°ä¸Šè¿°é”™è¯¯çš„åŸå› æ˜¯supervisordå¹¶æœªå¯åŠ¨ï¼Œåªè¦åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨å‘½ä»¤supervisordå¯åŠ¨supervisordå³å¯ã€‚
</span></span></code></pre></div><h3 id="ä¸€äº›ç›¸å…³å‘½ä»¤">ä¸€äº›ç›¸å…³å‘½ä»¤</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ã€å¯åŠ¨supervisordã€‘  supervisord  å»ºè®®supervisord -c/etc/supervisord.conf
</span></span><span class="line"><span class="cl">ã€åœæ­¢supervisordã€‘  supervisorctl shutdown
</span></span><span class="line"><span class="cl">ã€é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‘  supervisorctl reload
</span></span><span class="line"><span class="cl">ã€è¿›ç¨‹ç®¡ç†ã€‘
</span></span><span class="line"><span class="cl">1.å¯åŠ¨supervisordç®¡ç†çš„æ‰€æœ‰è¿›ç¨‹
</span></span><span class="line"><span class="cl">  supervisorctl start all
</span></span><span class="line"><span class="cl">2.åœæ­¢supervisordç®¡ç†çš„æ‰€æœ‰è¿›ç¨‹
</span></span><span class="line"><span class="cl">  supervisorctl stop all
</span></span><span class="line"><span class="cl">3.å¯åŠ¨supervisordç®¡ç†çš„æŸä¸€ä¸ªç‰¹å®šè¿›ç¨‹
</span></span><span class="line"><span class="cl">  supervisorctl start program-name // program-nameä¸º[program:xx]ä¸­çš„xx
</span></span><span class="line"><span class="cl">4.åœæ­¢supervisordç®¡ç†çš„æŸä¸€ä¸ªç‰¹å®šè¿›ç¨‹ 
</span></span><span class="line"><span class="cl">  supervisorctl stop program-name  // program-nameä¸º[program:xx]ä¸­çš„xx
</span></span><span class="line"><span class="cl">5.é‡å¯æ‰€æœ‰è¿›ç¨‹æˆ–æ‰€æœ‰è¿›ç¨‹
</span></span><span class="line"><span class="cl">  supervisorctl restart all  // é‡å¯æ‰€æœ‰
</span></span><span class="line"><span class="cl">  supervisorctl reatart program-name // é‡å¯æŸä¸€è¿›ç¨‹ï¼Œprogram-nameä¸º[program:xx]ä¸­çš„xx
</span></span><span class="line"><span class="cl">6.æŸ¥çœ‹supervisordå½“å‰ç®¡ç†çš„æ‰€æœ‰è¿›ç¨‹çš„çŠ¶æ€
</span></span><span class="line"><span class="cl">  supervisorctl status
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>æœ¬åœ°Homesteadå®‰è£…ğŸ˜´</title>
			<link>https://blog.gookm.cn/posts/2018/20180320-install-homestead/</link>
			<pubDate>Tue, 20 Mar 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180320-install-homestead/</guid>
			<description>Homesteadå®‰è£… å®‰è£… VirtualBox å®‰è£… Vagrant å¯¼å…¥ Homestead Box è™šæ‹Ÿæœºç›’å­ å®‰è£… Git å®‰è£… Homestead ç®¡ç†è„šæœ¬ é…ç½® Homestead.yaml æ–‡ä»¶ å¯åŠ¨ Homestead è™šæ‹Ÿæœº å®‰è£… VirtualBox ä¸‹è½½é“¾æ¥ https://pan.baidu.com/s/15ebprpm0HW3lQYxW4T8xPA ä¸€æ­¥ä¸€æ­¥å®‰è£…å³å¯ å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼šç¼ºå°‘isoæ–‡ä»¶ å®‰è£… Vagrant ä¸‹è½½é“¾æ¥ https://pan.baidu.com/s/1yuPDJ_sr7q3MVI0L__-eGA ç„¶åä¸€æ­¥ä¸€æ­¥æŒ‰ç…§é»˜è®¤å®‰è£…å³å¯ã€‚ Homestead ä»‹ç» Homestead åŒ…å«äº†ä¸¤ä¸ªä¸œè¥¿ï¼š
Homestead ç®¡ç†è„šæœ¬ï¼› Homestead Box è™šæ‹Ÿæœºç›’å­ã€‚ ä¸‹è½½é“¾æ¥ https://pan.baidu.com/s/1d5PH0XW_Xw1BwujK58GiCQ
1.å®‰è£…å’Œä½¿ç”¨ Homestead
åœ¨è§£å‹ç›®å½•ä¸­ lt-homestead-3-0-0-2017082400 è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯¼å…¥ Boxï¼š vagrant box add metadata.json 2. å®‰è£… Git
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ£€æµ‹æ˜¯å¦æˆåŠŸå®‰è£…ï¼š git --version git version 2.12.2.windows.2 3. ä¸‹è½½ Homestead ç®¡ç†è„šæœ¬
git clone https://git.coding.net/summerblue/homestead.git Homestead æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆå§‹åŒ– Homesteadï¼šbash init.</description>
			<content type="html"><![CDATA[<h2 id="homesteadå®‰è£…">Homesteadå®‰è£…</h2>
<ol>
<li>å®‰è£… VirtualBox</li>
<li>å®‰è£… Vagrant</li>
<li>å¯¼å…¥ Homestead Box è™šæ‹Ÿæœºç›’å­</li>
<li>å®‰è£… Git</li>
<li>å®‰è£… Homestead ç®¡ç†è„šæœ¬</li>
<li>é…ç½® Homestead.yaml æ–‡ä»¶</li>
<li>å¯åŠ¨ Homestead è™šæ‹Ÿæœº</li>
</ol>
<h3 id="å®‰è£…-virtualbox">å®‰è£… VirtualBox</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ä¸‹è½½é“¾æ¥ https://pan.baidu.com/s/15ebprpm0HW3lQYxW4T8xPA
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¸€æ­¥ä¸€æ­¥å®‰è£…å³å¯
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼šç¼ºå°‘isoæ–‡ä»¶
</span></span></code></pre></div><h3 id="å®‰è£…-vagrant">å®‰è£… Vagrant</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ä¸‹è½½é“¾æ¥ https://pan.baidu.com/s/1yuPDJ_sr7q3MVI0L__-eGA
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ç„¶åä¸€æ­¥ä¸€æ­¥æŒ‰ç…§é»˜è®¤å®‰è£…å³å¯ã€‚
</span></span></code></pre></div><h3 id="homestead-ä»‹ç»">Homestead ä»‹ç»</h3>
<p>Homestead åŒ…å«äº†ä¸¤ä¸ªä¸œè¥¿ï¼š</p>
<ul>
<li>Homestead ç®¡ç†è„šæœ¬ï¼›</li>
<li>Homestead Box è™šæ‹Ÿæœºç›’å­ã€‚</li>
</ul>
<p>ä¸‹è½½é“¾æ¥ <a href="https://pan.baidu.com/s/1d5PH0XW_Xw1BwujK58GiCQ">https://pan.baidu.com/s/1d5PH0XW_Xw1BwujK58GiCQ</a></p>
<p><strong>1.å®‰è£…å’Œä½¿ç”¨ Homestead</strong></p>
<ul>
<li>åœ¨è§£å‹ç›®å½•ä¸­ lt-homestead-3-0-0-2017082400 è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯¼å…¥ Boxï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vagrant box add metadata.json
</span></span></code></pre></div><p><strong>2. å®‰è£… Git</strong></p>
<ul>
<li>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ£€æµ‹æ˜¯å¦æˆåŠŸå®‰è£…ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git --version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git version 2.12.2.windows.2
</span></span></code></pre></div><p><strong>3. ä¸‹è½½ Homestead ç®¡ç†è„šæœ¬</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git clone https://git.coding.net/summerblue/homestead.git Homestead
</span></span></code></pre></div><ul>
<li>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆå§‹åŒ– Homesteadï¼šbash init.sh</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">â‘ è™šæ‹Ÿæœºè®¾ç½®
</span></span><span class="line"><span class="cl">ip: &#34;192.168.10.10&#34;   æˆ– 10.1.1.33
</span></span><span class="line"><span class="cl">ç”Ÿæˆ SSH Keyï¼šssh-keygen -t rsa -C &#34;email@163.com&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¡å…±äº«æ–‡ä»¶å¤¹é…ç½®
</span></span><span class="line"><span class="cl">æˆ‘ä»¬å¯ä»¥é€šè¿‡ folders æ¥æŒ‡æ˜æœ¬æœºè¦æ˜ å°„åˆ° Homestead è™šæ‹Ÿæœºä¸Šçš„æ–‡ä»¶å¤¹ã€‚
</span></span></code></pre></div><ul>
<li>map å¯¹åº”çš„æ˜¯æˆ‘ä»¬æœ¬æœºçš„æ–‡ä»¶å¤¹ï¼Œæ ¼å¼ä¾‹å¦‚ï¼šEï¼š/Homestead/Codeï¼Œä»¥å¼€å‘è€…å®é™…é¡¹ç›®ç›®å½•ä¸ºå‡†ã€‚</li>
<li>to å¯¹åº”çš„æ˜¯ Homestead ä¸Šçš„æ–‡ä»¶å¤¹ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">folders</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">D:/Homestead/code</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/Code</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">sites</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">homestead.app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/Code/Laravel/public</span><span class="w">
</span></span></span></code></pre></div><h3 id="ç™»å½•vagrantå¹¶å®‰è£…laravel">ç™»å½•vagrantå¹¶å®‰è£…laravel</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> ~/Homestead <span class="o">&amp;&amp;</span> vagrant up
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vagrant ssh 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> Code 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">composer create-project --prefer-dist laravel/laravel laravel <span class="s2">&#34;5.5.*&#34;</span>
</span></span></code></pre></div><p>æµè§ˆå™¨è®¿é—®ï¼šlocal.laravel.com</p>
]]></content>
		</item>
		
		<item>
			<title>PHPè®¾è®¡æ¨¡å¼</title>
			<link>https://blog.gookm.cn/posts/2018/20180316-php-mode/</link>
			<pubDate>Fri, 16 Mar 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180316-php-mode/</guid>
			<description>PHP è®¾è®¡æ¨¡å¼
æœ¬å®éªŒå†…å®¹ä»…åšè®¾è®¡æ¨¡å¼çš„ç®€å•ä»‹ç»ï¼Œå¹¶ä¸æ˜¯éå¸¸å®Œæ•´çš„æ€»ç»“æ€§æŠ€æœ¯æ–‡æ¡£ è¿™äº›æ¨¡å¼å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¤§ç±»ã€‚
åˆ›å»ºå‹ åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œåˆ›å»ºå‹è®¾è®¡æ¨¡å¼æ˜¯å¤„ç†å¯¹è±¡åˆ›å»ºæœºåˆ¶çš„è®¾è®¡æ¨¡å¼ï¼Œè¯•å›¾ä»¥é€‚å½“çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ã€‚å¯¹è±¡åˆ›å»ºçš„åŸºæœ¬å½¢å¼å¯èƒ½ä¼šå¸¦æ¥è®¾è®¡é—®é¢˜ï¼Œäº¦æˆ–å¢åŠ äº†è®¾è®¡çš„å¤æ‚åº¦ã€‚åˆ›å»ºå‹è®¾è®¡æ¨¡å¼é€šè¿‡æ§åˆ¶è¿™ä¸ªå¯¹è±¡çš„åˆ›å»ºæ–¹å¼æ¥è§£å†³æ­¤é—®é¢˜ã€‚
ç»“æ„å‹ åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œç»“æ„å‹è®¾è®¡æ¨¡å¼æ˜¯é€šè¿‡è¯†åˆ«å®ä½“ä¹‹é—´å…³ç³»æ¥ç®€åŒ–è®¾è®¡çš„è®¾è®¡æ¨¡å¼ã€‚
è¡Œä¸ºå‹ åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œè¡Œä¸ºè®¾è®¡æ¨¡å¼æ˜¯è¯†åˆ«å¯¹è±¡ä¹‹é—´çš„é€šç”¨é€šä¿¡æ¨¡å¼å¹¶å®ç°è¿™äº›æ¨¡å¼çš„è®¾è®¡æ¨¡å¼ã€‚ é€šè¿‡è¿™æ ·åšï¼Œè¿™äº›æ¨¡å¼å¢åŠ äº†æ‰§è¡Œæ­¤é€šä¿¡çš„çµæ´»æ€§ã€‚
åˆ›å»ºå‹ æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰ ç›®çš„ï¼šåœ¨ä¸æŒ‡å®šå…·ä½“ç±»çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ä¾èµ–å¯¹è±¡ã€‚ é€šå¸¸åˆ›å»ºçš„ç±»éƒ½å®ç°ç›¸åŒçš„æ¥å£ã€‚ æŠ½è±¡å·¥å‚çš„å®¢æˆ·å¹¶ä¸å…³å¿ƒè¿™äº›å¯¹è±¡æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œå®ƒåªæ˜¯çŸ¥é“å®ƒä»¬æ˜¯å¦‚ä½•ä¸€èµ·è¿è¡Œçš„ã€‚ å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰ ç›®çš„ï¼šå»ºé€ è€…æ˜¯åˆ›å»ºä¸€ä¸ªå¤æ‚å¯¹è±¡çš„ä¸€éƒ¨åˆ†æ¥å£ã€‚ æœ‰æ—¶å€™ï¼Œå¦‚æœå»ºé€ è€…å¯¹ä»–æ‰€åˆ›å»ºçš„ä¸œè¥¿æ‹¥æœ‰è¾ƒå¥½çš„çŸ¥è¯†å‚¨å¤‡ï¼Œè¿™ä¸ªæ¥å£å°±å¯èƒ½æˆä¸ºä¸€ä¸ªæœ‰é»˜è®¤æ–¹æ³•çš„æŠ½è±¡ç±»ï¼ˆåˆç§°ä¸ºé€‚é…å™¨ï¼‰ã€‚ å¦‚æœå¯¹è±¡æœ‰å¤æ‚çš„ç»§æ‰¿æ ‘ï¼Œé‚£ä¹ˆå¯¹äºå»ºé€ è€…æ¥è¯´ï¼Œæœ‰ä¸€ä¸ªå¤æ‚ç»§æ‰¿æ ‘ä¹Ÿæ˜¯ç¬¦åˆé€»è¾‘çš„ã€‚ æ³¨æ„ï¼šå»ºé€ è€…é€šå¸¸æœ‰ä¸€ä¸ªã€Œæµå¼æ¥å£ã€ï¼Œä¾‹å¦‚ PHPUnit æ¨¡æ‹Ÿç”Ÿæˆå™¨ã€‚ å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰ ç›®çš„ï¼šå¯¹æ¯”ç®€å•å·¥å‚æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œæ‚¨å¯ä»¥å°†å…¶å­ç±»ç”¨ä¸åŒçš„æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚ ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿™ä¸ªæŠ½è±¡ç±»å¯èƒ½åªæ˜¯ä¸€ä¸ªæ¥å£ã€‚ è¿™ç§æ¨¡å¼æ˜¯ã€ŒçœŸæ­£ã€çš„è®¾è®¡æ¨¡å¼ï¼Œ å› ä¸ºä»–å®ç°äº†S.O.L.I.DåŸåˆ™ä¸­ã€ŒDã€çš„ ã€Œä¾èµ–å€’ç½®ã€ã€‚ è¿™æ„å‘³ç€å·¥å‚æ–¹æ³•æ¨¡å¼å–å†³äºæŠ½è±¡ç±»ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ç±»ã€‚ è¿™æ˜¯ä¸ç®€å•å·¥å‚æ¨¡å¼å’Œé™æ€å·¥å‚æ¨¡å¼ç›¸æ¯”çš„ä¼˜åŠ¿ã€‚ SOLIDåŸåˆ™ å•ä¸€èŒè´£åŸåˆ™SRP:ä¸€ä¸ªç±»åº”è¯¥æœ‰ä¸”åªæœ‰ä¸€ä¸ªå»æ”¹å˜å®ƒçš„ç†ç”±ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€é¡¹å·¥ä½œ; å¼€æ”¾å°é—­åŸåˆ™OCP:å¯¹è±¡æˆ–å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­; æ›¿æ¢åŸåˆ™LSP:åœ¨å¯¹è±¡xä¸ºç±»å‹Tæ—¶q(x)æˆç«‹,é‚£ä¹ˆå½“Sæ˜¯Tçš„å­ç±»æ—¶,å¯¹è±¡yä¸ºç±»å‹Sæ—¶q(y)ä¹Ÿåº”æˆç«‹(å³å¯¹çˆ¶ç±»çš„è°ƒç”¨åŒæ ·é€‚ç”¨äºå­ç±»); æ¥å£åˆ†ç¦»åŸåˆ™ISP:ä¸åº”å¼ºè¿«å®¢æˆ·ç«¯å®ç°ä¸€ä¸ªå®ƒç”¨ä¸ä¸Šçš„æ¥å£ï¼Œæˆ–æ˜¯è¯´å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–å®ƒä»¬ä¸ä½¿ç”¨çš„æ–¹æ³•; ä¾èµ–å€’ç½®åŸåˆ™DIP:å®ä½“å¿…é¡»ä¾é æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°ã€‚å®ƒè¡¨ç¤ºé«˜å±‚æ¬¡çš„æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¬¡çš„æ¨¡å—ï¼Œå®ƒä»¬éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡; é™¤SOLIDåŸåˆ™å¤–è¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„é¢å‘å¯¹è±¡åŸåˆ™ã€‚å¦‚ï¼š &amp;#34;ç»„åˆæ›¿ä»£ç»§æ‰¿&amp;#34;:è¿™æ˜¯è¯´ç›¸å¯¹äºç»§æ‰¿ï¼Œè¦æ›´å€¾å‘äºä½¿ç”¨ç»„åˆï¼› &amp;#34;ç¬›ç±³ç‰¹æ³•åˆ™&amp;#34;ï¼šè¿™æ˜¯è¯´&amp;#34;ä½ çš„ç±»å¯¹å…¶å®ƒç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½&amp;#34;ï¼› &amp;#34;å…±åŒå°é—­åŸåˆ™&amp;#34;ï¼šè¿™æ˜¯è¯´&amp;#34;ç›¸å…³ç±»åº”è¯¥æ‰“åŒ…åœ¨ä¸€èµ·&amp;#34;ï¼› &amp;#34;ç¨³å®šæŠ½è±¡åŸåˆ™&amp;#34;ï¼šè¿™æ˜¯è¯´&amp;#34;ç±»è¶Šç¨³å®šï¼Œè¶Šåº”è¯¥ç”±æŠ½è±¡ç±»ç»„æˆ&amp;#34;; å¤šä¾‹æ¨¡å¼ï¼ˆMultitonï¼‰ å¤šä¾‹æ¨¡å¼è¢«å…¬è®¤ä¸ºæ˜¯ åé¢æ¨¡å¼ï¼Œä¸ºäº†è·å¾—æ›´å¥½çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¯·ä½¿ç”¨ã€ä¾èµ–æ³¨å…¥æ¨¡å¼ã€ã€‚
ç›®çš„ï¼šå¤šä¾‹æ¨¡å¼æ˜¯æŒ‡å­˜åœ¨ä¸€ä¸ªç±»æœ‰å¤šä¸ªç›¸åŒå®ä¾‹ï¼Œè€Œä¸”è¯¥å®ä¾‹éƒ½æ˜¯è¯¥ç±»æœ¬èº«ã€‚è¿™ä¸ªç±»å«åšå¤šä¾‹ç±»ã€‚ å¤šä¾‹æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯ï¼š å¤šä¾‹ç±»å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ã€‚ å¤šä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºã€ç®¡ç†è‡ªå·±çš„å®ä¾‹ï¼Œå¹¶å‘å¤–ç•Œæä¾›è‡ªå·±çš„å®ä¾‹ã€‚ å¤šä¾‹æ¨¡å¼å®é™…ä¸Šå°±æ˜¯å•ä¾‹æ¨¡å¼çš„æ¨å¹¿ ä¸¾ä¾‹ï¼š 1.2ä¸ªæ•°æ®åº“è¿æ¥å™¨ï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ MySQL ï¼Œå¦ä¸€ä¸ªæ˜¯ SQLite 2.å¤šä¸ªè®°å½•å™¨ï¼ˆä¸€ä¸ªç”¨äºè®°å½•è°ƒè¯•æ¶ˆæ¯ï¼Œä¸€ä¸ªç”¨äºè®°å½•é”™è¯¯ï¼‰ å¯¹è±¡æ± æ¨¡å¼ï¼ˆPoolï¼‰ ç›®çš„ï¼šå¯¹è±¡æ± æ¨¡å¼æ˜¯ä¸€ç§æå‰å‡†å¤‡äº†ä¸€ç»„å·²ç»åˆå§‹åŒ–äº†çš„å¯¹è±¡ã€æ± ã€è€Œä¸æ˜¯æŒ‰éœ€åˆ›å»ºæˆ–è€…é”€æ¯çš„åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ã€‚ å¯¹è±¡æ± çš„å®¢æˆ·ç«¯ä¼šå‘å¯¹è±¡æ± ä¸­è¯·æ±‚ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªè¿”å›çš„å¯¹è±¡æ‰§è¡Œç›¸å…³æ“ä½œã€‚å½“å®¢æˆ·ç«¯ä½¿ç”¨å®Œæ¯•ï¼Œ å®ƒå°†æŠŠè¿™ä¸ªç‰¹å®šç±»å‹çš„å·¥å‚å¯¹è±¡è¿”å›ç»™å¯¹è±¡æ± ï¼Œè€Œä¸æ˜¯é”€æ¯æ‰è¿™ä¸ªå¯¹è±¡ã€‚ åœ¨åˆå§‹åŒ–å®ä¾‹æˆæœ¬é«˜ï¼Œå®ä¾‹åŒ–ç‡é«˜ï¼Œå¯ç”¨å®ä¾‹ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œå¯¹è±¡æ± å¯ä»¥æå¤§åœ°æå‡æ€§èƒ½ã€‚ åœ¨åˆ›å»ºå¯¹è±¡ï¼ˆå°¤å…¶æ˜¯é€šè¿‡ç½‘ç»œï¼‰æ—¶é—´èŠ±é”€ä¸ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å¯¹è±¡æ± åœ¨å¯æœŸæ—¶é—´å†…å°±å¯ä»¥è·å¾—æ‰€éœ€çš„å¯¹è±¡ã€‚ æ— è®ºå¦‚ä½•ï¼Œå¯¹è±¡æ± æ¨¡å¼åœ¨éœ€è¦è€—æ—¶åˆ›å»ºå¯¹è±¡æ–¹é¢ï¼Œä¾‹å¦‚åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œå¥—æ¥å­—è¿æ¥ï¼Œçº¿ç¨‹å’Œå¤§å‹å›¾å½¢å¯¹è±¡ï¼ˆæ¯”æ–¹å­—ä½“æˆ–ä½å›¾ç­‰ï¼‰ï¼Œ ä½¿ç”¨èµ·æ¥éƒ½æ˜¯å¤§æœ‰è£¨ç›Šçš„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç®€å•çš„å¯¹è±¡æ± ï¼ˆæ— å¤–éƒ¨èµ„æºï¼Œåªå å†…å­˜ï¼‰å¯èƒ½æ•ˆç‡ä¸é«˜ï¼Œç”šè‡³ä¼šæœ‰æŸæ€§èƒ½ã€‚ åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰ ç›®çš„ï¼šç›¸æ¯”æ­£å¸¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ ( new Foo() )ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸå‹ï¼Œç„¶åå…‹éš†å®ƒä¼šæ›´èŠ‚çœå¼€é”€ã€‚ ç¤ºä¾‹ï¼šå¤§æ•°æ®é‡ ( ä¾‹å¦‚ï¼šé€šè¿‡ ORM æ¨¡å‹ä¸€æ¬¡æ€§å¾€æ•°æ®åº“æ’å…¥ 1,000,000 æ¡æ•°æ® ) ã€‚ ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factoryï¼‰ ç›®çš„ï¼šç®€å•å·¥å‚æ¨¡å¼æ˜¯ä¸€ä¸ªç²¾ç®€ç‰ˆçš„å·¥å‚æ¨¡å¼ã€‚ å®ƒä¸é™æ€å·¥å‚æ¨¡å¼æœ€å¤§çš„åŒºåˆ«æ˜¯å®ƒä¸æ˜¯ã€é™æ€ã€çš„ã€‚å› ä¸ºéé™æ€ï¼Œæ‰€ä»¥ä½ å¯ä»¥æ‹¥æœ‰å¤šä¸ªä¸åŒå‚æ•°çš„å·¥å‚ï¼Œä½ å¯ä»¥ä¸ºå…¶åˆ›å»ºå­ç±»ã€‚ ç”šè‡³å¯ä»¥æ¨¡æ‹Ÿï¼ˆMockï¼‰ä»–ï¼Œè¿™å¯¹ç¼–å†™å¯æµ‹è¯•çš„ä»£ç æ¥è®²è‡³å…³é‡è¦ã€‚ è¿™ä¹Ÿæ˜¯å®ƒæ¯”é™æ€å·¥å‚æ¨¡å¼å—æ¬¢è¿çš„åŸå›  å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰ å•ä¾‹æ¨¡å¼è¢«å…¬è®¤ä¸ºæ˜¯ åé¢æ¨¡å¼ï¼Œä¸ºäº†è·å¾—æ›´å¥½çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¯·ä½¿ç”¨ã€ä¾èµ–æ³¨å…¥æ¨¡å¼ã€ã€‚</description>
			<content type="html"><![CDATA[<p><strong>PHP è®¾è®¡æ¨¡å¼</strong></p>
<p><strong>æœ¬å®éªŒå†…å®¹ä»…åšè®¾è®¡æ¨¡å¼çš„ç®€å•ä»‹ç»ï¼Œå¹¶ä¸æ˜¯éå¸¸å®Œæ•´çš„æ€»ç»“æ€§æŠ€æœ¯æ–‡æ¡£</strong>
è¿™äº›æ¨¡å¼å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¤§ç±»ã€‚</p>
<ol>
<li>åˆ›å»ºå‹</li>
</ol>
<p>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œåˆ›å»ºå‹è®¾è®¡æ¨¡å¼æ˜¯å¤„ç†å¯¹è±¡åˆ›å»ºæœºåˆ¶çš„è®¾è®¡æ¨¡å¼ï¼Œè¯•å›¾ä»¥é€‚å½“çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ã€‚å¯¹è±¡åˆ›å»ºçš„åŸºæœ¬å½¢å¼å¯èƒ½ä¼šå¸¦æ¥è®¾è®¡é—®é¢˜ï¼Œäº¦æˆ–å¢åŠ äº†è®¾è®¡çš„å¤æ‚åº¦ã€‚åˆ›å»ºå‹è®¾è®¡æ¨¡å¼é€šè¿‡æ§åˆ¶è¿™ä¸ªå¯¹è±¡çš„åˆ›å»ºæ–¹å¼æ¥è§£å†³æ­¤é—®é¢˜ã€‚</p>
<ol start="2">
<li>ç»“æ„å‹</li>
</ol>
<p>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œç»“æ„å‹è®¾è®¡æ¨¡å¼æ˜¯é€šè¿‡è¯†åˆ«å®ä½“ä¹‹é—´å…³ç³»æ¥ç®€åŒ–è®¾è®¡çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<ol start="3">
<li>è¡Œä¸ºå‹</li>
</ol>
<p>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œè¡Œä¸ºè®¾è®¡æ¨¡å¼æ˜¯è¯†åˆ«å¯¹è±¡ä¹‹é—´çš„é€šç”¨é€šä¿¡æ¨¡å¼å¹¶å®ç°è¿™äº›æ¨¡å¼çš„è®¾è®¡æ¨¡å¼ã€‚ é€šè¿‡è¿™æ ·åšï¼Œè¿™äº›æ¨¡å¼å¢åŠ äº†æ‰§è¡Œæ­¤é€šä¿¡çš„çµæ´»æ€§ã€‚</p>
<h3 id="åˆ›å»ºå‹">åˆ›å»ºå‹</h3>
<ul>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šåœ¨ä¸æŒ‡å®šå…·ä½“ç±»çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ä¾èµ–å¯¹è±¡ã€‚ é€šå¸¸åˆ›å»ºçš„ç±»éƒ½å®ç°ç›¸åŒçš„æ¥å£ã€‚
</span></span><span class="line"><span class="cl">æŠ½è±¡å·¥å‚çš„å®¢æˆ·å¹¶ä¸å…³å¿ƒè¿™äº›å¯¹è±¡æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œå®ƒåªæ˜¯çŸ¥é“å®ƒä»¬æ˜¯å¦‚ä½•ä¸€èµ·è¿è¡Œçš„ã€‚
</span></span></code></pre></div><ul>
<li>å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå»ºé€ è€…æ˜¯åˆ›å»ºä¸€ä¸ªå¤æ‚å¯¹è±¡çš„ä¸€éƒ¨åˆ†æ¥å£ã€‚
</span></span><span class="line"><span class="cl">æœ‰æ—¶å€™ï¼Œå¦‚æœå»ºé€ è€…å¯¹ä»–æ‰€åˆ›å»ºçš„ä¸œè¥¿æ‹¥æœ‰è¾ƒå¥½çš„çŸ¥è¯†å‚¨å¤‡ï¼Œè¿™ä¸ªæ¥å£å°±å¯èƒ½æˆä¸ºä¸€ä¸ªæœ‰é»˜è®¤æ–¹æ³•çš„æŠ½è±¡ç±»ï¼ˆåˆç§°ä¸ºé€‚é…å™¨ï¼‰ã€‚
</span></span><span class="line"><span class="cl">å¦‚æœå¯¹è±¡æœ‰å¤æ‚çš„ç»§æ‰¿æ ‘ï¼Œé‚£ä¹ˆå¯¹äºå»ºé€ è€…æ¥è¯´ï¼Œæœ‰ä¸€ä¸ªå¤æ‚ç»§æ‰¿æ ‘ä¹Ÿæ˜¯ç¬¦åˆé€»è¾‘çš„ã€‚
</span></span><span class="line"><span class="cl">æ³¨æ„ï¼šå»ºé€ è€…é€šå¸¸æœ‰ä¸€ä¸ªã€Œæµå¼æ¥å£ã€ï¼Œä¾‹å¦‚ PHPUnit æ¨¡æ‹Ÿç”Ÿæˆå™¨ã€‚
</span></span></code></pre></div><ul>
<li>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå¯¹æ¯”ç®€å•å·¥å‚æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œæ‚¨å¯ä»¥å°†å…¶å­ç±»ç”¨ä¸åŒçš„æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚
</span></span><span class="line"><span class="cl">ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿™ä¸ªæŠ½è±¡ç±»å¯èƒ½åªæ˜¯ä¸€ä¸ªæ¥å£ã€‚
</span></span><span class="line"><span class="cl">è¿™ç§æ¨¡å¼æ˜¯ã€ŒçœŸæ­£ã€çš„è®¾è®¡æ¨¡å¼ï¼Œ å› ä¸ºä»–å®ç°äº†S.O.L.I.DåŸåˆ™ä¸­ã€ŒDã€çš„ ã€Œä¾èµ–å€’ç½®ã€ã€‚
</span></span><span class="line"><span class="cl">è¿™æ„å‘³ç€å·¥å‚æ–¹æ³•æ¨¡å¼å–å†³äºæŠ½è±¡ç±»ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ç±»ã€‚ è¿™æ˜¯ä¸ç®€å•å·¥å‚æ¨¡å¼å’Œé™æ€å·¥å‚æ¨¡å¼ç›¸æ¯”çš„ä¼˜åŠ¿ã€‚
</span></span></code></pre></div><ul>
<li>SOLIDåŸåˆ™</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å•ä¸€èŒè´£åŸåˆ™SRP:ä¸€ä¸ªç±»åº”è¯¥æœ‰ä¸”åªæœ‰ä¸€ä¸ªå»æ”¹å˜å®ƒçš„ç†ç”±ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€é¡¹å·¥ä½œ;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¼€æ”¾å°é—­åŸåˆ™OCP:å¯¹è±¡æˆ–å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ›¿æ¢åŸåˆ™LSP:åœ¨å¯¹è±¡xä¸ºç±»å‹Tæ—¶q(x)æˆç«‹,é‚£ä¹ˆå½“Sæ˜¯Tçš„å­ç±»æ—¶,å¯¹è±¡yä¸ºç±»å‹Sæ—¶q(y)ä¹Ÿåº”æˆç«‹(å³å¯¹çˆ¶ç±»çš„è°ƒç”¨åŒæ ·é€‚ç”¨äºå­ç±»);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ¥å£åˆ†ç¦»åŸåˆ™ISP:ä¸åº”å¼ºè¿«å®¢æˆ·ç«¯å®ç°ä¸€ä¸ªå®ƒç”¨ä¸ä¸Šçš„æ¥å£ï¼Œæˆ–æ˜¯è¯´å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–å®ƒä»¬ä¸ä½¿ç”¨çš„æ–¹æ³•;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¾èµ–å€’ç½®åŸåˆ™DIP:å®ä½“å¿…é¡»ä¾é æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°ã€‚å®ƒè¡¨ç¤ºé«˜å±‚æ¬¡çš„æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¬¡çš„æ¨¡å—ï¼Œå®ƒä»¬éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡;
</span></span></code></pre></div><ul>
<li>é™¤SOLIDåŸåˆ™å¤–è¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„é¢å‘å¯¹è±¡åŸåˆ™ã€‚å¦‚ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">&#34;ç»„åˆæ›¿ä»£ç»§æ‰¿&#34;:è¿™æ˜¯è¯´ç›¸å¯¹äºç»§æ‰¿ï¼Œè¦æ›´å€¾å‘äºä½¿ç”¨ç»„åˆï¼›
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;ç¬›ç±³ç‰¹æ³•åˆ™&#34;ï¼šè¿™æ˜¯è¯´&#34;ä½ çš„ç±»å¯¹å…¶å®ƒç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½&#34;ï¼›
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;å…±åŒå°é—­åŸåˆ™&#34;ï¼šè¿™æ˜¯è¯´&#34;ç›¸å…³ç±»åº”è¯¥æ‰“åŒ…åœ¨ä¸€èµ·&#34;ï¼›
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;ç¨³å®šæŠ½è±¡åŸåˆ™&#34;ï¼šè¿™æ˜¯è¯´&#34;ç±»è¶Šç¨³å®šï¼Œè¶Šåº”è¯¥ç”±æŠ½è±¡ç±»ç»„æˆ&#34;;
</span></span></code></pre></div><ul>
<li>å¤šä¾‹æ¨¡å¼ï¼ˆMultitonï¼‰</li>
</ul>
<blockquote>
<p>å¤šä¾‹æ¨¡å¼è¢«å…¬è®¤ä¸ºæ˜¯ åé¢æ¨¡å¼ï¼Œä¸ºäº†è·å¾—æ›´å¥½çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¯·ä½¿ç”¨ã€ä¾èµ–æ³¨å…¥æ¨¡å¼ã€ã€‚</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå¤šä¾‹æ¨¡å¼æ˜¯æŒ‡å­˜åœ¨ä¸€ä¸ªç±»æœ‰å¤šä¸ªç›¸åŒå®ä¾‹ï¼Œè€Œä¸”è¯¥å®ä¾‹éƒ½æ˜¯è¯¥ç±»æœ¬èº«ã€‚è¿™ä¸ªç±»å«åšå¤šä¾‹ç±»ã€‚ å¤šä¾‹æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯ï¼š
</span></span><span class="line"><span class="cl">å¤šä¾‹ç±»å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ã€‚
</span></span><span class="line"><span class="cl">å¤šä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºã€ç®¡ç†è‡ªå·±çš„å®ä¾‹ï¼Œå¹¶å‘å¤–ç•Œæä¾›è‡ªå·±çš„å®ä¾‹ã€‚
</span></span><span class="line"><span class="cl">å¤šä¾‹æ¨¡å¼å®é™…ä¸Šå°±æ˜¯å•ä¾‹æ¨¡å¼çš„æ¨å¹¿
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¸¾ä¾‹ï¼š
</span></span><span class="line"><span class="cl">1.2ä¸ªæ•°æ®åº“è¿æ¥å™¨ï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ MySQL ï¼Œå¦ä¸€ä¸ªæ˜¯ SQLite
</span></span><span class="line"><span class="cl">2.å¤šä¸ªè®°å½•å™¨ï¼ˆä¸€ä¸ªç”¨äºè®°å½•è°ƒè¯•æ¶ˆæ¯ï¼Œä¸€ä¸ªç”¨äºè®°å½•é”™è¯¯ï¼‰
</span></span></code></pre></div><ul>
<li>å¯¹è±¡æ± æ¨¡å¼ï¼ˆPoolï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå¯¹è±¡æ± æ¨¡å¼æ˜¯ä¸€ç§æå‰å‡†å¤‡äº†ä¸€ç»„å·²ç»åˆå§‹åŒ–äº†çš„å¯¹è±¡ã€æ± ã€è€Œä¸æ˜¯æŒ‰éœ€åˆ›å»ºæˆ–è€…é”€æ¯çš„åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ã€‚
</span></span><span class="line"><span class="cl">å¯¹è±¡æ± çš„å®¢æˆ·ç«¯ä¼šå‘å¯¹è±¡æ± ä¸­è¯·æ±‚ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªè¿”å›çš„å¯¹è±¡æ‰§è¡Œç›¸å…³æ“ä½œã€‚å½“å®¢æˆ·ç«¯ä½¿ç”¨å®Œæ¯•ï¼Œ
</span></span><span class="line"><span class="cl">å®ƒå°†æŠŠè¿™ä¸ªç‰¹å®šç±»å‹çš„å·¥å‚å¯¹è±¡è¿”å›ç»™å¯¹è±¡æ± ï¼Œè€Œä¸æ˜¯é”€æ¯æ‰è¿™ä¸ªå¯¹è±¡ã€‚
</span></span><span class="line"><span class="cl">åœ¨åˆå§‹åŒ–å®ä¾‹æˆæœ¬é«˜ï¼Œå®ä¾‹åŒ–ç‡é«˜ï¼Œå¯ç”¨å®ä¾‹ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œå¯¹è±¡æ± å¯ä»¥æå¤§åœ°æå‡æ€§èƒ½ã€‚
</span></span><span class="line"><span class="cl">åœ¨åˆ›å»ºå¯¹è±¡ï¼ˆå°¤å…¶æ˜¯é€šè¿‡ç½‘ç»œï¼‰æ—¶é—´èŠ±é”€ä¸ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å¯¹è±¡æ± åœ¨å¯æœŸæ—¶é—´å†…å°±å¯ä»¥è·å¾—æ‰€éœ€çš„å¯¹è±¡ã€‚
</span></span><span class="line"><span class="cl">æ— è®ºå¦‚ä½•ï¼Œå¯¹è±¡æ± æ¨¡å¼åœ¨éœ€è¦è€—æ—¶åˆ›å»ºå¯¹è±¡æ–¹é¢ï¼Œä¾‹å¦‚åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œå¥—æ¥å­—è¿æ¥ï¼Œçº¿ç¨‹å’Œå¤§å‹å›¾å½¢å¯¹è±¡ï¼ˆæ¯”æ–¹å­—ä½“æˆ–ä½å›¾ç­‰ï¼‰ï¼Œ
</span></span><span class="line"><span class="cl">ä½¿ç”¨èµ·æ¥éƒ½æ˜¯å¤§æœ‰è£¨ç›Šçš„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç®€å•çš„å¯¹è±¡æ± ï¼ˆæ— å¤–éƒ¨èµ„æºï¼Œåªå å†…å­˜ï¼‰å¯èƒ½æ•ˆç‡ä¸é«˜ï¼Œç”šè‡³ä¼šæœ‰æŸæ€§èƒ½ã€‚
</span></span></code></pre></div><ul>
<li>åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šç›¸æ¯”æ­£å¸¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ ( new Foo() )ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸå‹ï¼Œç„¶åå…‹éš†å®ƒä¼šæ›´èŠ‚çœå¼€é”€ã€‚
</span></span><span class="line"><span class="cl">ç¤ºä¾‹ï¼šå¤§æ•°æ®é‡ ( ä¾‹å¦‚ï¼šé€šè¿‡ ORM æ¨¡å‹ä¸€æ¬¡æ€§å¾€æ•°æ®åº“æ’å…¥ 1,000,000 æ¡æ•°æ® ) ã€‚
</span></span></code></pre></div><ul>
<li>ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factoryï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šç®€å•å·¥å‚æ¨¡å¼æ˜¯ä¸€ä¸ªç²¾ç®€ç‰ˆçš„å·¥å‚æ¨¡å¼ã€‚
</span></span><span class="line"><span class="cl">å®ƒä¸é™æ€å·¥å‚æ¨¡å¼æœ€å¤§çš„åŒºåˆ«æ˜¯å®ƒä¸æ˜¯ã€é™æ€ã€çš„ã€‚å› ä¸ºéé™æ€ï¼Œæ‰€ä»¥ä½ å¯ä»¥æ‹¥æœ‰å¤šä¸ªä¸åŒå‚æ•°çš„å·¥å‚ï¼Œä½ å¯ä»¥ä¸ºå…¶åˆ›å»ºå­ç±»ã€‚
</span></span><span class="line"><span class="cl">ç”šè‡³å¯ä»¥æ¨¡æ‹Ÿï¼ˆMockï¼‰ä»–ï¼Œè¿™å¯¹ç¼–å†™å¯æµ‹è¯•çš„ä»£ç æ¥è®²è‡³å…³é‡è¦ã€‚ è¿™ä¹Ÿæ˜¯å®ƒæ¯”é™æ€å·¥å‚æ¨¡å¼å—æ¬¢è¿çš„åŸå› 
</span></span></code></pre></div><ul>
<li>å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰</li>
</ul>
<blockquote>
<p>å•ä¾‹æ¨¡å¼è¢«å…¬è®¤ä¸ºæ˜¯ åé¢æ¨¡å¼ï¼Œä¸ºäº†è·å¾—æ›´å¥½çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¯·ä½¿ç”¨ã€ä¾èµ–æ³¨å…¥æ¨¡å¼ã€ã€‚</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šåœ¨åº”ç”¨ç¨‹åºè°ƒç”¨çš„æ—¶å€™ï¼Œåªèƒ½è·å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">æ•°æ®åº“è¿æ¥
</span></span><span class="line"><span class="cl">æ—¥å¿— (å¤šç§ä¸åŒç”¨é€”çš„æ—¥å¿—ä¹Ÿå¯èƒ½ä¼šæˆä¸ºå¤šä¾‹æ¨¡å¼)
</span></span><span class="line"><span class="cl">åœ¨åº”ç”¨ä¸­é”å®šæ–‡ä»¶ (ç³»ç»Ÿä¸­åªå­˜åœ¨ä¸€ä¸ª ...)
</span></span></code></pre></div><ul>
<li>é™æ€å·¥å‚æ¨¡å¼ï¼ˆStatic Factoryï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šä¸æŠ½è±¡å·¥å‚æ¨¡å¼ç±»ä¼¼ï¼Œæ­¤æ¨¡å¼ç”¨äºåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„å¯¹è±¡ã€‚ ã€é™æ€å·¥å‚æ¨¡å¼ã€ä¸ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€çš„åŒºåˆ«åœ¨äºï¼Œ
</span></span><span class="line"><span class="cl">    åªä½¿ç”¨ä¸€ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºæ‰€æœ‰ç±»å‹å¯¹è±¡ï¼Œ æ­¤æ–¹æ³•é€šå¸¸è¢«å‘½åä¸º factory æˆ– buildã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­:Zend Framework: Zend_Cache_Backend æˆ– _Frontend ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºç¼“å­˜åç«¯æˆ–å‰ç«¯ï¼›
</span></span></code></pre></div><h3 id="ç»“æ„å‹">ç»“æ„å‹</h3>
<ul>
<li>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå¯åº”ç”¨çš„å…¼å®¹æ¥å£ã€‚é€‚é…å™¨ä½¿åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">å®¢æˆ·ç«¯æ•°æ®åº“é€‚é…å™¨ï¼›
</span></span><span class="line"><span class="cl">ä½¿ç”¨å¤šä¸ªä¸åŒçš„ç½‘ç»œæœåŠ¡å’Œé€‚é…å™¨æ¥è§„èŒƒæ•°æ®ä½¿å¾—å‡ºç»“æœæ˜¯ç›¸åŒçš„ï¼›
</span></span></code></pre></div><ul>
<li>æ¡¥æ¢æ¨¡å¼ï¼ˆBridgeï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œè¿™æ ·ä¸¤è€…å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼šSymfony å­¦æœ¯æ¡¥æ¢
</span></span></code></pre></div><ul>
<li>ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šä¸€ç»„å¯¹è±¡ä¸è¯¥å¯¹è±¡çš„å•ä¸ªå®ä¾‹çš„å¤„ç†æ–¹å¼ä¸€è‡´ã€‚
</span></span><span class="line"><span class="cl">ç¤ºä¾‹ï¼š
</span></span><span class="line"><span class="cl">ä¸€ä¸ªè¡¨å•ç±»å®ä¾‹åœ¨å¤„ç†å…¶è¡¨å•æ‰€æœ‰å…ƒç´ çš„æ–¹æ³•ä¸å¤„ç†è¯¥è¡¨å•è‡ªèº«å®ä¾‹æ–¹æ³•ç›¸åŒï¼Œåœ¨è°ƒç”¨æ–¹æ³• render() æ—¶ï¼Œ
</span></span><span class="line"><span class="cl">ä¼šéšä¹‹éå†å®ƒçš„æ‰€æœ‰å­å…ƒç´ å¹¶å¯¹ä»–ä»¬è°ƒç”¨ render() æ–¹æ³•ï¼›
</span></span><span class="line"><span class="cl">Zend_Config: ä¸€ä¸ªé…ç½®é€‰é¡¹æ ‘ï¼Œæ¯ä¸ªé€‰é¡¹è‡ªèº«å°±æ˜¯ä¸€ä¸ª Zend_Config å¯¹è±¡ï¼›
</span></span></code></pre></div><ul>
<li>æ•°æ®æ˜ å°„æ¨¡å¼ï¼ˆData Mapperï¼‰</li>
</ul>
<pre tabindex="0"><code>ç›®æ ‡ï¼šæ•°æ®æ˜ å°„å™¨æ˜¯ä¸€ç§æ•°æ®è®¿é—®å±‚ï¼Œå®ƒæ‰§è¡ŒæŒä¹…æ€§æ•°æ®å­˜å‚¨ï¼ˆé€šå¸¸æ˜¯å…³ç³»æ•°æ®åº“ï¼‰å’Œå†…å­˜æ•°æ®è¡¨ç¤ºï¼ˆåŸŸå±‚ï¼‰ä¹‹é—´çš„æ•°æ®åŒå‘ä¼ è¾“ã€‚ 
è¯¥æ¨¡å¼çš„ç›®æ ‡æ˜¯ä¿æŒå†…å­˜è¡¨ç¤ºå’ŒæŒä¹…æ•°æ®å­˜å‚¨ç›¸äº’ç‹¬ç«‹ï¼Œå¹¶ä¿æŒæ•°æ®æ˜ å°„å™¨æœ¬èº«ã€‚ 
è¯¥å±‚ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ˜ å°„å™¨ï¼ˆæˆ–æ•°æ®è®¿é—®å¯¹è±¡ï¼‰ç»„æˆï¼Œæ‰§è¡Œæ•°æ®ä¼ è¾“ã€‚ æ˜ å°„å™¨å®ç°çš„èŒƒå›´æœ‰æ‰€ä¸åŒã€‚ 
é€šç”¨æ˜ å°„å™¨å°†å¤„ç†è®¸å¤šä¸åŒçš„åŸŸå®ä½“ç±»å‹ï¼Œä¸“ç”¨æ˜ å°„å™¨å°†å¤„ç†ä¸€ä¸ªæˆ–å‡ ä¸ªã€‚
    
è¿™ç§æ¨¡å¼çš„å…³é”®ç‚¹åœ¨äºï¼Œä¸æ´»åŠ¨è®°å½•æ¨¡å¼ä¸åŒï¼Œæ•°æ®æ¨¡å‹éµå¾ªå•ä¸€è´£ä»»åŸåˆ™ã€‚

ä¾‹å­ï¼šæ•°æ®åº“å¯¹è±¡å…³ç³»æ˜ å°„å™¨ï¼ˆ ORM ï¼‰ï¼šDoctrine2 ä½¿ç”¨çš„ DAOï¼Œåå­—å«åš â€œ EntityRepository â€ã€‚
</code></pre><ul>
<li>è£…é¥°æ¨¡å¼ï¼ˆDecoratorï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šä¸ºç±»å®ä¾‹åŠ¨æ€å¢åŠ æ–°çš„æ–¹æ³•ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">Zend Framework: Zend_Form_Element å®ä¾‹çš„è£…é¥°è€…ï¼›
</span></span><span class="line"><span class="cl">Web Service Layer: ç”¨äº REST æœåŠ¡çš„ JSON å’Œ XML è£…é¥°è€… (å½“ç„¶ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ç†åº”åªæœ‰ä¸€ä¸ªæ˜¯è¢«å…è®¸çš„)ï¼›
</span></span></code></pre></div><ul>
<li>ä¾èµ–æ³¨å…¥æ¨¡å¼ï¼ˆDependency Injectionï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šç”¨æ¾æ•£è€¦åˆçš„æ–¹å¼æ¥æ›´å¥½çš„å®ç°å¯æµ‹è¯•ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•çš„ä»£ç ã€‚
</span></span><span class="line"><span class="cl">ç”¨æ³•:DatabaseConfiguration è¢«æ³¨å…¥  DatabaseConnection  å¹¶è·å–æ‰€éœ€çš„  $config ã€‚
</span></span><span class="line"><span class="cl">å¦‚æœæ²¡æœ‰ä¾èµ–æ³¨å…¥æ¨¡å¼ï¼Œ é…ç½®å°†ç›´æ¥åˆ›å»º  DatabaseConnection ã€‚è¿™å¯¹æµ‹è¯•å’Œæ‰©å±•æ¥è¯´å¾ˆä¸å¥½ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">Doctrine2 ORM ä½¿ç”¨ä¾èµ–æ³¨å…¥ã€‚ ä¾‹å¦‚ï¼Œæ³¨å…¥åˆ°  Connection  å¯¹è±¡çš„é…ç½®ã€‚ 
</span></span><span class="line"><span class="cl">å¯¹äºæµ‹è¯•è€Œè¨€ï¼Œ å¯ä»¥è½»æ¾çš„åˆ›å»ºå¯æ‰©å±•çš„æ¨¡æ‹Ÿæ•°æ®å¹¶æ³¨å…¥åˆ°  Connection  å¯¹è±¡ä¸­ï¼›
</span></span><span class="line"><span class="cl">Symfony å’Œ Zend Framework 2 å·²ç»æœ‰äº†ä¾èµ–æ³¨å…¥çš„å®¹å™¨ã€‚ä»–ä»¬é€šè¿‡é…ç½®çš„æ•°ç»„æ¥åˆ›å»ºå¯¹è±¡ï¼Œå¹¶åœ¨éœ€è¦çš„åœ°æ–¹æ³¨å…¥ (åœ¨æ§åˆ¶å™¨ä¸­)ï¼›
</span></span></code></pre></div><ul>
<li>é—¨é¢æ¨¡å¼ï¼ˆFacadeï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šé—¨é¢æ¨¡å¼çš„æœ€åˆç›®çš„å¹¶ä¸æ˜¯ä¸ºäº†é¿å…è®©ä½ é˜…è¯»å¤æ‚çš„ API æ–‡æ¡£ï¼Œè¿™åªæ˜¯ä¸€ä¸ªé™„å¸¦ä½œç”¨ã€‚
</span></span><span class="line"><span class="cl">å…¶å®å®ƒçš„æœ¬æ„æ˜¯ä¸ºäº†é™ä½è€¦åˆæ€§å¹¶ä¸”éµå¾ª Demeter å®šå¾‹ã€‚
</span></span><span class="line"><span class="cl">ä¸€ä¸ªé—¨é¢æ—¨åœ¨é€šè¿‡åµŒå…¥è®¸å¤šï¼ˆä½†æœ‰æ—¶åªæœ‰ä¸€ä¸ªï¼‰æ¥å£æ¥åˆ†ç¦»å®¢æˆ·ç«¯å’Œå­ç³»ç»Ÿã€‚å½“ç„¶ï¼Œä¹Ÿæ˜¯ä¸ºäº†é™ä½å¤æ‚åº¦ã€‚
</span></span><span class="line"><span class="cl">é—¨é¢ä¸ä¼šç¦æ­¢ä½ è®¿é—®å­ç³»ç»Ÿã€‚ä½ å¯ä»¥ï¼ˆåº”è¯¥ï¼‰æœ‰å¤šä¸ªé—¨é¢å¯¹åº”ä¸€ä¸ªå­ç³»ç»Ÿã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªå¥½çš„é—¨é¢é‡Œæ²¡æœ‰ new çš„åŸå› ã€‚
</span></span><span class="line"><span class="cl">å¦‚æœæ¯ä¸ªæ–¹æ³•éƒ½æœ‰å¤šç§åˆ›å»ºï¼Œé‚£å¹¶ä¸æ˜¯ä¸€ä¸ªé—¨é¢ï¼Œè€Œæ˜¯ä¸€ä¸ªæ„å»ºå™¨ [æŠ½è±¡çš„|é™æ€çš„|ç®€å•çš„] æˆ–æ˜¯ä¸€ä¸ªå·¥å‚ [æ–¹æ³•] ã€‚
</span></span><span class="line"><span class="cl">æœ€å¥½çš„é—¨é¢æ˜¯æ²¡æœ‰ new çš„ï¼Œå¹¶ä¸”å…¶æ„é€ å‡½æ•°å¸¦æœ‰æ¥å£ç±»å‹æç¤ºçš„å‚æ•°ã€‚ å¦‚æœä½ éœ€è¦åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨å·¥å‚ä½œä¸ºå˜é‡ã€‚
</span></span></code></pre></div><ul>
<li>æµæ¥å£æ¨¡å¼ï¼ˆFluent Interfaceï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šç”¨æ¥ç¼–å†™æ˜“äºé˜…è¯»çš„ä»£ç ï¼Œå°±åƒè‡ªç„¶è¯­è¨€ä¸€æ ·ï¼ˆå¦‚è‹±è¯­ï¼‰ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">Doctrine2 çš„ QueryBuilderï¼Œå°±åƒä¸‹é¢ä¾‹å­ä¸­ç±»ä¼¼ï¼›
</span></span><span class="line"><span class="cl">PHPUnit ä½¿ç”¨è¿è´¯æ¥å£æ¥åˆ›å»º mock å¯¹è±¡ï¼›
</span></span><span class="line"><span class="cl">Yii æ¡†æ¶ï¼šCDbCommand ä¸ CActiveRecord ä¹Ÿä½¿ç”¨æ­¤æ¨¡å¼ï¼›
</span></span></code></pre></div><ul>
<li>äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šä¸ºäº†èŠ‚çº¦å†…å­˜çš„ä½¿ç”¨ï¼Œäº«å…ƒæ¨¡å¼ä¼šå°½é‡ä½¿ç±»ä¼¼çš„å¯¹è±¡å…±äº«å†…å­˜ã€‚åœ¨å¤§é‡ç±»ä¼¼å¯¹è±¡è¢«ä½¿ç”¨çš„æƒ…å†µä¸­è¿™æ˜¯ååˆ†å¿…è¦çš„ã€‚
</span></span><span class="line"><span class="cl">å¸¸ç”¨åšæ³•æ˜¯åœ¨å¤–éƒ¨æ•°æ®ç»“æ„ä¸­ä¿å­˜ç±»ä¼¼å¯¹è±¡çš„çŠ¶æ€ï¼Œå¹¶åœ¨éœ€è¦æ—¶å°†ä»–ä»¬ä¼ é€’ç»™äº«å…ƒå¯¹è±¡ã€‚
</span></span></code></pre></div><p>ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šé“¾æ¥ä»»ä½•å…·æœ‰é«˜ä»·å€¼æˆ–æ— æ³•å¤åˆ¶çš„ä»£ç ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­:Doctrine2 ä½¿ç”¨ä»£ç†æ¥å®ç°æ¡†æ¶çš„â€œé­”æœ¯â€ï¼ˆä¾‹å¦‚ï¼šå»¶è¿ŸåŠ è½½ï¼‰ï¼Œè€Œç”¨æˆ·ä»ç„¶ä½¿ç”¨ä»–ä»¬è‡ªå·±çš„å®ä½“ç±»ä¸”ä¸ä¼šä½¿ç”¨åˆ°ä»£ç†ã€‚
</span></span></code></pre></div><ul>
<li>æ³¨å†Œæ¨¡å¼ï¼ˆRegistryï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šç›®çš„æ˜¯èƒ½å¤Ÿå­˜å‚¨åœ¨åº”ç”¨ç¨‹åºä¸­ç»å¸¸ä½¿ç”¨çš„å¯¹è±¡å®ä¾‹ï¼Œé€šå¸¸ä¼šä½¿ç”¨åªæœ‰é™æ€æ–¹æ³•çš„æŠ½è±¡ç±»æ¥å®ç°ï¼ˆæˆ–ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼‰ã€‚
</span></span><span class="line"><span class="cl">éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œå¯èƒ½ä¼šå¼•å…¥å…¨å±€çš„çŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥é¿å…å®ƒã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">Zend æ¡†æ¶ 1ï¼šZend_Registry å®ç°äº†æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ logger å¯¹è±¡å’Œå‰ç«¯æ§åˆ¶å™¨ç­‰ï¼›
</span></span><span class="line"><span class="cl">Yii æ¡†æ¶ï¼šCWebApplication å…·æœ‰å…¨éƒ¨åº”ç”¨ç¨‹åºç»„ä»¶ï¼Œä¾‹å¦‚ CWebUserï¼ŒCUrlManager ç­‰ã€‚
</span></span></code></pre></div><h3 id="è¡Œä¸ºå‹">è¡Œä¸ºå‹</h3>
<p>è´£ä»»é“¾æ¨¡å¼ï¼ˆChain Of Responsibilitiesï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå»ºç«‹ä¸€ä¸ªå¯¹è±¡é“¾æ¥æŒ‰æŒ‡å®šé¡ºåºå¤„ç†è°ƒç”¨ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ— æ³•å¤„ç†å‘½ä»¤ï¼Œ
</span></span><span class="line"><span class="cl">å®ƒä¼šå§”æ‰˜è¿™ä¸ªè°ƒç”¨ç»™å®ƒçš„ä¸‹ä¸€ä¸ªå¯¹è±¡æ¥è¿›è¡Œå¤„ç†ï¼Œä»¥æ­¤ç±»æ¨ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­:
</span></span><span class="line"><span class="cl">æ—¥è®°æ¡†æ¶ï¼Œæ¯ä¸ªé“¾å…ƒç´ è‡ªä¸»å†³å®šå¦‚ä½•å¤„ç†æ—¥è®°æ¶ˆæ¯;
</span></span><span class="line"><span class="cl">åƒåœ¾é‚®ä»¶è¿‡æ»¤å™¨;
</span></span><span class="line"><span class="cl">ç¼“å­˜ï¼šä¾‹å¦‚ç¬¬ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ª Memcached æ¥å£å®ä¾‹ï¼Œå¦‚æœ â€œä¸¢å¤±â€ å®ƒä¼šå§”æ‰˜æ•°æ®åº“æ¥å£å¤„ç†è¿™ä¸ªè°ƒç”¨;
</span></span><span class="line"><span class="cl">Yii æ¡†æ¶: CFilterChain æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨è¡Œä¸ºè¿‡æ»¤å™¨é“¾ã€‚
</span></span><span class="line"><span class="cl">æ‰§è¡Œç‚¹ä¼šæœ‰é“¾ä¸Šçš„è¿‡æ»¤å™¨é€ä¸ªä¼ é€’ï¼Œå¹¶ä¸”åªæœ‰å½“æ‰€æœ‰çš„è¿‡æ»¤å™¨éªŒè¯é€šè¿‡ï¼Œè¿™ä¸ªè¡Œä¸ºæœ€åæ‰ä¼šè¢«è°ƒç”¨ã€‚
</span></span></code></pre></div><ul>
<li>å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆCommandï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šä¸ºäº†å°è£…è°ƒç”¨å’Œè§£è€¦ã€‚
</span></span><span class="line"><span class="cl">æˆ‘ä»¬æœ‰ä¸€ä¸ªè°ƒç”¨ç¨‹åºå’Œä¸€ä¸ªæ¥æ”¶å™¨ã€‚ è¿™ç§æ¨¡å¼ä½¿ç”¨ã€Œå‘½ä»¤è¡Œã€å°†æ–¹æ³•è°ƒç”¨å§”æ‰˜ç»™æ¥æ”¶å™¨å¹¶ä¸”å‘ˆç°ç›¸åŒçš„ã€Œæ‰§è¡Œã€æ–¹æ³•ã€‚ 
</span></span><span class="line"><span class="cl">å› æ­¤ï¼Œè°ƒç”¨ç¨‹åºåªçŸ¥é“è°ƒç”¨ã€Œæ‰§è¡Œã€å»å¤„ç†å®¢æˆ·ç«¯çš„å‘½ä»¤ã€‚æ¥æ”¶å™¨ä¼šä»è°ƒç”¨ç¨‹åºä¸­åˆ†ç¦»å‡ºæ¥ã€‚
</span></span><span class="line"><span class="cl">è¿™ä¸ªæ¨¡å¼çš„å¦ä¸€é¢æ˜¯å–æ¶ˆæ–¹æ³•çš„ execute()ï¼Œä¹Ÿå°±æ˜¯ undo() ã€‚
</span></span><span class="line"><span class="cl">å‘½ä»¤è¡Œä¹Ÿå¯ä»¥é€šè¿‡æœ€å°é‡çš„å¤åˆ¶ç²˜è´´å’Œä¾èµ–ç»„åˆï¼ˆä¸æ˜¯ç»§æ‰¿ï¼‰è¢«èšåˆï¼Œä»è€Œç»„åˆæˆæ›´å¤æ‚çš„å‘½ä»¤é›†ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">æ–‡æœ¬ç¼–è¾‘å™¨ï¼šæ‰€æœ‰äº‹ä»¶éƒ½æ˜¯å¯ä»¥è¢«è§£é™¤ã€å †æ”¾ï¼Œä¿å­˜çš„å‘½ä»¤ï¼›
</span></span><span class="line"><span class="cl">Symfony2ï¼šSF2 å‘½ä»¤å¯ä»¥ä» CLI è¿è¡Œï¼Œå®ƒçš„å»ºç«‹åªéœ€è€ƒè™‘åˆ°å‘½ä»¤è¡Œæ¨¡å¼ï¼›
</span></span><span class="line"><span class="cl">å¤§å‹ CLI å·¥å…·ä½¿ç”¨å­ç¨‹åºæ¥åˆ†å‘ä¸åŒçš„ä»»åŠ¡å¹¶å°†å®ƒä»¬å°è£…åœ¨ã€Œæ¨¡å‹ã€ä¸­ï¼Œæ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¨¡å¼å®ç°ï¼ˆä¾‹å¦‚ï¼švagrantï¼‰ã€‚
</span></span></code></pre></div><p>è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šè®©å¯¹è±¡å˜å¾—å¯è¿­ä»£å¹¶è¡¨ç°å¾—åƒå¯¹è±¡é›†åˆã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼šåœ¨æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œï¼ˆå¯¹è±¡è¡¨ç¤ºå½¢å¼çš„ï¼‰ä¸Šé€è¡Œå¤„ç†æ–‡ä»¶ï¼ˆä¹Ÿæ˜¯å¯¹è±¡ï¼‰ã€‚
</span></span></code></pre></div><ul>
<li>ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šæœ¬æ¨¡å¼æä¾›äº†ä¸€ç§è½»æ¾çš„å¤šç»„ä»¶ä¹‹é—´å¼±è€¦åˆçš„ååŒæ–¹å¼ã€‚å¦‚æœä½ æœ‰ä¸ªâ€œæƒ…æŠ¥ä¸­å¿ƒâ€ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ä¹Ÿæ˜¯ä¸ªå¥½é€‰æ‹©ï¼Œ
</span></span><span class="line"><span class="cl">ç±»ä¼¼äºæ§åˆ¶å™¨ï¼ˆå¹¶é MVC æ„ä¹‰ä¸Šçš„æ§åˆ¶å™¨ï¼‰ã€‚æ‰€æœ‰å…³è”ååŒçš„ç»„ä»¶ï¼ˆç§°ä½œ Colleagueï¼‰ä»…ä¸ MediatorInterface æ¥å£å»ºç«‹è€¦åˆï¼Œ
</span></span><span class="line"><span class="cl">é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­è¿™æ˜¯å¥½äº‹ï¼Œä¸€ä¸ªè‰¯å‹èƒœäºæœ‰å¤šä¸ªæœ‹å‹ã€‚è¿™æ˜¯è¯¥æ¨¡å¼çš„é‡è¦ç‰¹æ€§ã€‚
</span></span></code></pre></div><p>å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå®ƒæä¾›äº†åœ¨ä¸ç ´åå°è£…ï¼ˆå¯¹è±¡ä¸éœ€è¦å…·æœ‰è¿”å›å½“å‰çŠ¶æ€çš„å‡½æ•°ï¼‰çš„æƒ…å†µä¸‹æ¢å¤åˆ°ä¹‹å‰çŠ¶æ€ï¼ˆä½¿ç”¨å›æ»šï¼‰æˆ–è€…è·å–å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ã€‚
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">å¤‡å¿˜å½•æ¨¡å¼ä½¿ç”¨ 3 ä¸ªç±»æ¥å®ç°ï¼šOriginatorï¼ŒCaretaker å’Œ Mementoã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Memento â€”â€” è´Ÿè´£å­˜å‚¨ Originator çš„ å”¯ä¸€å†…éƒ¨çŠ¶æ€ ï¼Œå®ƒå¯ä»¥åŒ…å«ï¼š stringï¼Œnumberï¼Œ arrayï¼Œç±»çš„å®ä¾‹ç­‰ç­‰ã€‚
</span></span><span class="line"><span class="cl">Memento ã€Œä¸æ˜¯å…¬å¼€çš„ç±»ã€ï¼ˆä»»ä½•äººéƒ½ä¸åº”è¯¥ä¸”ä¸èƒ½æ›´æ”¹å®ƒï¼‰ï¼Œå¹¶é˜²æ­¢ Originator ä»¥å¤–çš„å¯¹è±¡è®¿é—®å®ƒï¼Œ
</span></span><span class="line"><span class="cl">å®ƒæä¾›2ä¸ªæ¥å£ï¼šCaretaker åªèƒ½çœ‹åˆ°å¤‡å¿˜å½•çš„çª„æ¥å£ï¼Œä»–åªèƒ½å°†å¤‡å¿˜å½•ä¼ é€’ç»™å…¶ä»–å¯¹è±¡ã€‚
</span></span><span class="line"><span class="cl">Originator å´å¯çœ‹åˆ°å¤‡å¿˜å½•çš„å®½æ¥å£ï¼Œå…è®¸å®ƒè®¿é—®è¿”å›åˆ°å…ˆå‰çŠ¶æ€æ‰€éœ€è¦çš„æ‰€æœ‰æ•°æ®ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Originator â€”â€” å®ƒè´Ÿè´£åˆ›å»º Memento  ï¼Œå¹¶è®°å½• å¤–éƒ¨å¯¹è±¡å½“å‰æ—¶åˆ»çš„çŠ¶æ€ï¼Œ å¹¶å¯ä½¿ç”¨ Memento æ¢å¤å†…éƒ¨çŠ¶æ€ã€‚
</span></span><span class="line"><span class="cl">Originator å¯æ ¹æ®éœ€è¦å†³å®š Memento å­˜å‚¨ Originator çš„å“ªäº›å†…éƒ¨çŠ¶æ€ã€‚
</span></span><span class="line"><span class="cl">Originator ä¹Ÿè®¸ï¼ˆä¸æ˜¯åº”è¯¥ï¼‰æœ‰è‡ªå·±çš„æ–¹æ³•ï¼ˆmethodsï¼‰ã€‚ ä½†æ˜¯ï¼Œä»–ä»¬ ä¸èƒ½æ›´æ”¹å·²ä¿å­˜å¯¹è±¡çš„å½“å‰çŠ¶æ€ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Caretaker â€”â€” è´Ÿè´£ä¿å­˜ Mementoã€‚ å®ƒå¯ä»¥ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡ï¼›å†³å®š Originator ä¸­å¯¹è±¡å½“å‰æ—¶åˆ»çš„çŠ¶æ€ï¼› 
</span></span><span class="line"><span class="cl">ä» Originator è·å–å¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼› æˆ–è€…å›æ»š Originator ä¸­å¯¹è±¡çš„çŠ¶æ€ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">å‘é€ä¸€ä¸ªéšæœºæ•°ï¼›
</span></span><span class="line"><span class="cl">å¹¶å°†è¿™ä¸ªéšæœºæ•°å­˜åœ¨æ—¶åºæœºä¸­ï¼›
</span></span><span class="line"><span class="cl">ä¿å­˜ä¹‹å‰æ§åˆ¶  ORM Model  ä¸­çš„çŠ¶æ€ã€‚
</span></span></code></pre></div><ul>
<li>ç©ºå¯¹è±¡æ¨¡å¼ï¼ˆNull Objectï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šç©ºå¯¹è±¡æ¨¡å¼ä¸å±äº GoF è®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯å®ƒä½œä¸ºä¸€ç§ç»å¸¸å‡ºç°çš„å¥—è·¯è¶³ä»¥è¢«è§†ä¸ºè®¾è®¡æ¨¡å¼äº†ã€‚å®ƒå…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š
</span></span><span class="line"><span class="cl">å®¢æˆ·ç«¯ä»£ç ç®€å•
</span></span><span class="line"><span class="cl">å¯ä»¥å‡å°‘æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸çš„å‡ ç‡
</span></span><span class="line"><span class="cl">æµ‹è¯•ç”¨ä¾‹ä¸éœ€è¦è€ƒè™‘å¤ªå¤šæ¡ä»¶
</span></span><span class="line"><span class="cl">è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ– null åº”è¯¥ç”¨è¿”å›å¯¹è±¡æˆ–è€… NullObject ä»£æ›¿ã€‚NullObject ç®€åŒ–äº†æ­»æ¿çš„ä»£ç ï¼Œæ¶ˆé™¤äº†å®¢æˆ·ç«¯ä»£ç ä¸­çš„æ¡ä»¶æ£€æŸ¥ï¼Œ
</span></span><span class="line"><span class="cl">ä¾‹å¦‚ if (!is_null($obj)) { $obj-&gt;callSomething(); } åªéœ€ $obj-&gt;callSomething(); å°±è¡Œã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">Symfony2: ç©ºæ—¥å¿—ï¼›
</span></span><span class="line"><span class="cl">Symfony2: Symfony/Console ç©ºè¾“å‡ºï¼›
</span></span><span class="line"><span class="cl">è´£ä»»é“¾æ¨¡å¼ä¸­çš„ç©ºå¤„ç†å™¨ï¼›
</span></span><span class="line"><span class="cl">å‘½ä»¤è¡Œæ¨¡å¼ä¸­çš„ç©ºå‘½ä»¤ã€‚
</span></span></code></pre></div><ul>
<li>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå½“å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚å®ƒä½¿ç”¨çš„æ˜¯ä½è€¦åˆçš„æ–¹å¼ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼šä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼è§‚å¯Ÿæ¶ˆæ¯é˜Ÿåˆ—åœ¨ GUI ä¸­çš„è¿è¡Œæƒ…å†µã€‚
</span></span></code></pre></div><p><strong>PHP å·²ç»å®šä¹‰äº†2ä¸ªæ¥å£ç”¨äºå¿«é€Ÿå®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼šSplObserver å’Œ SplSubjectã€‚</strong></p>
<ul>
<li>è§„æ ¼æ¨¡å¼ï¼ˆSpecificationï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šæ„å»ºä¸€ä¸ªæ¸…æ™°çš„ä¸šåŠ¡è§„åˆ™è§„èŒƒï¼Œå…¶ä¸­æ¯æ¡è§„åˆ™éƒ½èƒ½è¢«é’ˆå¯¹æ€§åœ°æ£€æŸ¥ã€‚
</span></span><span class="line"><span class="cl">æ¯ä¸ªè§„èŒƒç±»ä¸­éƒ½æœ‰ä¸€ä¸ªç§°ä¸ºisSatisfiedByçš„æ–¹æ³•ï¼Œæ–¹æ³•åˆ¤æ–­ç»™å®šçš„è§„åˆ™æ˜¯å¦æ»¡è¶³è§„èŒƒä»è€Œè¿”å› true æˆ– falseã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">RulerZ
</span></span></code></pre></div><ul>
<li>çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šçŠ¶æ€æ¨¡å¼å¯ä»¥åŸºäºä¸€ä¸ªå¯¹è±¡çš„åŒç§äº‹åŠ¡è€Œå°è£…å‡ºä¸åŒçš„è¡Œä¸ºã€‚
</span></span><span class="line"><span class="cl">å®ƒæä¾›ä¸€ç§ç®€æ´çš„æ–¹å¼ä½¿å¾—å¯¹è±¡åœ¨è¿è¡Œæ—¶å¯ä»¥æ”¹å˜è‡ªèº«è¡Œä¸ºï¼Œè€Œä¸å¿…å€ŸåŠ©å•ä¸€åºå¤§çš„æ¡ä»¶åˆ¤æ–­è¯­å¥ã€‚
</span></span></code></pre></div><ul>
<li>ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">æœ¯è¯­ï¼šä¸Šä¸‹æ–‡    ç­–ç•¥    å…·ä½“ç­–ç•¥
</span></span><span class="line"><span class="cl">ç›®çš„ï¼šåˆ†ç¦»ã€Œç­–ç•¥ã€å¹¶ä½¿ä»–ä»¬ä¹‹é—´èƒ½äº’ç›¸å¿«é€Ÿåˆ‡æ¢ã€‚æ­¤å¤–ï¼Œè¿™ç§æ¨¡å¼æ˜¯ä¸€ç§ä¸é”™çš„ç»§æ‰¿æ›¿ä»£æ–¹æ¡ˆï¼ˆæ›¿ä»£ä½¿ç”¨æ‰©å±•æŠ½è±¡ç±»çš„æ–¹å¼ï¼‰ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">å¯¹ä¸€ä¸ªå¯¹è±¡åˆ—è¡¨è¿›è¡Œæ’åºï¼Œä¸€ç§æŒ‰ç…§æ—¥æœŸï¼Œä¸€ç§æŒ‰ç…§ idï¼›
</span></span><span class="line"><span class="cl">ç®€åŒ–ç‰ˆçš„çš„å•å…ƒæµ‹è¯•ï¼šä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨æ–‡ä»¶å­˜å‚¨å’Œå†…å­˜å­˜å‚¨ä¹‹é—´äº’ç›¸åˆ‡æ¢ã€‚
</span></span></code></pre></div><ul>
<li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹çš„è®¾è®¡æ¨¡å¼ã€‚
</span></span><span class="line"><span class="cl">å¯èƒ½ä½ å·²ç»è§è¿‡è¿™ç§æ¨¡å¼å¾ˆå¤šæ¬¡äº†ã€‚å®ƒæ˜¯ä¸€ç§è®©æŠ½è±¡æ¨¡æ¿çš„å­ç±»ã€Œå®Œæˆã€ä¸€ç³»åˆ—ç®—æ³•çš„è¡Œä¸ºç­–ç•¥ã€‚
</span></span><span class="line"><span class="cl">ä¼—æ‰€å‘¨çŸ¥çš„ã€Œå¥½è±ååŸåˆ™ã€ï¼šã€Œä¸è¦æ‰“ç”µè¯ç»™æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šæ‰“ç”µè¯ç»™ä½ ã€ã€‚
</span></span><span class="line"><span class="cl">è¿™ä¸ªç±»ä¸æ˜¯ç”±å­ç±»è°ƒç”¨çš„ï¼Œè€Œæ˜¯ä»¥ç›¸åçš„æ–¹å¼ã€‚æ€ä¹ˆåšï¼Ÿå½“ç„¶å¾ˆæŠ½è±¡å•¦ï¼
</span></span><span class="line"><span class="cl">æ¢è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ç§éå¸¸é€‚åˆæ¡†æ¶åº“çš„ç®—æ³•éª¨æ¶ã€‚ç”¨æˆ·åªéœ€è¦å®ç°å­ç±»çš„ä¸€ç§æ–¹æ³•ï¼Œå…¶çˆ¶ç±»ä¾¿å¯å»æå®šè¿™é¡¹å·¥ä½œäº†ã€‚
</span></span><span class="line"><span class="cl">è¿™æ˜¯ä¸€ç§åˆ†ç¦»å…·ä½“ç±»çš„ç®€å•åŠæ³•ï¼Œä¸”å¯ä»¥å‡å°‘å¤åˆ¶ç²˜è´´ï¼Œè¿™ä¹Ÿæ˜¯å®ƒå¸¸è§çš„åŸå› ã€‚
</span></span></code></pre></div><ul>
<li>è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥è®©ä½ å°†å¯¹è±¡æ“ä½œå¤–åŒ…ç»™å…¶ä»–å¯¹è±¡ã€‚è¿™æ ·åšçš„æœ€ä¸»è¦åŸå› å°±æ˜¯å…³æ³¨ï¼ˆæ•°æ®ç»“æ„å’Œæ•°æ®æ“ä½œï¼‰åˆ†ç¦»ã€‚
</span></span><span class="line"><span class="cl">ä½†æ˜¯è¢«è®¿é—®çš„ç±»å¿…é¡»å®šä¸€ä¸ªå¥‘çº¦æ¥å—è®¿é—®è€…ã€‚ (è¯¦è§ä¾‹å­ä¸­çš„ Role::accept æ–¹æ³•)
</span></span><span class="line"><span class="cl">å¥‘çº¦å¯ä»¥æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ä¹Ÿå¯ç›´æ¥å°±æ˜¯ä¸€ä¸ªæ¥å£ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè®¿é—®è€…å¿…é¡»è‡ªè¡Œé€‰æ‹©è°ƒç”¨è®¿é—®è€…çš„å“ªä¸ªæ–¹æ³•ã€‚
</span></span></code></pre></div><p>æ›´å¤šç±»å‹</p>
<ul>
<li>å§”æ‰˜æ¨¡å¼ï¼ˆDelegationï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šåœ¨å§”æ‰˜æ¨¡å¼çš„ç¤ºä¾‹é‡Œï¼Œä¸€ä¸ªå¯¹è±¡å°†å®ƒè¦æ‰§è¡Œçš„ä»»åŠ¡å§”æ´¾ç»™ä¸ä¹‹å…³è”çš„å¸®åŠ©å¯¹è±¡å»æ‰§è¡Œã€‚
</span></span><span class="line"><span class="cl">åœ¨ç¤ºä¾‹ä¸­ï¼Œã€Œç»„é•¿ã€å£°æ˜äº† writeCode æ–¹æ³•å¹¶ä½¿ç”¨å®ƒï¼Œ
</span></span><span class="line"><span class="cl">å…¶å®ã€Œç»„é•¿ã€æŠŠ writeCode å§”æ‰˜ç»™ã€Œèœé¸Ÿå¼€å‘è€…ã€çš„ writeBadCode æ–¹æ³•åšäº†ã€‚
</span></span><span class="line"><span class="cl">è¿™ç§åè½¬è´£ä»»çš„åšæ³•éšè—äº†å…¶å†…éƒ¨æ‰§è¡Œ writeBadCode çš„ç»†èŠ‚ã€‚
</span></span></code></pre></div><ul>
<li>æœåŠ¡å®šä½å™¨æ¨¡å¼ï¼ˆService Locatorï¼‰</li>
</ul>
<blockquote>
<p>æœåŠ¡å®šä½å™¨æ¨¡å¼è¢«è®¤ä¸ºæ˜¯ä¸€ç§åé¢æ¨¡å¼ï¼
æœåŠ¡å®šä½å™¨æ¨¡å¼è¢«ä¸€äº›äººè®¤ä¸ºæ˜¯ä¸€ç§åé¢æ¨¡å¼ã€‚å®ƒè¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ã€‚è¯¥æ¨¡å¼éšè—ç±»çš„ä¾èµ–ï¼Œè€Œä¸æ˜¯æš´éœ²ä¾èµ–ï¼ˆå¦‚æœæš´éœ²å¯é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼æ³¨å…¥ä¾èµ–ï¼‰ã€‚å½“æŸé¡¹æœåŠ¡çš„ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿ç”¨è¯¥æœåŠ¡çš„ç±»çš„åŠŸèƒ½å°†é¢ä¸´è¢«ç ´åçš„é£é™©ï¼Œæœ€ç»ˆå¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç»´æŠ¤ã€‚</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šæœåŠ¡å®šä½å™¨æ¨¡å¼èƒ½å¤Ÿé™ä½ä»£ç çš„è€¦åˆåº¦ï¼Œä»¥ä¾¿è·å¾—å¯æµ‹è¯•ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•çš„ä»£ç ã€‚
</span></span><span class="line"><span class="cl">DI æ¨¡å¼å’ŒæœåŠ¡å®šä½å™¨æ¨¡å¼æ˜¯ IOC æ¨¡å¼çš„ä¸€ç§å®ç°ã€‚
</span></span><span class="line"><span class="cl">ç”¨æ³•ï¼šä½¿ç”¨ ServiceLocator ï¼Œä½ å¯ä»¥ä¸ºç»™å®šçš„ interface æ³¨å†Œä¸€ä¸ªæœåŠ¡ã€‚
</span></span><span class="line"><span class="cl">é€šè¿‡ä½¿ç”¨è¿™ä¸ª interfaceï¼Œä½ ä¸éœ€è¦çŸ¥é“è¯¥æœåŠ¡çš„å®ç°ç»†èŠ‚ï¼Œå°±å¯ä»¥è·å–å¹¶åœ¨ä½ åº”ç”¨ä¸­ä½¿ç”¨è¯¥æœåŠ¡ã€‚
</span></span><span class="line"><span class="cl">ä½ å¯ä»¥åœ¨å¼•å¯¼ç¨‹åºä¸­é…ç½®å’Œæ³¨å…¥æœåŠ¡å®šä½å™¨å¯¹è±¡ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼šZend Framework2 ä½¿ç”¨æœåŠ¡å®šä½å™¨åˆ›å»ºå’Œå…±äº«æ¡†æ¶ä¸­ä½¿ç”¨çš„æœåŠ¡
</span></span><span class="line"><span class="cl">ï¼ˆEventManagerï¼ŒModuleManagerï¼Œä»¥åŠç”±æ¨¡å—æä¾›çš„ç”¨æˆ·è‡ªå®šä¹‰æœåŠ¡ç­‰ï¼‰ã€‚
</span></span></code></pre></div><ul>
<li>èµ„æºåº“æ¨¡å¼ï¼ˆRepositoryï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šè¯¥æ¨¡å¼é€šè¿‡æä¾›é›†åˆé£æ ¼çš„æ¥å£æ¥è®¿é—®é¢†åŸŸå¯¹è±¡ï¼Œä»è€Œåè°ƒé¢†åŸŸå’Œæ•°æ®æ˜ å°„å±‚ã€‚ 
</span></span><span class="line"><span class="cl">èµ„æ–™åº“æ¨¡å¼å°è£…äº†ä¸€ç»„å­˜å‚¨åœ¨æ•°æ®å­˜å‚¨å™¨é‡Œçš„å¯¹è±¡å’Œæ“ä½œå®ƒä»¬çš„æ–¹é¢ï¼Œè¿™æ ·å­ä¸ºæ•°æ®æŒä¹…åŒ–å±‚æä¾›äº†æ›´åŠ é¢å‘å¯¹è±¡çš„è§†è§’ã€‚
</span></span><span class="line"><span class="cl">èµ„æ–™åº“æ¨¡å¼åŒæ—¶ä¹Ÿè¾¾åˆ°äº†é¢†åŸŸå±‚ä¸æ•°æ®æ˜ å°„å±‚ä¹‹é—´æ¸…æ™°åˆ†ç¦»ï¼Œå•å‘ä¾èµ–çš„ç›®çš„ã€‚
</span></span><span class="line"><span class="cl">ä¾‹å­ï¼š
</span></span><span class="line"><span class="cl">Doctrine 2 ORM: é€šè¿‡èµ„æ–™åº“åè°ƒå®ä½“å’Œ DBALï¼Œå®ƒåŒ…å«æ£€ç´¢å¯¹è±¡çš„æ–¹æ³•ï¼›
</span></span><span class="line"><span class="cl">Laravel æ¡†æ¶ã€‚
</span></span></code></pre></div><ul>
<li>å®ä½“å±æ€§å€¼æ¨¡å¼ï¼ˆEAV æ¨¡å¼ï¼‰</li>
</ul>
<blockquote>
<p>å®ä½“å±æ€§å€¼ï¼ˆEntity&ndash;attribute&ndash;value EAVï¼‰æ¨¡å¼ï¼Œå¯ä»¥æ–¹ä¾¿ PHP å®ç° EAV æ¨¡å‹ã€‚</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›®çš„ï¼šå®ä½“å±æ€§å€¼æ¨¡å‹ï¼ˆEntity-attribute-value EAVï¼‰æ˜¯ä¸€ç§ç”¨æ•°æ®æ¨¡å‹æè¿°å®ä½“çš„å±æ€§ï¼ˆå±æ€§ï¼Œå‚æ•°ï¼‰ï¼Œ
</span></span><span class="line"><span class="cl">å¯ä»¥ç”¨æ¥å½¢å®¹ä»–ä»¬æ½œåœ¨å·¨å¤§ï¼Œä½†å®é™…ä¸Šå°†é€‚ç”¨äºç»™å®šçš„å®ä½“çš„æ•°é‡æ˜¯ç›¸å¯¹è¾ƒå°‘ã€‚ 
</span></span><span class="line"><span class="cl">åœ¨æ•°å­¦ä¸­ï¼Œè¿™ç§æ¨¡å¼è¢«ç§°ä¸ºä¸€ä¸ªç¨€ç–çŸ©é˜µ ã€‚ EAVä¹Ÿè¢«ç§°ä¸ºå¯¹è±¡çš„å±æ€§å€¼çš„æ¨¡å¼ï¼Œå‚ç›´çš„æ•°æ®åº“æ¨¡å‹å’Œå¼€æ”¾å¼æ¶æ„ã€‚
</span></span></code></pre></div><ul>
<li>åé¢æ¨¡å¼ï¼ˆAnti-patternï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">è¯´æ˜
</span></span><span class="line"><span class="cl">åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œä¸€ä¸ªåé¢æ¨¡å¼ï¼ˆAnti-pattern æˆ– Antipatternï¼‰æŒ‡çš„æ˜¯åœ¨å®è·µä¸­æ˜æ˜¾å‡ºç°ä½†åˆä½æ•ˆæˆ–æ˜¯æœ‰å¾…ä¼˜åŒ–çš„è®¾è®¡æ¨¡å¼ï¼Œ
</span></span><span class="line"><span class="cl">æ˜¯ç”¨æ¥è§£å†³é—®é¢˜çš„å¸¦æœ‰å…±åŒæ€§çš„ä¸è‰¯æ–¹æ³•ã€‚å®ƒä»¬å·²ç»ç»è¿‡ç ”ç©¶å¹¶åˆ†ç±»ï¼Œä»¥é˜²æ­¢æ—¥åé‡è¹ˆè¦†è¾™ï¼Œ
</span></span><span class="line"><span class="cl">å¹¶èƒ½åœ¨ç ”å‘å°šæœªæŠ•äº§çš„ç³»ç»Ÿæ—¶è¾¨è®¤å‡ºæ¥ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Andrew Koenig åœ¨ 1995 å¹´é€ äº† Anti-pattern è¿™ä¸ªè¯ï¼Œçµæ„Ÿæ¥è‡ªäº GoF çš„ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ã€‚
</span></span><span class="line"><span class="cl">è€Œè¿™æœ¬ä¹¦åˆ™åœ¨è½¯ä»¶é¢†åŸŸå¼•å…¥äº†â€œè®¾è®¡æ¨¡å¼â€ï¼ˆDesign Patternï¼‰çš„æ¦‚å¿µã€‚
</span></span><span class="line"><span class="cl">ä¸‰å¹´å Antipattern å› ã€ŠAntiPatternsã€‹è¿™æœ¬ä¹¦è€Œè·å¾—æ™®åŠï¼Œè€Œå®ƒçš„ä½¿ç”¨ä¹Ÿä»è½¯ä»¶è®¾è®¡é¢†åŸŸæ‰©å±•åˆ°äº†æ—¥å¸¸çš„ç¤¾ä¼šäº’åŠ¨ä¸­ã€‚
</span></span><span class="line"><span class="cl">æŒ‰ã€ŠAntiPatternsã€‹ä½œè€…çš„è¯´æ³•ï¼Œå¯ä»¥ç”¨è‡³å°‘ä¸¤ä¸ªå…³é”®å› ç´ æ¥æŠŠåé¢æ¨¡å¼å’Œä¸è‰¯ä¹ æƒ¯ã€é”™è¯¯çš„å®è·µæˆ–ç³Ÿç³•çš„æƒ³æ³•åŒºåˆ†å¼€æ¥ï¼š
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¡ŒåŠ¨ã€è¿‡ç¨‹å’Œç»“æ„ä¸­çš„ä¸€äº›é‡å¤å‡ºç°çš„ä¹ä¸€çœ‹æ˜¯æœ‰ç›Šçš„ï¼Œä½†æœ€ç»ˆå¾—ä¸å¿å¤±çš„æ¨¡å¼
</span></span><span class="line"><span class="cl">åœ¨å®è·µä¸­è¯æ˜ä¸”å¯é‡å¤çš„æ¸…æ™°è®°å½•çš„é‡æ„æ–¹æ¡ˆ
</span></span><span class="line"><span class="cl">å¾ˆå¤šåé¢æ¨¡å¼åªç›¸å½“äºæ˜¯é”™è¯¯ã€å’†å“®ã€ä¸å¯è§£çš„é—®é¢˜ã€æˆ–æ˜¯å¯èƒ½å¯ä»¥é¿å…çš„ç³Ÿç³•çš„å®è·µï¼Œ
</span></span><span class="line"><span class="cl">å®ƒä»¬çš„åå­—é€šå¸¸éƒ½æ˜¯ä¸€äº›ç”¨åè¯æ„æˆçš„è¯è¯­ã€‚
</span></span><span class="line"><span class="cl">æœ‰äº›æ—¶å€™é™·é˜±ï¼ˆPitfallsï¼‰æˆ–é»‘è‰²æ¨¡å¼ï¼ˆDark Patternsï¼‰è¿™äº›ä¸æ­£å¼çš„è¯´æ³•ä¼šè¢«ç”¨æ¥æŒ‡ä»£å„ç±»åå¤å‡ºç°çš„ç³Ÿç³•çš„è§£å†³æ–¹æ³•ã€‚
</span></span><span class="line"><span class="cl">å› æ­¤ï¼Œä¸€äº›æœ‰äº‰è®®çš„å€™é€‰çš„åé¢æ¨¡å¼ä¸ä¼šè¢«æ­£å¼æ‰¿è®¤ã€‚
</span></span></code></pre></div><blockquote>
<p>â€”â€” ä»¥ä¸Šæ‘˜è‡ª wikipedia</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>Laravelæ‰‹åŠ¨åˆ›å»ºæ•°ç»„åˆ†é¡µğŸ˜</title>
			<link>https://blog.gookm.cn/posts/2018/20180110-laravel-paginate/</link>
			<pubDate>Wed, 10 Jan 2018 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2018/20180110-laravel-paginate/</guid>
			<description>laravelåˆ†é¡µåŠŸèƒ½ æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†é¡µã€‚æœ€ç®€å•çš„æ˜¯åœ¨ [æŸ¥è¯¢è¯­å¥æ„é€ å™¨] æˆ– [Eloquent æŸ¥è¯¢] ä¸­ä½¿ç”¨ paginate æˆ– simplePaginate æ–¹æ³•ã€‚
paginateç”¨æ³•å¦‚ä¸‹ï¼š
//æ§åˆ¶å™¨ä¸­ $users = DB::table(&amp;#39;users&amp;#39;)-&amp;gt;paginate(15); return view(&amp;#39;user.index&amp;#39;, [&amp;#39;users&amp;#39; =&amp;gt; $users]); //è§†å›¾ä¸­ {{ $users-&amp;gt;links() }} æ•ˆæœå¦‚ä¸‹ï¼š
ã€Œä¸Šä¸€é¡µã€ ã€Œ1ã€ã€Œ2ã€ã€Œ3ã€ ã€Œä¸‹ä¸€é¡µã€
simplePaginateç”¨æ³•å¦‚ä¸‹ï¼š
//æ§åˆ¶å™¨ä¸­ $users = User::where(&amp;#39;votes&amp;#39;, &amp;#39;&amp;gt;&amp;#39;, 100)-&amp;gt;simplePaginate(15); return view(&amp;#39;user.index&amp;#39;, compact(&amp;#39;users&amp;#39;)); //è§†å›¾ä¸­ {{ $users-&amp;gt;links() }} æ•ˆæœå¦‚ä¸‹ï¼š
ã€Œä¸Šä¸€é¡µã€ ã€Œä¸‹ä¸€é¡µã€
æ³¨æ„ï¼š
å¦‚æœä½ åªéœ€è¦åœ¨åˆ†é¡µè§†å›¾ä¸­æ˜¾ç¤ºç®€å•çš„ã€Œä¸‹ä¸€é¡µã€å’Œã€Œä¸Šä¸€é¡µã€çš„é“¾æ¥ï¼Œå³ä¸éœ€è¦æ˜¾ç¤ºæ¯ä¸ªé¡µç çš„é“¾æ¥ï¼Œæ›´æ¨èä½¿ç”¨ simplePaginate æ–¹æ³•æ¥æ‰§è¡Œæ›´é«˜æ•ˆçš„æŸ¥è¯¢ã€‚ ç›®å‰ï¼ŒLaravel æ— æ³•é«˜æ•ˆæ‰§è¡Œä½¿ç”¨ groupBy è¯­å¥çš„åˆ†é¡µæ“ä½œã€‚å¦‚æœä½ éœ€è¦åœ¨åˆ†é¡µç»“æœé›†ä¸­ä½¿ç”¨ groupByï¼Œå»ºè®®ä½ æŸ¥è¯¢æ•°æ®åº“å¹¶æ‰‹åŠ¨åˆ›å»ºåˆ†é¡µå™¨ã€‚ æœ‰æ—¶å€™å¯èƒ½ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼ŒdataAå’ŒdataBæ˜¯ä»æ•°æ®åº“å–å‡ºçš„ä¸¤ä¸ªä¸åŒçš„æ•°æ®é›†åˆï¼Œéœ€è¦åŒæ—¶å°†dataAå’ŒdataBåˆ†é…åˆ°è§†å›¾å¹¶è¿›è¡Œåˆ†é¡µå±•ç¤ºï¼Œé‚£è¿™ç§æƒ…å†µæ€ä¹ˆåŠå‘¢ï¼Ÿ è¿™ç§æƒ…å†µå¯ä»¥é‡‡ç”¨laravelæ•°ç»„åˆ†é¡µã€‚
å…¶å®åœ¨laravelæ–‡æ¡£ä¸­å·²ç»æœ‰å†™å¦‚ä½•è‡ªå·±ä½¿ç”¨åˆ†é¡µç±»å»åˆ†é¡µäº†ï¼Œä½†æ²¡æœ‰ è¯¦ç»†è¯´æ˜ã€‚
æ‰‹åŠ¨åˆ›å»ºåˆ†é¡µ å¦‚æœä½ æƒ³æ‰‹åŠ¨åˆ›å»ºåˆ†é¡µå®ä¾‹å¹¶ä¸”æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ•°ç»„ç±»å‹çš„ç»“æœï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚æ¥åˆ›å»º IlluminatePaginationPaginator æˆ–è€… IlluminatePaginationLengthAwarePaginator å®ä¾‹æ¥å®ç°ã€‚
å…·ä½“å¯ä»¥çœ‹IlluminatePaginationLengthAwarePaginatorä¸­çš„è¿™æ®µä»£ç ï¼š
public function __construct($items, $total, $perPage, $currentPage = null, array $options = []) { foreach ($options as $key =&amp;gt; $value) { $this-&amp;gt;{$key} = $value; } $this-&amp;gt;total = $total; $this-&amp;gt;perPage = $perPage; $this-&amp;gt;lastPage = max((int) ceil($total / $perPage), 1); $this-&amp;gt;path = $this-&amp;gt;path !</description>
			<content type="html"><![CDATA[<h3 id="laravelåˆ†é¡µåŠŸèƒ½">laravelåˆ†é¡µåŠŸèƒ½</h3>
<p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†é¡µã€‚æœ€ç®€å•çš„æ˜¯åœ¨ [æŸ¥è¯¢è¯­å¥æ„é€ å™¨] æˆ– [Eloquent æŸ¥è¯¢] ä¸­ä½¿ç”¨ paginate æˆ– simplePaginate æ–¹æ³•ã€‚</p>
<p>paginateç”¨æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//æ§åˆ¶å™¨ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$users</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="nv">$users</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è§†å›¾ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{{</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">links</span><span class="p">()</span> <span class="p">}}</span>
</span></span></code></pre></div><p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p>ã€Œä¸Šä¸€é¡µã€ ã€Œ1ã€ã€Œ2ã€ã€Œ3ã€ ã€Œä¸‹ä¸€é¡µã€</p>
<p>simplePaginateç”¨æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//æ§åˆ¶å™¨ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">simplePaginate</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;user.index&#39;</span><span class="p">,</span> <span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è§†å›¾ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{{</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">links</span><span class="p">()</span> <span class="p">}}</span>
</span></span></code></pre></div><p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p>ã€Œä¸Šä¸€é¡µã€ ã€Œä¸‹ä¸€é¡µã€</p>
<p>æ³¨æ„ï¼š</p>
<ol>
<li>å¦‚æœä½ åªéœ€è¦åœ¨åˆ†é¡µè§†å›¾ä¸­æ˜¾ç¤ºç®€å•çš„ã€Œä¸‹ä¸€é¡µã€å’Œã€Œä¸Šä¸€é¡µã€çš„é“¾æ¥ï¼Œå³ä¸éœ€è¦æ˜¾ç¤ºæ¯ä¸ªé¡µç çš„é“¾æ¥ï¼Œæ›´æ¨èä½¿ç”¨ simplePaginate æ–¹æ³•æ¥æ‰§è¡Œæ›´é«˜æ•ˆçš„æŸ¥è¯¢ã€‚</li>
<li>ç›®å‰ï¼ŒLaravel æ— æ³•é«˜æ•ˆæ‰§è¡Œä½¿ç”¨ groupBy è¯­å¥çš„åˆ†é¡µæ“ä½œã€‚å¦‚æœä½ éœ€è¦åœ¨åˆ†é¡µç»“æœé›†ä¸­ä½¿ç”¨ groupByï¼Œå»ºè®®ä½ æŸ¥è¯¢æ•°æ®åº“å¹¶æ‰‹åŠ¨åˆ›å»ºåˆ†é¡µå™¨ã€‚</li>
</ol>
<p>æœ‰æ—¶å€™å¯èƒ½ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼ŒdataAå’ŒdataBæ˜¯ä»æ•°æ®åº“å–å‡ºçš„ä¸¤ä¸ªä¸åŒçš„æ•°æ®é›†åˆï¼Œéœ€è¦åŒæ—¶å°†dataAå’ŒdataBåˆ†é…åˆ°è§†å›¾å¹¶è¿›è¡Œåˆ†é¡µå±•ç¤ºï¼Œé‚£è¿™ç§æƒ…å†µæ€ä¹ˆåŠå‘¢ï¼Ÿ
<img src="https://segmentfault.com/img/bVbbGnP?w=277&amp;h=235" alt=""></p>
<p><strong>è¿™ç§æƒ…å†µå¯ä»¥é‡‡ç”¨laravelæ•°ç»„åˆ†é¡µã€‚</strong></p>
<p>å…¶å®åœ¨laravelæ–‡æ¡£ä¸­å·²ç»æœ‰å†™å¦‚ä½•è‡ªå·±ä½¿ç”¨åˆ†é¡µç±»å»åˆ†é¡µäº†ï¼Œä½†æ²¡æœ‰ è¯¦ç»†è¯´æ˜ã€‚</p>
<h3 id="æ‰‹åŠ¨åˆ›å»ºåˆ†é¡µ">æ‰‹åŠ¨åˆ›å»ºåˆ†é¡µ</h3>
<p>å¦‚æœä½ æƒ³æ‰‹åŠ¨åˆ›å»ºåˆ†é¡µå®ä¾‹å¹¶ä¸”æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ•°ç»„ç±»å‹çš„ç»“æœï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚æ¥åˆ›å»º IlluminatePaginationPaginator æˆ–è€… IlluminatePaginationLengthAwarePaginator å®ä¾‹æ¥å®ç°ã€‚</p>
<p>å…·ä½“å¯ä»¥çœ‹IlluminatePaginationLengthAwarePaginatorä¸­çš„è¿™æ®µä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$items</span><span class="p">,</span> <span class="nv">$total</span><span class="p">,</span> <span class="nv">$perPage</span><span class="p">,</span> <span class="nv">$currentPage</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span> <span class="o">=</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$options</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$key</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">total</span> <span class="o">=</span> <span class="nv">$total</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">perPage</span> <span class="o">=</span> <span class="nv">$perPage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastPage</span> <span class="o">=</span> <span class="nx">max</span><span class="p">((</span><span class="nx">int</span><span class="p">)</span> <span class="nx">ceil</span><span class="p">(</span><span class="nv">$total</span> <span class="o">/</span> <span class="nv">$perPage</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span> <span class="o">?</span> <span class="nx">rtrim</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentPage</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setCurrentPage</span><span class="p">(</span><span class="nv">$currentPage</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pageName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">items</span> <span class="o">=</span> <span class="nv">$items</span> <span class="nx">instanceof</span> <span class="nx">Collection</span> <span class="o">?</span> <span class="nv">$items</span> <span class="o">:</span> <span class="nx">Collection</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="å…·ä½“å®ç°ä»£ç ">å…·ä½“å®ç°ä»£ç </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//æ§åˆ¶å™¨ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">LiveService</span> <span class="nv">$liveService</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ•°æ®A
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$dataA</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ•°æ®B
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$dataB</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$data</span> <span class="o">=</span> <span class="nx">array_merge</span><span class="p">(</span><span class="nv">$dataA</span><span class="p">,</span> <span class="nv">$dataB</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å½“å‰é¡µæ•° é»˜è®¤1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$page</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">page</span> <span class="o">?:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ¯é¡µçš„æ¡æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$perPage</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//è®¡ç®—æ¯é¡µåˆ†é¡µçš„åˆå§‹ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$offset</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$page</span> <span class="o">*</span> <span class="nv">$perPage</span><span class="p">)</span> <span class="o">-</span> <span class="nv">$perPage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//å®ä¾‹åŒ–LengthAwarePaginatorç±»ï¼Œå¹¶ä¼ å…¥å¯¹åº”çš„å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LengthAwarePaginator</span><span class="p">(</span><span class="nx">array_slice</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$offset</span><span class="p">,</span> <span class="nv">$perPage</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="nx">count</span><span class="p">(</span><span class="nv">$data</span><span class="p">),</span> <span class="nv">$perPage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$page</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">url</span><span class="p">(),</span> <span class="s1">&#39;query&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">()]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;admin.users.index&#39;</span><span class="p">,</span> <span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è§†å›¾ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{{</span> <span class="nv">$data</span><span class="o">-&gt;</span><span class="na">links</span><span class="p">()</span> <span class="p">}}</span>
</span></span></code></pre></div><p>ä»¥ä¸ŠåŸºæœ¬å°±å®Œæˆäº†æ•°ç»„åˆ†é¡µï¼Œå¤§è‡´æµç¨‹å°±æ˜¯æ§åˆ¶å™¨è·å–åˆ°å½“å‰é¡µæ•°ï¼Œå®ä¾‹åŒ–LengthAwarePaginatorç±»å¹¶ä¼ å…¥å¿…è¦çš„å‚æ•°ï¼Œæ ¹æ®æ¯é¡µçš„æ¡æ•°åˆ©ç”¨array_slice()æ–¹æ³•è·å–æ¯é¡µè¦æ˜¾ç¤ºçš„æ•°æ®ã€‚</p>
<p><a href="https://segmentfault.com/a/1190000015138587">å¦ä¸€å‚è€ƒåœ°å€</a></p>
]]></content>
		</item>
		
		<item>
			<title>Laravelä¸­å‘é€Ajaxè¯·æ±‚ğŸƒâ€â™‚ï¸</title>
			<link>https://blog.gookm.cn/posts/2017/20171108-laravel-ajax/</link>
			<pubDate>Wed, 08 Nov 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20171108-laravel-ajax/</guid>
			<description>ajaxè¯·æ±‚éªŒè¯,æ·»åŠ æ•°æ® $(&amp;#34;#submit2&amp;#34;).click(function () { var _error = 0; if ($(&amp;#34;.addtit&amp;#34;).val() == &amp;#34;&amp;#34;) { _error = 1 } if (_error == 1) { layer.msg(&amp;#39;æ‰€æœ‰ä¿¡æ¯å¿…é¡»å¡«å†™&amp;#39;, {icon: 5, time: 980}); return false; } $.ajax({ type:&amp;#39;post&amp;#39;, url:&amp;#39;{{route(&amp;#39;messages.sysstore&amp;#39;)}}&amp;#39;, data:{ &amp;#39;_token&amp;#39;:{{csrf_filed()}}, &amp;#39;type&amp;#39;:1, &amp;#39;title&amp;#39;:$(&amp;#39;#title_2&amp;#39;).val(), &amp;#39;timing&amp;#39;:$(&amp;#34;#timing_input2&amp;#34;).val(), &amp;#39;images&amp;#39;: JSON.stringify( images_arr ) }, success:function(msg){ if(msg.code == 0){ layer.msg(&amp;#39;okï¼&amp;#39;,{icon:6,time:1500},function(){ location.href = &amp;#34;{{route(&amp;#39;messages.index&amp;#39;)}}&amp;#34;; }); }else{ layer.msg(msg.error,{icon:5,time:1500}); } } }); return false; }) ajaxè¯·æ±‚ä¿®æ”¹æ•°æ® $.ajax({ url: &amp;#39;/registerAgreement/&amp;#39; + _id, type: &amp;#39;PATCH&amp;#39;, success: function (data) { console.</description>
			<content type="html"><![CDATA[<h3 id="ajaxè¯·æ±‚éªŒè¯æ·»åŠ æ•°æ®">ajaxè¯·æ±‚éªŒè¯,æ·»åŠ æ•°æ®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#submit2&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">_error</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addtit&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">_error</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">_error</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">layer</span><span class="p">.</span><span class="nx">msg</span><span class="p">(</span><span class="s1">&#39;æ‰€æœ‰ä¿¡æ¯å¿…é¡»å¡«å†™&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">icon</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">time</span><span class="o">:</span> <span class="mi">980</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;post&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">url</span><span class="o">:</span><span class="s1">&#39;{{route(&#39;</span><span class="nx">messages</span><span class="p">.</span><span class="nx">sysstore</span><span class="s1">&#39;)}}&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">data</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;_token&#39;</span><span class="o">:</span><span class="p">{{</span><span class="nx">csrf_filed</span><span class="p">()}},</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;type&#39;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;title&#39;</span><span class="o">:</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#title_2&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;timing&#39;</span><span class="o">:</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#timing_input2&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;images&#39;</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">images_arr</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">success</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nx">layer</span><span class="p">.</span><span class="nx">msg</span><span class="p">(</span><span class="s1">&#39;okï¼&#39;</span><span class="p">,{</span><span class="nx">icon</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span><span class="nx">time</span><span class="o">:</span><span class="mi">1500</span><span class="p">},</span><span class="kd">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s2">&#34;{{route(&#39;messages.index&#39;)}}&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">});</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">layer</span><span class="p">.</span><span class="nx">msg</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">error</span><span class="p">,{</span><span class="nx">icon</span><span class="o">:</span><span class="mi">5</span><span class="p">,</span><span class="nx">time</span><span class="o">:</span><span class="mi">1500</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><h3 id="ajaxè¯·æ±‚ä¿®æ”¹æ•°æ®">ajaxè¯·æ±‚ä¿®æ”¹æ•°æ®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">     <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/registerAgreement/&#39;</span> <span class="o">+</span> <span class="nx">_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;PATCH&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">_img</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">?</span> <span class="s1">&#39;watch1&#39;</span> <span class="o">:</span> <span class="s1">&#39;watch01&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">_this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&#34;.watch&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span> <span class="s2">&#34;/assets/images/&#34;</span> <span class="o">+</span> <span class="nx">_img</span> <span class="o">+</span> <span class="s2">&#34;.png&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">msg</span><span class="p">(</span><span class="s2">&#34;å¯ç”¨æˆåŠŸï¼&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nx">icon</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">time</span><span class="o">:</span> <span class="mi">1500</span><span class="p">},</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">             <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">         <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">           <span class="k">return</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;å¯ç”¨å¤±è´¥ï¼&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nx">icon</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">time</span><span class="o">:</span> <span class="mi">3000</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="p">});</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Laravel Carbonå‡½æ•°</title>
			<link>https://blog.gookm.cn/posts/2017/20171021-laravel-carbon/</link>
			<pubDate>Sat, 21 Oct 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20171021-laravel-carbon/</guid>
			<description>å¿«é€Ÿåˆ‡æ¢å‰åæ—¥æœŸ &amp;lt;?php use Carbon\Carbon; $now = Carbon::now(); echo $now; // 2015-03-26 00:36:47 $today = Carbon::today(); echo $today; // 2015-03-26 00:00:00 $tomorrow = Carbon::tomorrow(&amp;#39;Europe/London&amp;#39;); echo $tomorrow; // 2015-03-27 00:00:00 $yesterday = Carbon::yesterday(); echo $yesterday; // 2015-03-25 00:00:00 å»ºç«‹ç‰¹å®šæ—¥æœŸçš„æ—¶é—´ &amp;lt;?php use Carbon\Carbon; $timezone = &amp;#39;Asia/Taipei&amp;#39;; // å¾ã€Œå¹´æœˆæ—¥ã€å»ºç«‹ Carbon::createFromDate($year, $month, $day, $timezone); // å¾ã€Œæ™‚åˆ†ç§’ã€å»ºç«‹ Carbon::createFromTime($hour, $minute, $second, $timezone); // å¾å®Œæ•´çš„ã€Œå¹´æœˆæ—¥æ™‚åˆ†ç§’ã€å»ºç«‹ Carbon::create($year, $month, $day, $hour, $minute, $second, $timezone); // å¾æŒ‡å®šçš„æ ¼å¼å»ºç«‹ Carbon::createFromFormat($format, $time, $tz); echo Carbon::createFromFormat(&amp;#39;Y-m-d H&amp;#39;, &amp;#39;1975-05-21 22&amp;#39;)-&amp;gt;toDateTimeString(); // 1975-05-21 22:00:00 // å¾æ™‚é–“æˆ³è¨˜å»ºç«‹ echo Carbon::createFromTimeStamp(-1)-&amp;gt;toDateTimeString(); // 1969-12-31 18:59:59 echo Carbon::createFromTimeStamp(-1, &amp;#39;Europe/London&amp;#39;)-&amp;gt;toDateTimeString(); // 1970-01-01 00:59:59 echo Carbon::createFromTimeStampUTC(-1)-&amp;gt;toDateTimeString(); è½¬æ¢æ—¥æœŸ &amp;lt;?</description>
			<content type="html"><![CDATA[<h3 id="å¿«é€Ÿåˆ‡æ¢å‰åæ—¥æœŸ">å¿«é€Ÿåˆ‡æ¢å‰åæ—¥æœŸ</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$now</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$now</span><span class="p">;</span>                               <span class="c1">// 2015-03-26 00:36:47
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$today</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">today</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$today</span><span class="p">;</span>                             <span class="c1">// 2015-03-26 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$tomorrow</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">tomorrow</span><span class="p">(</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$tomorrow</span><span class="p">;</span>                          <span class="c1">// 2015-03-27 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$yesterday</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">yesterday</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$yesterday</span><span class="p">;</span>                         <span class="c1">// 2015-03-25 00:00:00
</span></span></span></code></pre></div><h3 id="å»ºç«‹ç‰¹å®šæ—¥æœŸçš„æ—¶é—´">å»ºç«‹ç‰¹å®šæ—¥æœŸçš„æ—¶é—´</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$timezone</span> <span class="o">=</span> <span class="s1">&#39;Asia/Taipei&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å¾ã€Œå¹´æœˆæ—¥ã€å»ºç«‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="nv">$year</span><span class="p">,</span> <span class="nv">$month</span><span class="p">,</span> <span class="nv">$day</span><span class="p">,</span> <span class="nv">$timezone</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å¾ã€Œæ™‚åˆ†ç§’ã€å»ºç«‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromTime</span><span class="p">(</span><span class="nv">$hour</span><span class="p">,</span> <span class="nv">$minute</span><span class="p">,</span> <span class="nv">$second</span><span class="p">,</span> <span class="nv">$timezone</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å¾å®Œæ•´çš„ã€Œå¹´æœˆæ—¥æ™‚åˆ†ç§’ã€å»ºç«‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$year</span><span class="p">,</span> <span class="nv">$month</span><span class="p">,</span> <span class="nv">$day</span><span class="p">,</span> <span class="nv">$hour</span><span class="p">,</span> <span class="nv">$minute</span><span class="p">,</span> <span class="nv">$second</span><span class="p">,</span> <span class="nv">$timezone</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å¾æŒ‡å®šçš„æ ¼å¼å»ºç«‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromFormat</span><span class="p">(</span><span class="nv">$format</span><span class="p">,</span> <span class="nv">$time</span><span class="p">,</span> <span class="nv">$tz</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromFormat</span><span class="p">(</span><span class="s1">&#39;Y-m-d H&#39;</span><span class="p">,</span> <span class="s1">&#39;1975-05-21 22&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span> <span class="c1">// 1975-05-21 22:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¾æ™‚é–“æˆ³è¨˜å»ºç«‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromTimeStamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>                        <span class="c1">// 1969-12-31 18:59:59
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromTimeStamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Europe/London&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>       <span class="c1">// 1970-01-01 00:59:59
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromTimeStampUTC</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>
</span></span></code></pre></div><h3 id="è½¬æ¢æ—¥æœŸ">è½¬æ¢æ—¥æœŸ</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é€éæ–‡å­—ç§»å‹•æ—¥æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$knownDate</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>          <span class="c1">// create testing date
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Carbon</span><span class="o">::</span><span class="na">setTestNow</span><span class="p">(</span><span class="nv">$knownDate</span><span class="p">);</span>                        <span class="c1">// set the mock
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="k">new</span> <span class="nx">Carbon</span><span class="p">(</span><span class="s1">&#39;tomorrow&#39;</span><span class="p">);</span>                           <span class="c1">// 2001-05-22 00:00:00  ... notice the time !
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="k">new</span> <span class="nx">Carbon</span><span class="p">(</span><span class="s1">&#39;yesterday&#39;</span><span class="p">);</span>                          <span class="c1">// 2001-05-20 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="k">new</span> <span class="nx">Carbon</span><span class="p">(</span><span class="s1">&#39;next wednesday&#39;</span><span class="p">);</span>                     <span class="c1">// 2001-05-23 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="k">new</span> <span class="nx">Carbon</span><span class="p">(</span><span class="s1">&#39;last friday&#39;</span><span class="p">);</span>                        <span class="c1">// 2001-05-18 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="k">new</span> <span class="nx">Carbon</span><span class="p">(</span><span class="s1">&#39;this thursday&#39;</span><span class="p">);</span>                      <span class="c1">// 2001-05-24 00:00:00
</span></span></span></code></pre></div><h3 id="å–å¾—æ—¥æœŸèµ„æ–™">å–å¾—æ—¥æœŸèµ„æ–™</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">parse</span><span class="p">(</span><span class="s1">&#39;2012-9-5 23:26:11.123789&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å–çš„æŒ‡å®šæ™‚é–“è³‡æ–™çš„è³‡è¨Šï¼ˆæ•´æ•¸ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">year</span><span class="p">);</span>                                         <span class="c1">// int(2012)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">month</span><span class="p">);</span>                                        <span class="c1">// int(9)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">day</span><span class="p">);</span>                                          <span class="c1">// int(5)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">hour</span><span class="p">);</span>                                         <span class="c1">// int(23)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">minute</span><span class="p">);</span>                                       <span class="c1">// int(26)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">second</span><span class="p">);</span>                                       <span class="c1">// int(11)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">micro</span><span class="p">);</span>                                        <span class="c1">// int(123789)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">dayOfWeek</span><span class="p">);</span>                                    <span class="c1">// int(3)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">dayOfYear</span><span class="p">);</span>                                    <span class="c1">// int(248)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">weekOfMonth</span><span class="p">);</span>                                  <span class="c1">// int(1)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">weekOfYear</span><span class="p">);</span>                                   <span class="c1">// int(36)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">daysInMonth</span><span class="p">);</span>                                  <span class="c1">// int(30)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">);</span>                                    <span class="c1">// int(1346901971)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">);</span>          <span class="c1">// int(39) calculated vs now in the same tz
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">quarter</span><span class="p">);</span>                                      <span class="c1">// int(3)å­£åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å›å‚³èˆ‡ UTC å·®ç•°çš„ç§’æ•¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromTimestampUTC</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">offset</span><span class="p">);</span>         <span class="c1">// int(0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromTimestamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">offset</span><span class="p">);</span>            <span class="c1">// int(-18000)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å›å‚³èˆ‡ UTC å·®ç•°çš„æ™‚æ•¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromTimestamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">offsetHours</span><span class="p">);</span>       <span class="c1">// int(-5)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰¾å‡ºç•¶å¤©æ—¥å¦æœ‰æ—¥å…‰ç¯€ç´„æ™‚é–“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">dst</span><span class="p">);</span>           <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">dst</span><span class="p">);</span>           <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ¤æ–·æŒ‡å®šçš„çš„æ™‚å€æ˜¯å¦èˆ‡é è¨­çš„æ™‚å€ç›¸åŒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">local</span><span class="p">);</span>                              <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">(</span><span class="s1">&#39;America/Vancouver&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">local</span><span class="p">);</span>           <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ¤æ–·æ˜¯å¦ç‚º UTC çš„æ™‚å€æ™‚é–“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">utc</span><span class="p">);</span>                                <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">(</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">utc</span><span class="p">);</span>                 <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromTimestampUTC</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">utc</span><span class="p">);</span>            <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å–å¾—æ™‚å€å¯¦ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">get_class</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">timezone</span><span class="p">);</span>                     <span class="c1">// DateTimeZone
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">get_class</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">tz</span><span class="p">);</span>                           <span class="c1">// DateTimeZone
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å–å¾—æ™‚å€å¯¦ä¾‹çš„åç¨±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">timezoneName</span><span class="p">;</span>                            <span class="c1">// America/Toronto
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">tzName</span><span class="p">;</span>                                  <span class="c1">// America/Toronto
</span></span></span></code></pre></div><h3 id="è®¾å®šæ—¶é—´èµ„æ–™">è®¾å®šæ—¶é—´èµ„æ–™</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">year</span> <span class="o">=</span> <span class="mi">1975</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">month</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>             <span class="c1">// å¹´ä»½æœƒå¼·åˆ¶ +1ï¼Œä¸”æœˆä»½è®Šç‚º 1 æœˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">month</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">day</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">hour</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">minute</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">second</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">timestamp</span> <span class="o">=</span> <span class="mi">169957925</span><span class="p">;</span>  <span class="c1">// é€™å€‹è¨­å®šä¸æœƒè®Šæ›´æ™‚å€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// é€éå­—ä¸²æˆ–æ˜¯ DateTimeZone å¯¦ä¾‹å»è¨­å®šæ™‚å€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">timezone</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTimeZone</span><span class="p">(</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">timezone</span> <span class="o">=</span> <span class="s1">&#39;Europe/London&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">tz</span> <span class="o">=</span> <span class="s1">&#39;Europe/London&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// éˆçµè¨­å®šæ–¹å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">year</span><span class="p">(</span><span class="mi">1975</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">month</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">day</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">hour</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">minute</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">second</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">setDate</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setTime</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">setDateTime</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">(</span><span class="mi">169957925</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">timezone</span><span class="p">(</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">tz</span><span class="p">(</span><span class="s1">&#39;America/Toronto&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setTimezone</span><span class="p">(</span><span class="s1">&#39;America/Vancouver&#39;</span><span class="p">);</span>
</span></span></code></pre></div><h3 id="æ ¼å¼åŒ–æ—¶é—´èµ„æ–™">æ ¼å¼åŒ–æ—¶é—´èµ„æ–™</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">()</span> <span class="o">==</span> <span class="nv">$dt</span><span class="p">);</span>          <span class="c1">// bool(true) =&gt; uses __toString()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toDateString</span><span class="p">();</span>                          <span class="c1">// 1975-12-25
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toFormattedDateString</span><span class="p">();</span>                 <span class="c1">// Dec 25, 1975
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toTimeString</span><span class="p">();</span>                          <span class="c1">// 14:15:16
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>                      <span class="c1">// 1975-12-25 14:15:16
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toDayDateTimeString</span><span class="p">();</span>                   <span class="c1">// Thu, Dec 25, 1975 2:15 PM
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä»å¯ä»¥ä½¿ç”¨ format() å‡½å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;l jS \\of F Y h:i:s A&#39;</span><span class="p">);</span>         <span class="c1">// Thursday 25th of December 1975 02:15:16 PM
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¸¸ç”¨çš„æ™‚é–“æ ¼å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toAtomString</span><span class="p">();</span>      <span class="c1">// in 1 Jahr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toCookieString</span><span class="p">();</span>    <span class="c1">// Thursday, 25-Dec-1975 14:15:16 EST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toIso8601String</span><span class="p">();</span>   <span class="c1">// 1975-12-25T14:15:16-0500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toRfc822String</span><span class="p">();</span>    <span class="c1">// Thu, 25 Dec 75 14:15:16 -0500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toRfc850String</span><span class="p">();</span>    <span class="c1">// Thursday, 25-Dec-75 14:15:16 EST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toRfc1036String</span><span class="p">();</span>   <span class="c1">// Thu, 25 Dec 75 14:15:16 -0500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toRfc1123String</span><span class="p">();</span>   <span class="c1">// Thu, 25 Dec 1975 14:15:16 -0500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toRfc2822String</span><span class="p">();</span>   <span class="c1">// Thu, 25 Dec 1975 14:15:16 -0500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toRfc3339String</span><span class="p">();</span>   <span class="c1">// 1975-12-25T14:15:16-05:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toRssString</span><span class="p">();</span>       <span class="c1">// Thu, 25 Dec 1975 14:15:16 -0500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toW3cString</span><span class="p">();</span>       <span class="c1">// 1975-12-25T14:15:16-05:00
</span></span></span></code></pre></div><h3 id="æ¯”è¾ƒæ—¶é—´å·®å€¼">æ¯”è¾ƒæ—¶é—´å·®å€¼</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">tzName</span><span class="p">;</span>                        <span class="c1">// America/Toronto
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$first</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$second</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;America/Vancouver&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$first</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>                   <span class="c1">// 2012-09-05 23:26:11
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$first</span><span class="o">-&gt;</span><span class="na">tzName</span><span class="p">;</span>                               <span class="c1">// America/Toronto
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$second</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>                  <span class="c1">// 2012-09-05 20:26:11
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$second</span><span class="o">-&gt;</span><span class="na">tzName</span><span class="p">;</span>                              <span class="c1">// America/Vancouver
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å¤§æ–¼ã€ç­‰æ–¼ã€å°æ–¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                     <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">ne</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                     <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">gt</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                     <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">gte</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                    <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">lt</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                     <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">lte</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                    <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">setDateTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$second</span><span class="o">-&gt;</span><span class="na">setDateTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>         <span class="c1">// Remember tz is &#39;America/Vancouver&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                     <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">ne</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                     <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">gt</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                     <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">gte</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                    <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">lt</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                     <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$first</span><span class="o">-&gt;</span><span class="na">lte</span><span class="p">(</span><span class="nv">$second</span><span class="p">));</span>                    <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ™‚é–“å€é–“æ¯”è¼ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$first</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$second</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">between</span><span class="p">(</span><span class="nv">$first</span><span class="p">,</span> <span class="nv">$second</span><span class="p">));</span>          <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">between</span><span class="p">(</span><span class="nv">$first</span><span class="p">,</span> <span class="nv">$second</span><span class="p">));</span>          <span class="c1">// bool(true)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">between</span><span class="p">(</span><span class="nv">$first</span><span class="p">,</span> <span class="nv">$second</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>   <span class="c1">// bool(false)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ™‚é–“å¤§å°æ¯”è¼ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$dt1</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt2</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt1</span><span class="o">-&gt;</span><span class="na">min</span><span class="p">(</span><span class="nv">$dt2</span><span class="p">);</span>                              <span class="c1">// 2012-01-01 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt1</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt2</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt1</span><span class="o">-&gt;</span><span class="na">max</span><span class="p">(</span><span class="nv">$dt2</span><span class="p">);</span>                              <span class="c1">// 2014-01-30 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// now is the default param
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$dt1</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt1</span><span class="o">-&gt;</span><span class="na">max</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ™‚é–“å·®ç•°é‹ç®—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">(</span><span class="s1">&#39;America/Vancouver&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">diffInSeconds</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">(</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">));</span> <span class="c1">// 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$dtOttawa</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;America/Toronto&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dtVancouver</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;America/Vancouver&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dtOttawa</span><span class="o">-&gt;</span><span class="na">diffInHours</span><span class="p">(</span><span class="nv">$dtVancouver</span><span class="p">);</span>                             <span class="c1">// 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dtOttawa</span><span class="o">-&gt;</span><span class="na">diffInHours</span><span class="p">(</span><span class="nv">$dtVancouver</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>                      <span class="c1">// 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dtVancouver</span><span class="o">-&gt;</span><span class="na">diffInHours</span><span class="p">(</span><span class="nv">$dtOttawa</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>                      <span class="c1">// -3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffInDays</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addMonth</span><span class="p">());</span>                         <span class="c1">// 31
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffInDays</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subMonth</span><span class="p">(),</span> <span class="k">false</span><span class="p">);</span>                  <span class="c1">// -31
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffInDays</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addMonth</span><span class="p">());</span>                         <span class="c1">// 30
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffInDays</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addWeek</span><span class="p">());</span>                          <span class="c1">// 7
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffInMinutes</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addSeconds</span><span class="p">(</span><span class="mi">59</span><span class="p">));</span>                  <span class="c1">// 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffInMinutes</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addSeconds</span><span class="p">(</span><span class="mi">60</span><span class="p">));</span>                  <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffInMinutes</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addSeconds</span><span class="p">(</span><span class="mi">119</span><span class="p">));</span>                 <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffInMinutes</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addSeconds</span><span class="p">(</span><span class="mi">120</span><span class="p">));</span>                 <span class="c1">// 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addSeconds</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">secondsSinceMidnight</span><span class="p">();</span>                     <span class="c1">// 120
</span></span></span></code></pre></div><h3 id="æ—¶é—´çŠ¶æ€">æ—¶é—´çŠ¶æ€</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">isWeekday</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">isWeekend</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">isYesterday</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">isToday</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">isTomorrow</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">isFuture</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">isPast</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">isLeapYear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">isSameDay</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="nv">$born</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="mi">1987</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">23</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$noCake</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">26</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$yesCake</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">23</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$born</span><span class="o">-&gt;</span><span class="na">isBirthday</span><span class="p">(</span><span class="nv">$noCake</span><span class="p">));</span>              <span class="c1">// bool(false)  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nv">$born</span><span class="o">-&gt;</span><span class="na">isBirthday</span><span class="p">(</span><span class="nv">$yesCake</span><span class="p">));</span>             <span class="c1">// bool(true)
</span></span></span></code></pre></div><h3 id="æ—¶é—´è¿ç®—">æ—¶é—´è¿ç®—</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">();</span>            <span class="c1">// 2012-01-31 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addYears</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>                   <span class="c1">// 2017-01-31 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addYear</span><span class="p">();</span>                     <span class="c1">// 2018-01-31 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subYear</span><span class="p">();</span>                     <span class="c1">// 2017-01-31 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subYears</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>                   <span class="c1">// 2012-01-31 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addMonths</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>                 <span class="c1">// 2017-01-31 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addMonth</span><span class="p">();</span>                    <span class="c1">// 2017-03-03 00:00:00 equivalent of $dt-&gt;month($dt-&gt;month + 1); so it wraps
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subMonth</span><span class="p">();</span>                    <span class="c1">// 2017-02-03 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subMonths</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>                 <span class="c1">// 2012-02-03 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addDays</span><span class="p">(</span><span class="mi">29</span><span class="p">);</span>                   <span class="c1">// 2012-03-03 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addDay</span><span class="p">();</span>                      <span class="c1">// 2012-03-04 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subDay</span><span class="p">();</span>                      <span class="c1">// 2012-03-03 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subDays</span><span class="p">(</span><span class="mi">29</span><span class="p">);</span>                   <span class="c1">// 2012-02-03 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addWeekdays</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>                <span class="c1">// 2012-02-09 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addWeekday</span><span class="p">();</span>                  <span class="c1">// 2012-02-10 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subWeekday</span><span class="p">();</span>                  <span class="c1">// 2012-02-09 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subWeekdays</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>                <span class="c1">// 2012-02-03 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addWeeks</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>                   <span class="c1">// 2012-02-24 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addWeek</span><span class="p">();</span>                     <span class="c1">// 2012-03-02 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subWeek</span><span class="p">();</span>                     <span class="c1">// 2012-02-24 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subWeeks</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>                   <span class="c1">// 2012-02-03 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addHours</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>                  <span class="c1">// 2012-02-04 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addHour</span><span class="p">();</span>                     <span class="c1">// 2012-02-04 01:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subHour</span><span class="p">();</span>                     <span class="c1">// 2012-02-04 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subHours</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>                  <span class="c1">// 2012-02-03 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addMinutes</span><span class="p">(</span><span class="mi">61</span><span class="p">);</span>                <span class="c1">// 2012-02-03 01:01:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addMinute</span><span class="p">();</span>                   <span class="c1">// 2012-02-03 01:02:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subMinute</span><span class="p">();</span>                   <span class="c1">// 2012-02-03 01:01:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subMinutes</span><span class="p">(</span><span class="mi">61</span><span class="p">);</span>                <span class="c1">// 2012-02-03 00:00:00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addSeconds</span><span class="p">(</span><span class="mi">61</span><span class="p">);</span>                <span class="c1">// 2012-02-03 00:01:01
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">addSecond</span><span class="p">();</span>                   <span class="c1">// 2012-02-03 00:01:02
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subSecond</span><span class="p">();</span>                   <span class="c1">// 2012-02-03 00:01:01
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">subSeconds</span><span class="p">(</span><span class="mi">61</span><span class="p">);</span>                <span class="c1">// 2012-02-03 00:00:00
</span></span></span></code></pre></div><h3 id="äººç±»é˜…è¯»æ—¶é—´æ ¼å¼">äººç±»é˜…è¯»æ—¶é—´æ ¼å¼</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é€šå¸¸æœƒç”¨åœ¨ç•™è¨€çš„æ™‚é–“é¡¯ç¤º
</span></span></span><span class="line"><span class="cl"><span class="c1">// è©²æ™‚é–“æœƒæ¯”è¼ƒèˆ‡ç¾åœ¨çš„æ™‚é–“çš„å·®ç•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subDays</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">diffForHumans</span><span class="p">();</span>               <span class="c1">// 5 days ago
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">diffForHumans</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subYear</span><span class="p">());</span>   <span class="c1">// 1 year after
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$dt</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromDate</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffForHumans</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addMonth</span><span class="p">());</span>              <span class="c1">// 1 month before
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">diffForHumans</span><span class="p">(</span><span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subMonth</span><span class="p">());</span>              <span class="c1">// 1 month after
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addSeconds</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">diffForHumans</span><span class="p">();</span>            <span class="c1">// 5 seconds from now
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subDays</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">diffForHumans</span><span class="p">();</span>              <span class="c1">// 3 weeks ago
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subDays</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">diffForHumans</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>    <span class="c1">// 3 weeks
</span></span></span></code></pre></div><h3 id="æ—¶é—´å¸¸æ•°">æ—¶é—´å¸¸æ•°</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">SUNDAY</span><span class="p">);</span>                          <span class="c1">// int(0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">MONDAY</span><span class="p">);</span>                          <span class="c1">// int(1)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">TUESDAY</span><span class="p">);</span>                         <span class="c1">// int(2)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">WEDNESDAY</span><span class="p">);</span>                       <span class="c1">// int(3)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">THURSDAY</span><span class="p">);</span>                        <span class="c1">// int(4)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">FRIDAY</span><span class="p">);</span>                          <span class="c1">// int(5)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">SATURDAY</span><span class="p">);</span>                        <span class="c1">// int(6)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">YEARS_PER_CENTURY</span><span class="p">);</span>               <span class="c1">// int(100)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">YEARS_PER_DECADE</span><span class="p">);</span>                <span class="c1">// int(10)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">MONTHS_PER_YEAR</span><span class="p">);</span>                 <span class="c1">// int(12)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">WEEKS_PER_YEAR</span><span class="p">);</span>                  <span class="c1">// int(52)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">DAYS_PER_WEEK</span><span class="p">);</span>                   <span class="c1">// int(7)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">HOURS_PER_DAY</span><span class="p">);</span>                   <span class="c1">// int(24)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">MINUTES_PER_HOUR</span><span class="p">);</span>                <span class="c1">// int(60)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">(</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">SECONDS_PER_MINUTE</span><span class="p">);</span>              <span class="c1">// int(60)
</span></span></span></code></pre></div><h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a href="https://blog.csdn.net/lbwo001/article/details/53063867">https://blog.csdn.net/lbwo001/article/details/53063867</a></p>
<ul>
<li>Carbon - A simple PHP API extension for DateTime.</li>
<li>Carbon - docs</li>
</ul>
]]></content>
		</item>
		
		<item>
			<title>Laravelä¸­é—´ä»¶ğŸ‘½</title>
			<link>https://blog.gookm.cn/posts/2017/20170913-laravel-middleware/</link>
			<pubDate>Wed, 13 Sep 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170913-laravel-middleware/</guid>
			<description>å¦‚ï¼šlaravelè‡ªå¸¦çš„ç”¨æˆ·è®¤è¯å¦‚ä½•åœ¨æ³¨å†Œå‰æ‰§è¡Œä¸­é—´ä»¶ï¼Ÿ
å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ä¸­é—´ä»¶æ¥è§£å†³ã€‚
å¤§è‡´æµç¨‹ï¼š
ç¬¬ä¸€æ­¥ è¿è¡ŒArtisan å‘½ä»¤ make:middleware åˆ›å»ºæ–°çš„ä¸­é—´ä»¶ï¼š php artisan make:middleware CheckIpIsRegistered ç¬¬äºŒæ­¥ ç¼–å†™ä¸­é—´ä»¶ &amp;lt;?php namespace App\Http\Middleware; use Closure; class CheckIpIsRegistered { /** * å¤„ç†ä¼ å…¥çš„è¯·æ±‚ * * @param \Illuminate\Http\Request $request * @param \Closure $next * @return mixed */ public function handle($request, Closure $next) { if (false) { //æ·»åŠ çš„ä½ é€»è¾‘ return redirect(&amp;#39;home&amp;#39;); } return $next($request); } } ç¬¬ä¸‰æ­¥ å† app/Http/Kernel.php æ³¨å†Œä¸­é—´ä»¶ï¼š protected $routeMiddleware = [ &amp;#39;auth&amp;#39; =&amp;gt; \Illuminate\Auth\Middleware\Authenticate::class, &amp;#39;auth.basic&amp;#39; =&amp;gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class, &amp;#39;bindings&amp;#39; =&amp;gt; \Illuminate\Routing\Middleware\SubstituteBindings::class, &amp;#39;can&amp;#39; =&amp;gt; \Illuminate\Auth\Middleware\Authorize::class, &amp;#39;guest&amp;#39; =&amp;gt; \App\Http\Middleware\RedirectIfAuthenticated::class, &amp;#39;throttle&amp;#39; =&amp;gt; \Illuminate\Routing\Middleware\ThrottleRequests::class, &amp;#39;checkip&amp;#39; =&amp;gt; CheckIpIsRegistered::class, ]; ç¬¬å››æ­¥ -æ·»åŠ ä¸­é—´ä»¶åˆ°è·¯ç”±</description>
			<content type="html"><![CDATA[<p>å¦‚ï¼šlaravelè‡ªå¸¦çš„ç”¨æˆ·è®¤è¯å¦‚ä½•åœ¨æ³¨å†Œå‰æ‰§è¡Œä¸­é—´ä»¶ï¼Ÿ</p>
<p>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ä¸­é—´ä»¶æ¥è§£å†³ã€‚</p>
<p><strong>å¤§è‡´æµç¨‹ï¼š</strong></p>
<h3 id="ç¬¬ä¸€æ­¥">ç¬¬ä¸€æ­¥</h3>
<ul>
<li>è¿è¡ŒArtisan å‘½ä»¤ make:middleware åˆ›å»ºæ–°çš„ä¸­é—´ä»¶ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan make:middleware CheckIpIsRegistered
</span></span></code></pre></div><h3 id="ç¬¬äºŒæ­¥">ç¬¬äºŒæ­¥</h3>
<ul>
<li>ç¼–å†™ä¸­é—´ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CheckIpIsRegistered</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * å¤„ç†ä¼ å…¥çš„è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="sd">     *
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param  \Illuminate\Http\Request  $request
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param  \Closure  $next
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @return mixed
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">//æ·»åŠ çš„ä½ é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="ç¬¬ä¸‰æ­¥">ç¬¬ä¸‰æ­¥</h3>
<ul>
<li>å† app/Http/Kernel.php æ³¨å†Œä¸­é—´ä»¶ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="nv">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;auth&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\Authenticate</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;auth.basic&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\AuthenticateWithBasicAuth</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;bindings&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;can&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\Authorize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;guest&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\RedirectIfAuthenticated</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;throttle&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\ThrottleRequests</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;checkip&#39;</span> <span class="o">=&gt;</span> <span class="nx">CheckIpIsRegistered</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div><h3 id="ç¬¬å››æ­¥">ç¬¬å››æ­¥</h3>
<p>-æ·»åŠ ä¸­é—´ä»¶åˆ°è·¯ç”±</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;user/register&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">})</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;checkip&#39;</span><span class="p">);</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Laravelå…³è”æ¨¡å‹</title>
			<link>https://blog.gookm.cn/posts/2017/20170806-laravel-model/</link>
			<pubDate>Sun, 06 Aug 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170806-laravel-model/</guid>
			<description>laravelå…³è”å…³ç³»
ä»¥å¤šå¯¹å¤šä¸ºä¾‹ ä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªè§’è‰²ï¼Œå¯ä»¥æ˜¯æ™®é€šç®¡ç†å‘˜ï¼Œä¹Ÿå¯ä»¥æ˜¯è¶…çº§ç®¡ç†å‘˜
ä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜ä¹Ÿå¯ä»¥è¢«å¤šä¸ªç”¨æˆ·æ‹¥æœ‰
å¤šå¯¹å¤šå…³è”æ¯” hasOne å’Œ hasMany å…³è”ç¨å¾®å¤æ‚äº›ã€‚è¿™ç§å…³è”çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯å…·æœ‰è®¸å¤šè§’è‰²çš„ç”¨æˆ·ï¼Œè€Œè§’è‰²ä¹Ÿè¢«å…¶ä»–ç”¨æˆ·å…±äº«ã€‚ä¾‹å¦‚ï¼Œè®¸å¤šç”¨æˆ·éƒ½å¯ä»¥æœ‰ã€Œç®¡ç†å‘˜ã€è§’è‰²ã€‚è¦å®šä¹‰è¿™ç§å…³è”ï¼Œéœ€è¦ç”¨åˆ°ä¸‰ä¸ªæ•°æ®åº“è¡¨ï¼šusersã€roles å’Œ role_userã€‚role_user è¡¨æ˜¯ä»¥ç›¸å…³è”çš„ä¸¤ä¸ªæ¨¡å‹æ•°æ®è¡¨ã€ä¾ç…§å­—æ¯é¡ºåºæ’åˆ—å‘½åçš„ï¼Œå¹¶ä¸”åŒ…å« user_id å’Œ role_id å­—æ®µã€‚
å¤šå¯¹å¤šå…³è”æ˜¯é€šè¿‡å†™ä¸€ä¸ªæ–¹æ³•å®šä¹‰çš„ï¼Œåœ¨æ–¹æ³•å†…éƒ¨è°ƒç”¨ belongsToMany æ–¹æ³•å¹¶è¿”å›å…¶ç»“æœã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ User æ¨¡å‹ä¸­å®šä¹‰ä¸€ä¸ª roles æ–¹æ³•ï¼š
&amp;lt;?php namespace App; use Illuminate\Database\Eloquent\Model; class User extends Model { /** * è·å¾—æ­¤ç”¨æˆ·çš„è§’è‰²ã€‚ */ public function roles() { return $this-&amp;gt;belongsToMany(&amp;#39;App\Role&amp;#39;, &amp;#39;role_user&amp;#39;, &amp;#39;user_id&amp;#39;, &amp;#39;role_id&amp;#39;);//è¦æ–°å»ºå¥½Roleæ¨¡å‹ } } å…³è”å…³ç³»å®šä¹‰å¥½åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ roles åŠ¨æ€å±æ€§è·å¾—ç”¨æˆ·çš„è§’è‰²äº†ï¼š
$roles = App\User::find(1)-&amp;gt;roles()-&amp;gt;orderBy(&amp;#39;name&amp;#39;)-&amp;gt;get(); ä¸­é—´è¡¨ç›¸å…³ï¼š
1ã€è·å¾—ä¸­é—´è¡¨å­—æ®µ $user = App\User::find(1); foreach ($user-&amp;gt;roles as $role) { echo $role-&amp;gt;pivot-&amp;gt;created_at; } 2ã€é»˜è®¤æƒ…å†µä¸‹ï¼Œpivot å¯¹è±¡åªåŒ…å«ä¸¤ä¸ªå…³è”æ¨¡å‹çš„é”®ã€‚å¦‚æœä¸­é—´è¡¨é‡Œè¿˜æœ‰é¢å¤–å­—æ®µï¼Œåˆ™å¿…é¡»åœ¨å®šä¹‰å…³è”æ—¶æ˜ç¡®æŒ‡å‡ºï¼š return $this-&amp;gt;belongsToMany(&amp;#39;App\Role&amp;#39;)-&amp;gt;withPivot(&amp;#39;column1&amp;#39;, &amp;#39;column2&amp;#39;); 3ã€å¦‚æœæ‚¨æƒ³è®©ä¸­é—´è¡¨è‡ªåŠ¨ç»´æŠ¤ created_at å’Œ updated_at æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆåœ¨å®šä¹‰å…³è”æ—¶åŠ ä¸Š withTimestamps æ–¹æ³•å³å¯ï¼š return $this-&amp;gt;belongsToMany(&amp;#39;App\Role&amp;#39;)-&amp;gt;withTimestamps(); 4ã€é€šè¿‡ä¸­é—´è¡¨è¿‡æ»¤å…³è”æ•°æ®ï¼š return $this-&amp;gt;belongsToMany(&amp;#39;App\Role&amp;#39;)-&amp;gt;wherePivot(&amp;#39;approved&amp;#39;, 1); return $this-&amp;gt;belongsToMany(&amp;#39;App\Role&amp;#39;)-&amp;gt;wherePivotIn(&amp;#39;priority&amp;#39;, [1, 2]); é¢„åŠ è½½ å½“ä½œä¸ºå±æ€§è®¿é—® Eloquent å…³è”æ—¶ï¼Œå…³è”æ•°æ®æ˜¯ã€Œæ‡’åŠ è½½ã€çš„ã€‚æ„å‘³ç€åœ¨ä½ ç¬¬ä¸€æ¬¡è®¿é—®è¯¥å±æ€§æ—¶ï¼Œæ‰ä¼šåŠ è½½å…³è”æ•°æ®ã€‚ä¸è¿‡ï¼Œæ˜¯å½“ä½ æŸ¥è¯¢çˆ¶æ¨¡å‹æ—¶ï¼ŒEloquent å¯ä»¥ã€Œé¢„åŠ è½½ã€å…³è”æ•°æ®ã€‚é¢„åŠ è½½é¿å…äº† N + 1 æŸ¥è¯¢é—®é¢˜ã€‚è¦è¯´æ˜ N + 1 æŸ¥è¯¢é—®é¢˜ï¼Œè¯•æƒ³ä¸€ä¸ª Book æ¨¡å‹å…³è”åˆ° Author æ¨¡å‹ï¼š</description>
			<content type="html"><![CDATA[<p><strong>laravelå…³è”å…³ç³»</strong></p>
<h3 id="ä»¥å¤šå¯¹å¤šä¸ºä¾‹">ä»¥å¤šå¯¹å¤šä¸ºä¾‹</h3>
<ul>
<li>
<p>ä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªè§’è‰²ï¼Œå¯ä»¥æ˜¯æ™®é€šç®¡ç†å‘˜ï¼Œä¹Ÿå¯ä»¥æ˜¯è¶…çº§ç®¡ç†å‘˜</p>
</li>
<li>
<p>ä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜ä¹Ÿå¯ä»¥è¢«å¤šä¸ªç”¨æˆ·æ‹¥æœ‰</p>
</li>
</ul>
<p>å¤šå¯¹å¤šå…³è”æ¯” hasOne å’Œ hasMany å…³è”ç¨å¾®å¤æ‚äº›ã€‚è¿™ç§å…³è”çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯å…·æœ‰è®¸å¤šè§’è‰²çš„ç”¨æˆ·ï¼Œè€Œè§’è‰²ä¹Ÿè¢«å…¶ä»–ç”¨æˆ·å…±äº«ã€‚ä¾‹å¦‚ï¼Œè®¸å¤šç”¨æˆ·éƒ½å¯ä»¥æœ‰ã€Œç®¡ç†å‘˜ã€è§’è‰²ã€‚è¦å®šä¹‰è¿™ç§å…³è”ï¼Œéœ€è¦ç”¨åˆ°ä¸‰ä¸ªæ•°æ®åº“è¡¨ï¼šusersã€roles å’Œ role_userã€‚role_user è¡¨æ˜¯ä»¥ç›¸å…³è”çš„ä¸¤ä¸ªæ¨¡å‹æ•°æ®è¡¨ã€ä¾ç…§å­—æ¯é¡ºåºæ’åˆ—å‘½åçš„ï¼Œå¹¶ä¸”åŒ…å« user_id å’Œ role_id å­—æ®µã€‚</p>
<p>å¤šå¯¹å¤šå…³è”æ˜¯é€šè¿‡å†™ä¸€ä¸ªæ–¹æ³•å®šä¹‰çš„ï¼Œåœ¨æ–¹æ³•å†…éƒ¨è°ƒç”¨ belongsToMany æ–¹æ³•å¹¶è¿”å›å…¶ç»“æœã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ User æ¨¡å‹ä¸­å®šä¹‰ä¸€ä¸ª roles æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * è·å¾—æ­¤ç”¨æˆ·çš„è§’è‰²ã€‚
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">roles</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">,</span> <span class="s1">&#39;role_user&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;role_id&#39;</span><span class="p">);</span><span class="c1">//è¦æ–°å»ºå¥½Roleæ¨¡å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å…³è”å…³ç³»å®šä¹‰å¥½åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ roles åŠ¨æ€å±æ€§è·å¾—ç”¨æˆ·çš„è§’è‰²äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$roles</span> <span class="o">=</span> <span class="nx">App\User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">roles</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span></code></pre></div><p>ä¸­é—´è¡¨ç›¸å…³ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="mi">1</span><span class="nx">ã€è·å¾—ä¸­é—´è¡¨å­—æ®µ</span>
</span></span><span class="line"><span class="cl"><span class="nv">$user</span> <span class="o">=</span> <span class="nx">App\User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">roles</span> <span class="k">as</span> <span class="nv">$role</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nv">$role</span><span class="o">-&gt;</span><span class="na">pivot</span><span class="o">-&gt;</span><span class="na">created_at</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="nx">ã€é»˜è®¤æƒ…å†µä¸‹ï¼Œpivot</span> <span class="nx">å¯¹è±¡åªåŒ…å«ä¸¤ä¸ªå…³è”æ¨¡å‹çš„é”®ã€‚å¦‚æœä¸­é—´è¡¨é‡Œè¿˜æœ‰é¢å¤–å­—æ®µï¼Œåˆ™å¿…é¡»åœ¨å®šä¹‰å…³è”æ—¶æ˜ç¡®æŒ‡å‡ºï¼š</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">withPivot</span><span class="p">(</span><span class="s1">&#39;column1&#39;</span><span class="p">,</span> <span class="s1">&#39;column2&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span><span class="nx">ã€å¦‚æœæ‚¨æƒ³è®©ä¸­é—´è¡¨è‡ªåŠ¨ç»´æŠ¤</span> <span class="nx">created_at</span> <span class="nx">å’Œ</span> <span class="nx">updated_at</span> <span class="nx">æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆåœ¨å®šä¹‰å…³è”æ—¶åŠ ä¸Š</span> <span class="nx">withTimestamps</span> <span class="nx">æ–¹æ³•å³å¯ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">withTimestamps</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="nx">ã€é€šè¿‡ä¸­é—´è¡¨è¿‡æ»¤å…³è”æ•°æ®ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">wherePivot</span><span class="p">(</span><span class="s1">&#39;approved&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="s1">&#39;App\Role&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">wherePivotIn</span><span class="p">(</span><span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
</span></span></code></pre></div><h3 id="é¢„åŠ è½½">é¢„åŠ è½½</h3>
<p>å½“ä½œä¸ºå±æ€§è®¿é—® Eloquent å…³è”æ—¶ï¼Œå…³è”æ•°æ®æ˜¯ã€Œæ‡’åŠ è½½ã€çš„ã€‚æ„å‘³ç€åœ¨ä½ ç¬¬ä¸€æ¬¡è®¿é—®è¯¥å±æ€§æ—¶ï¼Œæ‰ä¼šåŠ è½½å…³è”æ•°æ®ã€‚ä¸è¿‡ï¼Œæ˜¯å½“ä½ æŸ¥è¯¢çˆ¶æ¨¡å‹æ—¶ï¼ŒEloquent å¯ä»¥ã€Œé¢„åŠ è½½ã€å…³è”æ•°æ®ã€‚é¢„åŠ è½½é¿å…äº† N + 1 æŸ¥è¯¢é—®é¢˜ã€‚è¦è¯´æ˜ N + 1 æŸ¥è¯¢é—®é¢˜ï¼Œè¯•æƒ³ä¸€ä¸ª Book æ¨¡å‹å…³è”åˆ° Author æ¨¡å‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Book</span> <span class="k">extends</span> <span class="nx">Model</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * è·å¾—æ­¤ä¹¦çš„ä½œè€…ã€‚
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">author</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">&#39;App\Author&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥è·å¾—æ‰€æœ‰ä¹¦ç±å’Œä½œè€…æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$books</span> <span class="o">=</span> <span class="nx">App\Book</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$books</span> <span class="k">as</span> <span class="nv">$book</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">author</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¿™ä¸ªå¾ªç¯ä¼šè¿è¡Œä¸€æ¬¡æŸ¥è¯¢å–å›æ‰€æœ‰æ•°æ®è¡¨ä¸Šçš„ä¹¦ç±æ•°æ®ï¼Œç„¶ååˆè¿è¡Œä¸€æ¬¡æŸ¥è¯¢è·å¾—æ¯æœ¬ä¹¦çš„ä½œè€…æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬æœ‰ 25 æœ¬ä¹¦ï¼Œåˆ™å¾ªç¯å°±ä¼šæ‰§è¡Œ 26 æ¬¡æŸ¥è¯¢ï¼š1 æ¬¡æ˜¯è·å¾—æ‰€æœ‰ä¹¦ç±æ•°æ®ï¼Œå¦å¤– 25 æ¡æŸ¥è¯¢ç”¨æ¥è·å¾—æ¯æœ¬ä¹¦çš„ä½œè€…æ•°æ®ã€‚</p>
<p>è°¢å¤©è°¢åœ°ï¼Œæˆ‘ä»¬ä½¿ç”¨é¢„åŠ è½½è®©æ•´ä¸ªæŸ¥è¯¢å‡å°‘åˆ° 2 æ¬¡ã€‚è¿™æ˜¯é€šè¿‡æŒ‡å®šå…³è”ç»™ with æ–¹æ³•åŠåˆ°çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$books</span> <span class="o">=</span> <span class="nx">App\Book</span><span class="o">::</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$books</span> <span class="k">as</span> <span class="nv">$book</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">author</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ•´ä¸ªæ“ä½œï¼Œåªæ‰§è¡Œäº†ä¸¤æ¡æŸ¥è¯¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">books</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w">
</span></span></span></code></pre></div><h3 id="é¢„åŠ è½½ç›¸å…³">é¢„åŠ è½½ç›¸å…³</h3>
<p>1ã€é¢„åŠ è½½å¤šä¸ªå…³è”ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$books</span> <span class="o">=</span> <span class="nx">App\Book</span><span class="o">::</span><span class="na">with</span><span class="p">([</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span></code></pre></div><p>2ã€é¢„åŠ è½½åµŒå¥—å…³è”ï¼Œå¯ä»¥ä½¿ç”¨ã€Œç‚¹ã€è¯­æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª Eloquent è¯­å¥ä¸­ï¼Œé¢„åŠ è½½æ‰€æœ‰ä¹¦ç±ä½œè€…å’Œè¿™äº›ä½œè€…çš„è”ç³»ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$books</span> <span class="o">=</span> <span class="nx">App\Book</span><span class="o">::</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;author.contacts&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span></code></pre></div><p>3ã€ä¸ºé¢„åŠ è½½æ·»åŠ çº¦æŸæ¡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$users</span> <span class="o">=</span> <span class="nx">App\User</span><span class="o">::</span><span class="na">with</span><span class="p">([</span><span class="s1">&#39;posts&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;%first%&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}])</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span></code></pre></div><p>4ã€å»¶è¿Ÿé¢„åŠ è½½ã€‚æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦åœ¨è·å¾—çˆ¶çº§æ¨¡å‹åæ‰å»é¢„åŠ è½½å…³è”æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ éœ€è¦æ¥åŠ¨æ€å†³å®šæ˜¯å¦åŠ è½½å…³è”æ¨¡å‹æ—¶ï¼Œè¿™å¯èƒ½å¾ˆæœ‰å¸®åŠ©ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$books</span> <span class="o">=</span> <span class="nx">App\Book</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$someCondition</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$books</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¦‚æœæ‚¨æƒ³è®¾ç½®é¢„åŠ è½½æŸ¥è¯¢çš„é¢å¤–çº¦æŸæ¡ä»¶ï¼Œå¯ä»¥é€šè¿‡ç»™ load æ·»åŠ æ•°ç»„é”®çš„å½¢å¼è¾¾åˆ°ç›®çš„ï¼Œæ•°ç»„å€¼æ˜¯æ¥æ”¶æŸ¥è¯¢å®ä¾‹çš„é—­åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$books</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">([</span><span class="s1">&#39;author&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">,</span> <span class="s1">&#39;asc&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}]);</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Nginxä¸PHPäº¤äº’ğŸ¤</title>
			<link>https://blog.gookm.cn/posts/2017/20170721-nginx-php/</link>
			<pubDate>Fri, 21 Jul 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170721-nginx-php/</guid>
			<description>å®šä¹‰CGIï¼ŒFastCGIï¼ŒPHP-FPM 1. ä»€ä¹ˆæ˜¯CGIï¼Ÿ &amp;gt;CGIæ˜¯ä¸€ç§é€šç”¨ç½‘å…³åè®®ã€‚ä¸ºäº†è§£å†³ä¸åŒçš„è¯­è¨€è§£é‡Šå™¨(å¦‚phpã€pythonè§£é‡Šå™¨)ä¸WebServerçš„é€šä¿¡è€Œäº§ç”Ÿçš„ä¸€ç§åè®®ã€‚åªè¦éµå®ˆè¿™ç§åè®®å°±èƒ½å®ç°è¯­è¨€ä¸WebServeré€šè®¯ã€‚CGIæ˜¯è§„å®šäº†è¦ä¼ ä»€ä¹ˆæ•°æ®ï¼ä»¥ä»€ä¹ˆæ ¼å¼ä¼ è¾“ç»™phpè§£æå™¨çš„åè®®ã€‚ 2. ä»€ä¹ˆæ˜¯FastCGI? &amp;gt;æ˜¯ä¸€ç§å¯¹CGIåè®®å‡åçš„ä¸€ç§åè®®ã€‚FastCGIåƒæ˜¯ä¸€ä¸ªå¸¸é©»(long-live)å‹çš„CGIï¼Œå®ƒå¯ä»¥ä¸€ç›´æ‰§è¡Œç€ï¼Œåªè¦æ¿€æ´»åï¼Œä¸ä¼šæ¯æ¬¡éƒ½è¦èŠ±è´¹æ—¶é—´å»forkä¸€æ¬¡(è¿™æ˜¯CGIæœ€ä¸ºäººè¯Ÿç—…çš„fork-and-execute æ¨¡å¼)ã€‚å®ƒè¿˜æ”¯æŒåˆ†å¸ƒå¼çš„è¿ç®—, å³ FastCGI ç¨‹åºå¯ä»¥åœ¨ç½‘ç«™æœåŠ¡å™¨ä»¥å¤–çš„ä¸»æœºä¸Šæ‰§è¡Œå¹¶ä¸”æ¥å—æ¥è‡ªå…¶å®ƒç½‘ç«™æœåŠ¡å™¨æ¥çš„è¯·æ±‚ã€‚ã€‚ 3. ä»€ä¹ˆæ˜¯PHP-FPM? &amp;gt;(PHP FastCGI Process Manager)ï¼ŒPHP-FPMæ˜¯ä¸€ä¸ªå®ç°äº†Fastcgiåè®®çš„ç¨‹åº,ç”¨æ¥ç®¡ç†Fastcgièµ·çš„è¿›ç¨‹çš„,å³èƒ½å¤Ÿè°ƒåº¦php-cgiè¿›ç¨‹çš„ç¨‹åºã€‚å¹¶æä¾›äº†è¿›ç¨‹ç®¡ç†çš„åŠŸèƒ½ã€‚è¿›ç¨‹åŒ…å« master è¿›ç¨‹å’Œ worker è¿›ç¨‹ä¸¤ç§è¿›ç¨‹ã€‚masterè¿›ç¨‹åªæœ‰ä¸€ä¸ªï¼Œè´Ÿè´£ç›‘å¬ç«¯å£(é»˜è®¤9000)ï¼Œæ¥æ”¶æ¥è‡ª WebServerçš„è¯·æ±‚ï¼Œè€Œ worker è¿›ç¨‹åˆ™ä¸€èˆ¬æœ‰å¤šä¸ª(å…·ä½“æ•°é‡æ ¹æ®å®é™…éœ€è¦é…ç½®)ï¼Œæ¯ä¸ªè¿›ç¨‹å†…éƒ¨éƒ½åµŒå…¥äº†ä¸€ä¸ª PHP è§£é‡Šå™¨ï¼Œæ˜¯PHPä»£ç çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹ã€‚ 4. FastCGIå¥½åœ¨å“ªé‡Œï¼Ÿ &amp;gt;Fastcgiåˆ™ä¼šå…ˆforkä¸€ä¸ªmasterï¼Œè§£æé…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒï¼Œç„¶åå†forkå¤šä¸ªworkerã€‚å½“è¯·æ±‚è¿‡æ¥æ—¶ï¼Œmasterä¼šä¼ é€’ç»™ä¸€ä¸ªworkerï¼Œç„¶åç«‹å³å¯ä»¥æ¥å—ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚è¿™æ ·å°±é¿å…äº†é‡å¤çš„åŠ³åŠ¨ï¼Œæ•ˆç‡è‡ªç„¶æ˜¯é«˜ã€‚è€Œä¸”å½“workerä¸å¤Ÿç”¨æ—¶ï¼Œmasterå¯ä»¥æ ¹æ®é…ç½®é¢„å…ˆå¯åŠ¨å‡ ä¸ªworkerç­‰ç€ï¼›å½“ç„¶ç©ºé—²workerå¤ªå¤šæ—¶ï¼Œä¹Ÿä¼šåœæ‰ä¸€äº›ï¼Œè¿™æ ·å°±æé«˜äº†æ€§èƒ½ï¼Œä¹ŸèŠ‚çº¦äº†èµ„æºã€‚è¿™å°±æ˜¯Fastcgiçš„å¯¹è¿›ç¨‹çš„ç®¡ç†ã€‚å¤§å¤šæ•°Fastcgiå®ç°éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªè¿›ç¨‹æ± ã€‚æ³¨ï¼šswooleä½œä¸ºhttpserverï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ç±»ä¼¼è¿™æ ·çš„å·¥ä½œæ–¹å¼ã€‚ Nginxä¸PHPäº¤äº’è¿‡ç¨‹ æˆ‘ä»¬ä»¥ç”¨æˆ·è®¿é—®index.phpä¸ºï¼ŒæœåŠ¡å™¨ç¯å¢ƒä¸ºLNMP: 1. ç”¨æˆ·è¯·æ±‚index.phpæ—¶ï¼Œé¦–å…ˆåˆ°Nginx 2.Nginxæµç¨‹æ­¥éª¤ï¼š - æ ¹æ®é…ç½®æŸ¥æ‰¾è·¯ç”± - åŠ è½½nginxçš„fast-cgiæ¨¡å—(FastCGIçš„Client),å°†æ ¹æ®fastcgi.confæ–‡ä»¶ä¸­fastcgi_*é…ç½®å‚æ•°å€¼ä¹Ÿä¸€å¹¶åŠ å…¥è½¬å‘ä»»åŠ¡ä¸­ - æ ¹æ®nginx.confæ–‡ä»¶fastcgi_passé…ç½®å°†è¯·æ±‚è½¬å‘åˆ°127.0.0.1:9000ã€‚ 3.PHP-FPMæ“ä½œï¼š - PHP-FPMçš„masterè¿›ç¨‹ç›‘å¬9000ç«¯å£ã€‚ - æ”¶åˆ°è¯·æ±‚åè°ƒç”¨å­è¿›ç¨‹æ¥å¤„ç†é€»è¾‘ï¼ŒPHPè§£é‡Šå™¨è§£é‡ŠPHPè¯­æ³•å¹¶è¿”å›ç»™Nginxã€‚ 4.Nginxæ“ä½œï¼š - å°†å“åº”è¿”å›ç»™ç”¨æˆ· </description>
			<content type="html"><![CDATA[<h3 id="å®šä¹‰cgifastcgiphp-fpm">å®šä¹‰CGIï¼ŒFastCGIï¼ŒPHP-FPM</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1. ä»€ä¹ˆæ˜¯CGIï¼Ÿ
</span></span><span class="line"><span class="cl">   &gt;CGIæ˜¯ä¸€ç§é€šç”¨ç½‘å…³åè®®ã€‚ä¸ºäº†è§£å†³ä¸åŒçš„è¯­è¨€è§£é‡Šå™¨(å¦‚phpã€pythonè§£é‡Šå™¨)ä¸WebServerçš„é€šä¿¡è€Œäº§ç”Ÿçš„ä¸€ç§åè®®ã€‚åªè¦éµå®ˆè¿™ç§åè®®å°±èƒ½å®ç°è¯­è¨€ä¸WebServeré€šè®¯ã€‚CGIæ˜¯è§„å®šäº†è¦ä¼ ä»€ä¹ˆæ•°æ®ï¼ä»¥ä»€ä¹ˆæ ¼å¼ä¼ è¾“ç»™phpè§£æå™¨çš„åè®®ã€‚
</span></span><span class="line"><span class="cl">2. ä»€ä¹ˆæ˜¯FastCGI?
</span></span><span class="line"><span class="cl">   &gt;æ˜¯ä¸€ç§å¯¹CGIåè®®å‡åçš„ä¸€ç§åè®®ã€‚FastCGIåƒæ˜¯ä¸€ä¸ªå¸¸é©»(long-live)å‹çš„CGIï¼Œå®ƒå¯ä»¥ä¸€ç›´æ‰§è¡Œç€ï¼Œåªè¦æ¿€æ´»åï¼Œä¸ä¼šæ¯æ¬¡éƒ½è¦èŠ±è´¹æ—¶é—´å»forkä¸€æ¬¡(è¿™æ˜¯CGIæœ€ä¸ºäººè¯Ÿç—…çš„fork-and-execute æ¨¡å¼)ã€‚å®ƒè¿˜æ”¯æŒåˆ†å¸ƒå¼çš„è¿ç®—, å³ FastCGI ç¨‹åºå¯ä»¥åœ¨ç½‘ç«™æœåŠ¡å™¨ä»¥å¤–çš„ä¸»æœºä¸Šæ‰§è¡Œå¹¶ä¸”æ¥å—æ¥è‡ªå…¶å®ƒç½‘ç«™æœåŠ¡å™¨æ¥çš„è¯·æ±‚ã€‚ã€‚
</span></span><span class="line"><span class="cl">3. ä»€ä¹ˆæ˜¯PHP-FPM?
</span></span><span class="line"><span class="cl">   &gt;(PHP FastCGI Process Manager)ï¼ŒPHP-FPMæ˜¯ä¸€ä¸ªå®ç°äº†Fastcgiåè®®çš„ç¨‹åº,ç”¨æ¥ç®¡ç†Fastcgièµ·çš„è¿›ç¨‹çš„,å³èƒ½å¤Ÿè°ƒåº¦php-cgiè¿›ç¨‹çš„ç¨‹åºã€‚å¹¶æä¾›äº†è¿›ç¨‹ç®¡ç†çš„åŠŸèƒ½ã€‚è¿›ç¨‹åŒ…å« master è¿›ç¨‹å’Œ worker è¿›ç¨‹ä¸¤ç§è¿›ç¨‹ã€‚masterè¿›ç¨‹åªæœ‰ä¸€ä¸ªï¼Œè´Ÿè´£ç›‘å¬ç«¯å£(é»˜è®¤9000)ï¼Œæ¥æ”¶æ¥è‡ª WebServerçš„è¯·æ±‚ï¼Œè€Œ worker è¿›ç¨‹åˆ™ä¸€èˆ¬æœ‰å¤šä¸ª(å…·ä½“æ•°é‡æ ¹æ®å®é™…éœ€è¦é…ç½®)ï¼Œæ¯ä¸ªè¿›ç¨‹å†…éƒ¨éƒ½åµŒå…¥äº†ä¸€ä¸ª PHP è§£é‡Šå™¨ï¼Œæ˜¯PHPä»£ç çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹ã€‚
</span></span><span class="line"><span class="cl">4. FastCGIå¥½åœ¨å“ªé‡Œï¼Ÿ
</span></span><span class="line"><span class="cl">   &gt;Fastcgiåˆ™ä¼šå…ˆforkä¸€ä¸ªmasterï¼Œè§£æé…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒï¼Œç„¶åå†forkå¤šä¸ªworkerã€‚å½“è¯·æ±‚è¿‡æ¥æ—¶ï¼Œmasterä¼šä¼ é€’ç»™ä¸€ä¸ªworkerï¼Œç„¶åç«‹å³å¯ä»¥æ¥å—ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚è¿™æ ·å°±é¿å…äº†é‡å¤çš„åŠ³åŠ¨ï¼Œæ•ˆç‡è‡ªç„¶æ˜¯é«˜ã€‚è€Œä¸”å½“workerä¸å¤Ÿç”¨æ—¶ï¼Œmasterå¯ä»¥æ ¹æ®é…ç½®é¢„å…ˆå¯åŠ¨å‡ ä¸ªworkerç­‰ç€ï¼›å½“ç„¶ç©ºé—²workerå¤ªå¤šæ—¶ï¼Œä¹Ÿä¼šåœæ‰ä¸€äº›ï¼Œè¿™æ ·å°±æé«˜äº†æ€§èƒ½ï¼Œä¹ŸèŠ‚çº¦äº†èµ„æºã€‚è¿™å°±æ˜¯Fastcgiçš„å¯¹è¿›ç¨‹çš„ç®¡ç†ã€‚å¤§å¤šæ•°Fastcgiå®ç°éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªè¿›ç¨‹æ± ã€‚æ³¨ï¼šswooleä½œä¸ºhttpserverï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ç±»ä¼¼è¿™æ ·çš„å·¥ä½œæ–¹å¼ã€‚
</span></span></code></pre></div><h3 id="nginxä¸phpäº¤äº’è¿‡ç¨‹">Nginxä¸PHPäº¤äº’è¿‡ç¨‹</h3>
<ul>
<li>æˆ‘ä»¬ä»¥ç”¨æˆ·è®¿é—®index.phpä¸ºï¼ŒæœåŠ¡å™¨ç¯å¢ƒä¸ºLNMP:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1. ç”¨æˆ·è¯·æ±‚index.phpæ—¶ï¼Œé¦–å…ˆåˆ°Nginx
</span></span><span class="line"><span class="cl">2.Nginxæµç¨‹æ­¥éª¤ï¼š
</span></span><span class="line"><span class="cl">   - æ ¹æ®é…ç½®æŸ¥æ‰¾è·¯ç”±
</span></span><span class="line"><span class="cl">   - åŠ è½½nginxçš„fast-cgiæ¨¡å—(FastCGIçš„Client),å°†æ ¹æ®fastcgi.confæ–‡ä»¶ä¸­fastcgi_*é…ç½®å‚æ•°å€¼ä¹Ÿä¸€å¹¶åŠ å…¥è½¬å‘ä»»åŠ¡ä¸­
</span></span><span class="line"><span class="cl">   - æ ¹æ®nginx.confæ–‡ä»¶fastcgi_passé…ç½®å°†è¯·æ±‚è½¬å‘åˆ°127.0.0.1:9000ã€‚
</span></span><span class="line"><span class="cl">3.PHP-FPMæ“ä½œï¼š
</span></span><span class="line"><span class="cl">   - PHP-FPMçš„masterè¿›ç¨‹ç›‘å¬9000ç«¯å£ã€‚
</span></span><span class="line"><span class="cl">   - æ”¶åˆ°è¯·æ±‚åè°ƒç”¨å­è¿›ç¨‹æ¥å¤„ç†é€»è¾‘ï¼ŒPHPè§£é‡Šå™¨è§£é‡ŠPHPè¯­æ³•å¹¶è¿”å›ç»™Nginxã€‚
</span></span><span class="line"><span class="cl">4.Nginxæ“ä½œï¼š
</span></span><span class="line"><span class="cl">   - å°†å“åº”è¿”å›ç»™ç”¨æˆ·
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>GuzzleåŸºæœ¬ä½¿ç”¨</title>
			<link>https://blog.gookm.cn/posts/2017/20170702-guzzle-basic/</link>
			<pubDate>Sun, 02 Jul 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170702-guzzle-basic/</guid>
			<description>Guzzleæ˜¯ä¸€ä¸ªPHPçš„HTTPå®¢æˆ·ç«¯ï¼Œç”¨æ¥è½»è€Œæ˜“ä¸¾åœ°å‘é€è¯·æ±‚ï¼Œå¹¶é›†æˆåˆ°æˆ‘ä»¬çš„WEBæœåŠ¡ä¸Šã€‚ ç±»ä¼¼äºcurlå‘é€httpè¯·æ±‚çš„ç±»ã€‚
Guzzleå®˜æ–¹æ–‡æ¡£
å®‰è£…Guzzle ä½¿ç”¨composerå®‰è£…
php composer.phar require guzzlehttp/guzzle:~6.0 æˆ–è€…ç¼–è¾‘é¡¹ç›®çš„composer.jsonæ–‡ä»¶ï¼Œæ·»åŠ Guzzleä½œä¸ºä¾èµ–
{ &amp;#34;require&amp;#34;: { &amp;#34;guzzlehttp/guzzle&amp;#34;: &amp;#34;~6.0&amp;#34; } } æ‰§è¡Œ composer update GuzzleåŸºæœ¬ä½¿ç”¨ å‘é€è¯·æ±‚ use GuzzleHttp\Client; $client = new Client([ // Base URI is used with relative requests &amp;#39;base_uri&amp;#39; =&amp;gt; &amp;#39;http://httpbin.org&amp;#39;, // You can set any number of default request options. &amp;#39;timeout&amp;#39; =&amp;gt; 2.0, ]); $response = $client-&amp;gt;get(&amp;#39;http://httpbin.org/get&amp;#39;); $response = $client-&amp;gt;delete(&amp;#39;http://httpbin.org/delete&amp;#39;); $response = $client-&amp;gt;head(&amp;#39;http://httpbin.org/get&amp;#39;); $response = $client-&amp;gt;options(&amp;#39;http://httpbin.org/get&amp;#39;); $response = $client-&amp;gt;patch(&amp;#39;http://httpbin.org/patch&amp;#39;); $response = $client-&amp;gt;post(&amp;#39;http://httpbin.</description>
			<content type="html"><![CDATA[<blockquote>
<p>Guzzleæ˜¯ä¸€ä¸ªPHPçš„HTTPå®¢æˆ·ç«¯ï¼Œç”¨æ¥è½»è€Œæ˜“ä¸¾åœ°å‘é€è¯·æ±‚ï¼Œå¹¶é›†æˆåˆ°æˆ‘ä»¬çš„WEBæœåŠ¡ä¸Šã€‚
ç±»ä¼¼äºcurlå‘é€httpè¯·æ±‚çš„ç±»ã€‚</p>
</blockquote>
<p><a href="https://guzzle-cn.readthedocs.io/zh_CN/latest/quickstart.html">Guzzleå®˜æ–¹æ–‡æ¡£</a></p>
<h3 id="å®‰è£…guzzle">å®‰è£…Guzzle</h3>
<p>ä½¿ç”¨composerå®‰è£…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php composer.phar require guzzlehttp/guzzle:~6.0
</span></span></code></pre></div><p>æˆ–è€…ç¼–è¾‘é¡¹ç›®çš„composer.jsonæ–‡ä»¶ï¼Œæ·»åŠ Guzzleä½œä¸ºä¾èµ–</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;require&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;guzzlehttp/guzzle&#34;</span><span class="p">:</span> <span class="s2">&#34;~6.0&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>æ‰§è¡Œ composer update</li>
</ul>
<h3 id="guzzleåŸºæœ¬ä½¿ç”¨">GuzzleåŸºæœ¬ä½¿ç”¨</h3>
<ul>
<li>å‘é€è¯·æ±‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">GuzzleHttp\Client</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Base URI is used with relative requests
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;base_uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://httpbin.org&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// You can set any number of default request options.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;timeout&#39;</span>  <span class="o">=&gt;</span> <span class="mf">2.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/delete&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">head</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">options</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">patch</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/patch&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/put&#39;</span><span class="p">);</span>
</span></span></code></pre></div><ul>
<li>è®¾ç½®æŸ¥è¯¢å­—ç¬¦ä¸²</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://httpbin.org?foo=bar&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>æˆ–ä½¿ç”¨ query è¯·æ±‚å‚æ•°æ¥å£°æ˜æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://httpbin.org&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;query&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span></code></pre></div><ul>
<li>è®¾ç½®POSTè¡¨å•</li>
</ul>
<p>ä¼ å…¥ form_params æ•°ç»„å‚æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;form_params&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;field_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;abc&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;other_field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;nested_field&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;nested&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;hello&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span></code></pre></div><ul>
<li>ä½¿ç”¨å“åº”</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">### çŠ¶æ€ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$code</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">();</span> <span class="c1">// 200
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$reason</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getReasonPhrase</span><span class="p">();</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">### header
</span></span></span><span class="line"><span class="cl"><span class="c1">// Check if a header exists.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">hasHeader</span><span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;It exists&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Get a header from the response.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeader</span><span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Get all of the response headers.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeaders</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$name</span> <span class="o">=&gt;</span> <span class="nv">$values</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nv">$name</span> <span class="o">.</span> <span class="s1">&#39;: &#39;</span> <span class="o">.</span> <span class="nx">implode</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nv">$values</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="å“åº”ä½“">å“åº”ä½“</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$body</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Implicitly cast the body to a string and echo it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nv">$body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Explicitly cast the body to a string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$stringBody</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Read 10 bytes from the body
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$tenBytes</span> <span class="o">=</span> <span class="nv">$body</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Read the remaining contents of the body as a string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$remainingBytes</span> <span class="o">=</span> <span class="nv">$body</span><span class="o">-&gt;</span><span class="na">getContents</span><span class="p">();</span>
</span></span></code></pre></div><h3 id="ç®€å•æ¡ˆä¾‹">ç®€å•æ¡ˆä¾‹</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">GuzzleHttp\Client</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//use GuzzleHttp\Psr7\Request;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl"><span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$request</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span><span class="s1">&#39;http://xxxx.com/test&#39;</span><span class="p">,[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;query&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;f66748648e4deddcba65ad9504776b74&#39;</span> <span class="p">,</span> <span class="s1">&#39;v&#39;</span> <span class="o">=&gt;</span> <span class="mf">1.0</span> <span class="p">,</span> <span class="s1">&#39;month&#39;</span> <span class="o">=&gt;</span> <span class="mi">11</span> <span class="p">,</span> <span class="s1">&#39;day&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">decoding</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$cipher</span><span class="o">=</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">decode_value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$res</span><span class="o">=</span><span class="nx">Md5</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;cipher&#39;</span><span class="p">,</span><span class="nv">$cipher</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;plain&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$plain</span><span class="o">=</span><span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;plain&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$url</span><span class="o">=</span><span class="s2">&#34;http://www.test.com/do.php?c=Api&amp;m=crack&amp;uid=&#34;</span><span class="o">.</span><span class="nv">$uid</span><span class="o">.</span><span class="s2">&#34;&amp;token=&#34;</span><span class="o">.</span><span class="nv">$token</span><span class="o">.</span><span class="s2">&#34;&amp;cipher=&#34;</span><span class="o">.</span><span class="nv">$cipher</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="nx">json_decode</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>PHPStormä¸­ä½¿ç”¨FTPåŠŸèƒ½æ­¥éª¤ğŸ”</title>
			<link>https://blog.gookm.cn/posts/2017/20170611-phpstorm-ftp/</link>
			<pubDate>Sun, 11 Jun 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170611-phpstorm-ftp/</guid>
			<description>phpStormä¸­ä½¿ç”¨FTPåŠŸèƒ½æ­¥éª¤
PHPStormæ‹¥æœ‰FTPåŠŸèƒ½ï¼Œå› æ­¤æ— éœ€ä¸‹è½½å…¶ä»–FTPè½¯ä»¶
FTP æ˜¯File Transfer Protocolï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰çš„è‹±æ–‡ç®€ç§°ï¼Œè€Œä¸­æ–‡ç®€ç§°ä¸ºâ€œæ–‡ä¼ åè®®â€ã€‚ç”¨äºInternetä¸Šçš„æ§åˆ¶æ–‡ä»¶çš„åŒå‘ä¼ è¾“ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰ã€‚åŸºäºä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰ä¸åŒçš„FTPåº”ç”¨ç¨‹åºï¼Œè€Œæ‰€æœ‰è¿™äº›åº”ç”¨ç¨‹åºéƒ½éµå®ˆåŒä¸€ç§åè®®ä»¥ä¼ è¾“æ–‡ä»¶ã€‚åœ¨FTPçš„ä½¿ç”¨å½“ä¸­ï¼Œç”¨æˆ·ç»å¸¸é‡åˆ°ä¸¤ä¸ªæ¦‚å¿µï¼š&amp;ldquo;ä¸‹è½½&amp;rdquo;ï¼ˆDownloadï¼‰å’Œ&amp;quot;ä¸Šä¼ &amp;quot;ï¼ˆUploadï¼‰ã€‚&amp;ldquo;ä¸‹è½½&amp;quot;æ–‡ä»¶å°±æ˜¯ä»è¿œç¨‹ä¸»æœºæ‹·è´æ–‡ä»¶è‡³è‡ªå·±çš„è®¡ç®—æœºä¸Šï¼›&amp;ldquo;ä¸Šä¼ &amp;quot;æ–‡ä»¶å°±æ˜¯å°†æ–‡ä»¶ä»è‡ªå·±çš„è®¡ç®—æœºä¸­æ‹·è´è‡³è¿œç¨‹ä¸»æœºä¸Šã€‚ç”¨é€šä¿—è¯­è¨€æ¥è¯´ï¼Œç”¨æˆ·å¯é€šè¿‡å®¢æˆ·æœºç¨‹åºå‘è¿œç¨‹ä¸»æœºä¸Šä¼ æ–‡ä»¶æˆ–è€…ä»è¿œç¨‹ä¸»æœºä¸‹è½½æ–‡ä»¶ã€‚
ç¬¬ä¸€æ­¥ æ‰¾åˆ°å¤´éƒ¨çš„å·¥å…·æ ï¼Œç‚¹å‡» Toolï¼ˆå·¥å…·ï¼‰ï¼Œé€‰æ‹© Deploymentä¸‹çš„ Configuration... ç¬¬äºŒæ­¥ ç‚¹å‡»å·¦ä¸Šè§’çš„ + å·ï¼Œæ·»åŠ ä¸€ä¸ª web serverï¼Œåœ¨å¼¹çª—ä¸­å¡«å†™ç›¸å…³ä¿¡æ¯ ç¬¬ä¸‰æ­¥ å¡«å†™ Hostã€Portã€User Nameã€Password ç­‰ä¿¡æ¯ï¼Œä¸æœåŠ¡å™¨é“¾æ¥ ç¬¬å››æ­¥ åˆ‡æ¢åˆ° Mappingsï¼Œé€‰æ‹©æ ¹è·¯å¾„ </description>
			<content type="html"><![CDATA[<p>phpStormä¸­ä½¿ç”¨FTPåŠŸèƒ½æ­¥éª¤</p>
<p><strong>PHPStormæ‹¥æœ‰FTPåŠŸèƒ½ï¼Œå› æ­¤æ— éœ€ä¸‹è½½å…¶ä»–FTPè½¯ä»¶</strong></p>
<blockquote>
<p>FTP æ˜¯File Transfer Protocolï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰çš„è‹±æ–‡ç®€ç§°ï¼Œè€Œä¸­æ–‡ç®€ç§°ä¸ºâ€œæ–‡ä¼ åè®®â€ã€‚ç”¨äºInternetä¸Šçš„æ§åˆ¶æ–‡ä»¶çš„åŒå‘ä¼ è¾“ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰ã€‚åŸºäºä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰ä¸åŒçš„FTPåº”ç”¨ç¨‹åºï¼Œè€Œæ‰€æœ‰è¿™äº›åº”ç”¨ç¨‹åºéƒ½éµå®ˆåŒä¸€ç§åè®®ä»¥ä¼ è¾“æ–‡ä»¶ã€‚åœ¨FTPçš„ä½¿ç”¨å½“ä¸­ï¼Œç”¨æˆ·ç»å¸¸é‡åˆ°ä¸¤ä¸ªæ¦‚å¿µï¼š&ldquo;ä¸‹è½½&rdquo;ï¼ˆDownloadï¼‰å’Œ&quot;ä¸Šä¼ &quot;ï¼ˆUploadï¼‰ã€‚&ldquo;ä¸‹è½½&quot;æ–‡ä»¶å°±æ˜¯ä»è¿œç¨‹ä¸»æœºæ‹·è´æ–‡ä»¶è‡³è‡ªå·±çš„è®¡ç®—æœºä¸Šï¼›&ldquo;ä¸Šä¼ &quot;æ–‡ä»¶å°±æ˜¯å°†æ–‡ä»¶ä»è‡ªå·±çš„è®¡ç®—æœºä¸­æ‹·è´è‡³è¿œç¨‹ä¸»æœºä¸Šã€‚ç”¨é€šä¿—è¯­è¨€æ¥è¯´ï¼Œç”¨æˆ·å¯é€šè¿‡å®¢æˆ·æœºç¨‹åºå‘è¿œç¨‹ä¸»æœºä¸Šä¼ æ–‡ä»¶æˆ–è€…ä»è¿œç¨‹ä¸»æœºä¸‹è½½æ–‡ä»¶ã€‚</p>
</blockquote>
<h3 id="ç¬¬ä¸€æ­¥">ç¬¬ä¸€æ­¥</h3>
<ul>
<li>æ‰¾åˆ°å¤´éƒ¨çš„å·¥å…·æ ï¼Œç‚¹å‡» <code>Toolï¼ˆå·¥å…·ï¼‰</code>ï¼Œé€‰æ‹© <code>Deployment</code>ä¸‹çš„ <code>Configuration...</code></li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2017/20170611-phpstorm-ftp01.jpg" alt="å›¾ä¸€"></p>
<h3 id="ç¬¬äºŒæ­¥">ç¬¬äºŒæ­¥</h3>
<ul>
<li>ç‚¹å‡»å·¦ä¸Šè§’çš„ <code>+</code> å·ï¼Œæ·»åŠ ä¸€ä¸ª <code>web server</code>ï¼Œåœ¨å¼¹çª—ä¸­å¡«å†™ç›¸å…³ä¿¡æ¯</li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2017/20170611-phpstorm-ftp02.jpg" alt="å›¾äºŒ"></p>
<h3 id="ç¬¬ä¸‰æ­¥">ç¬¬ä¸‰æ­¥</h3>
<ul>
<li>å¡«å†™ <code>Host</code>ã€<code>Port</code>ã€<code>User Name</code>ã€<code>Password</code> ç­‰ä¿¡æ¯ï¼Œä¸æœåŠ¡å™¨é“¾æ¥</li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2017/20170611-phpstorm-ftp03.jpg" alt="å›¾ä¸‰"></p>
<h3 id="ç¬¬å››æ­¥">ç¬¬å››æ­¥</h3>
<ul>
<li>åˆ‡æ¢åˆ° <code>Mappings</code>ï¼Œé€‰æ‹©æ ¹è·¯å¾„</li>
</ul>
<p><img src="https://qiniu.zkilm.cn/blog/posts/2017/20170611-phpstorm-ftp04.jpg" alt="å›¾å››"></p>
]]></content>
		</item>
		
		<item>
			<title>Laravelæ“ä½œä¸Šä¼ æ–‡ä»¶çš„æ–¹æ³•</title>
			<link>https://blog.gookm.cn/posts/2017/20170604-laravel-upload/</link>
			<pubDate>Sun, 04 Jun 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170604-laravel-upload/</guid>
			<description>1ã€è·å–ä¸Šä¼ çš„æ–‡ä»¶
$file = $request-&amp;gt;file(&amp;#39;file&amp;#39;); 2ã€è·å–ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶åï¼ˆå¸¦åç¼€ï¼Œå¦‚test.pngï¼‰
$filename = $file-&amp;gt;getClientOriginalName(); 3ã€è·å–ä¸Šä¼ æ–‡ä»¶çš„åç¼€ï¼ˆå¦‚test.pngï¼Œè·å–åˆ°çš„ä¸ºpngï¼‰
$fileextension = $file-&amp;gt;getClientOriginalExtension(); 4ã€è·å–ä¸Šä¼ æ–‡ä»¶çš„å¤§å°
$filesize = $file-&amp;gt;getClientSize(); 5ã€è·å–ç¼“å­˜åœ¨tmpç›®å½•ä¸‹çš„æ–‡ä»¶åï¼ˆå¸¦åç¼€ï¼Œå¦‚php1234.tmpï¼‰
$filaname = $file-&amp;gt;getFilename(); 6ã€è·å–ä¸Šä¼ çš„æ–‡ä»¶ç¼“å­˜åœ¨tmpæ–‡ä»¶å¤¹ä¸‹çš„ç»å¯¹è·¯å¾„
$realpath = $file-&amp;gt;getRealPath(); 7ã€å°†ç¼“å­˜åœ¨tmpç›®å½•ä¸‹çš„æ–‡ä»¶ç§»åˆ°æŸä¸ªä½ç½®ï¼Œè¿”å›çš„æ˜¯è¿™ä¸ªæ–‡ä»¶ç§»åŠ¨è¿‡åçš„è·¯å¾„
$path = $file-&amp;gt;move(path,newname); //move()æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶ç§»åˆ°å“ªä¸ªæ–‡ä»¶å¤¹ä¸‹çš„è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å°†ä¸Šä¼ çš„æ–‡ä»¶é‡æ–°å‘½åçš„æ–‡ä»¶å 8ã€æ£€æµ‹ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦åˆæ³•ï¼Œè¿”å›å€¼ä¸ºtrueæˆ–false
$file-&amp;gt;isValid() </description>
			<content type="html"><![CDATA[<p>1ã€è·å–ä¸Šä¼ çš„æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>2ã€è·å–ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶åï¼ˆå¸¦åç¼€ï¼Œå¦‚test.pngï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">();</span>
</span></span></code></pre></div><p>3ã€è·å–ä¸Šä¼ æ–‡ä»¶çš„åç¼€ï¼ˆå¦‚test.pngï¼Œè·å–åˆ°çš„ä¸ºpngï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$fileextension</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalExtension</span><span class="p">();</span>
</span></span></code></pre></div><p>4ã€è·å–ä¸Šä¼ æ–‡ä»¶çš„å¤§å°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$filesize</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientSize</span><span class="p">();</span>
</span></span></code></pre></div><p>5ã€è·å–ç¼“å­˜åœ¨tmpç›®å½•ä¸‹çš„æ–‡ä»¶åï¼ˆå¸¦åç¼€ï¼Œå¦‚php1234.tmpï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$filaname</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getFilename</span><span class="p">();</span>
</span></span></code></pre></div><p>6ã€è·å–ä¸Šä¼ çš„æ–‡ä»¶ç¼“å­˜åœ¨tmpæ–‡ä»¶å¤¹ä¸‹çš„ç»å¯¹è·¯å¾„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$realpath</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getRealPath</span><span class="p">();</span>
</span></span></code></pre></div><p>7ã€å°†ç¼“å­˜åœ¨tmpç›®å½•ä¸‹çš„æ–‡ä»¶ç§»åˆ°æŸä¸ªä½ç½®ï¼Œè¿”å›çš„æ˜¯è¿™ä¸ªæ–‡ä»¶ç§»åŠ¨è¿‡åçš„è·¯å¾„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$path</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">newname</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//move()æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶ç§»åˆ°å“ªä¸ªæ–‡ä»¶å¤¹ä¸‹çš„è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å°†ä¸Šä¼ çš„æ–‡ä»¶é‡æ–°å‘½åçš„æ–‡ä»¶å
</span></span></span></code></pre></div><p>8ã€æ£€æµ‹ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦åˆæ³•ï¼Œè¿”å›å€¼ä¸ºtrueæˆ–false</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Laravelå­¦ä¹ ç¬”è®°ï¼ˆå››ï¼‰ğŸ–</title>
			<link>https://blog.gookm.cn/posts/2017/20170527-laravel-study04/</link>
			<pubDate>Sat, 27 May 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170527-laravel-study04/</guid>
			<description>ä»¥ä¸‹éƒ½æ˜¯ä¸ªäººåœ¨å­¦ä¹ æˆ–æ˜¯å·¥ä½œä¸­çš„éƒ¨åˆ†è®°å½•ï¼š
laravelè¿è¡¨é¢å¤–æ·»åŠ æ¡ä»¶ Product::query()-&amp;gt;from(&amp;#39;products as p&amp;#39;) -&amp;gt;leftJoin(&amp;#39;user_has_products as uhp&amp;#39;, function ($join){ $join-&amp;gt;on(&amp;#39;p.id&amp;#39;, &amp;#39;=&amp;#39;, &amp;#39;uhp.product_id&amp;#39;)-&amp;gt;where(&amp;#39;uhp.user_role&amp;#39;,&amp;#39;=&amp;#39;,&amp;#39;1&amp;#39;); }) laravelä¸­çš„å¤šæ¡ä»¶ Notice::where([&amp;#39;cate&amp;#39;=&amp;gt;2,&amp;#39;is_show&amp;#39;=&amp;gt;1]) laravel carbon æ—¶é—´æˆ³è½¬æ—¥æœŸ $date=Carbon::createFromTimestamp(&amp;#34;æ—¶é—´æˆ³&amp;#34;)-&amp;gt;toDateTimeString() ; //è·å–æ˜¨å¤©çš„æ—¶é—´æˆ³ $ts = Carbon::yesterday()-&amp;gt;timestamp; laravelæ—¶åŒºè®¾ç½® config/app.php //åè°ƒä¸–ç•Œæ—¶(UTC, Universal Time Coordinated)ï¼Œåˆç§°ä¸–ç•Œç»Ÿä¸€æ—¶é—´ï¼Œä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œå›½é™…åè°ƒæ—¶é—´ã€‚ &amp;#39;timezone&amp;#39; =&amp;gt; &amp;#39;UTC&amp;#39;,//// //ä¸­å›½æ ‡å‡†æ—¶é—´ &amp;#39;timezone&amp;#39; =&amp;gt; &amp;#39;PRC&amp;#39;, laravelä¸­è‡ªå¸¦bootstrapçš„å­—ä½“è·¯å¾„ //(è§£å†³æ‰¾ä¸åˆ°glyphicons-halflings-regular.woffé—®é¢˜) vendor-&amp;gt;phpunit-&amp;gt;php-code-coverage-&amp;gt;src-&amp;gt;Report-&amp;gt;Html-&amp;gt;Renderer-&amp;gt;Template-&amp;gt;fonts //æ‰¾ä¸åˆ°fontawesome-webfont.woffåŠï¼Ÿv=4.2.0é—®é¢˜ ä¸‹è½½åœ°å€ï¼ˆhttp://www.xz7.com/dir/329345.htmlï¼‰ï¼Œæ›´æ”¹ç›¸åº”jsä»£ç å¯å°†ï¼Ÿåéƒ¨åˆ†å»æ‰ï¼Œå› ä¸ºæ–‡ä»¶ä¸èƒ½å¸¦&amp;#39;?&amp;#39;ç­‰å­—ç¬¦ çº¿ä¸ŠæœåŠ¡å™¨æ‰§è¡Œ composer du æŠ¥é”™ [Symfony\Component\Process\Exception\RuntimeException] The Process class relies on proc_open, which is not available on your PHP installation. è§£å†³åŠæ³•ï¼š ä¿®æ”¹php.inié…ç½®æ–‡ä»¶ï¼Œå¹¶æœç´¢disable_functionsæŒ‡ä»¤ï¼Œæ‰¾åˆ°ç±»ä¼¼å¦‚ä¸‹å†…å®¹ï¼š disable_functions = passthru,exec,system,chroot,scandir,chgrp,chown,shell_exec,proc_get_status,proc_openï¼Œpopen,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,stream_socket_server æ‰¾åˆ°proc_openå¹¶åˆ é™¤å³å¯ã€‚ æ‰§è¡Œcomposer artisan config clear åé¡¹ç›®è¿è¡ŒæŠ¥é”™æˆ–æ‰§è¡Œphp artisanæŠ¥é”™ Uncaught ReflectionException: Class config does not exist in /www/wwwroot/larabbs/vendor/laravel/framework/src/Illuminate/Container/Container.</description>
			<content type="html"><![CDATA[<p><strong>ä»¥ä¸‹éƒ½æ˜¯ä¸ªäººåœ¨å­¦ä¹ æˆ–æ˜¯å·¥ä½œä¸­çš„éƒ¨åˆ†è®°å½•ï¼š</strong></p>
<h3 id="laravelè¿è¡¨é¢å¤–æ·»åŠ æ¡ä»¶">laravelè¿è¡¨é¢å¤–æ·»åŠ æ¡ä»¶</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Product</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;products as p&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;user_has_products as uhp&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$join</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$join</span><span class="o">-&gt;</span><span class="na">on</span><span class="p">(</span><span class="s1">&#39;p.id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;uhp.product_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;uhp.user_role&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span></code></pre></div><h3 id="laravelä¸­çš„å¤šæ¡ä»¶">laravelä¸­çš„å¤šæ¡ä»¶</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Notice</span><span class="o">::</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;cate&#39;</span><span class="o">=&gt;</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;is_show&#39;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">])</span>
</span></span></code></pre></div><h3 id="laravel-carbon-æ—¶é—´æˆ³è½¬æ—¥æœŸ">laravel carbon æ—¶é—´æˆ³è½¬æ—¥æœŸ</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$date</span><span class="o">=</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromTimestamp</span><span class="p">(</span><span class="s2">&#34;æ—¶é—´æˆ³&#34;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toDateTimeString</span><span class="p">()</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è·å–æ˜¨å¤©çš„æ—¶é—´æˆ³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$ts</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">yesterday</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">;</span>
</span></span></code></pre></div><h3 id="laravelæ—¶åŒºè®¾ç½®">laravelæ—¶åŒºè®¾ç½®</h3>
<ul>
<li><code>config/app.php</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//åè°ƒä¸–ç•Œæ—¶(UTC, Universal Time Coordinated)ï¼Œåˆç§°ä¸–ç•Œç»Ÿä¸€æ—¶é—´ï¼Œä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œå›½é™…åè°ƒæ—¶é—´ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s1">&#39;timezone&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;UTC&#39;</span><span class="p">,</span><span class="c1">////
</span></span></span><span class="line"><span class="cl"><span class="c1">//ä¸­å›½æ ‡å‡†æ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s1">&#39;timezone&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;PRC&#39;</span><span class="p">,</span>
</span></span></code></pre></div><h3 id="laravelä¸­è‡ªå¸¦bootstrapçš„å­—ä½“è·¯å¾„">laravelä¸­è‡ªå¸¦bootstrapçš„å­—ä½“è·¯å¾„</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">//(è§£å†³æ‰¾ä¸åˆ°glyphicons-halflings-regular.woffé—®é¢˜)
</span></span><span class="line"><span class="cl">vendor-&gt;phpunit-&gt;php-code-coverage-&gt;src-&gt;Report-&gt;Html-&gt;Renderer-&gt;Template-&gt;fonts
</span></span><span class="line"><span class="cl">//æ‰¾ä¸åˆ°fontawesome-webfont.woffåŠï¼Ÿv=4.2.0é—®é¢˜
</span></span><span class="line"><span class="cl">ä¸‹è½½åœ°å€ï¼ˆhttp://www.xz7.com/dir/329345.htmlï¼‰ï¼Œæ›´æ”¹ç›¸åº”jsä»£ç å¯å°†ï¼Ÿåéƒ¨åˆ†å»æ‰ï¼Œå› ä¸ºæ–‡ä»¶ä¸èƒ½å¸¦&#39;?&#39;ç­‰å­—ç¬¦
</span></span></code></pre></div><h3 id="çº¿ä¸ŠæœåŠ¡å™¨æ‰§è¡Œ-composer-du-æŠ¥é”™">çº¿ä¸ŠæœåŠ¡å™¨æ‰§è¡Œ composer du æŠ¥é”™</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">[Symfony\Component\Process\Exception\RuntimeException]                       
</span></span><span class="line"><span class="cl">The Process class relies on proc_open, which is not available on your PHP installation. 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è§£å†³åŠæ³•ï¼š
</span></span><span class="line"><span class="cl">ä¿®æ”¹php.inié…ç½®æ–‡ä»¶ï¼Œå¹¶æœç´¢disable_functionsæŒ‡ä»¤ï¼Œæ‰¾åˆ°ç±»ä¼¼å¦‚ä¸‹å†…å®¹ï¼š
</span></span><span class="line"><span class="cl">disable_functions = passthru,exec,system,chroot,scandir,chgrp,chown,shell_exec,proc_get_status,proc_openï¼Œpopen,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,stream_socket_server
</span></span><span class="line"><span class="cl">æ‰¾åˆ°proc_openå¹¶åˆ é™¤å³å¯ã€‚
</span></span></code></pre></div><h3 id="æ‰§è¡Œcomposer-artisan-config-clear-åé¡¹ç›®è¿è¡ŒæŠ¥é”™æˆ–æ‰§è¡Œphp-artisanæŠ¥é”™">æ‰§è¡Œcomposer artisan config clear åé¡¹ç›®è¿è¡ŒæŠ¥é”™æˆ–æ‰§è¡Œphp artisanæŠ¥é”™</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Uncaught ReflectionException: Class config does not exist in /www/wwwroot/larabbs/vendor/laravel/framework/src/Illuminate/Container/Container.php
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">è§£å†³æ–¹æ³•å°±æ˜¯åˆ é™¤bootstrap/cache/config.phpæ–‡ä»¶ï¼›æˆ–è€…æ£€æµ‹ä½ çš„.envæ–‡ä»¶æ˜¯å¦å«æœ‰ç©ºæ ¼
</span></span></code></pre></div><h3 id="å½“æœ¬åœ°é¡¹ç›®é‚®ç®±å¯ä»¥å‘é€çº¿ä¸Šå´æŠ¥æŠ¥é”™">å½“æœ¬åœ°é¡¹ç›®é‚®ç®±å¯ä»¥å‘é€ï¼Œçº¿ä¸Šå´æŠ¥æŠ¥é”™</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Connection could not be established with host smtp.qq.com [Connection timed out #110]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">æ­¤æ—¶å¯ä»¥å°†MAIL_PORT=25 æ”¹ä¸ºMAIL_PORT=587,æ¢ä¸ªç«¯å£è¯•è¯•
</span></span></code></pre></div><h3 id="laravelå¤šæ¬¡æ’åº--orderby">laravelå¤šæ¬¡æ’åº  orderBy</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span><span class="s1">&#39;desc&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">);</span>
</span></span></code></pre></div><h3 id="æ³¨å†Œç”¨æˆ·å-æ­£åˆ™éªŒè¯">æ³¨å†Œç”¨æˆ·å æ­£åˆ™éªŒè¯</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|between:3,25|regex:/^[A-Za-z0-9\-\_\x{4e00}-\x{9fa5}]+$/u|unique:users,name,&#39;</span> <span class="o">.</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">id</span><span class="p">(),</span>
</span></span></code></pre></div><h3 id="laravelä½¿ç”¨saveæˆ–updateæ›´æ–°æ•°æ®æ—¶created_atå’Œupdated_at-å­—æ®µéƒ½æ›´æ–°é—®é¢˜">laravelä½¿ç”¨save()æˆ–update()æ›´æ–°æ•°æ®æ—¶ï¼Œcreated_atå’Œupdated_at å­—æ®µéƒ½æ›´æ–°é—®é¢˜ï¼š</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">useCurrent</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">useCurrent</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">ä¹Ÿå¯å°†</span> <span class="nx">è®¾è®¡è¡¨æ—¶çš„</span> <span class="nx">æ›´å…·å½“å‰æ—¶é—´æˆ³æ›´æ–°</span> <span class="nx">å…³é—­</span>
</span></span></code></pre></div><h3 id="æ¶ˆæ¯é€šçŸ¥é‚®ä»¶æ•°æ®åº“">æ¶ˆæ¯é€šçŸ¥ï¼ˆé‚®ä»¶ï¼Œæ•°æ®åº“ï¼‰</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//Observers/ReplyObserver.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">created</span><span class="p">(</span><span class="nx">Reply</span> <span class="nv">$reply</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$topic</span><span class="o">=</span><span class="nv">$reply</span><span class="o">-&gt;</span><span class="na">topic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$topic</span><span class="o">-&gt;</span><span class="na">increment</span><span class="p">(</span><span class="s1">&#39;reply_count&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/@(.*?) /&#39;</span><span class="p">,</span><span class="nv">$reply</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">,</span><span class="nv">$userName</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">         <span class="nv">$atUsers</span><span class="o">=</span><span class="nv">$userName</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">whereIn</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="nv">$atUsers</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;!=&#39;</span><span class="p">,</span><span class="nx">Auth</span><span class="o">::</span><span class="na">id</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Notification</span><span class="o">::</span><span class="na">send</span><span class="p">(</span><span class="nv">$users</span><span class="p">,</span> <span class="k">new</span> <span class="nx">TopicReplied</span><span class="p">(</span><span class="nv">$reply</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// é€šçŸ¥ä½œè€…è¯é¢˜è¢«å›å¤äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$topic</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="k">new</span> <span class="nx">TopicReplied</span><span class="p">(</span><span class="nv">$reply</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="laravel-è‡ªå»ºå…¨å±€è¾…åŠ©å‡½æ•°">laravel è‡ªå»ºå…¨å±€è¾…åŠ©å‡½æ•°</h3>
<ul>
<li>åœ¨composer.jsonä¸­çš„autoloadä¸‹å¢åŠ å¦‚ä¸‹ä»£ç åŠ è½½è‡ªåŠ¨æ–‡ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s2">&#34;autoload&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;classmap&#34;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;database&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;psr-4&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;App</span><span class="se">\\</span><span class="s2">&#34;</span><span class="o">:</span> <span class="s2">&#34;app/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;files&#34;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;app/helpers/functions.php&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span></code></pre></div><ul>
<li>ç„¶åæ‰§è¡Œcomposerå‘½ä»¤è®©å…¶è‡ªåŠ¨åŠ è½½ï¼šcomposer dump-auto    composer du</li>
</ul>
<h3 id="composer--install--æŠ¥é”™">composer  install  æŠ¥é”™</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Your requirements could not be resolved to an installable set of packages.
</span></span><span class="line"><span class="cl">æç¤ºæˆ‘çš„PHP 7ç‰ˆæœ¬å¤ªé«˜ï¼Œä¸ç¬¦åˆcomposer.jsonéœ€è¦çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯åœ¨PHP 7ä¸‹åº”è¯¥ä¹Ÿæ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œcomposerå¯ä»¥è®¾ç½®å¿½ç•¥ç‰ˆæœ¬åŒ¹é…ï¼Œå‘½ä»¤æ˜¯ï¼š
</span></span><span class="line"><span class="cl">composerinstall --ignore-platform-reqs
</span></span></code></pre></div><h3 id="ç¦æ­¢æ›´æ–°æ•°æ®è¡¨çš„é»˜è®¤æ—¶é—´å­—æ®µcreated_at-updated_at">ç¦æ­¢æ›´æ–°æ•°æ®è¡¨çš„é»˜è®¤æ—¶é—´å­—æ®µcreated_at updated_at</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">åœ¨å¯¹åº”æ¨¡å‹æ–‡ä»¶å¤´éƒ¨    å¦‚ï¼š
</span></span><span class="line"><span class="cl">Models\User.php
</span></span><span class="line"><span class="cl">public $timestamps=false;
</span></span></code></pre></div><h3 id="ç”¨postmanä¿®æ”¹æ•°æ®">ç”¨postmanä¿®æ”¹æ•°æ®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">åœ¨ç”¨postmanä¿®æ”¹æ•°æ®æ—¶ï¼Œç”¨çš„patchè¯·æ±‚ï¼Œä½†è¦æ³¨æ„ï¼Œä¸èƒ½ç”¨form-dataæ ¼å¼å»ä¼ å‚äº†ï¼Œè€Œè¦ç”¨x-www-form-urlencoded
</span></span></code></pre></div><h3 id="laravelæ’å…¥æ•°æ®å¹¶è¿”å›æˆåŠŸæ•°æ®id">laravelæ’å…¥æ•°æ®å¹¶è¿”å›æˆåŠŸæ•°æ®id</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span><span class="nx">Photo</span><span class="o">::</span><span class="na">insertGetId</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span></code></pre></div><h3 id="laravelæ¨¡å‹é€‰å–æŒ‡å®šå­—æ®µæ•°æ®">laravelæ¨¡å‹é€‰å–æŒ‡å®šå­—æ®µæ•°æ®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$allSources</span> <span class="o">=</span> <span class="nx">HouseSource</span><span class="o">::</span><span class="na">with</span><span class="p">([</span><span class="s1">&#39;poi&#39;</span><span class="o">=&gt;</span><span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;house_source_id&#39;</span><span class="p">,</span><span class="s1">&#39;poi_id&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}])</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;!=&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;lng&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">]);</span>
</span></span></code></pre></div><h3 id="laravelæ’é™¤å…³è”æ¨¡å‹ä¸ºç©ºçš„æ•°æ®-has">laravelæ’é™¤å…³è”æ¨¡å‹ä¸ºç©ºçš„æ•°æ® has</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// è·å¾—æ‰€æœ‰è‡³å°‘æœ‰ä¸€æ¡è¯„è®ºçš„æ–‡ç« ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$posts</span> <span class="o">=</span> <span class="nx">App\Post</span><span class="o">::</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è·å¾—æ‰€æœ‰è‡³å°‘æœ‰ä¸€æ¡è¯„è®ºå†…å®¹æ»¡è¶³ foo% æ¡ä»¶çš„æ–‡ç« 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">whereHas</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo%&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span></span></code></pre></div><h3 id="å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•ä½ç½®ä½¿ç”¨å…¨å±€-config-å‡½æ•°æ¥è®¿é—®é…ç½®å€¼">å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•ä½ç½®ä½¿ç”¨å…¨å±€ config å‡½æ•°æ¥è®¿é—®é…ç½®å€¼</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è¿è¡Œæ—¶è®¾ç½®é…ç½®å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">config</span><span class="p">([</span><span class="s1">&#39;app.timezone&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;America/Chicago&#39;</span><span class="p">]);</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Laravelå­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰</title>
			<link>https://blog.gookm.cn/posts/2017/20170520-laravel-study03/</link>
			<pubDate>Sat, 20 May 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170520-laravel-study03/</guid>
			<description>gitå‘½ä»¤ git add -A git commit -m &amp;#34;Add captcha&amp;#34; git push origin master git clean -f -d å‘½ä»¤ git clean ä½œç”¨æ˜¯æ¸…ç†é¡¹ç›®ï¼Œ-f æ˜¯å¼ºåˆ¶æ¸…ç†æ–‡ä»¶çš„è®¾ç½®ï¼Œ-d é€‰é¡¹å‘½ä»¤è¿æ–‡ä»¶å¤¹ä¸€å¹¶æ¸…é™¤ git status Not a git repositoryé”™è¯¯è§£å†³æ–¹æ³• ï¼š è¿è¡Œgit initå°±å¯ä»¥äº† error: src refspec master does not match any. error: failed to push some refs to &amp;#39;git@github.com:zhukang0704/larabbs02.git&amp;#39; æœ¬åœ°ä»“åº“ä¸ºç©º è§£å†³åŠæ³•ï¼šgit add -A git commit -m &amp;#34;init files&amp;#34; Warning: Permanently added the RSA host key for IP address &amp;#39;13.250.177.223&amp;#39; to the list of known hosts.</description>
			<content type="html"><![CDATA[<h3 id="gitå‘½ä»¤">gitå‘½ä»¤</h3>
<pre tabindex="0"><code class="language-git" data-lang="git">git add -A
git commit -m &#34;Add captcha&#34;
git push origin master
git clean -f -d
å‘½ä»¤ git clean ä½œç”¨æ˜¯æ¸…ç†é¡¹ç›®ï¼Œ-f æ˜¯å¼ºåˆ¶æ¸…ç†æ–‡ä»¶çš„è®¾ç½®ï¼Œ-d é€‰é¡¹å‘½ä»¤è¿æ–‡ä»¶å¤¹ä¸€å¹¶æ¸…é™¤
git status


Not a git repositoryé”™è¯¯è§£å†³æ–¹æ³•  ï¼š è¿è¡Œgit initå°±å¯ä»¥äº†


error: src refspec master does not match any.
error: failed to push some refs to &#39;git@github.com:zhukang0704/larabbs02.git&#39;
æœ¬åœ°ä»“åº“ä¸ºç©º
è§£å†³åŠæ³•ï¼šgit add -A          git commit -m &#34;init files&#34;


Warning: Permanently added the RSA host key for IP address &#39;13.250.177.223&#39; to the list of known hosts.
æç¤ºä½¿ç”¨ git pull ä¹‹ååœ¨ push
git pull --rebase origin master
git push -u origin master
</code></pre><h3 id="homesteadå¸¸ç”¨">homesteadå¸¸ç”¨</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.è¿è¡Œ Laravel Mix      npm run watch-poll
</span></span><span class="line"><span class="cl">2.å¯åŠ¨ Homestead        vagrant up   vagrant ssh  exit   vagrant halt
</span></span><span class="line"><span class="cl">3.vagrant provision æ˜¯å‘½ä»¤ Vagrant é‡æ–°åŠ è½½ Homestead.yaml é…ç½®ï¼›
</span></span><span class="line"><span class="cl">  vagrant reload æ˜¯é‡å¯è™šæ‹Ÿæœºä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚
</span></span></code></pre></div><h3 id="æ ·å¼è°ƒæ•´è¿è¡Œlaravel-mix">æ ·å¼è°ƒæ•´,è¿è¡ŒLaravel Mix</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">æ–¹æ³•1
</span></span><span class="line"><span class="cl">    yarn config set registry https://registry.npm.taobao.org
</span></span><span class="line"><span class="cl">    yarn install
</span></span><span class="line"><span class="cl">    npm run watch-poll
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ–¹æ³•2
</span></span><span class="line"><span class="cl">    rm -rf node_modules
</span></span><span class="line"><span class="cl">    yarn config set registry http://registry.cnpmjs.org
</span></span><span class="line"><span class="cl">    yarn install --no-bin-links
</span></span><span class="line"><span class="cl">    æ¥ä¸‹æ¥æ‰“å¼€ pakage.json ä¿®æ”¹ã€å»æ‰å››å¤„ cross-env ã€‘
</span></span><span class="line"><span class="cl">    æ‰§è¡Œ $ npm run watch-poll æˆ–è€… npm run devï¼ˆæˆ‘æ˜¯æ‰§è¡Œçš„åè€…ï¼‰
</span></span></code></pre></div><h3 id="windowså®‰è£…composer">Windowsï¼šå®‰è£…composer</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ç›´æ¥ä¸‹è½½ composer.pharï¼Œåœ°å€ï¼šhttps://dl.laravel-china.org/composer.phar
</span></span><span class="line"><span class="cl">æŠŠä¸‹è½½çš„ composer.phar æ”¾åˆ° PHP å®‰è£…ç›®å½•
</span></span><span class="line"><span class="cl">æ–°å»º composer.bat, æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå¹¶ä¿å­˜ï¼š
</span></span><span class="line"><span class="cl">@php &#34;%~dp0composer.phar&#34; %*
</span></span></code></pre></div><h3 id="ä½¿ç”¨-composer-é•œåƒåŠ é€Ÿæœ‰ä¸¤ç§é€‰é¡¹">ä½¿ç”¨ Composer é•œåƒåŠ é€Ÿæœ‰ä¸¤ç§é€‰é¡¹</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">- é€‰é¡¹ä¸€ï¼šå…¨å±€é…ç½®ï¼Œè¿™æ ·æ‰€æœ‰é¡¹ç›®éƒ½èƒ½æƒ åŠï¼ˆæ¨èï¼‰ï¼›
</span></span><span class="line"><span class="cl">      composer config -g repo.packagist composer https://packagist.laravel-china.org
</span></span><span class="line"><span class="cl">- é€‰é¡¹äºŒï¼šå•ç‹¬é¡¹ç›®é…ç½®ï¼›
</span></span><span class="line"><span class="cl">      composer config repo.packagist composer https://packagist.laravel-china.org
</span></span><span class="line"><span class="cl">  å–æ¶ˆé•œåƒ
</span></span><span class="line"><span class="cl">      composer config -g --unset repos.packagist
</span></span><span class="line"><span class="cl">  composer å‘½ä»¤åé¢åŠ ä¸Š -vvv ï¼ˆæ˜¯3ä¸ªvï¼‰å¯ä»¥æ‰“å°å‡ºè°ƒé”™ä¿¡æ¯
</span></span><span class="line"><span class="cl">      $ composer -vvv create-project laravel/laravel blog
</span></span><span class="line"><span class="cl">      $ composer -vvv require psr/log
</span></span></code></pre></div><h3 id="æ–°å¢ç«™ç‚¹">æ–°å¢ç«™ç‚¹</h3>
<ul>
<li>åœ¨ Homestead.yaml æ–‡ä»¶ä¸­æ–°å¢ larabbs åº”ç”¨çš„ sites å’Œ databases çš„ç›¸å…³è®¾ç½®ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10.1.1.33&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l">virtualbox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">authorize</span><span class="p">:</span><span class="w"> </span><span class="l">~/.ssh/id_rsa.pub</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">keys</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">~/.ssh/id_rsa</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">folders</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">D:/Homestead/Code</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/Code</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">sites</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">local.larabbs.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/Code/larabbs/public</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">larabbs02.test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/Code/larabbs02/public</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">databases</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">larabbs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">larabbs02</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># blackfire:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     - id: foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       token: bar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       client-id: foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       client-token: bar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ports:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     - send: 50000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       to: 5000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#     - send: 7777</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       to: 777</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#       protocol: udp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span></code></pre></div><ul>
<li>
<p>ä¸»è¦è®¾ç½®äº† sites å’Œ databases ä¸¤é¡¹ã€‚ sites ä¼šå°†åŸŸå larabbs.test æ˜ å°„åˆ°è™šæ‹Ÿæœºçš„ <code>/home/vagrant/Code/larabbs/public</code> æ–‡ä»¶å¤¹ä¸Šï¼Œè€Œ databases åˆ™ä¸ºæ–°åˆ›å»ºçš„é¡¹ç›®æŒ‡å®šæ•°æ®åº“å</p>
</li>
<li>
<p>é‡å¯è™šæ‹Ÿæœº</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> ~/Homestead <span class="o">&amp;&amp;</span> vagrant provision <span class="o">&amp;&amp;</span> vagrant reload
</span></span></code></pre></div><h3 id="å°çŸ¥è¯†ç‚¹">å°çŸ¥è¯†ç‚¹</h3>
<ul>
<li>
<p><code>app()-&gt;getLocale()</code> è·å–çš„æ˜¯ <code>config/app.php</code> ä¸­çš„ locale é€‰é¡¹  zh-CN</p>
</li>
<li>
<p><code>@yield('title', 'LaraBBS')</code> ç»§æ‰¿æ­¤æ¨¡æ¿çš„é¡µé¢ï¼Œå¦‚æœæ²¡æœ‰å®šåˆ¶ title åŒºåŸŸçš„è¯ï¼Œå°±ä¼šè‡ªåŠ¨ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•° LaraBBS ä½œä¸ºæ ‡é¢˜å‰ç¼€</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;csrf-token&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;{{ csrf_token() }}&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><ul>
<li>
<p><code>asset('css/app.css')</code> ä½¿ç”¨å½“å‰è¯·æ±‚çš„åè®®ï¼ˆ HTTP æˆ– HTTPS ï¼‰ä¸ºèµ„æºæ–‡ä»¶ç”Ÿæˆä¸€ä¸ª URLï¼Œä»¥æˆ‘ä»¬çš„æƒ…å†µï¼Œä¼šç”Ÿæˆ <a href="http://larabbs.test/css/app.css">http://larabbs.test/css/app.css</a></p>
</li>
<li>
<p>è¾…åŠ©å‡½æ•°  éœ€è¦æ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶ <code>bootstrap/helpers.php</code> ï¼Œåœ¨ <code>bootstrap/app.php</code> æ–‡ä»¶çš„æœ€é¡¶éƒ¨è¿›è¡ŒåŠ è½½ï¼š<code>&lt;?php require_once __DIR__ . '/helpers.php'</code>;</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">route_class</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="nx">Route</span><span class="o">::</span><span class="na">currentRouteName</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ­¤æ–¹æ³•ä¼šå°†å½“å‰è¯·æ±‚çš„è·¯ç”±åç§°è½¬æ¢ä¸º CSS ç±»åç§°ï¼Œä½œç”¨æ˜¯å…è®¸æˆ‘ä»¬é’ˆå¯¹æŸä¸ªé¡µé¢åšé¡µé¢æ ·å¼å®šåˆ¶
</span></span></span></code></pre></div><ul>
<li>å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•ä½ç½®ä½¿ç”¨å…¨å±€ config å‡½æ•°æ¥è®¿é—®é…ç½®å€¼</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$value</span> <span class="o">=</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.timezone&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è¿è¡Œæ—¶è®¾ç½®é…ç½®å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">config</span><span class="p">([</span><span class="s1">&#39;app.timezone&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;America/Chicago&#39;</span><span class="p">]);</span>
</span></span></code></pre></div><ul>
<li>ä½¿ç”¨ env() æ–¹æ³•å¯çŸ¥å…¶ä¼˜å…ˆè¯»å– .env æ–‡ä»¶ä¸­çš„ APP_NAME é€‰é¡¹</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;Laravel&#39;</span><span class="p">),</span>  <span class="c1">//config/app.php
</span></span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Laravelå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ğŸ‰</title>
			<link>https://blog.gookm.cn/posts/2017/20170512-laravel-study02/</link>
			<pubDate>Fri, 12 May 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170512-laravel-study02/</guid>
			<description>è·¯ç”±é—®é¢˜ // èµ„æºè·¯ç”± Route::resource(&amp;#39;user&amp;#39;, &amp;#39;UserController&amp;#39;); // åˆ†ç»„è·¯ç”± Route::group([&amp;#39;prefix&amp;#39; =&amp;gt; &amp;#39;user&amp;#39;], function(){ Route::get(&amp;#39;showByName&amp;#39;, &amp;#39;UserController@showByName&amp;#39;); }); // æ­£ç¡®çš„å†™æ³•ï¼š æŠŠæ‰€æœ‰è·¯ç”±å†™åœ¨èµ„æºè·¯ç”±å‰é¢ // åˆ†ç»„è·¯ç”± Route::group([&amp;#39;prefix&amp;#39; =&amp;gt; &amp;#39;user&amp;#39;], function(){ Route::get(&amp;#39;showByName&amp;#39;, &amp;#39;UserController@showByName&amp;#39;); }); // èµ„æºè·¯ç”± Route::resource(&amp;#39;user&amp;#39;, &amp;#39;UserController&amp;#39;); `asset()`ä¼šå»æ‰¾ç›¸å¯¹äº`index.php`ç›®å½•ä¸‹çš„æ–‡ä»¶, é»˜è®¤æ˜¯ `laravel/public`çš„ç»å¯¹è·¯å¾„ `url()` å‚æ•°æ˜¯è·¯ç”±åå­— `route()`å‚æ•°æ˜¯è·¯ç”±çš„åˆ«å `return redirect(&amp;#39;&amp;#39;)`å‚æ•°æ˜¯è·¯ç”±æˆ–è€…å®Œæ•´url, `return redirect()-&amp;gt;route(&amp;#39;&amp;#39;)`å‚æ•°æ˜¯è·¯ç”±åˆ«å Model Model::all() //å–å¾—æ‰€æœ‰è®°å½• Model::where(&amp;#39;id&amp;#39;, &amp;#39;&amp;gt;&amp;#39;, 9)-&amp;gt;get() //å–å¾—ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è®°å½• Model::where(&amp;#39;id&amp;#39;, &amp;#39;&amp;gt;&amp;#39;, 9)-&amp;gt;first() //å–å¾—ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½• Model::save //ä¸ç”Ÿæ•ˆï¼Œå¦‚æœä½ æ•°æ®åº“çš„ä¸»é”®æ˜¯`Id`æ”¹æˆ`id`å³å¯ php artisan `php artisan make:controller Controller --resource` åŠ ä¸Š`--resource` å¯ä»¥è‡ªåŠ¨åˆ›å»ºèµ„æºæ§åˆ¶å™¨é»˜è®¤çš„æ–¹æ³• `php artisan route:list` æŸ¥çœ‹æ‰€æœ‰è·¯ç”± `php artisan make:auto` ç”Ÿæˆä¸€ä¸ªç™»å½•æ³¨å†Œ `php artisan serve --port=80` ç”¨80ç«¯å£å¼€å¯æœåŠ¡ç¯å¢ƒ `php artisan make:Postcontroller --model=Post` ç”Ÿæˆæ¨¡å‹æ§åˆ¶å™¨ `php artisan make:model User -a` ä¼šç”Ÿæˆ`Resource Controller`,`Migration`,`Factory`,`Model` php artisan make:model User -a ä¼šç”ŸæˆResource Controller,Migration,Factory,Model è¡¨å•æäº¤åä¿ç•™æ—§æ•°æ® æ§åˆ¶å™¨ï¼šreturn back()-&amp;gt;withInput(); è§†å›¾å±‚ï¼š&amp;lt;input type=&amp;#34;text&amp;#34; name=&amp;#34;username&amp;#34; value=&amp;#34;{{ old(&amp;#39;username&amp;#39;) }}&amp;#34; /&amp;gt; ç™»é™†åè·³è½¬åˆ°ç™»å½•å‰çš„é¡µé¢?</description>
			<content type="html"><![CDATA[<h3 id="è·¯ç”±é—®é¢˜">è·¯ç”±é—®é¢˜</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// èµ„æºè·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">Route</span><span class="o">::</span><span class="na">resource</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// åˆ†ç»„è·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">Route</span><span class="o">::</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user&#39;</span><span class="p">],</span> <span class="k">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">     <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;showByName&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@showByName&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">});</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// æ­£ç¡®çš„å†™æ³•ï¼š æŠŠæ‰€æœ‰è·¯ç”±å†™åœ¨èµ„æºè·¯ç”±å‰é¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="c1">// åˆ†ç»„è·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">Route</span><span class="o">::</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user&#39;</span><span class="p">],</span> <span class="k">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">     <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;showByName&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController@showByName&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">});</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// èµ„æºè·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="nx">Route</span><span class="o">::</span><span class="na">resource</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;UserController&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="sb">`asset()`</span><span class="nx">ä¼šå»æ‰¾ç›¸å¯¹äº</span><span class="sb">`index.php`</span><span class="nx">ç›®å½•ä¸‹çš„æ–‡ä»¶</span><span class="p">,</span> <span class="nx">é»˜è®¤æ˜¯</span>   <span class="sb">`laravel/public`</span><span class="nx">çš„ç»å¯¹è·¯å¾„</span>
</span></span><span class="line"><span class="cl"><span class="sb">`url()`</span>  <span class="nx">å‚æ•°æ˜¯è·¯ç”±åå­—</span>
</span></span><span class="line"><span class="cl"><span class="sb">`route()`</span><span class="nx">å‚æ•°æ˜¯è·¯ç”±çš„åˆ«å</span>
</span></span><span class="line"><span class="cl"><span class="sb">`return redirect(&#39;&#39;)`</span><span class="nx">å‚æ•°æ˜¯è·¯ç”±æˆ–è€…å®Œæ•´url</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl"><span class="sb">`return redirect()-&gt;route(&#39;&#39;)`</span><span class="nx">å‚æ•°æ˜¯è·¯ç”±åˆ«å</span>
</span></span></code></pre></div><h3 id="model">Model</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Model</span><span class="o">::</span><span class="na">all</span><span class="p">()</span> <span class="c1">//å–å¾—æ‰€æœ‰è®°å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Model</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">()</span> <span class="c1">//å–å¾—ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è®°å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Model</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span> <span class="c1">//å–å¾—ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Model</span><span class="o">::</span><span class="na">save</span> <span class="c1">//ä¸ç”Ÿæ•ˆï¼Œå¦‚æœä½ æ•°æ®åº“çš„ä¸»é”®æ˜¯`Id`æ”¹æˆ`id`å³å¯
</span></span></span></code></pre></div><h3 id="php-artisan">php artisan</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="sb">`</span>php artisan make:controller Controller --resource<span class="sb">`</span> åŠ ä¸Š<span class="sb">`</span>--resource<span class="sb">`</span> å¯ä»¥è‡ªåŠ¨åˆ›å»ºèµ„æºæ§åˆ¶å™¨é»˜è®¤çš„æ–¹æ³•
</span></span><span class="line"><span class="cl"><span class="sb">`</span>php artisan route:list<span class="sb">`</span> æŸ¥çœ‹æ‰€æœ‰è·¯ç”±
</span></span><span class="line"><span class="cl"><span class="sb">`</span>php artisan make:auto<span class="sb">`</span> ç”Ÿæˆä¸€ä¸ªç™»å½•æ³¨å†Œ
</span></span><span class="line"><span class="cl"><span class="sb">`</span>php artisan serve --port<span class="o">=</span>80<span class="sb">`</span> ç”¨80ç«¯å£å¼€å¯æœåŠ¡ç¯å¢ƒ
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="sb">`</span>php artisan make:Postcontroller --model<span class="o">=</span>Post<span class="sb">`</span> ç”Ÿæˆæ¨¡å‹æ§åˆ¶å™¨
</span></span><span class="line"><span class="cl"><span class="sb">`</span>php artisan make:model User -a<span class="sb">`</span> ä¼šç”Ÿæˆ<span class="sb">`</span>Resource Controller<span class="sb">`</span>,<span class="sb">`</span>Migration<span class="sb">`</span>,<span class="sb">`</span>Factory<span class="sb">`</span>,<span class="sb">`</span>Model<span class="sb">`</span>
</span></span><span class="line"><span class="cl"> php artisan make:model User -a ä¼šç”ŸæˆResource Controller,Migration,Factory,Model
</span></span></code></pre></div><h3 id="è¡¨å•æäº¤åä¿ç•™æ—§æ•°æ®">è¡¨å•æäº¤åä¿ç•™æ—§æ•°æ®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">æ§åˆ¶å™¨ï¼šreturn back()-&gt;withInput();
</span></span><span class="line"><span class="cl">è§†å›¾å±‚ï¼š<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;{{ old(&#39;username&#39;) }}&#34;</span> <span class="p">/&gt;</span>
</span></span></code></pre></div><p>ç™»é™†åè·³è½¬åˆ°ç™»å½•å‰çš„é¡µé¢?</p>
<ul>
<li>è·³è½¬ä¹‹å‰ï¼Œè·å–å½“å‰URLï¼Œæ‹¼æ¥åˆ°GETå‚æ•°ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢æ—¶å°±å˜æˆ <code>http://domain.com/login.php?url=detail.php</code>, åˆ°ç™»å½•é¡µé¢æ—¶ï¼Œ åˆ¤æ–­æœ‰æ²¡æœ‰GETå‚æ•°ï¼Œ å¦‚æœæœ‰ï¼Œ ç™»å½•æˆåŠŸåå°±è·³è½¬åˆ°ä¹‹å‰çš„é¡µé¢</li>
</ul>
<p>Laravel æ˜¯æ€ä¹ˆå®ç°è·¯ç”±ä¸ç”¨å¸¦å‘½åç©ºé—´è°ƒç”¨çš„ï¼Ÿ</p>
<ul>
<li>ä½¿ç”¨ <code>class_alias()</code> å‡½æ•°ï¼Œå¯ä»¥ä¸ºç±»èµ·åˆ«åï¼Œé€šè¿‡åˆ«åè°ƒç”¨ç±»ã€‚</li>
</ul>
]]></content>
		</item>
		
		<item>
			<title>Laravelå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰</title>
			<link>https://blog.gookm.cn/posts/2017/20170508-laravel-study01/</link>
			<pubDate>Mon, 08 May 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170508-laravel-study01/</guid>
			<description>laravelé¡¹ç›®åˆå§‹ 1.å¤åˆ¶.env.exampleä¸º.envï¼Œé…ç½®æ•°æ®åº“ä¿¡æ¯ï¼Œå¹¶è‡ªè¡Œåœ¨mysqlä¸­å»ºä¸€ä¸ªå¯¹åº”çš„æ•°æ®åº“ã€‚ cp .env.example .env 2.composer install å®‰è£…ç›¸å…³åŒ…ã€‚ 3.php artisan key:generate ç”Ÿæˆåº”ç”¨Keyã€‚ 4.php artisan migrate è¿è¡Œè¿ç§»ç”Ÿæˆæ•°æ®è¡¨ã€‚ è¿›è¡Œæ•°æ®åº“è¿ç§»ï¼Œå¦‚æœæœ‰seederçš„è¯ï¼Œè¿è¡Œphp artisan db:seed 5.é…ç½®è™šæ‹Ÿæœºæˆ–è€…ä½¿ç”¨php artisan serveå¯åŠ¨æœåŠ¡ã€‚ é€šè¿‡Composeråˆ›å»ºé¡¹ç›® æˆ–è€…ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œ create-project å‘½ä»¤æ¥å®‰è£… Laravelï¼š composer create-project --prefer-dist laravel/laravel blog &amp;#34;5.5.*&amp;#34; captchaï¼ˆéªŒè¯ç ï¼‰ å…ˆæ¥ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œå°†åŒ…è£…ä¸Š composer require mews/captcha å†æ¥è·‘è¿™ä¸ªå‘½ä»¤ï¼Œç”ŸæˆéªŒè¯ç çš„é…ç½®æ–‡ä»¶ php artisan vendor:publish ä¿®æ”¹html i18nè¯­è¨€åŒ… composer require caouecs/laravel-lang:~3.0 1. æ‰¾åˆ°vendor/caouecs/laravel-lang/src/zh-CNï¼Œæ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶åˆ°resources/langã€‚ 2. ä¿®æ”¹app/config.php &amp;#39;locale&amp;#39; =&amp;gt; &amp;#39;zh-CN&amp;#39;, åˆ é™¤ä¸€ä¸ªèµ„æº &amp;lt;script src=&amp;#34;/assets/js/laravel.js&amp;#34;&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;a href=&amp;#34;{{route(&amp;#39;issues.destroy&amp;#39;, $issue-&amp;gt;id)}}&amp;#34; data-method=&amp;#34;delete&amp;#34; data-token=&amp;#34;{{csrf_token()}}&amp;#34; data-confirm=&amp;#34;Are you sure?&amp;#34; ...&amp;gt;Destroy&amp;lt;/a&amp;gt; å¾…æ›´æ–°&amp;hellip;</description>
			<content type="html"><![CDATA[<h3 id="laravelé¡¹ç›®åˆå§‹">laravelé¡¹ç›®åˆå§‹</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.å¤åˆ¶.env.exampleä¸º.envï¼Œé…ç½®æ•°æ®åº“ä¿¡æ¯ï¼Œå¹¶è‡ªè¡Œåœ¨mysqlä¸­å»ºä¸€ä¸ªå¯¹åº”çš„æ•°æ®åº“ã€‚
</span></span><span class="line"><span class="cl">  cp .env.example .env
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.composer install å®‰è£…ç›¸å…³åŒ…ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.php artisan key:generate ç”Ÿæˆåº”ç”¨Keyã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.php artisan migrate è¿è¡Œè¿ç§»ç”Ÿæˆæ•°æ®è¡¨ã€‚
</span></span><span class="line"><span class="cl">è¿›è¡Œæ•°æ®åº“è¿ç§»ï¼Œå¦‚æœæœ‰seederçš„è¯ï¼Œè¿è¡Œphp artisan db:seed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5.é…ç½®è™šæ‹Ÿæœºæˆ–è€…ä½¿ç”¨php artisan serveå¯åŠ¨æœåŠ¡ã€‚
</span></span></code></pre></div><h3 id="é€šè¿‡composeråˆ›å»ºé¡¹ç›®">é€šè¿‡Composeråˆ›å»ºé¡¹ç›®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">æˆ–è€…ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œ create-project å‘½ä»¤æ¥å®‰è£… Laravelï¼š
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">composer create-project --prefer-dist laravel/laravel blog &#34;5.5.*&#34;
</span></span></code></pre></div><h3 id="captchaéªŒè¯ç ">captchaï¼ˆéªŒè¯ç ï¼‰</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å…ˆæ¥ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œå°†åŒ…è£…ä¸Š
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">composer require mews/captcha
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å†æ¥è·‘è¿™ä¸ªå‘½ä»¤ï¼Œç”ŸæˆéªŒè¯ç çš„é…ç½®æ–‡ä»¶
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">php artisan vendor:publish
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¿®æ”¹html
</span></span></code></pre></div><h3 id="i18nè¯­è¨€åŒ…">i18nè¯­è¨€åŒ…</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">composer require caouecs/laravel-lang:~3.0
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">1. æ‰¾åˆ°vendor/caouecs/laravel-lang/src/zh-CNï¼Œæ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶åˆ°resources/langã€‚
</span></span><span class="line"><span class="cl">2. ä¿®æ”¹app/config.php  &#39;locale&#39; =&gt; &#39;zh-CN&#39;,
</span></span></code></pre></div><h3 id="åˆ é™¤ä¸€ä¸ªèµ„æº">åˆ é™¤ä¸€ä¸ªèµ„æº</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;/assets/js/laravel.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{route(&#39;issues.destroy&#39;, $issue-&gt;id)}}&#34;</span> <span class="na">data-method</span><span class="o">=</span><span class="s">&#34;delete&#34;</span> <span class="na">data-token</span><span class="o">=</span><span class="s">&#34;{{csrf_token()}}&#34;</span> <span class="na">data-confirm</span><span class="o">=</span><span class="s">&#34;Are you sure?&#34;</span> <span class="err">...</span><span class="p">&gt;</span>Destroy<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>å¾…æ›´æ–°&hellip;</p>
]]></content>
		</item>
		
		<item>
			<title>Laravelä¹‹éªŒè¯ç </title>
			<link>https://blog.gookm.cn/posts/2017/20170426-laravel-captcha/</link>
			<pubDate>Wed, 26 Apr 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170426-laravel-captcha/</guid>
			<description>å°†åŒ…è£…ä¸Š composer require mews/captcha ç”ŸæˆéªŒè¯ç çš„é…ç½®æ–‡ä»¶ php artisan vendor:publish å±å¹•æç¤ºï¼š
Which provider or tag&amp;#39;s files would you like to publish?: [0 ] Publish files from all providers and tags listed below [1 ] Provider: Fideloper\Proxy\TrustedProxyServiceProvider [2 ] Provider: Illuminate\Mail\MailServiceProvider [3 ] Provider: Illuminate\Notifications\NotificationServiceProvider [4 ] Provider: Illuminate\Pagination\PaginationServiceProvider [5 ] Provider: Intervention\Image\ImageServiceProviderLaravel5 [6 ] Provider: Mews\Captcha\CaptchaServiceProvider [7 ] Tag: config [8 ] Tag: laravel-mail [9 ] Tag: laravel-notifications [10] Tag: laravel-pagination è¿™é‡Œé€‰æ‹© 6ï¼Œä¹Ÿå°±æ˜¯Captchaè¿™ä¸ªåŒ…ã€‚</description>
			<content type="html"><![CDATA[<h3 id="å°†åŒ…è£…ä¸Š">å°†åŒ…è£…ä¸Š</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">composer require mews/captcha
</span></span></code></pre></div><h3 id="ç”ŸæˆéªŒè¯ç çš„é…ç½®æ–‡ä»¶">ç”ŸæˆéªŒè¯ç çš„é…ç½®æ–‡ä»¶</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">php artisan vendor:publish
</span></span></code></pre></div><p>å±å¹•æç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Which provider or tag<span class="err">&#39;</span>s files would you like to publish?:
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">0</span> <span class="o">]</span> Publish files from all providers and tags listed below
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">1</span> <span class="o">]</span> Provider: Fideloper<span class="se">\P</span>roxy<span class="se">\T</span>rustedProxyServiceProvider
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">2</span> <span class="o">]</span> Provider: Illuminate<span class="se">\M</span>ail<span class="se">\M</span>ailServiceProvider
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">3</span> <span class="o">]</span> Provider: Illuminate<span class="se">\N</span>otifications<span class="se">\N</span>otificationServiceProvider
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">4</span> <span class="o">]</span> Provider: Illuminate<span class="se">\P</span>agination<span class="se">\P</span>aginationServiceProvider
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">5</span> <span class="o">]</span> Provider: Intervention<span class="se">\I</span>mage<span class="se">\I</span>mageServiceProviderLaravel5
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">6</span> <span class="o">]</span> Provider: Mews<span class="se">\C</span>aptcha<span class="se">\C</span>aptchaServiceProvider
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">7</span> <span class="o">]</span> Tag: config
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">8</span> <span class="o">]</span> Tag: laravel-mail
</span></span><span class="line"><span class="cl">  <span class="o">[</span><span class="m">9</span> <span class="o">]</span> Tag: laravel-notifications
</span></span><span class="line"><span class="cl">  <span class="o">[</span>10<span class="o">]</span> Tag: laravel-pagination
</span></span></code></pre></div><p>è¿™é‡Œé€‰æ‹© 6ï¼Œä¹Ÿå°±æ˜¯Captchaè¿™ä¸ªåŒ…ã€‚</p>
<p>è¿™æ ·åœ¨configä¸­ï¼Œå°±ä¼šå‡ºç°ä¸€ä¸ªå«åšcaptcha.phpçš„é…ç½®æ–‡ä»¶ã€‚è¿™é‡Œå­˜æ”¾çš„éƒ½æ˜¯è·ŸéªŒè¯ç ç›¸å…³çš„é…ç½®äº†ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="s1">&#39;length&#39;</span>    <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
</span></span></code></pre></div><h3 id="ä¿®æ”¹htmlæ‰¾åˆ°ç™»å½•é¡µé¢çš„éªŒè¯ç éƒ¨åˆ†">ä¿®æ”¹htmlï¼Œæ‰¾åˆ°ç™»å½•é¡µé¢çš„éªŒè¯ç éƒ¨åˆ†</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{captcha_src()}}&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;cursor: pointer;&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>ç‚¹å‡»åˆ·æ–°éªŒè¯ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{captcha_src()}}&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;cursor: pointer;&#34;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&#34;this.src=&#39;{{captcha_src()}}&#39;+ Math.random();&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="æ·»åŠ éªŒè¯logincontroller">æ·»åŠ éªŒè¯LoginController</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LoginController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">function</span> <span class="nf">validateLogin</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;captcha&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|captcha&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="éªŒè¯ç ä¿¡æ¯æç¤ºæ±‰åŒ–vendorcaouecslaravel-langsrczh-cn">éªŒè¯ç ä¿¡æ¯æç¤ºæ±‰åŒ–vendor/caouecs/laravel-lang/src/zh-CN</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;captcha&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;:attribute å¡«å†™é”™è¯¯ã€‚&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;attributes&#39;</span>           <span class="o">=&gt;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;captcha&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;éªŒè¯ç &#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>æ­£åˆ™è¡¨è¾¾å¼å­¦ä¹ å½’çº³ğŸ˜ª</title>
			<link>https://blog.gookm.cn/posts/2017/20170418-regex-study/</link>
			<pubDate>Tue, 18 Apr 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170418-regex-study/</guid>
			<description>1ã€æ­£åˆ™è¡¨è¾¾å¼
æ­£åˆ™è¡¨è¾¾å¼(regular expression)æè¿°äº†ä¸€ç§å­—ç¬¦ä¸²åŒ¹é…çš„æ¨¡å¼ï¼Œ å¯ä»¥ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªä¸²æ˜¯å¦å«æœ‰æŸç§å­ä¸²ã€å°†åŒ¹é…çš„å­ä¸²åšæ›¿æ¢æˆ–è€…ä»æŸä¸ªä¸²ä¸­å–å‡ºç¬¦åˆæŸä¸ªæ¡ä»¶çš„å­ä¸²ç­‰ã€‚ æ¨¡å¼ï¼šä½¿ç”¨ä¸€ç§ç‰¹æ®Šç¬¦å·æ¥å®ç°å­—ç¬¦ä¸²çš„åŒ¹é… 2ã€åˆ›å»ºæ­£åˆ™å¯¹è±¡
â‘ éšå¼åˆ›å»º var æ­£åˆ™å¯¹è±¡ = /æ­£åˆ™è¡¨è¾¾å¼/åŒ¹é…æ¨¡å¼; â‘¡ç›´æ¥å®ä¾‹åŒ– var æ­£åˆ™å¯¹è±¡ = new RegExp(â€˜æ­£åˆ™è¡¨è¾¾å¼â€™, â€˜åŒ¹é…æ¨¡å¼â€™); ä¸¤è€…ä¹‹é—´çš„åŠŸèƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œéƒ½æ˜¯ä¸ºäº†è·å¾—æ­£åˆ™å¯¹è±¡ã€‚ä½†æ˜¯ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ä¸»è¦åœ¨äºè¯­æ³•çš„ä¸åŒã€‚ 3ã€åŒ¹é…æ¨¡å¼
åŸºæœ¬è¯­æ³•ï¼š var reg = /æ­£åˆ™è¡¨è¾¾å¼/åŒ¹é…æ¨¡å¼; åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼ŒåŒ¹é…æ¨¡å¼å¸¸ç”¨çš„æœ‰ä¸¤ç§å½¢å¼ï¼š g ï¼šglobalç¼©å†™ï¼Œä»£è¡¨å…¨å±€åŒ¹é…ï¼ŒåŒ¹é…å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ç»“æœ i ï¼šignoreç¼©å†™ï¼Œä»£è¡¨å¿½ç•¥å¤§å°å†™ï¼ŒåŒ¹é…æ—¶ï¼Œä¼šè‡ªåŠ¨å¿½ç•¥å­—ç¬¦ä¸²çš„å¤§å°å†™ 4ã€ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸å…³çš„å‡ ä¸ªæ–¹æ³•
â‘  RegExpç±»ä¸‹çš„æ–¹æ³•(reg.testæˆ–reg.exec) test(str) ï¼šåˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šæ¨¡å¼çš„å­ä¸²ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å€¼ exec(str) ï¼šè¿”å›å­—ç¬¦ä¸²ä¸­æŒ‡å®šæ¨¡å¼çš„å­ä¸²ï¼Œä¸€æ¬¡åªèƒ½è·å–ä¸€ä¸ªä¸ä¹‹åŒ¹é…çš„ç»“æœ â‘¡ Stringç±»ä¸‹çš„æ–¹æ³•(str.æ–¹æ³•(reg)) search(reg) ï¼šä¸indexOféå¸¸ç±»ä¼¼ï¼Œè¿”å›æŒ‡å®šæ¨¡å¼çš„å­ä¸²åœ¨å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½® match(reg) ï¼šä»¥æ•°ç»„çš„å½¢å¼è¿”å›æŒ‡å®šæ¨¡å¼çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥è¿”å›æ‰€æœ‰åŒ¹é…çš„ç»“æœ replace(reg,â€™æ›¿æ¢åçš„å­—ç¬¦â€™) ï¼šæŠŠæŒ‡å®šæ¨¡å¼çš„å­ä¸²è¿›è¡Œæ›¿æ¢æ“ä½œ split(reg) ï¼šä»¥æŒ‡å®šæ¨¡å¼åˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ç»“æœä¸ºæ•°ç»„ 5ã€å‡ ä¸ªé‡è¦æ¦‚å¿µ
1.å­è¡¨è¾¾å¼ï¼šåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œé€šè¿‡ä¸€å¯¹åœ†æ‹¬å·æ‹¬èµ·æ¥çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºâ€œå­è¡¨è¾¾å¼â€ã€‚ å¦‚ï¼švar reg = /\d(\d)\d/gi; 2.æ•è·ï¼šåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå­è¡¨è¾¾å¼åŒ¹é…åˆ°ç›¸åº”çš„å†…å®¹æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ•è·è¿™ä¸ªè¡Œä¸ºï¼Œ ç„¶åå°†å­è¡¨è¾¾å¼åŒ¹é…åˆ°çš„å†…å®¹æ”¾å…¥ç³»ç»Ÿçš„ç¼“å­˜åŒºä¸­ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¹‹ä¸ºâ€œæ•è·â€ã€‚ 3.åå‘å¼•ç”¨ï¼šåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨\nï¼ˆn&amp;gt;0ï¼Œæ­£æ•´æ•°ï¼Œä»£è¡¨ç³»ç»Ÿä¸­çš„ç¼“å†²åŒºç¼–å·ï¼‰æ¥è·å–ç¼“å†²åŒºä¸­çš„å†…å®¹ï¼Œ æˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¹‹ä¸ºâ€œåå‘å¼•ç”¨â€ã€‚ 6ã€ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼ä¸‰æ­¥èµ°
1.åŒ¹é…ç¬¦ï¼ˆæŸ¥ä»€ä¹ˆï¼‰ åŒ¹é…ç¬¦ï¼šå­—ç¬¦åŒ¹é…ç¬¦ç”¨äºåŒ¹é…æŸä¸ªæˆ–æŸäº›å­—ç¬¦ åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œé€šè¿‡ä¸€å¯¹ä¸­æ‹¬å·æ‹¬èµ·æ¥çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºâ€œå­—ç¬¦ç°‡â€ã€‚ å­—ç¬¦ç°‡ä»£è¡¨çš„æ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œä½†æ˜¯åŒ¹é…æ—¶ï¼Œåªèƒ½åŒ¹é…æŸä¸ªå›ºå®šçš„ç»“æœã€‚ [a-z] ï¼šåŒ¹é…å­—ç¬¦aåˆ°å­—ç¬¦zä¹‹é—´çš„ä»»ä¸€å­—ç¬¦ [A-Z] ï¼šåŒ¹é…å­—ç¬¦Aåˆ°å­—ç¬¦Zä¹‹é—´çš„ä»»ä¸€å­—ç¬¦ [0-9] ï¼šåŒ¹é…æ•°å­—0åˆ°9ä¹‹é—´çš„ä»»ä¸€æ•°å­— [0-9a-z] ï¼šåŒ¹é…æ•°å­—0åˆ°9æˆ–å­—ç¬¦aåˆ°å­—ç¬¦zä¹‹é—´çš„ä»»ä¸€å­—ç¬¦ [0-9a-zA-Z] ï¼šåŒ¹é…æ•°å­—0åˆ°9æˆ–å­—ç¬¦aåˆ°å­—ç¬¦zæˆ–å­—ç¬¦Aåˆ°å­—ç¬¦Zä¹‹é—´çš„ä»»ä¸€å­—ç¬¦ [abcd] ï¼šåŒ¹é…å­—ç¬¦aæˆ–å­—ç¬¦bæˆ–å­—ç¬¦cæˆ–å­—ç¬¦d [1234] ï¼šåŒ¹é…æ•°å­—1æˆ–æ•°å­—2æˆ–æ•°å­—3æˆ–æ•°å­—4 åœ¨å­—ç¬¦ç°‡ä¸­ï¼Œé€šè¿‡ä¸€ä¸ª^è„±å­—èŠ‚æ¥è¡¨ç¤ºå–åçš„å«ä¹‰ã€‚ [^a-z] ï¼šåŒ¹é…é™¤å­—ç¬¦aåˆ°å­—ç¬¦zä»¥å¤–çš„ä»»ä¸€å­—ç¬¦ [^0-9] ï¼šåŒ¹é…é™¤æ•°å­—0åˆ°9ä»¥å¤–çš„ä»»ä¸€å­—ç¬¦ [^abcd] ï¼šåŒ¹é…é™¤aã€bã€cã€dä»¥å¤–çš„ä»»ä¸€å­—ç¬¦ å‡ ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„åŒ¹é…ç¬¦: \d ï¼šåŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[0-9] \D ï¼šåŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[^0-9] \w ï¼šåŒ¹é…åŒ…æ‹¬ä¸‹åˆ’çº¿çš„ä»»ä½•å•è¯å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[0-9a-zA-Z_] \W ï¼šåŒ¹é…ä»»ä½•éå•è¯å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[^\w] \s ï¼šåŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼Œspaceç¼©å†™ \S ï¼šåŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[^\s] .</description>
			<content type="html"><![CDATA[<p>1ã€æ­£åˆ™è¡¨è¾¾å¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">æ­£åˆ™è¡¨è¾¾å¼(regular expression)æè¿°äº†ä¸€ç§å­—ç¬¦ä¸²åŒ¹é…çš„æ¨¡å¼ï¼Œ
</span></span><span class="line"><span class="cl">å¯ä»¥ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªä¸²æ˜¯å¦å«æœ‰æŸç§å­ä¸²ã€å°†åŒ¹é…çš„å­ä¸²åšæ›¿æ¢æˆ–è€…ä»æŸä¸ªä¸²ä¸­å–å‡ºç¬¦åˆæŸä¸ªæ¡ä»¶çš„å­ä¸²ç­‰ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ¨¡å¼ï¼šä½¿ç”¨ä¸€ç§ç‰¹æ®Šç¬¦å·æ¥å®ç°å­—ç¬¦ä¸²çš„åŒ¹é…
</span></span></code></pre></div><p>2ã€åˆ›å»ºæ­£åˆ™å¯¹è±¡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">â‘ éšå¼åˆ›å»º
</span></span><span class="line"><span class="cl">var æ­£åˆ™å¯¹è±¡ = /æ­£åˆ™è¡¨è¾¾å¼/åŒ¹é…æ¨¡å¼;
</span></span><span class="line"><span class="cl">â‘¡ç›´æ¥å®ä¾‹åŒ–
</span></span><span class="line"><span class="cl">var æ­£åˆ™å¯¹è±¡ = new RegExp(â€˜æ­£åˆ™è¡¨è¾¾å¼â€™, â€˜åŒ¹é…æ¨¡å¼â€™);
</span></span><span class="line"><span class="cl">ä¸¤è€…ä¹‹é—´çš„åŠŸèƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œéƒ½æ˜¯ä¸ºäº†è·å¾—æ­£åˆ™å¯¹è±¡ã€‚ä½†æ˜¯ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ä¸»è¦åœ¨äºè¯­æ³•çš„ä¸åŒã€‚
</span></span></code></pre></div><p>3ã€åŒ¹é…æ¨¡å¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">åŸºæœ¬è¯­æ³•ï¼š   var  reg = /æ­£åˆ™è¡¨è¾¾å¼/åŒ¹é…æ¨¡å¼;
</span></span><span class="line"><span class="cl">åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼ŒåŒ¹é…æ¨¡å¼å¸¸ç”¨çš„æœ‰ä¸¤ç§å½¢å¼ï¼š
</span></span><span class="line"><span class="cl">g ï¼šglobalç¼©å†™ï¼Œä»£è¡¨å…¨å±€åŒ¹é…ï¼ŒåŒ¹é…å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ç»“æœ
</span></span><span class="line"><span class="cl">i ï¼šignoreç¼©å†™ï¼Œä»£è¡¨å¿½ç•¥å¤§å°å†™ï¼ŒåŒ¹é…æ—¶ï¼Œä¼šè‡ªåŠ¨å¿½ç•¥å­—ç¬¦ä¸²çš„å¤§å°å†™
</span></span></code></pre></div><p>4ã€ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸å…³çš„å‡ ä¸ªæ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">â‘  RegExpç±»ä¸‹çš„æ–¹æ³•(reg.testæˆ–reg.exec)
</span></span><span class="line"><span class="cl">  test(str) ï¼šåˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šæ¨¡å¼çš„å­ä¸²ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å€¼
</span></span><span class="line"><span class="cl">  exec(str) ï¼šè¿”å›å­—ç¬¦ä¸²ä¸­æŒ‡å®šæ¨¡å¼çš„å­ä¸²ï¼Œä¸€æ¬¡åªèƒ½è·å–ä¸€ä¸ªä¸ä¹‹åŒ¹é…çš„ç»“æœ
</span></span><span class="line"><span class="cl">â‘¡ Stringç±»ä¸‹çš„æ–¹æ³•(str.æ–¹æ³•(reg))
</span></span><span class="line"><span class="cl">  search(reg) ï¼šä¸indexOféå¸¸ç±»ä¼¼ï¼Œè¿”å›æŒ‡å®šæ¨¡å¼çš„å­ä¸²åœ¨å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®
</span></span><span class="line"><span class="cl">  match(reg) ï¼šä»¥æ•°ç»„çš„å½¢å¼è¿”å›æŒ‡å®šæ¨¡å¼çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥è¿”å›æ‰€æœ‰åŒ¹é…çš„ç»“æœ
</span></span><span class="line"><span class="cl">  replace(reg,â€™æ›¿æ¢åçš„å­—ç¬¦â€™) ï¼šæŠŠæŒ‡å®šæ¨¡å¼çš„å­ä¸²è¿›è¡Œæ›¿æ¢æ“ä½œ
</span></span><span class="line"><span class="cl">  split(reg) ï¼šä»¥æŒ‡å®šæ¨¡å¼åˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ç»“æœä¸ºæ•°ç»„
</span></span></code></pre></div><p>5ã€å‡ ä¸ªé‡è¦æ¦‚å¿µ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.å­è¡¨è¾¾å¼ï¼šåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œé€šè¿‡ä¸€å¯¹åœ†æ‹¬å·æ‹¬èµ·æ¥çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºâ€œå­è¡¨è¾¾å¼â€ã€‚
</span></span><span class="line"><span class="cl">å¦‚ï¼švar reg = /\d(\d)\d/gi;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.æ•è·ï¼šåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå­è¡¨è¾¾å¼åŒ¹é…åˆ°ç›¸åº”çš„å†…å®¹æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ•è·è¿™ä¸ªè¡Œä¸ºï¼Œ
</span></span><span class="line"><span class="cl">ç„¶åå°†å­è¡¨è¾¾å¼åŒ¹é…åˆ°çš„å†…å®¹æ”¾å…¥ç³»ç»Ÿçš„ç¼“å­˜åŒºä¸­ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¹‹ä¸ºâ€œæ•è·â€ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.åå‘å¼•ç”¨ï¼šåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨\nï¼ˆn&gt;0ï¼Œæ­£æ•´æ•°ï¼Œä»£è¡¨ç³»ç»Ÿä¸­çš„ç¼“å†²åŒºç¼–å·ï¼‰æ¥è·å–ç¼“å†²åŒºä¸­çš„å†…å®¹ï¼Œ
</span></span><span class="line"><span class="cl">æˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¹‹ä¸ºâ€œåå‘å¼•ç”¨â€ã€‚
</span></span></code></pre></div><p>6ã€ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼ä¸‰æ­¥èµ°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.åŒ¹é…ç¬¦ï¼ˆæŸ¥ä»€ä¹ˆï¼‰
</span></span><span class="line"><span class="cl">åŒ¹é…ç¬¦ï¼šå­—ç¬¦åŒ¹é…ç¬¦ç”¨äºåŒ¹é…æŸä¸ªæˆ–æŸäº›å­—ç¬¦
</span></span><span class="line"><span class="cl">åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œé€šè¿‡ä¸€å¯¹ä¸­æ‹¬å·æ‹¬èµ·æ¥çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºâ€œå­—ç¬¦ç°‡â€ã€‚
</span></span><span class="line"><span class="cl">å­—ç¬¦ç°‡ä»£è¡¨çš„æ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œä½†æ˜¯åŒ¹é…æ—¶ï¼Œåªèƒ½åŒ¹é…æŸä¸ªå›ºå®šçš„ç»“æœã€‚
</span></span><span class="line"><span class="cl">[a-z] ï¼šåŒ¹é…å­—ç¬¦aåˆ°å­—ç¬¦zä¹‹é—´çš„ä»»ä¸€å­—ç¬¦
</span></span><span class="line"><span class="cl">[A-Z] ï¼šåŒ¹é…å­—ç¬¦Aåˆ°å­—ç¬¦Zä¹‹é—´çš„ä»»ä¸€å­—ç¬¦
</span></span><span class="line"><span class="cl">[0-9] ï¼šåŒ¹é…æ•°å­—0åˆ°9ä¹‹é—´çš„ä»»ä¸€æ•°å­—
</span></span><span class="line"><span class="cl">[0-9a-z] ï¼šåŒ¹é…æ•°å­—0åˆ°9æˆ–å­—ç¬¦aåˆ°å­—ç¬¦zä¹‹é—´çš„ä»»ä¸€å­—ç¬¦
</span></span><span class="line"><span class="cl">[0-9a-zA-Z] ï¼šåŒ¹é…æ•°å­—0åˆ°9æˆ–å­—ç¬¦aåˆ°å­—ç¬¦zæˆ–å­—ç¬¦Aåˆ°å­—ç¬¦Zä¹‹é—´çš„ä»»ä¸€å­—ç¬¦
</span></span><span class="line"><span class="cl">[abcd] ï¼šåŒ¹é…å­—ç¬¦aæˆ–å­—ç¬¦bæˆ–å­—ç¬¦cæˆ–å­—ç¬¦d
</span></span><span class="line"><span class="cl">[1234] ï¼šåŒ¹é…æ•°å­—1æˆ–æ•°å­—2æˆ–æ•°å­—3æˆ–æ•°å­—4
</span></span><span class="line"><span class="cl">åœ¨å­—ç¬¦ç°‡ä¸­ï¼Œé€šè¿‡ä¸€ä¸ª^è„±å­—èŠ‚æ¥è¡¨ç¤ºå–åçš„å«ä¹‰ã€‚
</span></span><span class="line"><span class="cl">[^a-z] ï¼šåŒ¹é…é™¤å­—ç¬¦aåˆ°å­—ç¬¦zä»¥å¤–çš„ä»»ä¸€å­—ç¬¦
</span></span><span class="line"><span class="cl">[^0-9] ï¼šåŒ¹é…é™¤æ•°å­—0åˆ°9ä»¥å¤–çš„ä»»ä¸€å­—ç¬¦
</span></span><span class="line"><span class="cl">[^abcd] ï¼šåŒ¹é…é™¤aã€bã€cã€dä»¥å¤–çš„ä»»ä¸€å­—ç¬¦
</span></span><span class="line"><span class="cl">å‡ ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„åŒ¹é…ç¬¦:
</span></span><span class="line"><span class="cl">\d ï¼šåŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[0-9]
</span></span><span class="line"><span class="cl">\D ï¼šåŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[^0-9]
</span></span><span class="line"><span class="cl">\w ï¼šåŒ¹é…åŒ…æ‹¬ä¸‹åˆ’çº¿çš„ä»»ä½•å•è¯å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[0-9a-zA-Z_]
</span></span><span class="line"><span class="cl">\W ï¼šåŒ¹é…ä»»ä½•éå•è¯å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[^\w]
</span></span><span class="line"><span class="cl">\s ï¼šåŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼Œspaceç¼©å†™
</span></span><span class="line"><span class="cl">\S ï¼šåŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[^\s]
</span></span><span class="line"><span class="cl">.(æˆ‘æ˜¯ä¸€ä¸ªç‚¹å·)  ï¼šåŒ¹é…é™¤ &#34;\n&#34; ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦
</span></span><span class="line"><span class="cl">[\u4e00-\u9fa5] ï¼šåŒ¹é…ä¸­æ–‡å­—ç¬¦ä¸­çš„ä»»ä¸€å­—ç¬¦
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.é™å®šç¬¦ï¼ˆæŸ¥å¤šå°‘ï¼‰
</span></span><span class="line"><span class="cl">é™å®šç¬¦å¯ä»¥æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªç»™å®šç»„ä»¶å¿…é¡»è¦å‡ºç°å¤šå°‘æ¬¡æ‰èƒ½æ»¡è¶³åŒ¹é…ã€‚
</span></span><span class="line"><span class="cl">* ï¼šåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œ0åˆ°å¤šï¼Œ{0,}
</span></span><span class="line"><span class="cl">+ ï¼šåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œ1åˆ°å¤šï¼Œ{1,}
</span></span><span class="line"><span class="cl">? ï¼šåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œ0æˆ–1ï¼Œ{0,1}
</span></span><span class="line"><span class="cl">{n} ï¼šåŒ¹é…ç¡®å®šçš„ n æ¬¡
</span></span><span class="line"><span class="cl">{n,} ï¼šè‡³å°‘åŒ¹é…n æ¬¡
</span></span><span class="line"><span class="cl">{n,m} ï¼šæœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡
</span></span><span class="line"><span class="cl">  //ç‰¹åˆ«è¯´æ˜ï¼š
</span></span><span class="line"><span class="cl">è´ªå©ªåŒ¹é…
</span></span><span class="line"><span class="cl">åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œèƒ½åŒ¹é…å¤šçš„å°±ä¸åŒ¹é…å°‘çš„ï¼Œæˆ‘ä»¬æŠŠè¿™ç§åŒ¹é…æ¨¡å¼å°±ç§°ä¹‹ä¸ºâ€œè´ªå©ªåŒ¹é…ã€‚
</span></span><span class="line"><span class="cl">æ‰€æœ‰çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨çš„éƒ½æ˜¯è´ªå©ªåŒ¹é…åŸåˆ™ã€‚
</span></span><span class="line"><span class="cl">éè´ªå©ªåŒ¹é…
</span></span><span class="line"><span class="cl">åœ¨é™å®šç¬¦çš„åé¢æ·»åŠ ä¸€ä¸ªé—®å·ï¼Ÿï¼Œé‚£æˆ‘ä»¬çš„è´ªå©ªåŒ¹é…åŸåˆ™å°±ä¼šè½¬åŒ–ä¸ºéè´ªå©ªåŒ¹é…åŸåˆ™ï¼Œä¼˜å…ˆåŒ¹é…å°‘çš„ã€‚
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">3.å®šä½ç¬¦ï¼ˆä»å“ªæŸ¥ï¼‰
</span></span><span class="line"><span class="cl">å®šä½ç¬¦å¯ä»¥å°†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å›ºå®šåœ¨ä¸€è¡Œçš„å¼€å§‹æˆ–ç»“æŸã€‚ä¹Ÿå¯ä»¥åˆ›å»ºåªåœ¨å•è¯å†…æˆ–åªåœ¨å•è¯çš„å¼€å§‹æˆ–ç»“å°¾å¤„å‡ºç°çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚
</span></span><span class="line"><span class="cl">^ ï¼šåŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®
</span></span><span class="line"><span class="cl">$ ï¼šåŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½®
</span></span><span class="line"><span class="cl">\b ï¼šåŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œ
</span></span><span class="line"><span class="cl">\B ï¼šåŒ¹é…éå•è¯è¾¹ç•Œ
</span></span></code></pre></div><p>7ã€å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.è½¬ä¹‰ç¬¦
</span></span><span class="line"><span class="cl">åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åæ–œæ \å¯¹æŸäº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰æ“ä½œã€‚éœ€è¦è½¬ä¹‰çš„å­—ç¬¦ï¼š
</span></span><span class="line"><span class="cl">ç‚¹å·.
</span></span><span class="line"><span class="cl">å°æ‹¬å·()
</span></span><span class="line"><span class="cl">ä¸­æ‹¬å·[]
</span></span><span class="line"><span class="cl">å·¦æ–œæ /
</span></span><span class="line"><span class="cl">å³æ–œæ \
</span></span><span class="line"><span class="cl">é€‰æ‹©åŒ¹é…ç¬¦|
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.é€‰æ‹©åŒ¹é…ç¬¦ï¼šåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç«–çº¿|ä»£è¡¨é€‰æ‹©åŒ¹é…ç¬¦ã€‚å¯ä»¥ç†è§£æˆâ€œæˆ–â€ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.ç‰¹æ®Šç”¨æ³•ï¼š
</span></span><span class="line"><span class="cl">(?=) ï¼šæ­£å‘é¢„æŸ¥ï¼›
</span></span><span class="line"><span class="cl">(?!) ï¼šè´Ÿå‘é¢„æŸ¥ï¼›
</span></span><span class="line"><span class="cl">ç‰¹åˆ«è¯´æ˜ï¼šåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå¦‚æœå­è¡¨è¾¾å¼é‡åˆ°äº†execå°±ä¼šäº§ç”Ÿä¸Šé¢çš„ç»“æœã€‚å…¶è¿”å›ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚
</span></span><span class="line"><span class="cl">ç¬¬ä¸€ç»„å…ƒç´ ï¼Œç´¢å¼•ä¸º0çš„æ•°æ®hellophpï¼Œä»£è¡¨æ­£åˆ™åŒ¹é…åˆ°çš„ç»“æœ;ç´¢å¼•ä¸º1çš„æ•°æ®phpï¼Œä»£è¡¨æ˜¯ç¬¬ä¸€ä¸ªå­è¡¨è¾¾å¼åŒ¹é…åˆ°çš„ç»“æœ
</span></span><span class="line"><span class="cl">ç¬¬äºŒç»„å…ƒç´ ï¼Œç´¢å¼•ä¸º0çš„æ•°æ®hellojavascriptï¼Œä»£è¡¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ°çš„ç»“æœ;ç´¢å¼•ä¸º1çš„æ•°æ®javascriptï¼Œä»£è¡¨æ˜¯ç¬¬ä¸€ä¸ªå­è¡¨è¾¾å¼åŒ¹é…åˆ°çš„ç»“æœ
</span></span><span class="line"><span class="cl">å¦‚ä½•è§£å†³ä»¥ä¸Šé—®é¢˜å‘¢ï¼Ÿç­”ï¼šå¯ä»¥ä½¿ç”¨(?:)çš„å½¢å¼ï¼Œè®©æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„å­è¡¨è¾¾å¼åªè¾“å‡ºå†…å®¹ï¼Œä½†ä¸æ•è·ã€‚
</span></span><span class="line"><span class="cl"> (?:)ï¼šè¾“å‡ºå†…å®¹ä½†ä¸æ•è·ï¼ˆè¦ç”¨åˆ°çš„çŸ¥è¯†ç‚¹ï¼šå­è¡¨è¾¾å¼ä¸execæ–¹æ³•ï¼‰
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>mysqldumpå¯¼å‡ºæ•°æ®åº“å„å‚æ•°è¯´æ˜</title>
			<link>https://blog.gookm.cn/posts/2017/20170321-mysqldump/</link>
			<pubDate>Tue, 21 Mar 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170321-mysqldump/</guid>
			<description>mysqldumpæ˜¯mysqlç”¨äºè½¬å­˜å‚¨æ•°æ®åº“çš„å®ç”¨ç¨‹åºã€‚å®ƒä¸»è¦äº§ç”Ÿä¸€ä¸ªSQLè„šæœ¬ï¼Œå…¶ä¸­åŒ…å«ä»å¤´é‡æ–°åˆ›å»ºæ•°æ®åº“æ‰€å¿…éœ€çš„å‘½ä»¤CREATE TABLE INSERTç­‰ã€‚
ä¸‹é¢æˆ‘ä»¬è¯¦ç»†ä»‹ç»ä¸€ä¸‹mysqldumpå¯¼å‡ºçš„å„ç§å®ä¾‹ï¼š ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡
å¯¼å‡ºæ•°æ® 1 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“çš„ç»“æ„
mysqldump -d dbname -uroot -p &amp;gt; dbname.sql 2 å¯¼å‡ºå¤šä¸ªæ•°æ®åº“çš„ç»“æ„
mysqldump -d -B dbname1 dbname2 -uroot -p &amp;gt; dbname.sql 3 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­æ•°æ®ï¼ˆä¸åŒ…å«ç»“æ„ï¼‰
mysqldump -t dbname -uroot -p &amp;gt; dbname.sql 4 å¯¼å‡ºå¤šä¸ªæ•°æ®åº“ä¸­æ•°æ®ï¼ˆä¸åŒ…å«ç»“æ„ï¼‰
mysqldump -t -B dbname1 dbname2 -uroot -p &amp;gt; dbname.sql 5 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“çš„ç»“æ„ä»¥åŠæ•°æ®
mysqldump dbname -uroot -p &amp;gt; dbname.sql 6 å¯¼å‡ºå¤šä¸ªæ•°æ®åº“çš„ç»“æ„ä»¥åŠæ•°æ®
mysqldump -B dbname1 dbname2 -uroot -p &amp;gt; dbname.sql 7 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­ä¸€ä¸ªè¡¨çš„ç»“æ„
mysqldump -d dbname1 tablename -uroot -p &amp;gt; tablename.</description>
			<content type="html"><![CDATA[<blockquote>
<p>mysqldumpæ˜¯mysqlç”¨äºè½¬å­˜å‚¨æ•°æ®åº“çš„å®ç”¨ç¨‹åºã€‚å®ƒä¸»è¦äº§ç”Ÿä¸€ä¸ªSQLè„šæœ¬ï¼Œå…¶ä¸­åŒ…å«ä»å¤´é‡æ–°åˆ›å»ºæ•°æ®åº“æ‰€å¿…éœ€çš„å‘½ä»¤CREATE TABLE INSERTç­‰ã€‚</p>
</blockquote>
<p>ä¸‹é¢æˆ‘ä»¬è¯¦ç»†ä»‹ç»ä¸€ä¸‹mysqldumpå¯¼å‡ºçš„å„ç§å®ä¾‹ï¼š
ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡</p>
<h3 id="å¯¼å‡ºæ•°æ®">å¯¼å‡ºæ•°æ®</h3>
<p>1 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“çš„ç»“æ„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="n">dbname</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>2 å¯¼å‡ºå¤šä¸ªæ•°æ®åº“çš„ç»“æ„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="n">dbname2</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>3 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­æ•°æ®ï¼ˆä¸åŒ…å«ç»“æ„ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="n">dbname</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>4 å¯¼å‡ºå¤šä¸ªæ•°æ®åº“ä¸­æ•°æ®ï¼ˆä¸åŒ…å«ç»“æ„ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="n">dbname2</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>5 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“çš„ç»“æ„ä»¥åŠæ•°æ®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="n">dbname</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>6 å¯¼å‡ºå¤šä¸ªæ•°æ®åº“çš„ç»“æ„ä»¥åŠæ•°æ®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="n">dbname2</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>7 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­ä¸€ä¸ªè¡¨çš„ç»“æ„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tablename</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>8 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­å¤šä¸ªè¡¨çš„ç»“æ„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="o">--</span><span class="kp">tables</span><span class="w"> </span><span class="n">tablename1</span><span class="w"> </span><span class="n">tablename2</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tablename</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>9 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­ä¸€ä¸ªè¡¨çš„æ•°æ®ï¼ˆä¸åŒ…å«ç»“æ„ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tablename</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>10 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­å¤šä¸ªè¡¨çš„æ•°æ®ï¼ˆä¸åŒ…å«ç»“æ„ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="o">--</span><span class="kp">tables</span><span class="w"> </span><span class="n">tablename1</span><span class="w"> </span><span class="n">tablename2</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tablename</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>11 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­ä¸€ä¸ªè¡¨çš„ç»“æ„ä»¥åŠæ•°æ®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tablename</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>12 å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ä¸­å¤šä¸ªè¡¨çš„ç»“æ„ä»¥åŠæ•°æ®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="o">--</span><span class="kp">tables</span><span class="w"> </span><span class="n">tablename1</span><span class="w"> </span><span class="n">tablename2</span><span class="w"> </span><span class="o">-</span><span class="n">uroot</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tablename</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><h3 id="å­˜å‚¨è¿‡ç¨‹å‡½æ•°æ“ä½œ">å­˜å‚¨è¿‡ç¨‹&amp;å‡½æ•°æ“ä½œ</h3>
<p>1 åªå¯¼å‡ºå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°(ä¸å¯¼å‡ºç»“æ„å’Œæ•°æ®ï¼Œè¦åŒæ—¶å¯¼å‡ºç»“æ„çš„è¯ï¼Œéœ€è¦åŒæ—¶ä½¿ç”¨-d)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="n">ndt</span><span class="w"> </span><span class="n">dbname</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>2 åªå¯¼å‡ºäº‹ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="w"> </span><span class="o">-</span><span class="n">ndt</span><span class="w"> </span><span class="n">dbname</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><p>3 ä¸å¯¼å‡ºè§¦å‘å™¨ï¼ˆè§¦å‘å™¨æ˜¯é»˜è®¤å¯¼å‡ºçš„â€“triggersï¼Œä½¿ç”¨â€“skip-triggerså±è”½å¯¼å‡ºè§¦å‘å™¨ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysqldump</span><span class="w"> </span><span class="o">--</span><span class="n">skip</span><span class="o">-</span><span class="n">triggers</span><span class="w"> </span><span class="n">dbname1</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><h3 id="æŠŠå¯¼å‡ºçš„æ•°æ®å¯¼å…¥åˆ°æ•°æ®åº“">æŠŠå¯¼å‡ºçš„æ•°æ®å¯¼å…¥åˆ°æ•°æ®åº“</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">&gt;</span><span class="n">mysql</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&gt;</span><span class="k">use</span><span class="w"> </span><span class="n">dbname</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&gt;</span><span class="n">source</span><span class="w"> </span><span class="n">dbname</span><span class="p">.</span><span class="k">sql</span><span class="w">
</span></span></span></code></pre></div><h3 id="æ€»ç»“ä¸€ä¸‹">æ€»ç»“ä¸€ä¸‹</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">-d ç»“æ„(--no-data:ä¸å¯¼å‡ºä»»ä½•æ•°æ®ï¼Œåªå¯¼å‡ºæ•°æ®åº“è¡¨ç»“æ„)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">-t æ•°æ®(--no-create-info:åªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE TABLE è¯­å¥)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-n (--no-create-db:åªå¯¼å‡ºæ•°æ®ï¼Œè€Œä¸æ·»åŠ CREATE DATABASE è¯­å¥ï¼‰
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-R (--routines:å¯¼å‡ºå­˜å‚¨è¿‡ç¨‹ä»¥åŠè‡ªå®šä¹‰å‡½æ•°)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-E (--events:å¯¼å‡ºäº‹ä»¶)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--triggers (é»˜è®¤å¯¼å‡ºè§¦å‘å™¨ï¼Œä½¿ç”¨--skip-triggerså±è”½å¯¼å‡º)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-B (--databases:å¯¼å‡ºæ•°æ®åº“åˆ—è¡¨ï¼Œå•ä¸ªåº“æ—¶å¯çœç•¥ï¼‰
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--tables è¡¨åˆ—è¡¨ï¼ˆå•ä¸ªè¡¨æ—¶å¯çœç•¥ï¼‰
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘ åŒæ—¶å¯¼å‡ºç»“æ„ä»¥åŠæ•°æ®æ—¶å¯åŒæ—¶çœç•¥-då’Œ-t
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¡åŒæ—¶ ä¸ å¯¼å‡ºç»“æ„å’Œæ•°æ®å¯ä½¿ç”¨-ntd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¢åªå¯¼å‡ºå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°å¯ä½¿ç”¨-R -ntd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘£å¯¼å‡ºæ‰€æœ‰(ç»“æ„&amp;æ•°æ®&amp;å­˜å‚¨è¿‡ç¨‹&amp;å‡½æ•°&amp;äº‹ä»¶&amp;è§¦å‘å™¨)ä½¿ç”¨-R -E(ç›¸å½“äºâ‘ ï¼Œçœç•¥äº†-d -t;è§¦å‘å™¨é»˜è®¤å¯¼å‡º)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¤åªå¯¼å‡ºç»“æ„&amp;å‡½æ•°&amp;äº‹ä»¶&amp;è§¦å‘å™¨ä½¿ç”¨ -R -E -d
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>MySQLé«˜çº§æ“ä½œğŸ¥—</title>
			<link>https://blog.gookm.cn/posts/2017/20170106-mysql-advanced/</link>
			<pubDate>Fri, 06 Jan 2017 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2017/20170106-mysql-advanced/</guid>
			<description>å¢åŠ å†…å®¹ï¼ˆåŸºç¡€å‘½ä»¤ï¼‰ 1.è¡¨åå¢åŠ ä¸»é”®alter table è¡¨å add primary key(å­—æ®µ); åœ¨æ‰€æœ‰å­—æ®µä¹‹åå¢åŠ primary keyé€‰é¡¹ï¼šprimary key(å­—æ®µä¿¡æ¯) ç›´æ¥åœ¨éœ€è¦å½“åšä¸»é”®çš„å­—æ®µä¹‹åï¼Œå¢åŠ primary keyå±æ€§æ¥ç¡®å®šä¸»é”® 2.åˆ é™¤ä¸»é”®alter table è¡¨å drop primary key; 3.è‡ªåŠ¨å¢é•¿åœ¨å­—æ®µä¹‹åå¢åŠ ä¸€ä¸ªå±æ€§auto_increment 4.ä¿®æ”¹è‡ªåŠ¨å¢é•¿ alter table è¡¨åauto_increment = å€¼; 5.åˆ é™¤è‡ªåŠ¨å¢é•¿ å¦‚ï¼šalter table è¡¨å modify id int 6.æŸ¥çœ‹è‡ªå¢é•¿åˆå§‹å˜é‡ show variables like &amp;#39;auto_increment%&amp;#39;; 7.æ·»åŠ å”¯ä¸€é”®ï¼ˆä¸ä¸»é”®åŸºæœ¬ä¸€æ ·ï¼‰alter table è¡¨åadd unique key(å­—æ®µåˆ—è¡¨); 8.åˆ é™¤å”¯ä¸€é”® alter table è¡¨ådrop unique key; - - é”™è¯¯çš„ å”¯ä¸€é”®å¯ä»¥æœ‰å¤šä¸ª alter table è¡¨ådrop index å”¯ä¸€é”®åå­—; é«˜çº§æ•°æ®æ“ä½œ 1.å¤šæ•°æ®æ’å…¥ insert into è¡¨å [(å­—æ®µåˆ—è¡¨)] values(å€¼åˆ—è¡¨), (å€¼åˆ—è¡¨)â€¦; 2.ä¸»é”®å†²çªæ›´æ–°insert into è¡¨å [(å­—æ®µåˆ—è¡¨)] values(å€¼åˆ—è¡¨) on duplicate key updateå­—æ®µ = æ–°å€¼; 3.</description>
			<content type="html"><![CDATA[<h3 id="å¢åŠ å†…å®¹åŸºç¡€å‘½ä»¤">å¢åŠ å†…å®¹ï¼ˆåŸºç¡€å‘½ä»¤ï¼‰</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="mi">1</span><span class="p">.</span><span class="err">è¡¨åå¢åŠ ä¸»é”®</span><span class="n">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="err">å­—æ®µ</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">åœ¨æ‰€æœ‰å­—æ®µä¹‹åå¢åŠ </span><span class="n">primary</span><span class="w"> </span><span class="n">keyé€‰é¡¹</span><span class="err">ï¼š</span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="err">å­—æ®µä¿¡æ¯</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">ç›´æ¥åœ¨éœ€è¦å½“åšä¸»é”®çš„å­—æ®µä¹‹åï¼Œå¢åŠ </span><span class="n">primary</span><span class="w"> </span><span class="n">keyå±æ€§æ¥ç¡®å®šä¸»é”®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">2</span><span class="p">.</span><span class="err">åˆ é™¤ä¸»é”®</span><span class="n">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">3</span><span class="p">.</span><span class="err">è‡ªåŠ¨å¢é•¿åœ¨å­—æ®µä¹‹åå¢åŠ ä¸€ä¸ªå±æ€§</span><span class="n">auto_increment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">4</span><span class="p">.</span><span class="err">ä¿®æ”¹è‡ªåŠ¨å¢é•¿</span><span class="w"> </span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="n">auto_increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">å€¼</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">5</span><span class="p">.</span><span class="err">åˆ é™¤è‡ªåŠ¨å¢é•¿</span><span class="w"> </span><span class="err">å¦‚ï¼š</span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">6</span><span class="p">.</span><span class="err">æŸ¥çœ‹è‡ªå¢é•¿åˆå§‹å˜é‡</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;auto_increment%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">7</span><span class="p">.</span><span class="err">æ·»åŠ å”¯ä¸€é”®ï¼ˆä¸ä¸»é”®åŸºæœ¬ä¸€æ ·ï¼‰</span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="n">add</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">8</span><span class="p">.</span><span class="err">åˆ é™¤å”¯ä¸€é”®</span><span class="w"> </span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="n">drop</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="k">key</span><span class="p">;</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="err">é”™è¯¯çš„</span><span class="w"> </span><span class="err">å”¯ä¸€é”®å¯ä»¥æœ‰å¤šä¸ª</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="n">drop</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="err">å”¯ä¸€é”®åå­—</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="é«˜çº§æ•°æ®æ“ä½œ">é«˜çº§æ•°æ®æ“ä½œ</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="mi">1</span><span class="p">.</span><span class="err">å¤šæ•°æ®æ’å…¥</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="p">[(</span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="p">)]</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="err">å€¼åˆ—è¡¨</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="err">å€¼åˆ—è¡¨</span><span class="p">)</span><span class="err">â€¦</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">2</span><span class="p">.</span><span class="err">ä¸»é”®å†²çªæ›´æ–°</span><span class="n">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="p">[(</span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="p">)]</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="err">å€¼åˆ—è¡¨</span><span class="p">)</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">duplicate</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">updateå­—æ®µ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">æ–°å€¼</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">3</span><span class="p">.</span><span class="err">ä¸»é”®å†²çªæ›¿æ¢</span><span class="n">replace</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="p">[(</span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="p">)]</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="err">å€¼åˆ—è¡¨</span><span class="p">);</span><span class="w">  </span><span class="err">å¹²æ‰åŸæ¥çš„æ•°æ®ï¼Œé‡æ–°æ’å…¥è¿›å»</span><span class="w"> </span><span class="err">ä¸</span><span class="n">insertæœ‰ç‚¹åƒ</span><span class="w"> </span><span class="err">æ¯”</span><span class="n">insertæ•ˆç‡ä½</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">4</span><span class="p">.</span><span class="err">è •è™«å¤åˆ¶</span><span class="n">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="p">[(</span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="p">)]</span><span class="w"> </span><span class="k">select</span><span class="w">  </span><span class="o">*/</span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">è¡¨</span><span class="p">;</span><span class="w"> </span><span class="err">æµ‹è¯•è¡¨çš„å‹åŠ›</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">5</span><span class="p">.</span><span class="err">æ›´æ–°æ•°æ®</span><span class="n">updateè¡¨å</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="err">å­—æ®µå</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">æ–°å€¼</span><span class="w"> </span><span class="p">[</span><span class="k">where</span><span class="w"> </span><span class="err">åˆ¤æ–­æ¡ä»¶</span><span class="p">]</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="err">æ•°é‡</span><span class="p">;</span><span class="err">ï¼ˆæ²¡æœ‰</span><span class="n">whereæ˜¯å…¨è¡¨æ›´æ–°</span><span class="err">ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">6</span><span class="p">.</span><span class="err">åˆ é™¤æ•°æ®</span><span class="n">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="p">[</span><span class="k">where</span><span class="w"> </span><span class="err">æ¡ä»¶</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">limit</span><span class="w"> </span><span class="err">æ•°é‡</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">7</span><span class="p">.</span><span class="err">é‡ç½®è‡ªå¢é•¿</span><span class="n">truncate</span><span class="w"> </span><span class="err">è¡¨å</span><span class="p">;</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="err">ç›¸å½“äº</span><span class="n">drop</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="err">å†</span><span class="n">create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">8</span><span class="p">.</span><span class="err">æŸ¥è¯¢æ•°æ®</span><span class="w"> </span><span class="k">select</span><span class="w">  </span><span class="p">[</span><span class="n">selectçš„é€‰é¡¹</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="w">   </span><span class="k">from</span><span class="w"> </span><span class="err">æ•°æ®æº</span><span class="w">   </span><span class="n">whereæ¡ä»¶</span><span class="w">   </span><span class="k">group</span><span class="w"> </span><span class="n">byåˆ†ç»„</span><span class="w">  </span><span class="n">havingæ¡ä»¶</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="n">byæ’åº</span><span class="w">   </span><span class="n">limité™åˆ¶</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Selecté€‰é¡¹</span><span class="err">ï¼šé»˜è®¤</span><span class="n">all</span><span class="w">   </span><span class="err">å­—æ®µåˆ—è¡¨ï¼šå­—æ®µå</span><span class="w"> </span><span class="p">[</span><span class="k">as</span><span class="p">]</span><span class="w"> </span><span class="err">åˆ«å</span><span class="w">  </span><span class="n">fromæ•°æ®æº</span><span class="err">ï¼š</span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">è¡¨</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">åˆ«å</span><span class="p">;</span><span class="w">  </span><span class="err">èšåˆå‡½æ•°ï¼š</span><span class="nf">group_concat</span><span class="p">()</span><span class="err">ä¸ºäº†å°†åˆ†ç»„ä¸­æŒ‡å®šçš„å­—æ®µè¿›è¡Œåˆå¹¶ï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">9</span><span class="p">.</span><span class="err">åˆ†ç»„æ’åº</span><span class="n">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="err">å­—æ®µ</span><span class="w"> </span><span class="p">[</span><span class="k">asc</span><span class="o">|</span><span class="k">desc</span><span class="p">]</span><span class="err">ï¼Œå­—æ®µ</span><span class="w"> </span><span class="p">[</span><span class="k">asc</span><span class="o">|</span><span class="k">desc</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">10</span><span class="p">.</span><span class="err">å›æº¯ç»Ÿè®¡</span><span class="n">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="err">å­—æ®µ</span><span class="w"> </span><span class="p">[</span><span class="k">asc</span><span class="o">|</span><span class="k">desc</span><span class="p">]</span><span class="w"> </span><span class="n">withrollup</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">11</span><span class="p">.</span><span class="err">è”åˆæŸ¥è¯¢</span><span class="n">select</span><span class="w"> </span><span class="err">è¯­å¥</span><span class="w"> </span><span class="err">é»˜è®¤ï¼š</span><span class="k">distinct</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="p">[</span><span class="k">union</span><span class="w"> </span><span class="err">é€‰é¡¹</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">è§„åˆ™</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="err">åœ¨è”åˆæŸ¥è¯¢ä¸­ï¼Œå¦‚æœè¦ä½¿ç”¨</span><span class="n">order</span><span class="w"> </span><span class="k">by</span><span class="err">ï¼Œé‚£ä¹ˆå¯¹åº”çš„</span><span class="n">selectè¯­å¥å¿…é¡»ä½¿ç”¨æ‹¬å·æ‹¬èµ·æ¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">è§„åˆ™</span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">orderbyåœ¨è”åˆæŸ¥è¯¢ä¸­è‹¥è¦ç”Ÿæ•ˆ</span><span class="err">ï¼Œå¿…é¡»é…åˆä½¿ç”¨</span><span class="n">limit</span><span class="err">ï¼šè€Œ</span><span class="n">limitåé¢å¿…é¡»è·Ÿå¯¹åº”çš„é™åˆ¶æ•°é‡</span><span class="err">ï¼ˆé€šå¸¸å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼šå¤§äºå¯¹åº”è¡¨çš„è®°å½•æ•°çš„å€¼ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">12</span><span class="p">.</span><span class="err">è¿æ¥æŸ¥è¯¢</span><span class="w"> </span><span class="k">cross</span><span class="w"> </span><span class="k">join</span><span class="p">:</span><span class="err">è¡¨</span><span class="mi">1</span><span class="w"> </span><span class="k">cross</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="err">è¡¨</span><span class="mi">2</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">è¡¨</span><span class="mi">1</span><span class="w"> </span><span class="p">[</span><span class="k">inner</span><span class="p">]</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="err">è¡¨</span><span class="mi">2</span><span class="w">  </span><span class="n">onåŒ¹é…æ¡ä»¶</span><span class="p">;</span><span class="w"> </span><span class="err">ä¸å¸¦æ¡ä»¶å°±æ˜¯äº¤å‰æŸ¥è¯¢ï¼ˆé¿å…ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">outer</span><span class="w"> </span><span class="k">join</span><span class="err">ï¼šä¸»è¡¨</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="err">ä»è¡¨</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="err">è¿æ¥æ¡ä»¶</span><span class="p">;</span><span class="w">  </span><span class="c1">-- å¤–è¿æ¥å¿…é¡»æœ‰onæ¡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">   </span><span class="err">å¤–è¿æ¥çš„ç‰¹ç‚¹ï¼š</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="mi">1</span><span class="err">ã€å¤–è¿æ¥ä¸­ä¸»è¡¨æ•°æ®è®°å½•ä¸€å®šä¼šä¿å­˜ï¼šè¿æ¥ä¹‹åä¸ä¼šå‡ºç°è®°å½•æ•°å°‘äºä¸»è¡¨çš„æƒ…å†µï¼ˆä½†å†…è¿æ¥å¯èƒ½å°‘ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="mi">2</span><span class="err">ã€å·¦è¿æ¥å’Œå³è¿æ¥å…¶å®å¯ä»¥äº’ç›¸è½¬æ¢ï¼Œä½†æ˜¯æ•°æ®å¯¹åº”çš„ä½ç½®ï¼ˆè¡¨é¡ºåºï¼‰ä¼šæ”¹å˜ã€‚</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">13</span><span class="p">.</span><span class="err">æ ‡é‡å­æŸ¥è¯¢</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">æ•°æ®æº</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="err">æ¡ä»¶åˆ¤æ–­</span><span class="w"> </span><span class="o">=/&lt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="err">å­—æ®µå</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">æ•°æ®æº</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="err">æ¡ä»¶åˆ¤æ–­</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="err">æ³¨æ„ï¼Œæ‹¬å·ä¸­æ ‡é‡å­æŸ¥è¯¢å¾—åˆ°çš„ç»“æœåªæœ‰ä¸€ä¸ªå€¼</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">14</span><span class="p">.</span><span class="err">åˆ—å­æŸ¥è¯¢</span><span class="w"> </span><span class="err">ä¸»æŸ¥è¯¢</span><span class="n">where</span><span class="w"> </span><span class="err">æ¡ä»¶</span><span class="nf">in</span><span class="w">  </span><span class="p">(</span><span class="err">åˆ—å­æŸ¥è¯¢</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">15</span><span class="p">.</span><span class="err">è¡Œå­æŸ¥è¯¢</span><span class="w"> </span><span class="err">ä¸»æŸ¥è¯¢</span><span class="n">where</span><span class="w"> </span><span class="err">æ¡ä»¶</span><span class="p">[</span><span class="err">ï¼ˆæ„é€ ä¸€ä¸ªè¡Œå…ƒç´ ï¼‰</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">è¡Œå­æŸ¥è¯¢</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="err">è¡Œå…ƒç´ ï¼šè¡Œå…ƒç´ å¯¹åº”çš„å°±æ˜¯å¤šä¸ªå­—æ®µï¼ŒæŠŠå¤šä¸ªå­—æ®µâ€œåˆèµ·æ¥â€ä½œä¸ºä¸€ä¸ªå…ƒç´ å‚ä¸è¿ç®—ï¼ŒæŠŠè¿™ç§æƒ…å†µç§°ä¹‹ä¸ºè¡Œå…ƒç´ ã€‚</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">16</span><span class="p">.</span><span class="err">è¡¨å­æŸ¥è¯¢</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="err">è¡¨å­æŸ¥è¯¢</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">åˆ«å</span><span class="w"> </span><span class="p">[</span><span class="k">where</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">having</span><span class="p">][</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">limit</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">17</span><span class="p">.</span><span class="n">existså­æŸ¥è¯¢</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">exists</span><span class="p">(</span><span class="err">æŸ¥è¯¢è¯­å¥</span><span class="p">)</span><span class="err">ï¼›</span><span class="w"> </span><span class="err">æŸ¥è¯¢è¿”å›çš„ç»“æœåªæœ‰</span><span class="mi">0</span><span class="err">æˆ–è€…</span><span class="mi">1</span><span class="err">ï¼Œ</span><span class="mi">1</span><span class="err">ä»£è¡¨æˆç«‹ï¼Œ</span><span class="mi">0</span><span class="err">ä»£è¡¨ä¸æˆç«‹</span><span class="w">
</span></span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Linuxå­¦ä¹ å½’çº³å“ˆå“ˆğŸš€</title>
			<link>https://blog.gookm.cn/posts/2016/20160703-linux-study/</link>
			<pubDate>Sun, 03 Jul 2016 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2016/20160703-linux-study/</guid>
			<description>ç³»ç»Ÿä¸­å¸¸ç”¨ShellæŒ‡ä»¤ â‘ æŒ‡ä»¤å•ç‹¬å­˜åœ¨ â‘¡ æŒ‡ä»¤å¸¦é€‰é¡¹ â‘¢ æŒ‡ä»¤å¸¦é€‰é¡¹å¸¦å‚æ•° lsæŒ‡ä»¤ï¼šæ˜¾ç¤ºå½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ ç›¸å…³é€‰é¡¹ï¼š -l ï¼šlistç¼©å†™ï¼Œä»£è¡¨ä»¥åˆ—è¡¨å½¢å¼æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ -a ï¼šallç¼©å†™ï¼Œä»£è¡¨æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰ â‘  lsæŒ‡ä»¤ â‘¡ lsæŒ‡ä»¤ -lï¼Œè¿™ä¸ªæŒ‡ä»¤è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€å†™ä¸ºll â‘¢ lsæŒ‡ä»¤ -a â‘£ lsæŒ‡ä»¤ -al ï¼šä»¥åˆ—è¡¨å½¢å¼æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰ Ls â€“l /var/www *.php åˆ—å‡ºå½“å‰ç›®å½•ä¸‹ï¼Œä»¥.phpç»“å°¾çš„æ–‡ä»¶ ls â€“al *.php pwdæŒ‡ä»¤ï¼šæ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½• cdæŒ‡ä»¤ï¼šè·³è½¬åˆ°æŒ‡å®šç›®å½• â‘  cd + è·¯å¾„ï¼šè·³è½¬åˆ°æŒ‡å®šçš„ç›®å½• â‘¡ cd .. ï¼šè·³è½¬åˆ°ä¸Šä¸€çº§ç›®å½• â‘¢ cd + ~ ï¼šè·³è½¬åˆ°è‡ªå·±çš„å®¶ä¸­ï¼Œæ™®é€šç”¨æˆ·å°±è·³è½¬åˆ°/home/ç”¨æˆ·åç›®å½•ä¸‹ï¼Œè¶…çº§ç®¡ç†å‘˜/root clear ï¼šæ¸…å±æŒ‡ä»¤ logout ï¼šé€€å‡ºæŒ‡ä»¤ æ™®åŠå°çŸ¥è¯†ï¼šLinuxæ“ä½œç³»ç»Ÿä¸­ï¼Œå­˜åœ¨ä¸¤ç§ç•Œé¢ï¼Œä¸€ä¸ªæ˜¯å›¾å½¢ç•Œé¢ï¼Œä¸€ä¸ªå­—ç¬¦ç•Œé¢ã€‚ Ctrl + Alt + F1 ï¼šåˆ‡æ¢åˆ°å›¾å½¢ç•Œé¢ Ctrl + Alt + F2~F6 ï¼šåˆ‡æ¢åˆ°å­—ç¬¦ç•Œé¢ shutdown ï¼šå…³æœºæŒ‡ä»¤ ç›¸å…³é€‰é¡¹ï¼š â‘  shutdown -h åˆ†é’Ÿæ•°ï¼šå¤šå°‘åˆ†é’Ÿåå…³æœºï¼ˆçœŸå®å…³æœºï¼‰ â‘¡ shutdown -r åˆ†é’Ÿæ•°ï¼šå¤šå°‘åˆ†é’Ÿåé‡å¯ â‘¢ shutdown -k åˆ†é’Ÿæ•°ï¼šå¤šå°‘åˆ†é’Ÿåå…³æœºï¼ˆåªå‘å‡ºè­¦å‘Šï¼Œä¸å…³æœºï¼‰ â‘£ shutdown -c ï¼šå–æ¶ˆå…³æœºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¿«æ·é”®Ctrl + C ä½†æ˜¯ç‰¹åˆ«æ³¨æ„ï¼šshutdownæŒ‡ä»¤åªèƒ½æ˜¯è¶…çº§ç®¡ç†å‘˜ä½¿ç”¨ï¼Œä½¿ç”¨su rootåˆ‡æ¢è¶…çº§ç®¡ç†å‘˜ haltæŒ‡ä»¤ï¼šç«‹å³å…³æœº rebootæŒ‡ä»¤ï¼šç«‹å³é‡å¯ VIç¼–è¾‘å™¨çš„åŸºæœ¬æ“ä½œ â‘  vi filename ï¼šæ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥æ–‡ä»¶ â‘¡ vi + filename ï¼šæ‰“å¼€æ–‡ä»¶å¹¶å°†å…‰æ ‡ç½®äºæœ€åä¸€è¡Œ â‘¢ vi +n filename ï¼šæ‰“å¼€æ–‡ä»¶å¹¶å°†å…‰æ ‡ç½®äºç¬¬nè¡Œ â‘£ vi +/string filename ï¼šæ‰“å¼€æ–‡ä»¶å¹¶é«˜äº®æ˜¾ç¤ºstringå…³é”®è¯ æç¤ºï¼šå¯ä»¥ä½¿ç”¨å¿«æ·é”®å°nä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå…³é”®è¯ï¼Œè¾“å…¥ # æˆ–è€…å¤§ N ä¼šåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªå…³é”®è¯ã€‚ â‘¤ vi filename1 filename2 ï¼šåŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶ æç¤ºï¼šåœ¨æœ«è¡Œæ¨¡å¼ä¸‹ä½¿ç”¨:nextæˆ–:nåˆ‡æ¢ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨:prevåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ–‡ä»¶ã€‚ æ™®åŠå°çŸ¥è¯†ï¼šLinuxè‡ªåŠ¨è¡¥å…¨ï¼ˆéå¸¸é‡è¦ï¼‰ å½“è¾“å…¥æŸä¸ªæŒ‡ä»¤æˆ–æŸä¸ªæ–‡ä»¶åç§°æ—¶ï¼Œå¦‚æœæŒ‡ä»¤æˆ–åç§°è¿‡é•¿ï¼Œæˆ‘ä»¬åªéœ€è¦è¾“å…¥å‰å‡ ä¸ªå­—æ¯+TabæŒ‰é”®å°±å¯ä»¥å®ç°è‡ªåŠ¨è¡¥å…¨ã€‚ VIç¼–è¾‘å™¨çš„å‘½ä»¤æ¨¡å¼ä¸æœ«è¡Œæ¨¡å¼ å‘½ä»¤æ¨¡å¼ï¼š â‘  yy ï¼šå¤åˆ¶å½“å‰è¡Œ nyy ï¼šä»å½“å‰è¡Œå¼€å§‹å¤åˆ¶nè¡Œï¼Œä¾‹å¦‚ï¼šå¤åˆ¶3è¡Œå†…å®¹ï¼Œ3yy â‘¡ p ï¼šç²˜è´´ â‘¢ dd ï¼šåˆ é™¤å½“å‰è¡Œ ndd ï¼šä»å½“å‰è¡Œå¼€å§‹åˆ é™¤nè¡Œï¼Œä¾‹å¦‚ï¼šåˆ é™¤3è¡Œå†…å®¹ï¼Œ3ddã€‚ â‘£ u ï¼šæ’¤é”€ï¼Œç›¸å½“äºWindowsä¸­çš„Ctrl + Z â‘¤ d$ï¼šåˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®åˆ°è¡Œæœ«çš„æ‰€æœ‰å†…å®¹ã€‚ â‘¥ $ï¼šæŠŠå…‰æ ‡ç§»åŠ¨åˆ°è¡Œæœ«ã€‚ â‘¦ ^ï¼šæŠŠå…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–ã€‚ æœ«è¡Œæ¨¡å¼ï¼š :set nu ï¼šæ˜¾ç¤ºè¡Œå· :set nonu ï¼šå–æ¶ˆè¡Œå· /å…³é”®è¯ï¼šé«˜äº®æ˜¾ç¤ºæ‰€æœ‰å…³é”®è¯ :noh ï¼šå–æ¶ˆæ‰€æœ‰å…³é”®è¯é«˜äº® num1,num2 co num3 ï¼šæŠŠä»num1è¡Œåˆ°num2è¡Œçš„ä»£ç æ’å…¥åˆ°num3è¡Œçš„åé¢ :w ï¼šä¿å­˜æ–‡ä»¶ :q ï¼šé€€å‡º :wq ï¼šä¿å­˜å¹¶é€€å‡º ç‰¹åˆ«æ³¨æ„ï¼šæœ‰äº›æƒ…å†µä¸‹ï¼Œæœ‰äº›ç³»ç»Ÿæ–‡ä»¶ä¸å…è®¸ä¿å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨å¼ºåˆ¶ä¿å­˜æˆ–å¼ºåˆ¶é€€å‡ºæŒ‡ä»¤ã€‚ :w!</description>
			<content type="html"><![CDATA[<h3 id="ç³»ç»Ÿä¸­å¸¸ç”¨shellæŒ‡ä»¤">ç³»ç»Ÿä¸­å¸¸ç”¨ShellæŒ‡ä»¤</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">â‘ æŒ‡ä»¤å•ç‹¬å­˜åœ¨  â‘¡ æŒ‡ä»¤å¸¦é€‰é¡¹ â‘¢ æŒ‡ä»¤å¸¦é€‰é¡¹å¸¦å‚æ•°
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">lsæŒ‡ä»¤ï¼šæ˜¾ç¤ºå½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-l ï¼šlistç¼©å†™ï¼Œä»£è¡¨ä»¥åˆ—è¡¨å½¢å¼æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶
</span></span><span class="line"><span class="cl">-a ï¼šallç¼©å†™ï¼Œä»£è¡¨æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰
</span></span><span class="line"><span class="cl">â‘  lsæŒ‡ä»¤
</span></span><span class="line"><span class="cl">â‘¡ lsæŒ‡ä»¤ -lï¼Œè¿™ä¸ªæŒ‡ä»¤è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€å†™ä¸ºll
</span></span><span class="line"><span class="cl">â‘¢ lsæŒ‡ä»¤ -a
</span></span><span class="line"><span class="cl">â‘£ lsæŒ‡ä»¤ -al ï¼šä»¥åˆ—è¡¨å½¢å¼æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰
</span></span><span class="line"><span class="cl">Ls â€“l /var/www *.php
</span></span><span class="line"><span class="cl">åˆ—å‡ºå½“å‰ç›®å½•ä¸‹ï¼Œä»¥.phpç»“å°¾çš„æ–‡ä»¶  ls  â€“al *.php
</span></span><span class="line"><span class="cl">pwdæŒ‡ä»¤ï¼šæ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•
</span></span><span class="line"><span class="cl">cdæŒ‡ä»¤ï¼šè·³è½¬åˆ°æŒ‡å®šç›®å½•
</span></span><span class="line"><span class="cl">â‘  cd + è·¯å¾„ï¼šè·³è½¬åˆ°æŒ‡å®šçš„ç›®å½•
</span></span><span class="line"><span class="cl">â‘¡ cd .. ï¼šè·³è½¬åˆ°ä¸Šä¸€çº§ç›®å½•
</span></span><span class="line"><span class="cl">â‘¢ cd + ~ ï¼šè·³è½¬åˆ°è‡ªå·±çš„å®¶ä¸­ï¼Œæ™®é€šç”¨æˆ·å°±è·³è½¬åˆ°/home/ç”¨æˆ·åç›®å½•ä¸‹ï¼Œè¶…çº§ç®¡ç†å‘˜/root
</span></span><span class="line"><span class="cl">clear ï¼šæ¸…å±æŒ‡ä»¤
</span></span><span class="line"><span class="cl">logout ï¼šé€€å‡ºæŒ‡ä»¤
</span></span><span class="line"><span class="cl">æ™®åŠå°çŸ¥è¯†ï¼šLinuxæ“ä½œç³»ç»Ÿä¸­ï¼Œå­˜åœ¨ä¸¤ç§ç•Œé¢ï¼Œä¸€ä¸ªæ˜¯å›¾å½¢ç•Œé¢ï¼Œä¸€ä¸ªå­—ç¬¦ç•Œé¢ã€‚
</span></span><span class="line"><span class="cl">Ctrl + Alt + F1 ï¼šåˆ‡æ¢åˆ°å›¾å½¢ç•Œé¢
</span></span><span class="line"><span class="cl">Ctrl + Alt + F2~F6 ï¼šåˆ‡æ¢åˆ°å­—ç¬¦ç•Œé¢
</span></span><span class="line"><span class="cl">shutdown ï¼šå…³æœºæŒ‡ä»¤
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">â‘  shutdown  -h  åˆ†é’Ÿæ•°ï¼šå¤šå°‘åˆ†é’Ÿåå…³æœºï¼ˆçœŸå®å…³æœºï¼‰
</span></span><span class="line"><span class="cl">â‘¡ shutdown  -r  åˆ†é’Ÿæ•°ï¼šå¤šå°‘åˆ†é’Ÿåé‡å¯
</span></span><span class="line"><span class="cl">â‘¢ shutdown  -k  åˆ†é’Ÿæ•°ï¼šå¤šå°‘åˆ†é’Ÿåå…³æœºï¼ˆåªå‘å‡ºè­¦å‘Šï¼Œä¸å…³æœºï¼‰
</span></span><span class="line"><span class="cl">â‘£ shutdown  -c ï¼šå–æ¶ˆå…³æœºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¿«æ·é”®Ctrl + C
</span></span><span class="line"><span class="cl">ä½†æ˜¯ç‰¹åˆ«æ³¨æ„ï¼šshutdownæŒ‡ä»¤åªèƒ½æ˜¯è¶…çº§ç®¡ç†å‘˜ä½¿ç”¨ï¼Œä½¿ç”¨su  rootåˆ‡æ¢è¶…çº§ç®¡ç†å‘˜
</span></span><span class="line"><span class="cl">haltæŒ‡ä»¤ï¼šç«‹å³å…³æœº
</span></span><span class="line"><span class="cl">rebootæŒ‡ä»¤ï¼šç«‹å³é‡å¯
</span></span></code></pre></div><h3 id="viç¼–è¾‘å™¨çš„åŸºæœ¬æ“ä½œ">VIç¼–è¾‘å™¨çš„åŸºæœ¬æ“ä½œ</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">â‘  vi filename ï¼šæ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥æ–‡ä»¶
</span></span><span class="line"><span class="cl">â‘¡ vi + filename ï¼šæ‰“å¼€æ–‡ä»¶å¹¶å°†å…‰æ ‡ç½®äºæœ€åä¸€è¡Œ
</span></span><span class="line"><span class="cl">â‘¢ vi +n filename ï¼šæ‰“å¼€æ–‡ä»¶å¹¶å°†å…‰æ ‡ç½®äºç¬¬nè¡Œ
</span></span><span class="line"><span class="cl">â‘£ vi +/string filename  ï¼šæ‰“å¼€æ–‡ä»¶å¹¶é«˜äº®æ˜¾ç¤ºstringå…³é”®è¯
</span></span><span class="line"><span class="cl">æç¤ºï¼šå¯ä»¥ä½¿ç”¨å¿«æ·é”®å°nä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå…³é”®è¯ï¼Œè¾“å…¥ # æˆ–è€…å¤§ N ä¼šåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªå…³é”®è¯ã€‚
</span></span><span class="line"><span class="cl">â‘¤ vi filename1 filename2 ï¼šåŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶
</span></span><span class="line"><span class="cl">æç¤ºï¼šåœ¨æœ«è¡Œæ¨¡å¼ä¸‹ä½¿ç”¨:nextæˆ–:nåˆ‡æ¢ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨:prevåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ–‡ä»¶ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ™®åŠå°çŸ¥è¯†ï¼šLinuxè‡ªåŠ¨è¡¥å…¨ï¼ˆéå¸¸é‡è¦ï¼‰
</span></span><span class="line"><span class="cl">å½“è¾“å…¥æŸä¸ªæŒ‡ä»¤æˆ–æŸä¸ªæ–‡ä»¶åç§°æ—¶ï¼Œå¦‚æœæŒ‡ä»¤æˆ–åç§°è¿‡é•¿ï¼Œæˆ‘ä»¬åªéœ€è¦è¾“å…¥å‰å‡ ä¸ªå­—æ¯+TabæŒ‰é”®å°±å¯ä»¥å®ç°è‡ªåŠ¨è¡¥å…¨ã€‚
</span></span></code></pre></div><h3 id="viç¼–è¾‘å™¨çš„å‘½ä»¤æ¨¡å¼ä¸æœ«è¡Œæ¨¡å¼">VIç¼–è¾‘å™¨çš„å‘½ä»¤æ¨¡å¼ä¸æœ«è¡Œæ¨¡å¼</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">å‘½ä»¤æ¨¡å¼ï¼š
</span></span><span class="line"><span class="cl">â‘  yy ï¼šå¤åˆ¶å½“å‰è¡Œ
</span></span><span class="line"><span class="cl">   nyy ï¼šä»å½“å‰è¡Œå¼€å§‹å¤åˆ¶nè¡Œï¼Œä¾‹å¦‚ï¼šå¤åˆ¶3è¡Œå†…å®¹ï¼Œ3yy
</span></span><span class="line"><span class="cl">â‘¡ p ï¼šç²˜è´´
</span></span><span class="line"><span class="cl">â‘¢ dd ï¼šåˆ é™¤å½“å‰è¡Œ
</span></span><span class="line"><span class="cl">   ndd ï¼šä»å½“å‰è¡Œå¼€å§‹åˆ é™¤nè¡Œï¼Œä¾‹å¦‚ï¼šåˆ é™¤3è¡Œå†…å®¹ï¼Œ3ddã€‚
</span></span><span class="line"><span class="cl">â‘£ u ï¼šæ’¤é”€ï¼Œç›¸å½“äºWindowsä¸­çš„Ctrl + Z
</span></span><span class="line"><span class="cl">â‘¤ d$ï¼šåˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®åˆ°è¡Œæœ«çš„æ‰€æœ‰å†…å®¹ã€‚
</span></span><span class="line"><span class="cl">â‘¥ $ï¼šæŠŠå…‰æ ‡ç§»åŠ¨åˆ°è¡Œæœ«ã€‚
</span></span><span class="line"><span class="cl">â‘¦ ^ï¼šæŠŠå…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æœ«è¡Œæ¨¡å¼ï¼š
</span></span><span class="line"><span class="cl">:set nu ï¼šæ˜¾ç¤ºè¡Œå·
</span></span><span class="line"><span class="cl">:set nonu ï¼šå–æ¶ˆè¡Œå·
</span></span><span class="line"><span class="cl">/å…³é”®è¯ï¼šé«˜äº®æ˜¾ç¤ºæ‰€æœ‰å…³é”®è¯
</span></span><span class="line"><span class="cl">:noh ï¼šå–æ¶ˆæ‰€æœ‰å…³é”®è¯é«˜äº®
</span></span><span class="line"><span class="cl">num1,num2 co num3 ï¼šæŠŠä»num1è¡Œåˆ°num2è¡Œçš„ä»£ç æ’å…¥åˆ°num3è¡Œçš„åé¢
</span></span><span class="line"><span class="cl">:w ï¼šä¿å­˜æ–‡ä»¶
</span></span><span class="line"><span class="cl">:q ï¼šé€€å‡º
</span></span><span class="line"><span class="cl">:wq ï¼šä¿å­˜å¹¶é€€å‡º
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ç‰¹åˆ«æ³¨æ„ï¼šæœ‰äº›æƒ…å†µä¸‹ï¼Œæœ‰äº›ç³»ç»Ÿæ–‡ä»¶ä¸å…è®¸ä¿å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨å¼ºåˆ¶ä¿å­˜æˆ–å¼ºåˆ¶é€€å‡ºæŒ‡ä»¤ã€‚
</span></span><span class="line"><span class="cl">:w! ï¼šå¼ºåˆ¶ä¿å­˜
</span></span><span class="line"><span class="cl">:q! ï¼šå¼ºåˆ¶é€€å‡º
</span></span><span class="line"><span class="cl">:wq! ï¼šå¼ºåˆ¶ä¿å­˜å¹¶é€€å‡º
</span></span><span class="line"><span class="cl">:n : å°†å…‰æ ‡æ”¾åˆ°æŒ‡å®šçš„è¡Œ
</span></span></code></pre></div><h3 id="linuxç³»ç»Ÿè½¯ä»¶çš„å®‰è£…ä¸å¸è½½">Linuxç³»ç»Ÿè½¯ä»¶çš„å®‰è£…ä¸å¸è½½</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">1.æŸ¥è¯¢å·²å®‰è£…çš„Linuxè½¯ä»¶ï¼š
</span></span><span class="line"><span class="cl">    1ã€rpm -qa
</span></span><span class="line"><span class="cl">    2ã€é€‰é¡¹è¯´æ˜ï¼š
</span></span><span class="line"><span class="cl">    3ã€-q ï¼šqueryç¼©å†™ï¼Œä»£è¡¨æŸ¥è¯¢
</span></span><span class="line"><span class="cl">    4ã€-a ï¼šallç¼©å†™ï¼Œä»£è¡¨æŸ¥è¯¢æ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">2ã€ç®¡é“å‘½ä»¤
</span></span><span class="line"><span class="cl">åŸºæœ¬è¯­æ³•ï¼š
</span></span><span class="line"><span class="cl">rpm  -qa | grep  vim
</span></span><span class="line"><span class="cl">ç®¡é“å‘½ä»¤æ“ä½œç¬¦æ˜¯ï¼šâ€|â€ã€‚
</span></span><span class="line"><span class="cl">ä½œç”¨ï¼šå°†â€œ|â€å·¦è¾¹å‘½ä»¤çš„ç»“æœä¿¡æ¯ä½œä¸ºä¸‹ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ä¿¡æ¯
</span></span><span class="line"><span class="cl">æ–‡æœ¬æœç´¢å‘½ä»¤ï¼šgrep
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3ã€å¸è½½å·²å®‰è£…çš„è½¯ä»¶
</span></span><span class="line"><span class="cl">åŸºæœ¬è¯­æ³•ï¼š
</span></span><span class="line"><span class="cl">rpm  -e  è½¯ä»¶åç§°
</span></span><span class="line"><span class="cl">å¦‚ï¼šrpm â€“e vim-common
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4ã€å®‰è£…Linuxè½¯ä»¶ï¼ˆrpmåŒ…ï¼‰
</span></span><span class="line"><span class="cl">â‘ è£…è½½ç³»ç»Ÿé•œåƒ1ï¼ˆDVD1ï¼‰
</span></span><span class="line"><span class="cl">â‘¡é€‰æ‹©å·²è¿æ¥ï¼Œå¯åŠ¨å…‰é©±
</span></span><span class="line"><span class="cl">â‘¢åˆ°/mediaç›®å½•ä¸‹å¯»æ‰¾DVDå…‰é©±ä¸­çš„å†…å®¹
</span></span><span class="line"><span class="cl">â‘£å®‰è£…rpmè½¯ä»¶åŒ…ï¼Œè¦ç”¨åˆ°çš„çŸ¥è¯†ç‚¹ï¼š
</span></span><span class="line"><span class="cl">rpm  -ivh  è½¯ä»¶åç§°ï¼šå®‰è£…è½¯ä»¶
</span></span><span class="line"><span class="cl">-i ï¼šinstallç¼©å†™ï¼Œå®‰è£…
</span></span><span class="line"><span class="cl">-vh ï¼šæ˜¾ç¤ºå®‰è£…è¿›åº¦
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5ã€è¿”å›ä¸Šçº§ç›®å½•åï¼Œå•å‡»å°bé‡å¯è®¡ç®—æœº
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6ã€æ›´æ”¹è¶…çº§ç®¡ç†å‘˜rootå¯†ç 
</span></span><span class="line"><span class="cl">åŸºæœ¬è¯­æ³•ï¼š
</span></span><span class="line"><span class="cl">passwd  ç”¨æˆ·ååç§° ï¼šé‡ç½®å¯†ç 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">7ã€è®¾ç½®å¯†ç åï¼Œé‡å¯æ“ä½œç³»ç»Ÿ
</span></span></code></pre></div><h3 id="ä¸ç»„ç›¸å…³çš„shellæŒ‡ä»¤">ä¸ç»„ç›¸å…³çš„ShellæŒ‡ä»¤</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">â‘  groupadd ç»„åï¼šæ·»åŠ ç»„
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-g ï¼šæ·»åŠ ç»„æ—¶ï¼ŒæŒ‡å®šç»„id
</span></span><span class="line"><span class="cl">â‘¡ groupmod ç»„å
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-n ï¼šä¿®æ”¹ç»„åç§°
</span></span><span class="line"><span class="cl">-g ï¼šä¿®æ”¹ç»„id
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¢ groupdel ç»„å
</span></span><span class="line"><span class="cl">VIMä½¿ç”¨å°æŠ€å·§ï¼šåœ¨æœ«è¡Œæ¨¡å¼ä¸‹
</span></span><span class="line"><span class="cl">ä½¿ç”¨:0ä»£è¡¨è·³è½¬åˆ°ç¬¬1è¡Œ
</span></span><span class="line"><span class="cl">ä½¿ç”¨:$ä»£è¡¨è°ƒæ•´åˆ°æœ€å1è¡Œ
</span></span><span class="line"><span class="cl">tailæŒ‡ä»¤ï¼šåœ¨ä¸æ‰“å¼€æ–‡ä»¶çš„å‰æä¸‹ï¼ŒæŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹
</span></span><span class="line"><span class="cl">tail -n æ˜¾ç¤ºæœ€åå‡ è¡Œï¼ˆçº¯æ•°å­—ï¼‰ æ–‡ä»¶åç§°
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘£æ·»åŠ æˆ–åˆ é™¤ç»„æˆå‘˜ï¼ˆé’ˆå¯¹é™„å±ç»„ï¼‰
</span></span><span class="line"><span class="cl">gpasswd  [é€‰é¡¹]  ç»„å
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-a user_name ï¼šæ·»åŠ ç”¨æˆ·åˆ°é™„å±ç»„ä¸­
</span></span><span class="line"><span class="cl">-d user_name ï¼šä»é™„å±ç»„ä¸­åˆ é™¤ç”¨æˆ·
</span></span></code></pre></div><h3 id="ä¸ç”¨æˆ·çš„ç›¸å…³çš„shellæŒ‡ä»¤">ä¸ç”¨æˆ·çš„ç›¸å…³çš„ShellæŒ‡ä»¤</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">â‘  useraddæŒ‡ä»¤ï¼šæ·»åŠ ç”¨æˆ·
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-g group_name ï¼šä»£è¡¨æ·»åŠ ç”¨æˆ·æ—¶æŒ‡å®šç”¨æˆ·çš„æ‰€å±ç»„
</span></span><span class="line"><span class="cl">-d  home_dir  -mï¼šæ·»åŠ ç”¨æˆ·æ—¶æŒ‡å®šç”¨æˆ·çš„å®¶ï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤/home/ç”¨æˆ·å
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¡ usermod æŒ‡ä»¤ï¼šä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-c comment ï¼šä¿®æ”¹ç”¨æˆ·çš„å¤‡æ³¨ä¿¡æ¯
</span></span><span class="line"><span class="cl">-l login_name ï¼šä¿®æ”¹ç”¨æˆ·çš„åç§°
</span></span><span class="line"><span class="cl">-d home_dir ï¼šä¿®æ”¹ç”¨æˆ·çš„å®¶
</span></span><span class="line"><span class="cl">-g group_name ï¼šä¿®æ”¹ç”¨æˆ·çš„æ‰€å±ç»„
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¢ userdel æŒ‡ä»¤ï¼šåˆ é™¤ç”¨æˆ·
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-r ï¼šåˆ é™¤ç”¨æˆ·æ—¶åŒæ—¶åˆ é™¤ç”¨æˆ·çš„å®¶
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘£è®¾ç½®ç”¨æˆ·å£ä»¤ï¼ˆå¯†ç ï¼‰
</span></span><span class="line"><span class="cl">åŸºæœ¬è¯­æ³•ï¼špasswd [é€‰é¡¹] ç”¨æˆ·
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-S ï¼šStatusç¼©å†™ï¼ŒæŸ¥çœ‹ç”¨æˆ·å£ä»¤çŠ¶æ€
</span></span><span class="line"><span class="cl">ç‰¹åˆ«è¯´æ˜ï¼šå¦‚æœä¸€ä¸ªç”¨æˆ·æ²¡æœ‰å¯†ç ï¼Œä¹Ÿä¼šæ˜¾ç¤ºå¯†ç å·²è¢«é”å®šã€‚
</span></span><span class="line"><span class="cl">-l ï¼šlockç¼©å†™ï¼Œä»£è¡¨é”å®šç”¨æˆ·ï¼Œä¸èƒ½ç™»å½•æ“ä½œç³»ç»Ÿ
</span></span><span class="line"><span class="cl">-u ï¼šunlockç¼©å†™ï¼Œä»£è¡¨è§£é”ç”¨æˆ·
</span></span><span class="line"><span class="cl">-d ï¼šdelç¼©å†™ï¼Œä»£è¡¨åˆ é™¤ç”¨æˆ·å¯†ç 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¤ç”¨æˆ·çš„ç›¸å…³æŒ‡ä»¤
</span></span><span class="line"><span class="cl"> suæŒ‡ä»¤ï¼šåˆ‡æ¢ç”¨æˆ·
</span></span><span class="line"><span class="cl">ç‰¹åˆ«è¯´æ˜ï¼šå¦‚æœä»æ™®é€šç”¨æˆ·åˆ‡æ¢åˆ°è¶…çº§ç®¡ç†å‘˜ï¼Œéœ€è¦å¯†ç 
</span></span><span class="line"><span class="cl">å¦‚æœä»è¶…çº§ç®¡ç†å‘˜åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·ï¼Œä¸éœ€è¦å¯†ç 
</span></span><span class="line"><span class="cl"> newgrpï¼šåˆ‡æ¢æ‰€å±ç»„
</span></span><span class="line"><span class="cl"> whoamiï¼šæˆ‘æ˜¯è°
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¥æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
</span></span><span class="line"><span class="cl">id ï¼šæŸ¥çœ‹çš„å†…å®¹æ¯”è¾ƒå¤šï¼ŒæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
</span></span><span class="line"><span class="cl">groups ï¼šæŸ¥çœ‹çš„å†…å®¹æ¯”è¾ƒå°‘ï¼Œåªèƒ½æŸ¥çœ‹ç”¨æˆ·çš„æ‰€å±ç»„
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¦è®¾ç½®ä¸æŸ¥çœ‹ç”¨æˆ·èµ„æ–™ä¿¡æ¯
</span></span><span class="line"><span class="cl"> chfn [ç”¨æˆ·åç§°] ï¼šæ›´æ”¹ç”¨æˆ·çš„èµ„æ–™ä¿¡æ¯
</span></span><span class="line"><span class="cl"> finger [ç”¨æˆ·åç§°] ï¼šæŸ¥çœ‹ç”¨æˆ·çš„èµ„æ–™ä¿¡æ¯
</span></span><span class="line"><span class="cl">å®‰è£…fingeréœ€è¦ä¾èµ–çš„è½¯ä»¶
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘§æ‰¹é‡æ·»åŠ ç”¨æˆ·
</span></span><span class="line"><span class="cl"> 1.ç¼–è¾‘ç”¨æˆ·æ–‡ä»¶
</span></span><span class="line"><span class="cl">vim user.txt
</span></span><span class="line"><span class="cl">2. ç¼–è¾‘ç”¨æˆ·å¯†ç ï¼ˆæ˜æ–‡ï¼‰
</span></span><span class="line"><span class="cl">vim pass.txt
</span></span><span class="line"><span class="cl">3. ä½¿ç”¨newusersæŒ‡ä»¤åˆ°user.txtä¸­çš„ç”¨æˆ·ä¿¡æ¯åˆ°/etc/passwdæ–‡ä»¶ä¸­
</span></span><span class="line"><span class="cl">4. ä½¿ç”¨pwunconvæŒ‡ä»¤æŠŠ/etc/shadowæ–‡ä»¶ä¸­çš„å¯†ç éƒ½å€’å›åˆ°/etc/passwdæ–‡ä»¶ä¸­
</span></span><span class="line"><span class="cl">5. ä½¿ç”¨chpasswdæŒ‡ä»¤æŠŠpass.txtæ–‡ä»¶ä¸­çš„å¯†ç å¯¼å…¥/etc/passwdæ–‡ä»¶ä¸­
</span></span><span class="line"><span class="cl">6. ä½¿ç”¨pwconvæŒ‡ä»¤æŠŠåŠ å¯†åçš„å¯†ç å­˜å‚¨åœ¨/etc/shadowæ–‡ä»¶ä¸­
</span></span></code></pre></div><h3 id="ç›®å½•ç®¡ç†">ç›®å½•ç®¡ç†</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">â‘  mkdir ï¼šåˆ›å»ºç›®å½•
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-p ï¼šé€’å½’åˆ›å»º
</span></span><span class="line"><span class="cl">-m ï¼šåˆ›å»ºç›®å½•æ—¶æŒ‡å®šç›®å½•æƒé™
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¡ rmdir ï¼šåˆ é™¤ç›®å½•
</span></span><span class="line"><span class="cl">ç›¸å…³å‚æ•°ï¼š
</span></span><span class="line"><span class="cl">-p ï¼šé€’å½’åˆ é™¤
</span></span></code></pre></div><h3 id="æ–‡ä»¶ç›¸å…³">æ–‡ä»¶ç›¸å…³</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">â‘  touchæŒ‡ä»¤ï¼šåˆ›å»ºæ–‡ä»¶
</span></span><span class="line"><span class="cl">ouchæŒ‡ä»¤ä¸vimæŒ‡ä»¤åˆ›å»ºæ–‡ä»¶æœ‰ä½•åŒºåˆ«å‘¢ï¼Ÿ
</span></span><span class="line"><span class="cl">vimæŒ‡ä»¤æ‰“å¼€æ–‡ä»¶ï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºè¯¥æ–‡ä»¶
</span></span><span class="line"><span class="cl">touchæŒ‡ä»¤åªèƒ½åˆ›å»ºæ–‡ä»¶è€Œæ²¡æœ‰æ‰“å¼€åŠŸèƒ½
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¡ rmæŒ‡ä»¤åˆ é™¤æ–‡ä»¶
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-r ï¼šé€’å½’åˆ é™¤ï¼ˆä¸»è¦ç”¨äºåˆ é™¤æ–‡ä»¶å¤¹ï¼‰
</span></span><span class="line"><span class="cl">-f ï¼šå…³é—­åˆ é™¤ç¡®è®¤
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘£æ–‡ä»¶ç»Ÿè®¡
</span></span><span class="line"><span class="cl">åŸºæœ¬è¯­æ³•ï¼š
</span></span><span class="line"><span class="cl">wc  [é€‰é¡¹]  &lt;æ–‡ä»¶åˆ—è¡¨&gt;
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-c ï¼šç»Ÿè®¡æ–‡ä»¶çš„å­—èŠ‚æ•°
</span></span><span class="line"><span class="cl">-l ï¼šlinesç¼©å†™ï¼Œç»Ÿè®¡æ–‡ä»¶çš„è¡Œæ•°
</span></span><span class="line"><span class="cl">-w ï¼šwordç¼©å†™ï¼Œç»Ÿè®¡æ–‡ä»¶çš„å•è¯æ•°
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¤grepæœç´¢åŒ¹é…è¡Œ
</span></span><span class="line"><span class="cl">åŸºæœ¬è¯­æ³•ï¼š
</span></span><span class="line"><span class="cl">grep  [é€‰é¡¹]  &lt;å­—ç¬¦ä¸²&gt;  &lt;æºæ–‡ä»¶&gt;
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-n ï¼šæ˜¾ç¤ºåŒ¹é…çš„è¡Œå·
</span></span><span class="line"><span class="cl">-c ï¼šç»Ÿè®¡ä¸€å…±æœ‰å¤šå°‘è¡Œ
</span></span><span class="line"><span class="cl">-i ï¼šignoreç¼©å†™ï¼Œä»£è¡¨åŒ¹é…æ—¶å¿½ç•¥å¤§å°å†™
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¥æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
</span></span><span class="line"><span class="cl">1. catæŒ‡ä»¤ï¼šæ­£åºæ˜¾ç¤ºæ–‡ä»¶å†…å®¹
</span></span><span class="line"><span class="cl">2. tacæŒ‡ä»¤ï¼šå€’åºæ˜¾ç¤ºæ–‡ä»¶å†…å®¹
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¦æ›´æ”¹æ–‡ä»¶çš„æƒé™
</span></span><span class="line"><span class="cl">1. æ›´æ”¹æ–‡ä»¶çš„æƒé™
</span></span><span class="line"><span class="cl">chmod  -Rï¼ˆé€’å½’ä¿®æ”¹ï¼‰ 777
</span></span><span class="line"><span class="cl">2. æ›´æ”¹æ–‡ä»¶çš„æ‹¥æœ‰è€…
</span></span><span class="line"><span class="cl">chown  -Rï¼ˆé€’å½’ä¿®æ”¹ï¼‰ root
</span></span><span class="line"><span class="cl">3. æ›´æ”¹æ–‡ä»¶çš„æ‰€å±ç»„
</span></span><span class="line"><span class="cl">chgrp  -Rï¼ˆé€’å½’ä¿®æ”¹ï¼‰ itcast
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘§åˆ›å»ºé“¾æ¥æ–‡ä»¶
</span></span><span class="line"><span class="cl">è½¯é“¾æ¥åˆ›å»ºæ­¥éª¤ï¼š
</span></span><span class="line"><span class="cl">ln  [-s]  &lt;æºæ–‡ä»¶æˆ–ç›®å½•&gt;  &lt;é“¾æ¥æ–‡ä»¶æˆ–ç›®å½•&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">â‘¨å¤åˆ¶ä¸ç§»åŠ¨æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹
</span></span><span class="line"><span class="cl">1. cp  [é€‰é¡¹]   &lt;æºæ–‡ä»¶è·¯å¾„&gt;   &lt;ç›®æ ‡æ–‡ä»¶è·¯å¾„&gt;
</span></span><span class="line"><span class="cl">ç›¸å…³é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">-v : æ˜¾ç¤ºè¿›åº¦æ¡
</span></span><span class="line"><span class="cl">-R : é€’å½’å¤åˆ¶
</span></span><span class="line"><span class="cl">-p : å¤åˆ¶æ—¶ä¿æŒæ–‡ä»¶çš„åŸæœ‰å±æ€§
</span></span><span class="line"><span class="cl">-vRp ï¼šé€’å½’å¤åˆ¶ï¼Œä¿å­˜æ–‡ä»¶çš„åŸæœ‰å±æ€§ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡
</span></span><span class="line"><span class="cl">è¿˜å¯ä»¥å¤åˆ¶æ–‡ä»¶æ—¶æ›´æ”¹æ–‡ä»¶åç§°
</span></span><span class="line"><span class="cl">2. mvæŒ‡ä»¤ï¼šå‰ªåˆ‡æˆ–ç§»åŠ¨
</span></span><span class="line"><span class="cl">ç›¸å…³æŒ‡ä»¤ï¼š
</span></span><span class="line"><span class="cl">-v ï¼šç§»åŠ¨æ—¶æ˜¾ç¤ºè¿›åº¦æ¡
</span></span><span class="line"><span class="cl">3. mvæŒ‡ä»¤ï¼šæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹é‡å‘½å
</span></span><span class="line"><span class="cl">åŸºæœ¬è¯­æ³•ï¼š
</span></span><span class="line"><span class="cl">mv  æ—§æ–‡ä»¶å æ–°æ–‡ä»¶å
</span></span></code></pre></div>]]></content>
		</item>
		
		<item>
			<title>MySQLåŸºç¡€æ“ä½œğŸ•</title>
			<link>https://blog.gookm.cn/posts/2016/20160511-mysql-basic/</link>
			<pubDate>Sun, 01 May 2016 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2016/20160511-mysql-basic/</guid>
			<description>æ•°æ®åº“åŸºæœ¬æ“ä½œ 1.åˆ›å»ºæ•°æ®åº“ create database æ•°æ®åº“åå­— charset å­—ç¬¦é›†åç§°; 2.æ˜¾ç¤ºæ•°æ®åº“ show databases; show databases like â€˜åŒ¹é…æ¨¡å¼â€™; 3.æ˜¾ç¤ºæ•°æ®åº“åˆ›å»ºè¯­å¥ show create database æ•°æ®åº“åå­—; 4.é€‰æ‹©æ•°æ® use æ•°æ®åº“åå­—; 5.ä¿®æ”¹æ•°æ®åº“ alter database æ•°æ®åº“åå­— charset = å­—ç¬¦é›†;ï¼ˆç­‰å·å¯ä»¥çœï¼‰ 6.åˆ é™¤æ•°æ®åº“ drop database æ•°æ®åº“åå­—; æ•°æ®è¡¨æ“ä½œ 1.åˆ›å»ºæ•°æ®è¡¨ create table è¡¨å( å­—æ®µå1å­—æ®µç±»å‹ [å­—æ®µå±æ€§], -- å­—æ®µä¸å­—æ®µä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš” â€¦ å­—æ®µåNå­—æ®µç±»å‹ [å­—æ®µå±æ€§] -- æœ€åä¸€ä¸ªå­—æ®µåé¢ä¸éœ€è¦é€—å·) [è¡¨é€‰é¡¹] 2.å¤åˆ¶å·²æœ‰è¡¨ç»“æ„ create table æ–°è¡¨å like è¡¨å; 3.æ˜¾ç¤ºæ•°æ®è¡¨ show tables; show tables like â€˜åŒ¹é…æ¨¡å¼â€™; 4.æ˜¾ç¤ºè¡¨ç»“æ„ describe è¡¨å desc è¡¨å(æ¨è) show columns from è¡¨å 5.</description>
			<content type="html"><![CDATA[<h3 id="æ•°æ®åº“åŸºæœ¬æ“ä½œ">æ•°æ®åº“åŸºæœ¬æ“ä½œ</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="mi">1</span><span class="p">.</span><span class="err">åˆ›å»ºæ•°æ®åº“</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="err">æ•°æ®åº“åå­—</span><span class="w"> </span><span class="kp">charset</span><span class="w"> </span><span class="err">å­—ç¬¦é›†åç§°</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">2</span><span class="p">.</span><span class="err">æ˜¾ç¤ºæ•°æ®åº“</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">databases</span><span class="p">;</span><span class="w">  </span><span class="k">show</span><span class="w"> </span><span class="k">databases</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="err">â€˜åŒ¹é…æ¨¡å¼â€™</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">3</span><span class="p">.</span><span class="err">æ˜¾ç¤ºæ•°æ®åº“åˆ›å»ºè¯­å¥</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="err">æ•°æ®åº“åå­—</span><span class="p">;</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">4</span><span class="p">.</span><span class="err">é€‰æ‹©æ•°æ®</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">æ•°æ®åº“åå­—</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">5</span><span class="p">.</span><span class="err">ä¿®æ”¹æ•°æ®åº“</span><span class="w"> </span><span class="k">alter</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="err">æ•°æ®åº“åå­—</span><span class="w"> </span><span class="kp">charset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">å­—ç¬¦é›†</span><span class="p">;</span><span class="err">ï¼ˆç­‰å·å¯ä»¥çœï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">6</span><span class="p">.</span><span class="err">åˆ é™¤æ•°æ®åº“</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="err">æ•°æ®åº“åå­—</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="æ•°æ®è¡¨æ“ä½œ">æ•°æ®è¡¨æ“ä½œ</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="mi">1</span><span class="p">.</span><span class="err">åˆ›å»ºæ•°æ®è¡¨</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">å­—æ®µå</span><span class="mi">1</span><span class="err">å­—æ®µç±»å‹</span><span class="w"> </span><span class="p">[</span><span class="err">å­—æ®µå±æ€§</span><span class="p">],</span><span class="w"> </span><span class="c1">-- å­—æ®µä¸å­—æ®µä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="err">â€¦</span><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">å­—æ®µå</span><span class="n">Nå­—æ®µç±»å‹</span><span class="w"> </span><span class="p">[</span><span class="err">å­—æ®µå±æ€§</span><span class="p">]</span><span class="w"> </span><span class="c1">-- æœ€åä¸€ä¸ªå­—æ®µåé¢ä¸éœ€è¦é€—å·) [è¡¨é€‰é¡¹]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">2</span><span class="p">.</span><span class="err">å¤åˆ¶å·²æœ‰è¡¨ç»“æ„</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">æ–°è¡¨å</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="err">è¡¨å</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">3</span><span class="p">.</span><span class="err">æ˜¾ç¤ºæ•°æ®è¡¨</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="kp">tables</span><span class="p">;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="kp">tables</span><span class="w"> </span><span class="k">like</span><span class="w">  </span><span class="err">â€˜åŒ¹é…æ¨¡å¼â€™</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">4</span><span class="p">.</span><span class="err">æ˜¾ç¤ºè¡¨ç»“æ„</span><span class="w"> </span><span class="k">describe</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w">   </span><span class="k">desc</span><span class="w"> </span><span class="err">è¡¨å</span><span class="p">(</span><span class="err">æ¨è</span><span class="p">)</span><span class="w">  </span><span class="k">show</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">5</span><span class="p">.</span><span class="err">æ˜¾ç¤ºè¡¨åˆ›å»ºè¯­å¥</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="p">;</span><span class="w"> </span><span class="n">Mysqlä¸­æœ‰å¤šç§è¯­å¥ç»“æŸç¬¦</span><span class="p">:</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="err">\</span><span class="n">g</span><span class="w"> </span><span class="err">\</span><span class="n">G</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">6</span><span class="p">.</span><span class="err">è®¾ç½®è¡¨å±æ€§ï¼ˆè¡¨é€‰é¡¹ï¼‰</span><span class="w"> </span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="err">è¡¨é€‰é¡¹</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="err">å€¼</span><span class="p">;</span><span class="w">  </span><span class="kp">engine</span><span class="err">ï¼Œ</span><span class="n">charsetå’Œcollate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">7</span><span class="p">.</span><span class="err">ä¿®æ”¹è¡¨åå­—</span><span class="w"> </span><span class="k">rename</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">æ—§è¡¨å</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="err">æ–°è¡¨å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">8</span><span class="p">.</span><span class="err">ä¿®æ”¹è¡¨é€‰é¡¹</span><span class="w"> </span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="err">è¡¨é€‰é¡¹</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="err">æ–°å€¼</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">9</span><span class="p">.</span><span class="err">æ–°å¢å­—æ®µ</span><span class="w"> </span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="p">[</span><span class="k">column</span><span class="p">]</span><span class="w"> </span><span class="err">æ–°å­—æ®µå</span><span class="w"> </span><span class="err">åˆ—ç±»å‹</span><span class="w"> </span><span class="p">[</span><span class="err">åˆ—å±æ€§</span><span class="p">][</span><span class="err">ä½ç½®</span><span class="n">first</span><span class="o">/</span><span class="n">after</span><span class="w"> </span><span class="err">å­—æ®µå</span><span class="w">       </span><span class="err">å­—æ®µç±»å‹</span><span class="w"> </span><span class="err">å¿…é¡»æœ‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">10</span><span class="p">.</span><span class="err">ä¿®æ”¹å­—æ®µå</span><span class="w"> </span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="k">change</span><span class="w"> </span><span class="err">æ—§å­—æ®µå</span><span class="w"> </span><span class="err">æ–°å­—æ®µå</span><span class="w"> </span><span class="err">å­—æ®µç±»å‹</span><span class="w"> </span><span class="p">[</span><span class="err">åˆ—å±æ€§</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="err">æ–°ä½ç½®</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">11</span><span class="p">.</span><span class="err">ä¿®æ”¹å­—æ®µç±»å‹</span><span class="w"> </span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="err">å­—æ®µå</span><span class="w"> </span><span class="err">æ–°ç±»å‹</span><span class="w"> </span><span class="p">[</span><span class="err">æ–°å±æ€§</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="err">æ–°ä½ç½®</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">12</span><span class="p">.</span><span class="err">åˆ é™¤å­—æ®µ</span><span class="w"> </span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="err">å­—æ®µå</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">13</span><span class="p">.</span><span class="err">åˆ é™¤è¡¨ç»“æ„</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">è¡¨å</span><span class="p">[,</span><span class="err">è¡¨å</span><span class="mi">2</span><span class="err">â€¦</span><span class="p">]</span><span class="err">ï¼Œ</span><span class="w">
</span></span></span></code></pre></div><h3 id="æ•°æ®åŸºç¡€æ“ä½œ">æ•°æ®åŸºç¡€æ“ä½œ</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="mi">1</span><span class="p">.</span><span class="err">å‘è¡¨ä¸­æŒ‡å®šå­—æ®µæ’å…¥æ•°æ®</span><span class="n">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="err">è¡¨å</span><span class="p">[(</span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="p">)]</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="err">å¯¹åº”å­—æ®µåˆ—è¡¨</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">2</span><span class="p">.</span><span class="err">å‘è¡¨ä¸­æ‰€æœ‰å­—æ®µæ’å…¥æ•°æ®</span><span class="n">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="k">values</span><span class="err">ï¼ˆå¯¹åº”è¡¨ç»“æ„ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">3</span><span class="p">.</span><span class="err">æŸ¥è¯¢è¡¨ä¸­å…¨éƒ¨æ•°æ®</span><span class="n">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">4</span><span class="p">.</span><span class="err">æŸ¥è¯¢è¡¨ä¸­éƒ¨åˆ†å­—æ®µ</span><span class="n">select</span><span class="w"> </span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">è¡¨å</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">5</span><span class="p">.</span><span class="err">ç®€å•æ¡ä»¶æŸ¥è¯¢è¯­å¥</span><span class="n">select</span><span class="w"> </span><span class="err">å­—æ®µåˆ—è¡¨</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="err">å­—æ®µå</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">å€¼</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">6</span><span class="p">.</span><span class="err">åˆ é™¤æ“ä½œ</span><span class="n">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="p">[</span><span class="k">where</span><span class="w"> </span><span class="err">æ¡ä»¶</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">7</span><span class="p">.</span><span class="err">æ›´æ–°æ“ä½œ</span><span class="n">update</span><span class="w"> </span><span class="err">è¡¨å</span><span class="w"> </span><span class="kt">set</span><span class="w">  </span><span class="err">å­—æ®µå</span><span class="o">=</span><span class="err">æ–°å€¼</span><span class="w"> </span><span class="p">[</span><span class="k">where</span><span class="w"> </span><span class="err">æ¡ä»¶</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><p>åæœŸä¼šæŒç»­æ›´æ–°&hellip;&hellip;</p>
]]></content>
		</item>
		
		<item>
			<title>PHPåŸºç¡€å‡½æ•°ğŸ§</title>
			<link>https://blog.gookm.cn/posts/2016/20160305-php-basic/</link>
			<pubDate>Sat, 05 Mar 2016 00:00:00 +0000</pubDate>
			
			<guid>https://blog.gookm.cn/posts/2016/20160305-php-basic/</guid>
			<description>æœ‰å…³è¾“å‡ºçš„å‡½æ•° print() //ç±»ä¼¼äºechoè¾“å‡ºæä¾›çš„å†…å®¹ï¼Œè¿”å›1 print_r() //ä¸€èˆ¬ç”¨äºæ‰“å°æ•°ç»„,ä¸æ‰“å°ç±»å‹ var_dump() //æ‰“å°æ•°æ®çš„å€¼,è¿˜æœ‰ç±»å‹ æœ‰å…³æ—¶é—´çš„å‡½æ•° date() //æ˜¾ç¤ºæ—¥æœŸæ—¶é—´ ä¸¾ä¾‹ï¼šdate(â€œY-m-dH:i:sâ€) time() //æ—¶é—´æˆ³ï¼ˆç§’æ•°ï¼‰ microtime() //è¿”å›æ—¶é—´æˆ³å’Œå¾®ç§’æ•° strtotime() //å°†æ—¥æœŸæ—¶é—´çš„å­—ç¬¦ä¸²è§£ææˆæ—¶é—´æˆ³ æ•°å­¦ç›¸å…³å‡½æ•° max($v1,$v2,$v3â€¦) //æ±‚æœ€å¤§å€¼ min($v1,$v2,$v3â€¦) //æ±‚æœ€å°å€¼ rand() //éšæœºæ•° mt_rand() //ç”Ÿæˆæ›´å¥½çš„éšæœºæ•° round(å˜é‡ [,N]) //ä¿ç•™nä½å° ceil() //å‘ä¸Šå–æ•´ floor() //å‘ä¸‹å–æ•´ pow(x,y) //æ±‚xY abs() //ç»å¯¹å€¼ sqrt() //æ±‚å¹³æ–¹æ ¹ æœ‰å…³å‡½æ•°çš„å‡½æ•° function_exists(å‡½æ•°å) //åˆ¤æ–­å‡½æ•°æ˜¯å¦å­˜åœ¨ func_get_arg(ä¸‹æ ‡) //è·å–æŒ‡å®šä¸‹æ ‡å¯¹åº”çš„å‚æ•° func_get_args() //åœ¨è‡ªå®šä¹‰å‡½æ•°ä¸­è·å–æ‰€æœ‰çš„å‚æ•°ï¼ˆè¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰ func_num_args() //è·å–å½“å‰è‡ªå®šä¹‰å‡½æ•°çš„å‚æ•°æ•°é‡ å­—ç¬¦ä¸²ç›¸å…³çš„å‡½æ•° strlen() //å¾—åˆ°å­—ç¬¦ä¸²çš„é•¿åº¦ mb_strlen($å­—ç¬¦ä¸²å˜é‡å ï¼Œå­—ç¬¦ç¼–ç ) implode(è¿æ¥æ–¹å¼,æ•°ç»„) //è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸² explode(åˆ†å‰²å­—ç¬¦,ç›®æ ‡å­—ç¬¦ä¸²) //å˜æˆæ•°ç»„ str_split(å­—ç¬¦ä¸²,å­—ç¬¦é•¿åº¦) //æŒ‰ç…§æŒ‡å®šé•¿åº¦æ‹†åˆ†å­—ç¬¦ä¸²å¾—åˆ°æ•°ç»„ trim(å­—ç¬¦ä¸²[,æŒ‡å®šå­—ç¬¦]) //é»˜è®¤æ˜¯ç”¨æ¥å»é™¤å­—ç¬¦ä¸²ä¸¤è¾¹çš„ç©ºæ ¼ ltrim() //å»é™¤å·¦è¾¹çš„ rtrim() //å»é™¤å³è¾¹çš„ substr(å­—ç¬¦ä¸²,èµ·å§‹ä½ç½®ä»0å¼€å§‹[,é•¿åº¦]) strstr(å­—ç¬¦ä¸²,åŒ¹é…å­—ç¬¦) //ä»æŒ‡å®šä½ç½®å¼€å§‹ï¼Œæˆªå–åˆ°æœ€åï¼ˆå¯ä»¥ç”¨æ¥å»æ–‡ä»¶åç¼€åï¼‰ strtolower() //å…¨éƒ¨å°å†™ strtoupper() //å…¨éƒ¨å¤§å†™ ucfirst() //é¦–å­—æ¯å¤§å†™ strpos(å­—ç¬¦ä¸²ï¼ŒåŒ¹é…å­—ç¬¦) //åˆ¤æ–­å­—ç¬¦åœ¨ç›®æ ‡å­—ç¬¦ä¸²ä¸­å‡ºç°çš„ä½ç½®ï¼ˆé¦–æ¬¡ï¼‰ strrpos(å­—ç¬¦ä¸²ï¼ŒåŒ¹é…å­—ç¬¦) str_replace(åŒ¹é…ç›®æ ‡,æ›¿æ¢çš„å†…å®¹,å­—ç¬¦ä¸²æœ¬èº«) printf/sprintf(è¾“å‡ºå­—ç¬¦ä¸²æœ‰å ä½ç¬¦,é¡ºåºå ä½å†…å®¹.</description>
			<content type="html"><![CDATA[<p><img src="https://qiniu.zkilm.cn/blog/posts/2016/php02.png" alt="å°é¢"></p>
<h3 id="æœ‰å…³è¾“å‡ºçš„å‡½æ•°">æœ‰å…³è¾“å‡ºçš„å‡½æ•°</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">print</span><span class="p">()</span> <span class="c1">//ç±»ä¼¼äºechoè¾“å‡ºæä¾›çš„å†…å®¹ï¼Œè¿”å›1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">print_r</span><span class="p">()</span>  <span class="c1">//ä¸€èˆ¬ç”¨äºæ‰“å°æ•°ç»„,ä¸æ‰“å°ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">var_dump</span><span class="p">()</span> <span class="c1">//æ‰“å°æ•°æ®çš„å€¼,è¿˜æœ‰ç±»å‹
</span></span></span></code></pre></div><h3 id="æœ‰å…³æ—¶é—´çš„å‡½æ•°">æœ‰å…³æ—¶é—´çš„å‡½æ•°</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">date</span><span class="p">()</span> <span class="c1">//æ˜¾ç¤ºæ—¥æœŸæ—¶é—´  ä¸¾ä¾‹ï¼šdate(â€œY-m-dH:i:sâ€)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">time</span><span class="p">()</span> <span class="c1">//æ—¶é—´æˆ³ï¼ˆç§’æ•°ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">microtime</span><span class="p">()</span> <span class="c1">//è¿”å›æ—¶é—´æˆ³å’Œå¾®ç§’æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">strtotime</span><span class="p">()</span> <span class="c1">//å°†æ—¥æœŸæ—¶é—´çš„å­—ç¬¦ä¸²è§£ææˆæ—¶é—´æˆ³
</span></span></span></code></pre></div><h3 id="æ•°å­¦ç›¸å…³å‡½æ•°">æ•°å­¦ç›¸å…³å‡½æ•°</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">max</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$v2</span><span class="p">,</span><span class="nv">$v3â€¦</span><span class="p">)</span> <span class="c1">//æ±‚æœ€å¤§å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">min</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$v2</span><span class="p">,</span><span class="nv">$v3â€¦</span><span class="p">)</span> <span class="c1">//æ±‚æœ€å°å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">rand</span><span class="p">()</span> <span class="c1">//éšæœºæ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">mt_rand</span><span class="p">()</span> <span class="c1">//ç”Ÿæˆæ›´å¥½çš„éšæœºæ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">round</span><span class="p">(</span><span class="nx">å˜é‡</span> <span class="p">[,</span><span class="nx">N</span><span class="p">])</span> <span class="c1">//ä¿ç•™nä½å°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ceil</span><span class="p">()</span> <span class="c1">//å‘ä¸Šå–æ•´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">floor</span><span class="p">()</span> <span class="c1">//å‘ä¸‹å–æ•´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">pow</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="c1">//æ±‚xY
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">abs</span><span class="p">()</span> <span class="c1">//ç»å¯¹å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">sqrt</span><span class="p">()</span> <span class="c1">//æ±‚å¹³æ–¹æ ¹
</span></span></span></code></pre></div><h3 id="æœ‰å…³å‡½æ•°çš„å‡½æ•°">æœ‰å…³å‡½æ•°çš„å‡½æ•°</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">function_exists</span><span class="p">(</span><span class="nx">å‡½æ•°å</span><span class="p">)</span>  <span class="c1">//åˆ¤æ–­å‡½æ•°æ˜¯å¦å­˜åœ¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">func_get_arg</span><span class="p">(</span><span class="nx">ä¸‹æ ‡</span><span class="p">)</span>  <span class="c1">//è·å–æŒ‡å®šä¸‹æ ‡å¯¹åº”çš„å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">func_get_args</span><span class="p">()</span> <span class="c1">//åœ¨è‡ªå®šä¹‰å‡½æ•°ä¸­è·å–æ‰€æœ‰çš„å‚æ•°ï¼ˆè¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">func_num_args</span><span class="p">()</span> <span class="c1">//è·å–å½“å‰è‡ªå®šä¹‰å‡½æ•°çš„å‚æ•°æ•°é‡
</span></span></span></code></pre></div><h3 id="å­—ç¬¦ä¸²ç›¸å…³çš„å‡½æ•°">å­—ç¬¦ä¸²ç›¸å…³çš„å‡½æ•°</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">strlen</span><span class="p">()</span> <span class="c1">//å¾—åˆ°å­—ç¬¦ä¸²çš„é•¿åº¦ mb_strlen($å­—ç¬¦ä¸²å˜é‡å ï¼Œå­—ç¬¦ç¼–ç )
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">implode</span><span class="p">(</span><span class="nx">è¿æ¥æ–¹å¼</span><span class="p">,</span><span class="nx">æ•°ç»„</span><span class="p">)</span> <span class="c1">//è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">explode</span><span class="p">(</span><span class="nx">åˆ†å‰²å­—ç¬¦</span><span class="p">,</span><span class="nx">ç›®æ ‡å­—ç¬¦ä¸²</span><span class="p">)</span> <span class="c1">//å˜æˆæ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">str_split</span><span class="p">(</span><span class="nx">å­—ç¬¦ä¸²</span><span class="p">,</span><span class="nx">å­—ç¬¦é•¿åº¦</span><span class="p">)</span> <span class="c1">//æŒ‰ç…§æŒ‡å®šé•¿åº¦æ‹†åˆ†å­—ç¬¦ä¸²å¾—åˆ°æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">trim</span><span class="p">(</span><span class="nx">å­—ç¬¦ä¸²</span><span class="p">[,</span><span class="nx">æŒ‡å®šå­—ç¬¦</span><span class="p">])</span> <span class="c1">//é»˜è®¤æ˜¯ç”¨æ¥å»é™¤å­—ç¬¦ä¸²ä¸¤è¾¹çš„ç©ºæ ¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ltrim</span><span class="p">()</span> <span class="c1">//å»é™¤å·¦è¾¹çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">rtrim</span><span class="p">()</span> <span class="c1">//å»é™¤å³è¾¹çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">substr</span><span class="p">(</span><span class="nx">å­—ç¬¦ä¸²</span><span class="p">,</span><span class="nx">èµ·å§‹ä½ç½®ä»0å¼€å§‹</span><span class="p">[,</span><span class="nx">é•¿åº¦</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nx">strstr</span><span class="p">(</span><span class="nx">å­—ç¬¦ä¸²</span><span class="p">,</span><span class="nx">åŒ¹é…å­—ç¬¦</span><span class="p">)</span> <span class="c1">//ä»æŒ‡å®šä½ç½®å¼€å§‹ï¼Œæˆªå–åˆ°æœ€åï¼ˆå¯ä»¥ç”¨æ¥å»æ–‡ä»¶åç¼€åï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">strtolower</span><span class="p">()</span> <span class="c1">//å…¨éƒ¨å°å†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">strtoupper</span><span class="p">()</span> <span class="c1">//å…¨éƒ¨å¤§å†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ucfirst</span><span class="p">()</span> <span class="c1">//é¦–å­—æ¯å¤§å†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">strpos</span><span class="p">(</span><span class="nx">å­—ç¬¦ä¸²ï¼ŒåŒ¹é…å­—ç¬¦</span><span class="p">)</span> <span class="c1">//åˆ¤æ–­å­—ç¬¦åœ¨ç›®æ ‡å­—ç¬¦ä¸²ä¸­å‡ºç°çš„ä½ç½®ï¼ˆé¦–æ¬¡ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">strrpos</span><span class="p">(</span><span class="nx">å­—ç¬¦ä¸²ï¼ŒåŒ¹é…å­—ç¬¦</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">str_replace</span><span class="p">(</span><span class="nx">åŒ¹é…ç›®æ ‡</span><span class="p">,</span><span class="nx">æ›¿æ¢çš„å†…å®¹</span><span class="p">,</span><span class="nx">å­—ç¬¦ä¸²æœ¬èº«</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">printf</span><span class="o">/</span><span class="nx">sprintf</span><span class="p">(</span><span class="nx">è¾“å‡ºå­—ç¬¦ä¸²æœ‰å ä½ç¬¦</span><span class="p">,</span><span class="nx">é¡ºåºå ä½å†…å®¹</span><span class="o">..</span><span class="p">)</span><span class="o">%</span><span class="nx">d</span>  <span class="o">%</span><span class="nx">s</span>
</span></span><span class="line"><span class="cl"><span class="nx">str_repeat</span><span class="p">()</span> <span class="c1">//é‡å¤æŸä¸ªå­—ç¬¦ä¸²næ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">str_shuffle</span><span class="p">()</span> <span class="c1">//éšæœºæ‰“ä¹±å­—ç¬¦ä¸²
</span></span></span></code></pre></div><h3 id="æ•°ç»„ç›¸å…³çš„å‡½æ•°">æ•°ç»„ç›¸å…³çš„å‡½æ•°</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//æ•°ç»„æ’åºçš„å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">sort</span><span class="p">()</span> <span class="c1">//æŒ‰å…ƒç´ çš„å€¼  å‡åºæ’åˆ—ï¼ˆä¸‹æ ‡é‡æ’ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">rsort</span><span class="p">()</span> <span class="c1">//æŒ‰å…ƒç´ çš„å€¼é™åºæ’åˆ—ï¼ˆä¸‹æ ‡é‡æ’ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">asort</span><span class="p">()</span> <span class="c1">//æŒ‰å…ƒç´ çš„å€¼å‡åºæ’åˆ—ï¼ˆä¸‹æ ‡ä¿ç•™ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">arsort</span><span class="p">()</span> <span class="c1">//æŒ‰å…ƒç´ çš„å€¼é™åºæ’åˆ—ï¼ˆä¸‹æ ‡ä¿ç•™ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ksort</span><span class="p">()</span> <span class="c1">//æ•°ç»„æŒ‰é”®å(ä¸‹æ ‡) å‡åºæ’åˆ—ï¼Œï¼ˆä¸‹æ ‡ä¿ç•™ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">krsort</span><span class="p">()</span> <span class="c1">//æŒ‰é”®åé™åºæ’åˆ—ï¼Œï¼ˆä¸‹æ ‡ä¿ç•™ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">shuffle</span><span class="p">()</span> <span class="c1">//éšæœºæ‰“ä¹±æ•°ç»„å…ƒç´ ï¼Œæ•°ç»„ä¸‹æ ‡ä¼šé‡æ’
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">æ’åºï¼šé»˜è®¤çš„æ˜¯å‡åºæ’åˆ—ï¼Œæœ‰</span> <span class="nx">rå°±æ˜¯é™åºæ’åˆ—</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">æœ‰aï¼šå°±æ˜¯ä¿ç•™ç´¢å¼•å…³ç³»</span> 
</span></span><span class="line"><span class="cl"><span class="nx">æœ‰kï¼šå°±æ˜¯æŒ‰ç…§é”®åæ’åº</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">reset</span><span class="p">()</span> <span class="c1">//é‡ç½®æŒ‡é’ˆï¼Œå°†æ•°ç»„æŒ‡é’ˆå›åˆ°é¦–ä½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">end</span><span class="p">()</span>  <span class="c1">//é‡ç½®æŒ‡é’ˆï¼Œå°†æ•°ç»„æŒ‡é’ˆæŒ‡åˆ°æœ€åä¸€ä¸ªå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">next</span><span class="p">()</span>  <span class="c1">//æŒ‡é’ˆä¸‹ç§»ï¼Œå–å¾—ä¸‹ä¸€ä¸ªå…ƒç´ çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">prev</span><span class="p">()</span>  <span class="c1">//æŒ‡é’ˆä¸Šç§»ï¼Œå–å¾—ä¸Šä¸€ä¸ªå…ƒç´ çš„å€¼                       
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">current</span><span class="p">()</span> <span class="c1">//è·å–å½“å‰æŒ‡é’ˆå¯¹åº”çš„å…ƒç´ å€¼  ï¼ˆä¸ç§»åŠ¨æŒ‡é’ˆï¼‰      
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">key</span><span class="p">()</span> <span class="c1">//è·å–å½“å‰æŒ‡é’ˆå¯¹åº”çš„ä¸‹æ ‡å€¼ï¼ˆä¸ç§»åŠ¨æŒ‡é’ˆï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1">//æ•°ç»„å…¶ä»–å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">count</span><span class="p">()</span> <span class="c1">//ç»Ÿè®¡æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_push</span><span class="p">()</span> <span class="c1">//å¾€æ•°ç»„ä¸­åŠ å…¥ä¸€ä¸ªå…ƒç´ ï¼ˆæ•°ç»„åé¢ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_pop</span><span class="p">()</span> <span class="c1">//ä»æ•°ç»„ä¸­å–å‡ºä¸€ä¸ªå…ƒç´ ï¼ˆæ•°ç»„åé¢ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_shift</span><span class="p">()</span> <span class="c1">//ä»æ•°ç»„ä¸­å–å‡ºä¸€ä¸ªå…ƒç´ ï¼ˆæ•°ç»„å‰é¢ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_unshift</span><span class="p">()</span> <span class="c1">//ä»æ•°ç»„ä¸­åŠ å…¥ä¸€ä¸ªå…ƒç´ ï¼ˆæ•°ç»„å‰é¢ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_reverse</span><span class="p">()</span> <span class="c1">//æ•°ç»„å…ƒç´ åè¿‡æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">in_array</span><span class="p">()</span> <span class="c1">//åˆ¤æ–­ä¸€ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_keys</span><span class="p">()</span> <span class="c1">//è·å–ä¸€ä¸ªæ•°ç»„çš„æ‰€æœ‰ä¸‹æ ‡ï¼Œè¿”å›ä¸€ä¸ªç´¢å¼•æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_values</span><span class="p">()</span> <span class="c1">//è·å–ä¸€ä¸ªæ•°ç»„çš„æ‰€æœ‰å€¼ï¼Œè¿”å›ä¸€ä¸ªç´¢å¼•æ•°ç»„
</span></span></span></code></pre></div><p><a href="">åæœŸä¼šæŒç»­æ›´æ–°&hellip;..</a></p>
<h3 id="æ›´æ–°">æ›´æ–°</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">array_merge</span><span class="p">()</span> <span class="c1">//åˆå¹¶ä¸€ä¸ªæˆ–å¤šä¸ªæ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_merge</span><span class="p">(</span><span class="nv">$arr1</span><span class="p">,</span><span class="nv">$arr2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">array_splice</span><span class="p">()</span> <span class="c1">//æŠŠæ•°ç»„ä¸­çš„ä¸€éƒ¨åˆ†å»æ‰å¹¶ç”¨å…¶å®ƒå€¼å–ä»£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$input</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;red&#34;</span><span class="p">,</span> <span class="s2">&#34;green&#34;</span><span class="p">,</span> <span class="s2">&#34;blue&#34;</span><span class="p">,</span> <span class="s2">&#34;yellow&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">array_splice</span><span class="p">(</span><span class="nv">$input</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span><span class="c1">//$input is now array(â€œredâ€,â€ greenâ€);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_chunk</span><span class="p">()</span> <span class="c1">//å°†ä¸€ä¸ªæ•°ç»„åˆ†å‰²æˆå¤šä¸ª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">shuffle</span><span class="p">()</span> <span class="c1">//å°†æ•°ç»„æ‰“ä¹±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">range</span><span class="p">()</span> <span class="c1">//å»ºç«‹ä¸€ä¸ªåŒ…å«æŒ‡å®šèŒƒå›´å•å…ƒçš„æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">is_file</span><span class="p">()</span> <span class="c1">//åˆ¤æ–­ç»™å®šæ–‡ä»¶åæ˜¯å¦ä¸ºä¸€ä¸ªæ­£å¸¸çš„æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">define</span><span class="p">()</span> <span class="c1">//å®šä¹‰ä¸€ä¸ªå¸¸é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">defined</span><span class="p">()</span> <span class="c1">//æ£€æŸ¥æŸä¸ªåç§°çš„å¸¸é‡æ˜¯å¦å­˜åœ¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ini_set</span><span class="p">()</span> <span class="c1">//ä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼  ini_set(&#39;display_errors&#39;, &#39;1&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">basename</span><span class="p">()</span> <span class="c1">//è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">is_array</span><span class="p">()</span> <span class="c1">//æ£€æµ‹å˜é‡æ˜¯å¦æ˜¯æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  
</span></span><span class="line"><span class="cl"><span class="k">list</span><span class="p">()</span> <span class="c1">//æŠŠæ•°ç»„ä¸­çš„å€¼èµ‹ç»™ä¸€äº›å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$info</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;coffee&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="s1">&#39;caffeine&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">list</span><span class="p">(</span><span class="nv">$drink</span><span class="p">,</span> <span class="nv">$color</span><span class="p">,</span> <span class="nv">$power</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$drink</span><span class="s2"> is </span><span class="si">$color</span><span class="s2"> and </span><span class="si">$power</span><span class="s2"> makes it special.</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">nl2br</span><span class="p">()</span> <span class="c1">//åœ¨å­—ç¬¦ä¸²æ‰€æœ‰æ–°è¡Œä¹‹å‰æ’å…¥ HTML æ¢è¡Œæ ‡è®°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array_rand</span><span class="p">()</span> <span class="c1">//ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">count</span><span class="p">()</span> <span class="c1">//è®¡ç®—æ•°ç»„ä¸­çš„å•å…ƒæ•°ç›®æˆ–å¯¹è±¡ä¸­çš„å±æ€§ä¸ªæ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">reset</span><span class="p">()</span> <span class="c1">//å°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªå•å…ƒ
</span></span></span></code></pre></div>]]></content>
		</item>
		
	</channel>
</rss>
