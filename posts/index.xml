<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Posts on Promise</title>
		<link>http://hugo.zkilm.cn/posts/</link>
		<description>Recent content in Posts on Promise</description>
		<generator>Hugo -- gohugo.io</generator>
		<language>zh-hans</language>
		<copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright>
		<lastBuildDate>Mon, 23 Aug 2021 00:00:00 +0000</lastBuildDate>
		<atom:link href="http://hugo.zkilm.cn/posts/index.xml" rel="self" type="application/rss+xml" />
		
		<item>
			<title>Elasticsearch åœ¨ Laravel ä¸­çš„ä½¿ç”¨ğŸ‘</title>
			<link>http://hugo.zkilm.cn/posts/20210823-laravel-es/</link>
			<pubDate>Mon, 23 Aug 2021 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20210823-laravel-es/</guid>
			<description>æœ¬æ–‡ç›®æ ‡  å­¦ä¼šåœ¨ Laravel ä¸­å®‰è£… Elasticsearchã€‚ åˆ›å»ºç´¢å¼•ã€‚ ç®€å•æŸ¥è¯¢ã€‚  å®‰è£… composer åŒ… composer require elasticsearch/elasticsearch &amp;#39;~7.0&amp;#39; é…ç½® config/database.php # Elasticsearch Config Info &#39;elasticsearch&#39; =&amp;gt; [ // Elasticsearch æ”¯æŒå¤šå°æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå› æ­¤è¿™é‡Œæ˜¯ä¸€ä¸ªæ•°ç»„ &#39;hosts&#39; =&amp;gt; explode(&#39;,&#39;, env(&#39;ES_HOSTS&#39;)), &#39;username&#39; =&amp;gt; env(&#39;ES_USERNAME&#39;), &#39;password&#39; =&amp;gt; env(&#39;ES_PASSWORD&#39;), ], åˆå§‹åŒ– Elasticsearch å¯¹è±¡ // æ³¨å†Œä¸€ä¸ªåä¸º es çš„å•ä¾‹ $this-&amp;gt;app-&amp;gt;singleton(&amp;#39;es&amp;#39;, function () { // ä»é…ç½®æ–‡ä»¶è¯»å– Elasticsearch æœåŠ¡å™¨åˆ—è¡¨  $builder = ESClientBuilder::create()-&amp;gt;setHosts(config(&amp;#39;database.elasticsearch.hosts&amp;#39;)) -&amp;gt;setBasicAuthentication(config(&amp;#39;database.elasticsearch.username&amp;#39;),config(&amp;#39;database.elasticsearch.password&amp;#39;)); // å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒ  if (app()-&amp;gt;environment() === &amp;#39;local&amp;#39;) { // é…ç½®æ—¥å¿—ï¼ŒElasticsearch çš„è¯·æ±‚å’Œè¿”å›æ•°æ®å°†æ‰“å°åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•  $builder-&amp;gt;setLogger(app(&amp;#39;log&amp;#39;)-&amp;gt;driver()); } return $builder-&amp;gt;build(); }); åˆ›å»ºç´¢å¼• curl -XPUT -u name:pwd http://ip:9200/user_behavior?</description>
			<content type="html"><![CDATA[<p><img src="https://qiniu.zkilm.cn/image/aJXCpPH5dKc4Grq0Jg2d3pJjL23P4BnUcPRvTQGm.jpeg" alt="ç®€å•ç”Ÿæ´»ï¼Œçƒ­çˆ±ä¸€åˆ‡ï¼"></p>
<h3 id="æœ¬æ–‡ç›®æ ‡">æœ¬æ–‡ç›®æ ‡</h3>
<ul>
<li>å­¦ä¼šåœ¨ <code>Laravel</code> ä¸­å®‰è£… <code>Elasticsearch</code>ã€‚</li>
<li>åˆ›å»ºç´¢å¼•ã€‚</li>
<li>ç®€å•æŸ¥è¯¢ã€‚</li>
</ul>
<h3 id="å®‰è£…-composer-åŒ…">å®‰è£… <code>composer</code> åŒ…</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">composer require elasticsearch/elasticsearch <span class="s1">&#39;~7.0&#39;</span>
</code></pre></div><h3 id="é…ç½®-configdatabasephp">é…ç½® <code>config/database.php</code></h3>
<pre><code class="language-dotenv" data-lang="dotenv"># Elasticsearch Config Info
'elasticsearch' =&gt; [
    // Elasticsearch æ”¯æŒå¤šå°æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå› æ­¤è¿™é‡Œæ˜¯ä¸€ä¸ªæ•°ç»„
    'hosts' =&gt; explode(',', env('ES_HOSTS')),
    'username' =&gt; env('ES_USERNAME'),
    'password' =&gt; env('ES_PASSWORD'),
],
</code></pre><h3 id="åˆå§‹åŒ–-elasticsearch-å¯¹è±¡">åˆå§‹åŒ– <code>Elasticsearch</code> å¯¹è±¡</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// æ³¨å†Œä¸€ä¸ªåä¸º es çš„å•ä¾‹
</span><span class="c1"></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ä»é…ç½®æ–‡ä»¶è¯»å– Elasticsearch æœåŠ¡å™¨åˆ—è¡¨
</span><span class="c1"></span>    <span class="nv">$builder</span> <span class="o">=</span> <span class="nx">ESClientBuilder</span><span class="o">::</span><span class="na">create</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">setHosts</span><span class="p">(</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;database.elasticsearch.hosts&#39;</span><span class="p">))</span>
        <span class="o">-&gt;</span><span class="na">setBasicAuthentication</span><span class="p">(</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;database.elasticsearch.username&#39;</span><span class="p">),</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;database.elasticsearch.password&#39;</span><span class="p">));</span>
    <span class="c1">// å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒ
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;local&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// é…ç½®æ—¥å¿—ï¼ŒElasticsearch çš„è¯·æ±‚å’Œè¿”å›æ•°æ®å°†æ‰“å°åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•
</span><span class="c1"></span>        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">setLogger</span><span class="p">(</span><span class="nx">app</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">driver</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">build</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div><h3 id="åˆ›å»ºç´¢å¼•">åˆ›å»ºç´¢å¼•</h3>
<pre><code>curl -XPUT -u name:pwd http://ip:9200/user_behavior?pretty
</code></pre><h3 id="åˆ›å»ºç´¢å¼•ç»“æ„">åˆ›å»ºç´¢å¼•ç»“æ„</h3>
<pre><code>curl -H'Content-Type: application/json'  -XPUT -u name:pwd http://ip:9200/user_behavior/_mapping/?pretty -d'{
  &quot;properties&quot;: {
    &quot;open_id&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;store&quot;:true }, 
    &quot;imp_date&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;store&quot;:true }, 
    &quot;first_login&quot;: { &quot;type&quot;: &quot;text&quot;,&quot;store&quot;:true }
    }
  }
}'
</code></pre><h3 id="æµ‹è¯•å†™å…¥æ•°æ®">æµ‹è¯•å†™å…¥æ•°æ®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">app</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">([</span><span class="s1">&#39;index&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_behavior&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;open_id&#39;</span><span class="o">=&gt;</span><span class="nx">md5</span><span class="p">(</span><span class="nx">time</span><span class="p">()),</span><span class="s1">&#39;imp_date&#39;</span><span class="o">=&gt;</span><span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nx">date</span><span class="p">(</span><span class="s1">&#39;Ymd&#39;</span><span class="p">),</span><span class="s1">&#39;first_login&#39;</span><span class="o">=&gt;</span><span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nx">date</span><span class="p">(</span><span class="s1">&#39;Ymd&#39;</span><span class="p">)]])</span>
</code></pre></div><h3 id="æŸ¥è¯¢æ•°æ®">æŸ¥è¯¢æ•°æ®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nv">$params</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;index&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_behavior&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_source&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;imp_date&#39;</span><span class="p">],</span>
            <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;query&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="s1">&#39;bool&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                        <span class="s1">&#39;filter&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                            <span class="s1">&#39;range&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                                <span class="s1">&#39;imp_date&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;gte&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;20210120&#39;</span><span class="p">,</span> <span class="s1">&#39;lte&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;20210430&#39;</span><span class="p">]</span>
                            <span class="p">]</span>
                        <span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">],</span>
                <span class="s1">&#39;size&#39;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span>
                <span class="c1">//&#39;collapse&#39; =&gt; [&#39;field&#39; =&gt; &#39;open_id&#39;],
</span><span class="c1"></span>                <span class="s1">&#39;aggs&#39;</span><span class="o">=&gt;</span><span class="p">[</span>
                    <span class="cm">/*&#39;my_count&#39;=&gt;[
</span><span class="cm">                        &#39;value_count&#39;=&gt;[&#39;field&#39; =&gt; &#39;open_id&#39;]
</span><span class="cm">                    ],*/</span>
                    <span class="s1">&#39;distinct_open_id&#39;</span><span class="o">=&gt;</span><span class="p">[</span>
                        <span class="s1">&#39;cardinality&#39;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s1">&#39;field&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;open_id&#39;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">]</span>
            <span class="p">],</span>
        <span class="p">];</span>


<span class="nv">$results</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;es&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">search</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
<span class="nv">$results</span><span class="p">[</span><span class="s1">&#39;aggregations&#39;</span><span class="p">][</span><span class="s1">&#39;distinct_open_id&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
</code></pre></div><p>å¦å¤–å¯å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.junphp.com/details/325.jsp">https://blog.junphp.com/details/325.jsp</a></p>
]]></content>
		</item>
		
		<item>
			<title>Homestead(ubuntu)&#43;Laravel ä½¿ç”¨ RabbitMQ</title>
			<link>http://hugo.zkilm.cn/posts/20210121-laravel-rabbitmq/</link>
			<pubDate>Thu, 21 Jan 2021 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20210121-laravel-rabbitmq/</guid>
			<description>å®‰è£… erlang erlang æ˜¯ RabbitMQ çš„ä¾èµ–ã€‚é¦–å…ˆæ‰§è¡Œ
sudo apt-get update ç„¶åæ‰§è¡Œ
sudo apt-get install erlang å®‰è£…å®Œæ¯•åï¼Œè¾“å…¥ erl æŸ¥çœ‹ erlang ç‰ˆæœ¬ï¼Œå‡ºç°å¦‚ä¸‹æç¤ºåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š
Erlang/OTP 20 [erts-9.2] [source] [64-bit] [smp:1:1] [ds:1:1:10] [async-threads:10] [kernel-poll:false] Eshell V9.2 (abort with ^G) 1&amp;gt; ç„¶åé€€å‡º erlang å‘½ä»¤è¡Œï¼šæŒ‰ä¸‹ ctrl+cï¼Œç„¶åè¾“å…¥ a å³å¯ã€‚
å®‰è£… RabbitMq sudo apt-get install rabbitmq-server å®‰è£…å®Œæ¯•åï¼ŒæŸ¥çœ‹ RabbitMQ çŠ¶æ€ï¼š
sudo rabbitmqctl status # é™„ï¼š # å¯åŠ¨RabbitMQï¼š service rabbitmq-server start # åœæ­¢RabbitMQï¼š service rabbitmq-server stop  # é‡å¯RabbitMQï¼š service rabbitmq-server restart  é…ç½® RabbitMQ æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨ RabbitMQ æ’ä»¶</description>
			<content type="html"><![CDATA[<h3 id="å®‰è£…-erlang">å®‰è£… erlang</h3>
<p><code>erlang</code> æ˜¯ <code>RabbitMQ</code> çš„ä¾èµ–ã€‚é¦–å…ˆæ‰§è¡Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo apt-get update
</code></pre></div><p>ç„¶åæ‰§è¡Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo apt-get install erlang
</code></pre></div><p>å®‰è£…å®Œæ¯•åï¼Œè¾“å…¥ <code>erl</code> æŸ¥çœ‹ <code>erlang</code> ç‰ˆæœ¬ï¼Œå‡ºç°å¦‚ä¸‹æç¤ºåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">Erlang/OTP <span class="m">20</span> <span class="o">[</span>erts-9.2<span class="o">]</span> <span class="o">[</span>source<span class="o">]</span> <span class="o">[</span>64-bit<span class="o">]</span> <span class="o">[</span>smp:1:1<span class="o">]</span> <span class="o">[</span>ds:1:1:10<span class="o">]</span> <span class="o">[</span>async-threads:10<span class="o">]</span> <span class="o">[</span>kernel-poll:false<span class="o">]</span>
    
Eshell V9.2  <span class="o">(</span>abort with ^G<span class="o">)</span>
1&gt;
</code></pre></div><p>ç„¶åé€€å‡º <code>erlang</code> å‘½ä»¤è¡Œï¼šæŒ‰ä¸‹ ctrl+cï¼Œç„¶åè¾“å…¥ a å³å¯ã€‚</p>
<h3 id="å®‰è£…-rabbitmq">å®‰è£… RabbitMq</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo apt-get install rabbitmq-server
</code></pre></div><p>å®‰è£…å®Œæ¯•åï¼ŒæŸ¥çœ‹ RabbitMQ çŠ¶æ€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo rabbitmqctl status
    
<span class="c1"># é™„ï¼š</span>
<span class="c1"># å¯åŠ¨RabbitMQï¼š service rabbitmq-server start</span>
<span class="c1"># åœæ­¢RabbitMQï¼š service rabbitmq-server stop </span>
<span class="c1"># é‡å¯RabbitMQï¼š service rabbitmq-server restart </span>
</code></pre></div><h3 id="é…ç½®-rabbitmq">é…ç½® RabbitMQ</h3>
<p>æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨ <code>RabbitMQ</code> æ’ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo rabbitmq-plugins <span class="nb">enable</span> rabbitmq_management
</code></pre></div><p>æ·»åŠ ç”¨æˆ· <code>RabbitMQ</code>ï¼Œæ ¼å¼ï¼šrabbitmqctl add_user ç”¨æˆ·å å¯†ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">rabbitmqctl add_user admin admin
</code></pre></div><p>ç»™äºˆç”¨æˆ·ç®¡ç†å‘˜æƒé™</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo rabbitmqctl set_user_tags admin administrator
</code></pre></div><p>ä¸ºç”¨æˆ·è®¾ç½®è¯»å†™æƒé™</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo rabbitmqctl set_permissions -p / admin <span class="s2">&#34;.*&#34;</span> <span class="s2">&#34;.*&#34;</span> <span class="s2">&#34;.*&#34;</span>
</code></pre></div><p>æ‰“å¼€ <code>RabbitMQ</code> åå°</p>
<pre><code>æµè§ˆå™¨ä¸­è¾“å…¥ï¼šhttp:// æœåŠ¡å™¨ ip+:15672, ä¾‹å¦‚æˆ‘çš„æ˜¯ï¼š192.168.10.10:15672/
</code></pre><p>15672 ç«¯å£é»˜è®¤æ˜¯å…³é—­çš„ï¼Œå› æ­¤éœ€è¦æ‰“å¼€</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">1. sudo apt-get install iptables
2. sudo iptables -I INPUT -p tcp --dport <span class="m">15672</span> -j ACCEPT
</code></pre></div><h3 id="è¿è¡Œç¯å¢ƒubuntuå®‰è£…-amqp-æ‰©å±•">è¿è¡Œç¯å¢ƒï¼ˆubuntuï¼‰å®‰è£… amqp æ‰©å±•</h3>
<p>è¿™äº›æ‰©å±•æ˜¯è¿è¡Œå¿…é¡»ï¼Œå¯ä»¥ç±»æ¯”ä¸º mongodb,redis æ‰©å±•ã€‚åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo apt-get -y install gcc make autoconf libc-dev pkg-config
sudo apt-get -y install libssl-dev
sudo apt-get -y install librabbitmq-dev
</code></pre></div><p>åœ¨è¿™é‡Œå®‰è£…å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å°é—®é¢˜ï¼Œé‡äº‹ä¸å†³å°±æ‰§è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo apt-get update
//æ—¶é—´å¯èƒ½ä¼šéœ€è¦å¾ˆä¹…ï¼Œæˆ‘æ‰§è¡Œç­‰å®ƒè¿è¡Œçš„æ—¶å€™å¤§æ¦‚èŠ±äº†ä¸€ä¸ªå°æ—¶
sudo apt-get upgrade
</code></pre></div><p>ä»¥ä¸Šçš„æ‰©å±•å®‰è£…å®Œæˆåæ‰§è¡ŒæŒ‡ä»¤å®‰è£… <code>amqp</code> æ‰©å±•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo pecl install amqp
</code></pre></div><p>å®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤º</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="m">28</span> <span class="nb">source</span> files, building
running: phpize
Configuring <span class="k">for</span>:
PHP Api Version:         <span class="m">20170718</span>
Zend Module Api No:      <span class="m">20170718</span>
Zend Extension Api No:   <span class="m">320170718</span>
Set the path to librabbitmq install prefix <span class="o">[</span>autodetect<span class="o">]</span> :
</code></pre></div><p>å›è½¦å³å¯ï¼Œç­‰å¾…å®‰è£…å®Œæˆï¼š</p>
<p><code>You should add &quot;extension=amqp.so&quot; to php.ini</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo -s
<span class="nb">echo</span> <span class="nv">extension</span><span class="o">=</span>amqp.so &gt;&gt; /etc/php/7.2/cli/php.ini
<span class="nb">echo</span> <span class="nv">extension</span><span class="o">=</span>amqp.so &gt;&gt; /etc/php/7.2/fpm/php.ini
sudo service php7.2-fpm restart
</code></pre></div><p>ç„¶åæ‰§è¡Œ <code>php -m</code> æŸ¥çœ‹æ‰©å±•æ˜¯å¦å®‰è£…å®Œæˆ</p>
<h3 id="laravel-é¡¹ç›®ä¸­ä½¿ç”¨">Laravel é¡¹ç›®ä¸­ä½¿ç”¨</h3>
<p>æ·»åŠ  <code>RabbitMQ</code></p>
<table>
<thead>
<tr>
<th>Package Version</th>
<th>Laravel Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>6.0</td>
<td>5.5</td>
</tr>
<tr>
<td>7.0</td>
<td>5.6</td>
</tr>
<tr>
<td>7.1</td>
<td>5.7</td>
</tr>
<tr>
<td>7.2</td>
<td>5.8</td>
</tr>
<tr>
<td>8.0</td>
<td>5.9</td>
</tr>
<tr>
<td>9</td>
<td>6</td>
</tr>
<tr>
<td>10</td>
<td>6.7</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">composer require vladimir-yuldashev/laravel-queue-rabbitmq ^7.1
</code></pre></div><p>åœ¨ <code>app/config/queue.php</code> æ–‡ä»¶ä¸­ï¼Œ<code>connections</code> æ•°ç»„ä¸­æ·»åŠ </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="s1">&#39;rabbitmq&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span>                <span class="o">=&gt;</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span>
 
    <span class="s1">&#39;host&#39;</span>                  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
    <span class="s1">&#39;port&#39;</span>                  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_PORT&#39;</span><span class="p">,</span> <span class="mi">5672</span><span class="p">),</span>
 
    <span class="s1">&#39;vhost&#39;</span>                 <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_VHOST&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">),</span>
    <span class="s1">&#39;login&#39;</span>                 <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_LOGIN&#39;</span><span class="p">,</span> <span class="s1">&#39;guest&#39;</span><span class="p">),</span>
    <span class="s1">&#39;password&#39;</span>              <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;guest&#39;</span><span class="p">),</span>
 
    <span class="s1">&#39;queue&#39;</span>                 <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE&#39;</span><span class="p">),</span> <span class="c1">// name of the default queue,
</span><span class="c1"></span> 
    <span class="s1">&#39;exchange_declare&#39;</span>      <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_DECLARE&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="c1">// create the exchange if not exists
</span><span class="c1"></span>    <span class="s1">&#39;queue_declare_bind&#39;</span>    <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_DECLARE_BIND&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="c1">// create the queue if not exists and bind to the exchange
</span><span class="c1"></span> 
    <span class="s1">&#39;queue_params&#39;</span>          <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;passive&#39;</span>           <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_PASSIVE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
        <span class="s1">&#39;durable&#39;</span>           <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_DURABLE&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span>
        <span class="s1">&#39;exclusive&#39;</span>         <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_EXCLUSIVE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
        <span class="s1">&#39;auto_delete&#39;</span>       <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_QUEUE_AUTODELETE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
    <span class="p">],</span>
 
    <span class="s1">&#39;exchange_params&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span>        <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_NAME&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
        <span class="s1">&#39;type&#39;</span>        <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;direct&#39;</span><span class="p">),</span> <span class="c1">// more info at http://www.rabbitmq.com/tutorials/amqp-concepts.html
</span><span class="c1"></span>        <span class="s1">&#39;passive&#39;</span>     <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_PASSIVE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
        <span class="s1">&#39;durable&#39;</span>     <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_DURABLE&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="c1">// the exchange will survive server restarts
</span><span class="c1"></span>        <span class="s1">&#39;auto_delete&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;RABBITMQ_EXCHANGE_AUTODELETE&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">),</span>
    <span class="p">],</span>
 
<span class="p">],</span>
</code></pre></div><p>åœ¨ <code>.env</code> ä¸­æ·»åŠ </p>
<pre><code class="language-dotenv" data-lang="dotenv">QUEUE_CONNECTION=rabbitmq #ä¿®æ”¹ä¸€ä¸‹
RABBITMQ_HOST = 127.0.0.1   #è¦è¿æ¥å¾—ä¸»æœºå
RABBITMQ_PORT = 5672  #ç«¯å£
RABBITMQ_VHOST = / 
RABBITMQ_LOGIN = admin #mqç™»å½•å
RABBITMQ_PASSWORD = admin  #mqç™»é™†å¯†ç 
RABBITMQ_QUEUE = test  #mqè¿æ¥å¾—æµ‹è¯•å
</code></pre><p>å…¶ä»–å’Œæ­£å¸¸è·‘é˜Ÿåˆ—åŒºåˆ«ä¸å¤§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php artisan queue:restart
php artisan queue:work
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>Homestead å®‰è£… Swoole æ‰©å±•</title>
			<link>http://hugo.zkilm.cn/posts/20200828-homestead-swoole/</link>
			<pubDate>Fri, 28 Aug 2020 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20200828-homestead-swoole/</guid>
			<description>é…ç½®é•œåƒæº é…ç½®å¥½ ubuntu çš„å›½å†…é•œåƒæºå¹¶æ›´æ–°
å®‰è£… dev æŸ¥çœ‹ php ç‰ˆæœ¬ï¼Œå¹¶å®‰è£…å¯¹åº” php ç‰ˆæœ¬çš„ dev
sudo apt install php7.2-dev é…ç½® pecl sudo pecl channel-update pecl.php.net sudo pear clear-cache sudo pear update-channels sudo pear upgrade å®‰è£… swoole æ‰©å±• å®‰è£… php çš„ swoole æ‰©å±•
sudo pecl install swoole ä¿®æ”¹ php.ini åœ¨ php.ini ä¸­å¢åŠ  extension=swoole.so
php -i | grep php.ini vim /etc/php/7.2/cli/php.ini
# åœ¨php.iniçš„å°¾éƒ¨å¢åŠ å¦‚ä¸‹ä»£ç  extension=swoole.so é‡å¯ php # åœ¨php.iniçš„å°¾éƒ¨å¢åŠ å¦‚ä¸‹ä»£ç  extension=swoole.so æŸ¥çœ‹æ˜¯å¦æˆåŠŸå®‰è£… æŸ¥çœ‹ php æ˜¯å¦æˆåŠŸå®‰è£… swoole æ¨¡å—</description>
			<content type="html"><![CDATA[<h3 id="é…ç½®é•œåƒæº">é…ç½®é•œåƒæº</h3>
<p>é…ç½®å¥½ <code>ubuntu</code> çš„å›½å†…é•œåƒæºå¹¶æ›´æ–°</p>
<h3 id="å®‰è£…-dev">å®‰è£… <code>dev</code></h3>
<p>æŸ¥çœ‹ <code>php</code> ç‰ˆæœ¬ï¼Œå¹¶å®‰è£…å¯¹åº” <code>php</code> ç‰ˆæœ¬çš„ <code>dev</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo apt install php7.2-dev
</code></pre></div><h3 id="é…ç½®-pecl">é…ç½® <code>pecl</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo pecl channel-update pecl.php.net
sudo pear clear-cache
sudo pear update-channels
sudo pear upgrade
</code></pre></div><h3 id="å®‰è£…-swoole-æ‰©å±•">å®‰è£… <code>swoole</code> æ‰©å±•</h3>
<p>å®‰è£… <code>php</code> çš„ <code>swoole</code> æ‰©å±•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo pecl install swoole
</code></pre></div><h3 id="ä¿®æ”¹-phpini">ä¿®æ”¹ <code>php.ini</code></h3>
<p>åœ¨ <code>php.ini</code> ä¸­å¢åŠ  <code>extension=swoole.so</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php -i <span class="p">|</span> grep php.ini
</code></pre></div><p><code>vim</code>  <code>/etc/php/7.2/cli/php.ini</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># åœ¨php.iniçš„å°¾éƒ¨å¢åŠ å¦‚ä¸‹ä»£ç </span>
<span class="nv">extension</span><span class="o">=</span>swoole.so
</code></pre></div><h3 id="é‡å¯-php">é‡å¯ <code>php</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># åœ¨php.iniçš„å°¾éƒ¨å¢åŠ å¦‚ä¸‹ä»£ç </span>
<span class="nv">extension</span><span class="o">=</span>swoole.so
</code></pre></div><h4 id="æŸ¥çœ‹æ˜¯å¦æˆåŠŸå®‰è£…">æŸ¥çœ‹æ˜¯å¦æˆåŠŸå®‰è£…</h4>
<p>æŸ¥çœ‹ <code>php</code> æ˜¯å¦æˆåŠŸå®‰è£… <code>swoole</code> æ¨¡å—</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php -m <span class="p">|</span> grep swoole
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>å¾®ä¿¡æ‰«ç  - å…³æ³¨å…¬ä¼—å·åç½‘ç«™è‡ªåŠ¨ç™»å½•</title>
			<link>http://hugo.zkilm.cn/posts/20210824-wx-scan/</link>
			<pubDate>Fri, 07 Feb 2020 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20210824-wx-scan/</guid>
			<description>å¤§æ¦‚æµç¨‹æ˜¯ï¼šç‚¹å‡»å¾®ä¿¡ç™»å½•ï¼Œç½‘ç«™è‡ªå·±å¼¹å‡ºä¸€ä¸ªäºŒç»´ç ã€æ‰«æäºŒç»´ç åå¼¹å‡ºå…¬ä¼—å·çš„å…³æ³¨ç•Œé¢ã€åªè¦ä¸€å…³æ³¨å…¬ä¼—å·ç½‘ç«™è‡ªåŠ¨ç™»å½•ã€ç¬¬äºŒæ¬¡æ‰«æç™»å½•çš„æ—¶å€™ç½‘ç«™ç›´æ¥ç™»å½•ã€‚è¿™ç§æ‰«ç ç™»å½•çš„æ–¹å¼ä¸ªäººè§‰å¾—éå¸¸åˆ©äºæ¨å¹¿å…¬ä¼—å·ã€‚
å¤§å®¶å¯ä»¥ä½“éªŒä¸€ä¸‹ ã€Œè¿™ç§ç™»å½•æ–¹å¼ã€
å‰æœŸå‡†å¤‡  æœåŠ¡å·ï¼ˆæˆ–è€…å¾®ä¿¡æµ‹è¯•è´¦å·ï¼‰ EasyWeChat æ‰©å±•åŒ…  ç†è§£ ç®€å•çš„è§£é‡Šä¸€ä¸‹æ‰«æè¿™ä¸ªå¸¦å‚äºŒç»´ç æœ‰ä»€ä¹ˆä¸åŒï¼š
 æ‰«æäºŒç»´ç ï¼Œå¦‚æœç”¨æˆ·è¿˜æœªå…³æ³¨å…¬ä¼—å·ï¼Œåˆ™ç”¨æˆ·å¯ä»¥å…³æ³¨å…¬ä¼—å·ï¼Œå…³æ³¨åå¾®ä¿¡ä¼šå°†å¸¦åœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å€¼ï¼‰å…³æ³¨äº‹ä»¶æ¨é€ç»™å¼€å‘è€…ã€‚ æ‰«æäºŒç»´ç ï¼Œå¦‚æœç”¨æˆ·å·²ç»å…³æ³¨å…¬ä¼—å·ï¼Œåœ¨ç”¨æˆ·æ‰«æåä¼šè‡ªåŠ¨è¿›å…¥ä¼šè¯ï¼Œå¾®ä¿¡ä¹Ÿä¼šå°†å¸¦åœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å€¼ï¼‰æ‰«ç äº‹ä»¶æ¨é€ç»™å¼€å‘è€…ã€‚  æ¢³ç† çœ‹åˆ°è¿™é‡Œç›¸ä¿¡ä½ å·²ç»æ˜ç™½äº†ï¼Œæ¢³ç†ä¸€ä¸‹ï¼š
 ç”ŸæˆäºŒç»´ç çš„æ—¶å€™ä½ è‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°åˆ°äºŒç»´ç ä¸­ï¼Œé¡ºä¾¿æŠŠè¿™ä¸ªå‚æ•°ä¼ åˆ°å‰ç«¯é¡µé¢ä¸­ã€‚ å‰ç«¯é¡µé¢æ ¹æ®è¿™ä¸ªå‚æ•°è½®è¯¢ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼ˆä¹Ÿå¯ä½¿ç”¨ socketï¼‰ã€‚ ç”¨æˆ·æ‰«ç å…³æ³¨åä¼šæ¨é€ä¸€ä¸ªå…³æ³¨äº‹ä»¶åˆ°æœåŠ¡ç«¯ï¼Œä¹Ÿä¼šæŠŠè‡ªå®šä¹‰å‚æ•°å¸¦å…¥åˆ°äº‹ä»¶ä¸­ã€‚ æ ¹æ® openid åˆ›å»ºç”¨æˆ·åï¼Œç„¶ååœ¨ Redis ä¸­å­˜å‚¨ Key ä¸ºåœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å‚æ•°ï¼‰ Value ä¸ºç”¨æˆ·åˆ›å»ºåçš„ idã€‚ å‰ç«¯è½®è¯¢æ–¹æ³•ä¸­å¦‚æœåœ¨ Redis ä¸­è·å–åˆ° Id åï¼ŒAuth ç™»é™†ï¼Œé¡µé¢å†é‡è½½ä¸€ä¸‹ï¼Œæµç¨‹å®Œæ¯•ã€‚  è¿˜æœ‰ä¸€ç§æ˜¯ç”¨äºæœ‰è´¦å·çš„ç”¨æˆ·ï¼Œå…ˆè´¦å·å¯†ç ç™»å½•ï¼Œå†æ‰«ç ï¼ˆä½¿ç”¨è¿‡ï¼‰ï¼š
 ç”Ÿæˆå¸¦loginå‚æ•°çš„ä¸´æ—¶äºŒç»´ç çš„æ—¶å€™ï¼Œå°†äºŒç»´ç çš„ticketæ›´æ–°åˆ°æ•°æ®åº“è¯¥ç”¨æˆ·ä¸‹ï¼Œé»˜è®¤çŠ¶æ€ä¸ºæœªä½¿ç”¨ ç”¨æˆ·æ‰«ç ï¼Œå¾®ä¿¡ä¼šæ¨é€ä¸€ä¸ªæ‰«ç äº‹ä»¶ï¼Œä¹Ÿä¼šæŠŠè‡ªå®šä¹‰å‚æ•°loginå¸¦åˆ°äº‹ä»¶ä¸­ï¼Œæ”¹å˜äºŒç»´ç çŠ¶æ€ä¸ºå·²ä½¿ç”¨ å‰ç«¯è¿›åˆ°æ‰«ç é¡µé¢çš„åŒæ—¶å°±å¼€å§‹è½®è¯¢æ‰«æç»“æœæ¥å£ï¼ŒçŠ¶æ€ä¸ºå·²ä½¿ç”¨åˆ™æ‰«ç ç™»å½•æˆåŠŸ æœªå…³æ³¨çš„ç”¨æˆ·ï¼Œä¼šå…ˆæ ¹æ®openidè·å–ç”¨æˆ·ä¿¡æ¯å¹¶å†™å…¥æ•°æ®åº“ï¼Œå…³æ³¨è¿‡çš„åˆ™æ•°æ®åº“æœ‰æ•°æ®ï¼Œåšç›¸å…³æ›´æ–°æ“ä½œã€‚  æœ€åé€ä¸ªè‡ªå·±ğŸ’ª
 å…¨ä¸–ç•Œå°±ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ä½ ï¼Œè¯·ä¸€å®šï¼šçœŸè¯šåšäººï¼ŒåŠªåŠ›åšäº‹ï¼ä½ æƒ³è¦çš„ï¼Œå²æœˆéƒ½ä¼šç»™ä½ ã€‚
 </description>
			<content type="html"><![CDATA[<p>å¤§æ¦‚æµç¨‹æ˜¯ï¼šç‚¹å‡»å¾®ä¿¡ç™»å½•ï¼Œç½‘ç«™è‡ªå·±å¼¹å‡ºä¸€ä¸ªäºŒç»´ç ã€æ‰«æäºŒç»´ç åå¼¹å‡ºå…¬ä¼—å·çš„å…³æ³¨ç•Œé¢ã€åªè¦ä¸€å…³æ³¨å…¬ä¼—å·ç½‘ç«™è‡ªåŠ¨ç™»å½•ã€ç¬¬äºŒæ¬¡æ‰«æç™»å½•çš„æ—¶å€™ç½‘ç«™ç›´æ¥ç™»å½•ã€‚è¿™ç§æ‰«ç ç™»å½•çš„æ–¹å¼ä¸ªäººè§‰å¾—éå¸¸åˆ©äºæ¨å¹¿å…¬ä¼—å·ã€‚</p>
<p>å¤§å®¶å¯ä»¥ä½“éªŒä¸€ä¸‹ <a href="http://90sheji.com">ã€Œè¿™ç§ç™»å½•æ–¹å¼ã€</a></p>
<h3 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡</h3>
<ul>
<li>æœåŠ¡å·ï¼ˆæˆ–è€…å¾®ä¿¡æµ‹è¯•è´¦å·ï¼‰</li>
<li>EasyWeChat æ‰©å±•åŒ…</li>
</ul>
<h3 id="ç†è§£">ç†è§£</h3>
<p><strong>ç®€å•çš„è§£é‡Šä¸€ä¸‹æ‰«æè¿™ä¸ªå¸¦å‚äºŒç»´ç æœ‰ä»€ä¹ˆä¸åŒï¼š</strong></p>
<ul>
<li>æ‰«æäºŒç»´ç ï¼Œå¦‚æœç”¨æˆ·è¿˜æœªå…³æ³¨å…¬ä¼—å·ï¼Œåˆ™ç”¨æˆ·å¯ä»¥å…³æ³¨å…¬ä¼—å·ï¼Œå…³æ³¨åå¾®ä¿¡ä¼šå°†å¸¦åœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å€¼ï¼‰å…³æ³¨äº‹ä»¶æ¨é€ç»™å¼€å‘è€…ã€‚</li>
<li>æ‰«æäºŒç»´ç ï¼Œå¦‚æœç”¨æˆ·å·²ç»å…³æ³¨å…¬ä¼—å·ï¼Œåœ¨ç”¨æˆ·æ‰«æåä¼šè‡ªåŠ¨è¿›å…¥ä¼šè¯ï¼Œå¾®ä¿¡ä¹Ÿä¼šå°†å¸¦åœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å€¼ï¼‰æ‰«ç äº‹ä»¶æ¨é€ç»™å¼€å‘è€…ã€‚</li>
</ul>
<h3 id="æ¢³ç†">æ¢³ç†</h3>
<p><strong>çœ‹åˆ°è¿™é‡Œç›¸ä¿¡ä½ å·²ç»æ˜ç™½äº†ï¼Œæ¢³ç†ä¸€ä¸‹ï¼š</strong></p>
<ul>
<li>ç”ŸæˆäºŒç»´ç çš„æ—¶å€™ä½ è‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°åˆ°äºŒç»´ç ä¸­ï¼Œé¡ºä¾¿æŠŠè¿™ä¸ªå‚æ•°ä¼ åˆ°å‰ç«¯é¡µé¢ä¸­ã€‚</li>
<li>å‰ç«¯é¡µé¢æ ¹æ®è¿™ä¸ªå‚æ•°è½®è¯¢ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼ˆä¹Ÿå¯ä½¿ç”¨ socketï¼‰ã€‚</li>
<li>ç”¨æˆ·æ‰«ç å…³æ³¨åä¼šæ¨é€ä¸€ä¸ªå…³æ³¨äº‹ä»¶åˆ°æœåŠ¡ç«¯ï¼Œä¹Ÿä¼šæŠŠè‡ªå®šä¹‰å‚æ•°å¸¦å…¥åˆ°äº‹ä»¶ä¸­ã€‚</li>
<li>æ ¹æ® openid åˆ›å»ºç”¨æˆ·åï¼Œç„¶ååœ¨ Redis ä¸­å­˜å‚¨ Key ä¸ºåœºæ™¯å€¼ï¼ˆè‡ªå®šä¹‰å‚æ•°ï¼‰ Value ä¸ºç”¨æˆ·åˆ›å»ºåçš„ idã€‚</li>
<li>å‰ç«¯è½®è¯¢æ–¹æ³•ä¸­å¦‚æœåœ¨ Redis ä¸­è·å–åˆ° Id åï¼ŒAuth ç™»é™†ï¼Œé¡µé¢å†é‡è½½ä¸€ä¸‹ï¼Œæµç¨‹å®Œæ¯•ã€‚</li>
</ul>
<p><strong>è¿˜æœ‰ä¸€ç§æ˜¯ç”¨äºæœ‰è´¦å·çš„ç”¨æˆ·ï¼Œå…ˆè´¦å·å¯†ç ç™»å½•ï¼Œå†æ‰«ç ï¼ˆä½¿ç”¨è¿‡ï¼‰ï¼š</strong></p>
<ul>
<li>ç”Ÿæˆå¸¦loginå‚æ•°çš„ä¸´æ—¶äºŒç»´ç çš„æ—¶å€™ï¼Œå°†äºŒç»´ç çš„ticketæ›´æ–°åˆ°æ•°æ®åº“è¯¥ç”¨æˆ·ä¸‹ï¼Œé»˜è®¤çŠ¶æ€ä¸ºæœªä½¿ç”¨</li>
<li>ç”¨æˆ·æ‰«ç ï¼Œå¾®ä¿¡ä¼šæ¨é€ä¸€ä¸ªæ‰«ç äº‹ä»¶ï¼Œä¹Ÿä¼šæŠŠè‡ªå®šä¹‰å‚æ•°loginå¸¦åˆ°äº‹ä»¶ä¸­ï¼Œæ”¹å˜äºŒç»´ç çŠ¶æ€ä¸ºå·²ä½¿ç”¨</li>
<li>å‰ç«¯è¿›åˆ°æ‰«ç é¡µé¢çš„åŒæ—¶å°±å¼€å§‹è½®è¯¢æ‰«æç»“æœæ¥å£ï¼ŒçŠ¶æ€ä¸ºå·²ä½¿ç”¨åˆ™æ‰«ç ç™»å½•æˆåŠŸ</li>
<li>æœªå…³æ³¨çš„ç”¨æˆ·ï¼Œä¼šå…ˆæ ¹æ®openidè·å–ç”¨æˆ·ä¿¡æ¯å¹¶å†™å…¥æ•°æ®åº“ï¼Œå…³æ³¨è¿‡çš„åˆ™æ•°æ®åº“æœ‰æ•°æ®ï¼Œåšç›¸å…³æ›´æ–°æ“ä½œã€‚</li>
</ul>
<p><strong>æœ€åé€ä¸ªè‡ªå·±ğŸ’ª</strong></p>
<blockquote>
<p>å…¨ä¸–ç•Œå°±ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ä½ ï¼Œè¯·ä¸€å®šï¼šçœŸè¯šåšäººï¼ŒåŠªåŠ›åšäº‹ï¼ä½ æƒ³è¦çš„ï¼Œå²æœˆéƒ½ä¼šç»™ä½ ã€‚</p>
</blockquote>
]]></content>
		</item>
		
		<item>
			<title>Laravelçš„å¾®ä¿¡å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æ¨é€ğŸ“¨</title>
			<link>http://hugo.zkilm.cn/posts/20191127-wechat-pushmsg/</link>
			<pubDate>Wed, 27 Nov 2019 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20191127-wechat-pushmsg/</guid>
			<description>å®‰è£…ä¸€ä¸ªçº¯å‡€çš„laravelæ¡†æ¶ composer create-project --prefer-dist laravel/laravel blog &amp;#34;5.7.*&amp;#34; å®‰è£…å¾®ä¿¡æ‰©å±•åŒ…EasyWeChat å®‰è£…å¥½ç”¨çš„å¾®ä¿¡æ‰©å±•åŒ…EasyWeChatï¼Œè¿™é‡Œä½¿ç”¨ laravel-wechat
# Laravel &amp;lt; 5.8 composer require &amp;#34;overtrue/laravel-wechat:~4.0&amp;#34; ç®¡ç†å¤šå…¬ä¼—å· Laravel ä½¿ç”¨ EasyWechat ç®¡ç†å¤šå…¬ä¼—å·
 åˆ›å»ºæ•°æ®è¡¨  php artisan make:model Wechat -m $table-&amp;gt;increments(&amp;#39;id&amp;#39;); $table-&amp;gt;string(&amp;#39;aid&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;wechat_app_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡å…¬ä¼—å·è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;wechat_secret&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;wechat_token&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;wechat_aes_key&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;pay_mch_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡æ”¯ä»˜è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;pay_api_key&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;pay_cert_path&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;pay_key_path&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;op_app_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡å¼€æ”¾å¹³å°è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;op_secret&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;op_token&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;op_aes_key&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;work_corp_id&amp;#39;)-&amp;gt;nullable(); //å¾®ä¿¡ä¼ä¸šå·è®¾ç½®å‚æ•° $table-&amp;gt;string(&amp;#39;work_agent_id&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;string(&amp;#39;work_secret&amp;#39;)-&amp;gt;nullable(); $table-&amp;gt;timestamps(); åœ¨ App\Handlers åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•° WechatConfigHandler.php æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š  &amp;lt;?php /** * Created by PhpStorm. * User: zhukang. * Date: 2019/11/9. * Time: 11:54.</description>
			<content type="html"><![CDATA[<h3 id="å®‰è£…ä¸€ä¸ªçº¯å‡€çš„laravelæ¡†æ¶">å®‰è£…ä¸€ä¸ªçº¯å‡€çš„laravelæ¡†æ¶</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">composer create-project --prefer-dist laravel/laravel blog <span class="s2">&#34;5.7.*&#34;</span>
</code></pre></div><h3 id="å®‰è£…å¾®ä¿¡æ‰©å±•åŒ…easywechat">å®‰è£…å¾®ä¿¡æ‰©å±•åŒ…EasyWeChat</h3>
<p>å®‰è£…å¥½ç”¨çš„å¾®ä¿¡æ‰©å±•åŒ…EasyWeChatï¼Œè¿™é‡Œä½¿ç”¨ laravel-wechat</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># Laravel &lt; 5.8</span>
composer require <span class="s2">&#34;overtrue/laravel-wechat:~4.0&#34;</span>
</code></pre></div><h3 id="ç®¡ç†å¤šå…¬ä¼—å·">ç®¡ç†å¤šå…¬ä¼—å·</h3>
<p>Laravel ä½¿ç”¨ EasyWechat ç®¡ç†å¤šå…¬ä¼—å·</p>
<ol>
<li>åˆ›å»ºæ•°æ®è¡¨</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php artisan make:model Wechat -m
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_app_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span> <span class="c1">//å¾®ä¿¡å…¬ä¼—å·è®¾ç½®å‚æ•°
</span><span class="c1"></span><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_token&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;wechat_aes_key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_mch_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>  <span class="c1">//å¾®ä¿¡æ”¯ä»˜è®¾ç½®å‚æ•°
</span><span class="c1"></span><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_api_key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_cert_path&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;pay_key_path&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_app_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>  <span class="c1">//å¾®ä¿¡å¼€æ”¾å¹³å°è®¾ç½®å‚æ•°
</span><span class="c1"></span><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_token&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;op_aes_key&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;work_corp_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>  <span class="c1">//å¾®ä¿¡ä¼ä¸šå·è®¾ç½®å‚æ•°
</span><span class="c1"></span><span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;work_agent_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;work_secret&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
</code></pre></div><ol start="2">
<li>åœ¨ <code>App\Handlers</code> åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•° <code>WechatConfigHandler.php</code> æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="sd">/**
</span><span class="sd">* Created by PhpStorm.
</span><span class="sd">* User: zhukang.
</span><span class="sd">* Date: 2019/11/9.
</span><span class="sd">* Time: 11:54.
</span><span class="sd">*/</span>
<span class="k">namespace</span> <span class="nx">App\Handlers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Wechat</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">EasyWeChat\Factory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WechatConfigHandler</span>
<span class="p">{</span>
   <span class="c1">//[1-1]å¾®ä¿¡å…¬ä¼—å·è®¾ç½®
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">app_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
       
       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
           <span class="s1">&#39;app_id&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_app_id</span><span class="p">,</span>      <span class="c1">// AppID
</span><span class="c1"></span>           <span class="s1">&#39;secret&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_secret</span><span class="p">,</span>      <span class="c1">// AppSecret
</span><span class="c1"></span>           <span class="s1">&#39;token&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_token</span><span class="p">,</span>       <span class="c1">// Token
</span><span class="c1"></span>           <span class="s1">&#39;aes_key&#39;</span> <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_aes_key</span><span class="p">,</span>     <span class="c1">// EncodingAESKeyï¼Œå…¼å®¹ä¸å®‰å…¨æ¨¡å¼ä¸‹è¯·ä¸€å®šè¦å¡«å†™ï¼ï¼ï¼
</span><span class="c1"></span>           <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
           <span class="s1">&#39;log&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
               <span class="s1">&#39;level&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
               <span class="s1">&#39;file&#39;</span> <span class="o">=&gt;</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;logs/wechat.log&#39;</span><span class="p">),</span>  <span class="c1">//è¿™ä¸ªå¿…é¡»è¦æœ‰ï¼Œè¦ä¸è°ƒè¯•æœ‰é—®é¢˜ï¼Œä½ éƒ½ä¼šæ‰¾ä¸åˆ°åŸå› 
</span><span class="c1"></span>           <span class="p">],</span>
       <span class="p">];</span>
       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//[1-2]ç”Ÿæˆå¾®ä¿¡å…¬ä¼—å·ç›¸å…³
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$app</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">officialAccount</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
       <span class="k">return</span> <span class="nv">$app</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//[2-1]å¾®ä¿¡æ”¯ä»˜è®¾ç½®
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">pay_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
       
       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
           <span class="s1">&#39;app_id&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_app_id</span><span class="p">,</span>      <span class="c1">// AppID
</span><span class="c1"></span>           <span class="s1">&#39;secret&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_secret</span><span class="p">,</span>      <span class="c1">// AppSecret
</span><span class="c1"></span>           <span class="s1">&#39;mch_id&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_mch_id</span><span class="p">,</span>
           <span class="s1">&#39;key&#39;</span>         <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_api_key</span><span class="p">,</span>   <span class="c1">// API å¯†é’¥
</span><span class="c1"></span>           <span class="c1">// å¦‚éœ€ä½¿ç”¨æ•æ„Ÿæ¥å£ï¼ˆå¦‚é€€æ¬¾ã€å‘é€çº¢åŒ…ç­‰ï¼‰éœ€è¦é…ç½® API è¯ä¹¦è·¯å¾„(ç™»å½•å•†æˆ·å¹³å°ä¸‹è½½ API è¯ä¹¦)
</span><span class="c1"></span>           <span class="s1">&#39;cert_path&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_api_key</span><span class="p">,</span> <span class="c1">// XXX: ç»å¯¹è·¯å¾„ï¼ï¼ï¼ï¼
</span><span class="c1"></span>           <span class="s1">&#39;key_path&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">pay_api_key</span><span class="p">,</span>      <span class="c1">// XXX: ç»å¯¹è·¯å¾„ï¼ï¼ï¼ï¼
</span><span class="c1"></span>           <span class="s1">&#39;notify_url&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;é»˜è®¤çš„è®¢å•å›è°ƒåœ°å€&#39;</span><span class="p">,</span>     <span class="c1">// ä½ ä¹Ÿå¯ä»¥åœ¨ä¸‹å•æ—¶å•ç‹¬è®¾ç½®æ¥æƒ³è¦†ç›–å®ƒ
</span><span class="c1"></span>       <span class="p">];</span>
       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//[2-2]ç”Ÿæˆå¾®ä¿¡æ”¯ä»˜ç›¸å…³
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">pay</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$pay</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">payment</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pay_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
       <span class="k">return</span> <span class="nv">$pay</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//[3-1]å¾®ä¿¡å°ç¨‹åºè®¾ç½®
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">mini_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
           <span class="s1">&#39;app_id&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_app_id</span><span class="p">,</span>         <span class="c1">// AppID
</span><span class="c1"></span>           <span class="s1">&#39;secret&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">wechat_secret</span><span class="p">,</span>     <span class="c1">// AppSecret
</span><span class="c1"></span>           <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
       <span class="p">];</span>
       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//[3-2]å¾®ä¿¡å°ç¨‹åºç›¸å…³
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">miniProgram</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$miniProgram</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">miniProgram</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mini_config</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
       <span class="k">return</span> <span class="nv">$miniProgram</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//[4-1]å¾®ä¿¡å¼€æ”¾å¹³å°è®¾ç½®å‚æ•°
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">opconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
           <span class="s1">&#39;app_id&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_app_id</span><span class="p">,</span>
           <span class="s1">&#39;secret&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_secret</span><span class="p">,</span>
           <span class="s1">&#39;token&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_token</span><span class="p">,</span>
           <span class="s1">&#39;aes_key&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">op_aes_key</span>
       <span class="p">];</span>
       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//[4-2]å¾®ä¿¡å¼€æ”¾å¹³å°ç›¸å…³
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">openPlatform</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$openPlatform</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">openPlatform</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">opconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
       <span class="k">return</span> <span class="nv">$openPlatform</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//[5-1]å¾®ä¿¡ä¼ä¸šå·è®¾ç½®å‚æ•°
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">workconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$wechat</span> <span class="o">=</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;aid&#39;</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wechat</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">[];</span>
       <span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
           <span class="s1">&#39;corp_id&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">work_corp_id</span><span class="p">,</span>
           <span class="s1">&#39;agent_id&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">work_agent_id</span><span class="p">,</span>
           <span class="s1">&#39;secret&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">work_secret</span><span class="p">,</span>

           <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
       <span class="p">];</span>
       <span class="k">return</span> <span class="nv">$config</span><span class="p">;</span>

   <span class="p">}</span>

   <span class="c1">//[5-2]å¾®ä¿¡ä¼ä¸šå·ç›¸å…³
</span><span class="c1"></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">work</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$work</span> <span class="o">=</span> <span class="nx">Factory</span><span class="o">::</span><span class="na">work</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">workconfig</span><span class="p">(</span><span class="nv">$account</span><span class="p">));</span>
       <span class="k">return</span> <span class="nv">$work</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ol start="3">
<li>åˆ›å»ºä¸€ä¸ªå¾®ä¿¡æ§åˆ¶å™¨ï¼Œè¿›è¡Œå¾®ä¿¡å…¬ä¼—å¹³å°å¯¹æ¥</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php artisan make:controller WechatController
</code></pre></div><p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
       
<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Api</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Handlers\WechatConfigHandler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\SubscribeReplay</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Wechat</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\WechatKeyword</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\WechatRule</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\WechatUser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">EasyWeChat\Factory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Log</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WeChatController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>

   <span class="cm">/*public function serve()
</span><span class="cm">   {
</span><span class="cm">       $app=app(&#39;wechat.official_account&#39;);
</span><span class="cm">       return $app-&gt;server-&gt;serve();
</span><span class="cm">   }*/</span>

   <span class="k">protected</span> <span class="nv">$wechat</span><span class="p">;</span>
   <span class="k">protected</span> <span class="nv">$app</span><span class="p">;</span>
   <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">WechatConfigHandler</span> <span class="nv">$wechat</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span> <span class="o">=</span> <span class="nv">$wechat</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="sd">/**
</span><span class="sd">    * å¤„ç†å¾®ä¿¡çš„è¯·æ±‚æ¶ˆæ¯
</span><span class="sd">    * @return string
</span><span class="sd">    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="nf">serve</span><span class="p">(</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>

       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$account</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">switch</span> <span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;MsgType&#39;</span><span class="p">])</span> <span class="p">{</span>
               <span class="k">case</span> <span class="s1">&#39;event&#39;</span><span class="o">:</span>
                   <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="nv">$account</span><span class="p">);</span>
                   <span class="k">break</span><span class="p">;</span>
               <span class="k">case</span> <span class="s1">&#39;text&#39;</span><span class="o">:</span>
                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°æ–‡å­—æ¶ˆæ¯&#39;</span><span class="p">;</span>
                   <span class="k">break</span><span class="p">;</span>
               <span class="k">case</span> <span class="s1">&#39;image&#39;</span><span class="o">:</span>
                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°å›¾ç‰‡æ¶ˆæ¯&#39;</span><span class="p">;</span>
                   <span class="k">break</span><span class="p">;</span>
               <span class="k">case</span> <span class="s1">&#39;voice&#39;</span><span class="o">:</span>
                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°è¯­éŸ³æ¶ˆæ¯&#39;</span><span class="p">;</span>
                   <span class="k">break</span><span class="p">;</span>
               <span class="k">case</span> <span class="s1">&#39;video&#39;</span><span class="o">:</span>
                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°è§†é¢‘æ¶ˆæ¯&#39;</span><span class="p">;</span>
                   <span class="k">break</span><span class="p">;</span>
               <span class="k">case</span> <span class="s1">&#39;location&#39;</span><span class="o">:</span>
                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°åæ ‡æ¶ˆæ¯&#39;</span><span class="p">;</span>
                   <span class="k">break</span><span class="p">;</span>
               <span class="k">case</span> <span class="s1">&#39;link&#39;</span><span class="o">:</span>
                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°é“¾æ¥æ¶ˆæ¯&#39;</span><span class="p">;</span>
                   <span class="k">break</span><span class="p">;</span>
               <span class="k">case</span> <span class="s1">&#39;file&#39;</span><span class="o">:</span>
                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°æ–‡ä»¶æ¶ˆæ¯&#39;</span><span class="p">;</span>
               <span class="c1">// ... å…¶å®ƒæ¶ˆæ¯
</span><span class="c1"></span>               <span class="k">default</span><span class="o">:</span>
                   <span class="k">return</span> <span class="s1">&#39;æ”¶åˆ°å…¶å®ƒæ¶ˆæ¯&#39;</span><span class="p">;</span>
                   <span class="k">break</span><span class="p">;</span>
           <span class="p">}</span>
       <span class="p">});</span>

       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">serve</span><span class="p">();</span>
   <span class="p">}</span>

   <span class="cm">/*
</span><span class="cm">    *äº‹ä»¶
</span><span class="cm">    */</span>
   <span class="k">protected</span> <span class="k">function</span> <span class="nf">event</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="k">switch</span> <span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;Event&#39;</span><span class="p">])</span> <span class="p">{</span>
           <span class="c1">//å…³æ³¨äº‹ä»¶
</span><span class="c1"></span>           <span class="k">case</span> <span class="s1">&#39;subscribe&#39;</span><span class="o">:</span>
               <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">welcome</span><span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;FromUserName&#39;</span><span class="p">],</span><span class="nv">$account</span><span class="p">);</span>
               <span class="k">break</span><span class="p">;</span>
           <span class="k">case</span> <span class="s1">&#39;unsubscribe&#39;</span><span class="o">:</span>
               <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unsubscribe</span><span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;FromUserName&#39;</span><span class="p">]);</span>
               <span class="k">break</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">EventKey</span><span class="p">(</span><span class="nv">$message</span><span class="p">[</span><span class="s1">&#39;EventKey&#39;</span><span class="p">]);</span>
   <span class="p">}</span>

   <span class="cm">/*
</span><span class="cm">    *å…³æ³¨äº‹ä»¶å›å¤
</span><span class="cm">    */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="nf">welcome</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="p">,</span><span class="nv">$account</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="o">.</span><span class="s1">&#39;&lt;å…³æ³¨&gt;&#39;</span><span class="p">);</span>
       <span class="nv">$rule</span><span class="o">=</span><span class="nx">WechatRule</span><span class="o">::</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;wechat_id&#39;</span><span class="o">=&gt;</span><span class="nv">$account</span><span class="p">,</span><span class="s1">&#39;event&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;subscribe&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
       <span class="nv">$reply_content</span><span class="o">=</span><span class="p">(</span><span class="nx">WechatKeyword</span><span class="o">::</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;wechat_id&#39;</span><span class="o">=&gt;</span><span class="nv">$account</span><span class="p">,</span><span class="s1">&#39;keyword&#39;</span><span class="o">=&gt;</span><span class="nv">$rule</span><span class="o">-&gt;</span><span class="na">keyword</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">reply_content</span><span class="p">;</span>
       <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="p">);</span>
       <span class="nv">$is_exist</span><span class="o">=</span><span class="nx">WechatUser</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;openid&#39;</span><span class="p">,</span><span class="nv">$FromUserName</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
       <span class="k">if</span><span class="p">(</span><span class="nv">$is_exist</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">){</span>
           <span class="nx">WechatUser</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
       <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nv">$is_exist</span><span class="o">-&gt;</span><span class="na">subscribe</span> <span class="o">==</span> <span class="mi">2</span><span class="p">){</span>
           <span class="nv">$is_exist</span><span class="o">-&gt;</span><span class="na">subscribe</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
           <span class="nv">$is_exist</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
       <span class="p">}</span>

       <span class="nv">$replayTemp</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;[toUserName]&#39;</span><span class="p">,</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;nickname&#39;</span><span class="p">],</span><span class="nv">$reply_content</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]);</span>
       <span class="k">return</span> <span class="nv">$replayTemp</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="cm">/*
</span><span class="cm">   *å–æ¶ˆå…³æ³¨äº‹ä»¶å›å¤
</span><span class="cm">   */</span>
   <span class="k">public</span> <span class="k">function</span> <span class="nf">unsubscribe</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="p">)</span>
   <span class="p">{</span>
       <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="nv">$FromUserName</span><span class="o">.</span><span class="s1">&#39;&lt;å–æ¶ˆå…³æ³¨&gt;&#39;</span><span class="p">);</span>
       <span class="nx">WechatUser</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;openid&#39;</span><span class="p">,</span><span class="nv">$FromUserName</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;subscribe&#39;</span><span class="o">=&gt;</span><span class="mi">2</span><span class="p">]);</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ol start="4">
<li>ä¸­é—´é”®<code> Middleware</code> æ–‡ä»¶å¤¹é‡Œ <code>VerifyCsrfToken.php</code> ä¿®æ”¹è·¯ç”±å¿½ç•¥</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">protected</span> <span class="nv">$except</span> <span class="o">=</span> <span class="p">[</span>
   <span class="s1">&#39;wechat/*&#39;</span>
<span class="p">];</span> 
</code></pre></div><ol start="5">
<li>ç„¶ååœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·å†™</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">app</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//å…¬ä¼—å·
</span><span class="c1"></span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">pay</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//å¾®ä¿¡æ”¯ä»˜
</span><span class="c1"></span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">miniProgram</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//å¾®ä¿¡å°ç¨‹åº
</span><span class="c1"></span><span class="nv">$app</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wechat</span><span class="o">-&gt;</span><span class="na">work</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>  <span class="c1">//ä¼ä¸šå·åº”ç”¨
</span></code></pre></div><ol start="6">
<li>å…¶ä»–</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">//å¾®ä¿¡å…¬ä¼—å¹³å°å¼€å‘è€…é€‰é¡¹é‡Œè¦è®¾ç½®ä¸ºï¼š
</span><span class="c1">//http://www.xxx.com/wechat/1
</span><span class="c1"></span>
<span class="c1">//é…ç½®è·¯ç”±(web.php):
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">any</span><span class="p">(</span><span class="s1">&#39;/wechat/{account}&#39;</span><span class="p">,</span> <span class="s1">&#39;Api\WeChatController@serve&#39;</span><span class="p">);</span>       
</code></pre></div><h3 id="æµ‹è¯•å¹³å°">æµ‹è¯•å¹³å°</h3>
<p><img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/promise/post/wxgzhpz.jpg" alt="æµ‹è¯•å¹³å°"></p>
<h3 id="å¢åŠ æ¶ˆæ¯æ¨¡æ¿">å¢åŠ æ¶ˆæ¯æ¨¡æ¿</h3>
<p><img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/promise/post/mbxxsz.jpg" alt="å¢åŠ æ¶ˆæ¯æ¨¡æ¿"></p>
<h3 id="æ–°å»ºæ¨¡æ¿æ¶ˆæ¯æ§åˆ¶å™¨">æ–°å»ºæ¨¡æ¿æ¶ˆæ¯æ§åˆ¶å™¨</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php artisan make:controller Api/WechatTemplateMsgController
</code></pre></div><p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
    
<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Api</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\WechatUser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Log</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WechatTemplateMsgController</span> <span class="k">extends</span> <span class="nx">ApiController</span>
<span class="p">{</span>
    <span class="c1">//å‘é€æ¨¡æ¿æ¶ˆæ¯
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendTemplateMsg</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$users</span><span class="o">=</span><span class="nx">WechatUser</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;subscribe&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;subscribe&#39;</span><span class="p">,</span><span class="s1">&#39;openid&#39;</span><span class="p">,</span><span class="s1">&#39;nickname&#39;</span><span class="p">,</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span><span class="s1">&#39;city&#39;</span><span class="p">,</span><span class="s1">&#39;province&#39;</span><span class="p">,</span><span class="s1">&#39;country&#39;</span><span class="p">,</span><span class="s1">&#39;subscribe_time&#39;</span><span class="p">]);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">){</span>
            <span class="nv">$msg_content_data</span><span class="o">=</span><span class="p">[</span>
                <span class="s1">&#39;first&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¨é€ğŸ˜„&#39;</span><span class="p">,</span>  <span class="c1">// ä¸éœ€è¦æŒ‡å®šé¢œè‰²
</span><span class="c1"></span>                <span class="s1">&#39;nickname&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">nickname</span><span class="p">,</span> <span class="s1">&#39;#F00&#39;</span><span class="p">],</span> <span class="c1">// æŒ‡å®šä¸ºçº¢è‰²
</span><span class="c1"></span>                <span class="s1">&#39;sex&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">sex</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;ç”·&#39;</span> <span class="o">:</span> <span class="s1">&#39;å¥³&#39;</span><span class="p">,</span> <span class="c1">// ä¸ç¬¬äºŒ`ç§ä¸€æ ·
</span><span class="c1"></span>                <span class="s1">&#39;city&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">city</span><span class="p">,</span> <span class="c1">// ä¸ç¬¬ä¸€ç§ä¸€æ ·
</span><span class="c1"></span>                <span class="s1">&#39;province&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">province</span><span class="p">,</span> <span class="c1">// ä¸ç¬¬ä¸€ç§ä¸€æ ·
</span><span class="c1"></span>                <span class="s1">&#39;country&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">country</span><span class="p">,</span> <span class="c1">// ä¸ç¬¬ä¸€ç§ä¸€æ ·
</span><span class="c1"></span>                <span class="s1">&#39;subscribe_time&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="nx">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">,</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscribe_time</span><span class="p">),</span><span class="s1">&#39;#F00&#39;</span><span class="p">],</span> <span class="c1">// ä¸ç¬¬ä¸€ç§ä¸€æ ·
</span><span class="c1"></span>            <span class="p">];</span>
            <span class="nv">$msg_content</span><span class="o">=</span><span class="p">[</span>
                <span class="s1">&#39;touser&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">openid</span><span class="p">,</span>
                <span class="s1">&#39;template_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cn27K9GkTx0O0xxxxxxxxxxxxxxQl-OmA&#39;</span><span class="p">,</span>
                <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://www.xxxxx.com&#39;</span><span class="p">,</span>
                <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nv">$msg_content_data</span><span class="p">,</span>
            <span class="p">];</span>
            <span class="nv">$res</span><span class="o">=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">template_message</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$msg_content</span><span class="p">);</span>
            <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">([</span><span class="s1">&#39;template_message&#39;</span><span class="o">=&gt;</span><span class="nv">$res</span><span class="p">]);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;errcode&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">selfMessage</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;errcode&#39;</span><span class="p">],</span> <span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;errmsg&#39;</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">selfMessage</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="mi">1010</span><span class="p">,</span> <span class="s1">&#39;æ¨¡æ¿æ¶ˆæ¯å‘é€æˆåŠŸï¼&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="è·¯ç”±apiphp">è·¯ç”±(api.php)</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">//å‘é€æ¨¡æ¿æ¶ˆæ¯
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;wechat/send_template_msg&#39;</span><span class="p">,</span> <span class="s1">&#39;WechatTemplateMsgController@sendTemplateMsg&#39;</span><span class="p">);</span>
</code></pre></div><h4 id="æµ‹è¯•">æµ‹è¯•</h4>
<p>Postmanè°ƒç”¨å‘é€æ¨¡æ¿æ¶ˆæ¯æ¥å£ï¼š
<img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/promise/post/postman_mb.jpg" alt="Postmanè°ƒç”¨å‘é€æ¨¡æ¿æ¶ˆæ¯æ¥å£"></p>
<p>æ•ˆæœå›¾ï¼š
<img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/promise/post/mbxgt.jpg" alt="æ•ˆæœå›¾"></p>
]]></content>
		</item>
		
		<item>
			<title>GitBookåˆè¯•ğŸº</title>
			<link>http://hugo.zkilm.cn/posts/20190826-try-gitbook/</link>
			<pubDate>Mon, 26 Aug 2019 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20190826-try-gitbook/</guid>
			<description>å®Œæˆåçš„æˆæœé¢„è§ˆåœ°å€ï¼šhttps://zkbook.zam9.com/
 å®‰è£… npm install gitbook-cli -g æŠ¥é”™ï¼š
npm WARN checkPermissions Missing write access to /usr/lib/node_modules åŸå› ï¼šå®‰è£…å…¨å±€çš„åŒ…ï¼Œæ²¡æœ‰æƒé™
è§£å†³åŠæ³•ï¼šåœ¨å®‰è£…å‘½ä»¤å‰åŠ ä¸Š sudo ,è¾“å…¥ç”¨æˆ·çš„ç™»é™†å¯†ç ï¼Œæå‡æƒé™è¿›è¡Œå®‰è£…ã€‚
sudo npm install gitbook-cli -g åˆå§‹åŒ– æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚ gitbook ï¼Œcd åˆ° gitbook ï¼Œç„¶åï¼š
gitbook init - README.md: ä¹¦çš„ä»‹ç»æ–‡å­—ï¼Œå¦‚å‰è¨€ã€ç®€ä»‹ï¼Œåœ¨ç« èŠ‚ä¸­ä¹Ÿå¯åšä¸ºç« èŠ‚çš„ç®€ä»‹ã€‚ - SUMMARY.md: å®šåˆ¶ä¹¦ç±çš„ç« èŠ‚ç»“æ„å’Œé¡ºåºã€‚ å¼€å§‹ç¼–å†™ä½ çš„ç›®å½•åŠæ–‡ä»¶ å¦‚ä½ å¯ä»¥åœ¨ gitbook ä¸‹æ–°å»ºä¸€ä¸ª part01 ç›®å½•ä¸ README.md å’Œ SUMMARY.md åŒçº§ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹æ–°å»º md æ–‡ä»¶å³å¯ã€‚
SUMMARY.md æ–‡ä»¶ä½œä¸ºä¹¦ç±çš„ç›®å½•ç»“æ„:
#Summary - [Introduction](README.md) - Part I - [ç™»å½•æµç¨‹ä»‹ç»](part01/login.md) - [test01](part01/test01.md) - [test02 å‚è€ƒ](part01/test02.md) - [æ¦‚è§ˆ](part01/test.md) - [Test](part01/Test.</description>
			<content type="html"><![CDATA[<blockquote>
<p>å®Œæˆåçš„æˆæœé¢„è§ˆåœ°å€ï¼šhttps://zkbook.zam9.com/</p>
</blockquote>
<h3 id="å®‰è£…">å®‰è£…</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">npm install gitbook-cli -g
</code></pre></div><p>æŠ¥é”™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">npm WARN checkPermissions Missing write access to /usr/lib/node_modules
</code></pre></div><p>åŸå› ï¼šå®‰è£…å…¨å±€çš„åŒ…ï¼Œæ²¡æœ‰æƒé™</p>
<p>è§£å†³åŠæ³•ï¼šåœ¨å®‰è£…å‘½ä»¤å‰åŠ ä¸Š sudo ,è¾“å…¥ç”¨æˆ·çš„ç™»é™†å¯†ç ï¼Œæå‡æƒé™è¿›è¡Œå®‰è£…ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo npm install gitbook-cli -g
</code></pre></div><h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚ gitbook ï¼Œcd åˆ° gitbook ï¼Œç„¶åï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">gitbook init
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">- README.md: ä¹¦çš„ä»‹ç»æ–‡å­—ï¼Œå¦‚å‰è¨€ã€ç®€ä»‹ï¼Œåœ¨ç« èŠ‚ä¸­ä¹Ÿå¯åšä¸ºç« èŠ‚çš„ç®€ä»‹ã€‚
- SUMMARY.md: å®šåˆ¶ä¹¦ç±çš„ç« èŠ‚ç»“æ„å’Œé¡ºåºã€‚
</code></pre></div><h3 id="å¼€å§‹ç¼–å†™ä½ çš„ç›®å½•åŠæ–‡ä»¶">å¼€å§‹ç¼–å†™ä½ çš„ç›®å½•åŠæ–‡ä»¶</h3>
<p>å¦‚ä½ å¯ä»¥åœ¨ gitbook ä¸‹æ–°å»ºä¸€ä¸ª part01 ç›®å½•ä¸ README.md å’Œ SUMMARY.md åŒçº§ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹æ–°å»º md æ–‡ä»¶å³å¯ã€‚</p>
<p>SUMMARY.md  æ–‡ä»¶ä½œä¸ºä¹¦ç±çš„ç›®å½•ç»“æ„:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">#Summary</span>
    
- <span class="o">[</span>Introduction<span class="o">](</span>README.md<span class="o">)</span>
- Part I
    - <span class="o">[</span>ç™»å½•æµç¨‹ä»‹ç»<span class="o">](</span>part01/login.md<span class="o">)</span>
    - <span class="o">[</span>test01<span class="o">](</span>part01/test01.md<span class="o">)</span>
    - <span class="o">[</span>test02 å‚è€ƒ<span class="o">](</span>part01/test02.md<span class="o">)</span>
        - <span class="o">[</span>æ¦‚è§ˆ<span class="o">](</span>part01/test.md<span class="o">)</span>
        - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
        - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
        - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
- Part II
    - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
    - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
    - <span class="o">[</span>Test<span class="o">](</span>part01/Test.md<span class="o">)</span>
</code></pre></div><h3 id="é¢„è§ˆ">é¢„è§ˆ</h3>
<ul>
<li>æ‰§è¡Œå‘½ä»¤ gitbook serve ï¼Œgitbook ä¼šå¯åŠ¨ä¸€ä¸ª 4000 ç«¯å£ç”¨äºé¢„è§ˆã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">gitbook serve
</code></pre></div><ul>
<li>ç¬¬äºŒç§é¢„è§ˆæ–¹å¼ï¼Œè¿è¡Œ gitbook build å‘½ä»¤åä¼šåœ¨ä¹¦ç±çš„æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸€ä¸ª _book æ–‡ä»¶å¤¹, é‡Œé¢çš„å†…å®¹å³ä¸ºç”Ÿæˆçš„ html æ–‡ä»¶. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ¥ç”Ÿæˆç½‘é¡µè€Œä¸å¼€å¯æœåŠ¡å™¨ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">gitbook build
</code></pre></div><h3 id="å…³äºç”Ÿæˆé™æ€htmlä¾§è¾¹æ æ— æ³•ç‚¹å‡»é—®é¢˜">å…³äºç”Ÿæˆé™æ€HTMLä¾§è¾¹æ æ— æ³•ç‚¹å‡»é—®é¢˜</h3>
<p>ç™¾åº¦åˆ°çš„ç»“æœæ˜¯ï¼šä» 3.0.0 ç‰ˆèµ·, gitbook build ç”Ÿæˆçš„ website å°±ä¸æ”¯æŒ local æ‰“å¼€äº†, å¿…éœ€è¦ webserver å¼€å¯;å®åœ¨è¦å®Œå…¨é™æ€çš„, å°±å®‰è£… 2.6.7 ç‰ˆå§ã€‚ä½¿ç”¨2.6.7ç‰ˆæœ¬ï¼Œä¼šè‡ªåŠ¨å®‰è£…å¹¶ç”Ÿæˆï¼Œå·¦ä¾§ç›®å½•å¯ç‚¹å‡»ï¼ŒFirefoxã€Chromeæš‚æ— ä»»ä½•é—®é¢˜</p>
<p>è§£å†³åŠæ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">#ç”Ÿæˆå¯¹åº”ç‰ˆæœ¬çš„ï¼Œæœ¬åœ°æ— æ­¤ç‰ˆæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½</span>
gitbook build --gitbook<span class="o">=</span>2.6.7   
</code></pre></div><p>ä½†æ˜¯åˆç¢°åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">Error loading version latest: Error: Cannot find module <span class="s1">&#39;internal/util/types&#39;</span>
</code></pre></div><p>è§£å†³ï¼šå°† node ç‰ˆæœ¬é™ä½</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 1.å®‰è£…nodeç®¡ç† n</span>
sudo npm install -g n 

<span class="c1"># 2. é™ä½ç‰ˆæœ¬ï¼Œæ›´æ–°npm</span>
sudo n <span class="m">6</span>
sudo npm install npm -g

<span class="c1"># 3.æ­¤æ—¶è¿è¡Œgitbook2.6.7çš„å‘½ä»¤å³å¯ã€‚</span>
gitbook build --gitbook<span class="o">=</span>2.6.7

<span class="c1"># 4. å¾…è½¬æ¢å®Œæˆåï¼Œå°†npmç‰ˆæœ¬ï¼ˆä¾‹å¦‚9.10.0ï¼‰åˆ‡å›æ¥å³å¯,ä»¥å…å½±å“å…¶ä»–æ¨¡å—</span>
sudo n 8.16.1
</code></pre></div><h3 id="å…³äºä¾§è¾¹æ æŠ˜å é—®é¢˜å’Œåº•éƒ¨æ‰“èµåŠŸèƒ½">å…³äºä¾§è¾¹æ æŠ˜å é—®é¢˜å’Œåº•éƒ¨æ‰“èµåŠŸèƒ½</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">å¦‚æœæœ‰å¤šä¸ªç›®å½•ï¼ŒGitbook åœ¨æµè§ˆå™¨ä¸Šæ‰“å¼€æ—¶ï¼Œé»˜è®¤æ‰€æœ‰çš„ç›®å½•éƒ½ä¼šæ‰“å¼€ï¼Œå½“ç›®å½•æ¯”è¾ƒå¤šæ—¶ï¼Œå…¨éƒ¨æ˜¾ç¤ºä¸åˆ©äºé˜…è¯»ã€‚

å¯ä»¥ä½¿ç”¨æ’ä»¶é…ç½®ç›®å½•æŠ˜å ï¼Œä½¿å¾—æ‰“å¼€æµè§ˆå™¨æ—¶è¿™äº›ç›®å½•é»˜è®¤æ˜¯å…³é—­çš„ã€‚

åœ¨æ‰§è¡Œ gitbook init ä¸»ç›®å½•ä¸‹å¢åŠ  book.json æ–‡ä»¶åšå®šåˆ¶åŒ–é…ç½®
</code></pre></div><p>é…ç½®ç›®å½•æŠ˜å åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<pre><code class="language-smartyconfig" data-lang="smartyconfig">{
  &quot;plugins&quot;:[
    &quot;expandable-chapters&quot;,
    &quot;donate&quot;
  ],
  &quot;pluginsConfig&quot;: {
    &quot;donate&quot;: {
      &quot;wechat&quot;: &quot;https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/images/123444.png&quot;,
      &quot;alipay&quot;: &quot;https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/images/662.png&quot;,
      &quot;title&quot;: &quot;&quot;,
      &quot;button&quot;: &quot;Donate&quot;,
      &quot;alipayText&quot;: &quot;æ”¯ä»˜å®æèµ &quot;,
      &quot;wechatText&quot;: &quot;å¾®ä¿¡æèµ &quot;
    }
  }
}
</code></pre><p>ç„¶åï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">gitbook install
</code></pre></div><p>GitBookæ’ä»¶åœ°å€ï¼š<a href="https://plugins.gitbook.com/">https://plugins.gitbook.com/</a></p>
]]></content>
		</item>
		
		<item>
			<title>Laravelè§£å†³è·¨åŸŸè¯·æ±‚ğŸƒâ€</title>
			<link>http://hugo.zkilm.cn/posts/20190725-cross-request/</link>
			<pubDate>Thu, 25 Jul 2019 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20190725-cross-request/</guid>
			<description>ä»Šå¤©å…¬å¸å‰ç«¯çªç„¶è¯´è¯·æ±‚è·¨åŸŸäº†ï¼Œé‚£ä¹ˆå°±è§£å†³ä¸‹å’¯ï¼
åˆ›å»ºä¸­é—´ä»¶ é¦–å…ˆåˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶
php artisan make:middleware EnableCrossRequestMiddleware ç¼–å†™ä¸­é—´ä»¶ ç„¶ååœ¨ä¸­é—´ä»¶ EnableCrossRequestMiddleware.php ç¼–å†™
&amp;lt;?php namespace App\Http\Middleware; use Closure; class EnableCrossRequestMiddleware { /** * Handle an incoming request. * * @param \Illuminate\Http\Request $request * @param \Closure $next * @return mixed */ public function handle($request, Closure $next) { $response = $next($request); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Origin&amp;#39;, &amp;#39;*&amp;#39;); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Headers&amp;#39;, &amp;#39;Origin, Content-Type, Cookie, Accept&amp;#39;); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Methods&amp;#39;, &amp;#39;GET, POST, PATCH, PUT, OPTIONS&amp;#39;); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Credentials&amp;#39;, &amp;#39;true&amp;#39;); //essionå…±äº«çš„éœ€æ±‚æ‰ç”¨åˆ°  return $response; } } æ³¨å†Œä¸­é—´ä»¶ æ·»åŠ åˆ°å…¨å±€ä¸­é—´ä»¶ Kernel.</description>
			<content type="html"><![CDATA[<p>ä»Šå¤©å…¬å¸å‰ç«¯çªç„¶è¯´è¯·æ±‚è·¨åŸŸäº†ï¼Œé‚£ä¹ˆå°±è§£å†³ä¸‹å’¯ï¼</p>
<h3 id="åˆ›å»ºä¸­é—´ä»¶">åˆ›å»ºä¸­é—´ä»¶</h3>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php artisan make:middleware EnableCrossRequestMiddleware
</code></pre></div><h3 id="ç¼–å†™ä¸­é—´ä»¶">ç¼–å†™ä¸­é—´ä»¶</h3>
<p>ç„¶ååœ¨ä¸­é—´ä»¶ <code>EnableCrossRequestMiddleware.php</code> ç¼–å†™</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
    
<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EnableCrossRequestMiddleware</span>
<span class="p">{</span>
    <span class="sd">/**
</span><span class="sd">     * Handle an incoming request.
</span><span class="sd">     *
</span><span class="sd">     * @param  \Illuminate\Http\Request  $request
</span><span class="sd">     * @param  \Closure  $next
</span><span class="sd">     * @return mixed
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">);</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;Origin, Content-Type, Cookie, Accept&#39;</span><span class="p">);</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">,</span> <span class="s1">&#39;GET, POST, PATCH, PUT, OPTIONS&#39;</span><span class="p">);</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">);</span>  <span class="c1">//essionå…±äº«çš„éœ€æ±‚æ‰ç”¨åˆ°
</span><span class="c1"></span>        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="æ³¨å†Œä¸­é—´ä»¶">æ³¨å†Œä¸­é—´ä»¶</h3>
<p>æ·»åŠ åˆ°å…¨å±€ä¸­é—´ä»¶ <code>Kernel.php</code> ç»„ä¸­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">protected</span> <span class="nv">$middleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="nx">\App\Http\Middleware\EnableCrossRequestMiddleware</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="p">];</span>
</code></pre></div><p>å¯èƒ½ç¢°åˆ°çš„é—®é¢˜ï¼ˆiosä¸è¯†åˆ«*ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;Origin, Content-Type, Cookie, X-CSRF-TOKEN, Accept, Authorization, token&#39;</span><span class="p">);</span><span class="c1">// å¼€æ”¾å“ªäº›è‡ªå®šä¹‰å¤´(ios ä¸è¯†åˆ«*)
</span></code></pre></div><p>æˆ–è€…é€‰æ‹© laravel-cors  <a href="https://github.com/barryvdh/laravel-cors">https://github.com/barryvdh/laravel-cors</a></p>
<p>å‚è€ƒï¼š<a href="http://www.ptbird.cn/laravel-cors-to-cors-laravel-app.html">http://www.ptbird.cn/laravel-cors-to-cors-laravel-app.html</a></p>
]]></content>
		</item>
		
		<item>
			<title>å¾®ä¿¡çš„H5åˆ†äº«ï¼ˆåŸºäº Laravel-Wechatï¼‰ğŸ˜¶</title>
			<link>http://hugo.zkilm.cn/posts/20190610-wechat-h5/</link>
			<pubDate>Mon, 10 Jun 2019 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20190610-wechat-h5/</guid>
			<description>ä¸€ã€ç¼˜ç”± ä»€ä¹ˆéƒ½ä¸åšçš„æƒ…å†µä¸‹ï¼Œåœ¨å¾®ä¿¡åˆ†äº«H5é¡µé¢çš„æ—¶å€™ï¼Œåˆ†äº«åæ˜¯è¿™æ ·çš„ï¼š
ä½†æ˜¯ï¼Œç°åœ¨éœ€æ±‚æ˜¯ï¼Œåˆ†äº«åä¸ºä¸‹é¢è¿™æ ·ï¼š
æ²¡åŠæ³•ï¼Œè‡ªå·±å¼€å‘çš„H5è¦æƒ³åœ¨å¾®ä¿¡ä¸­è¿›è¡Œä¼ æ’­ï¼Œä½¿ç”¨å¾®ä¿¡ JSSDK æ˜¯å¿…ä¸å¯å°‘çš„ç¯èŠ‚ã€‚è€Œ JSSDK è™½ç„¶åªæ˜¯ä¸ª js ï¼Œå¯æ˜¯åŠ å¯†å¿…é¡»å¾—åœ¨æœåŠ¡ç«¯è¿›è¡Œã€‚
äºŒã€åŸºæœ¬æµç¨‹ 1.è®¾ç½®JSæ¥å£å®‰å…¨åŸŸå
è¿›å…¥å¾®ä¿¡å…¬ä¼—å·å¹³å° â€”&amp;gt; å…¬ä¼—å·è®¾ç½® â€”&amp;gt; åŠŸèƒ½è®¾ç½® â€”&amp;gt; JSæ¥å£å®‰å…¨åŸŸåï¼ˆ`test.zks.design`ï¼‰ è®¾ç½®çš„æ—¶å€™ï¼Œå¾®ä¿¡æœ‰æ•™ä½ å¦‚ä½•å»è®¾ç½®ï¼Œå°†ä¸‹è½½çš„æ–‡ä»¶ï¼ˆMP_verify_acUZIwvhxMREbXNt.txtï¼‰æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•å°±å¯ä»¥äº†ã€‚ 2.é…ç½®ä¸€ä¸ªåŸºç¡€ url ç”¨äºè·å– jssdk çš„ config å†…å®¹
ä½¿ç”¨çš„ url æ˜¯ http://test.zks.design/jssdkconfig
3.H5 é™æ€é¡µé¢å­˜æ”¾åœ¨ public/h5/ æ–‡ä»¶å¤¹ä¸‹
å› æ­¤åœ¨è®¿é—® H5 çš„æ—¶å€™ï¼Œéœ€è¦è®¿é—®åŸŸå `http://test.zks.design/h5/xxxx/` å› ä¸º H5 ä¸»è¦æ˜¯åˆ†äº«ï¼Œè€Œä¸æ˜¯åŸŸåè®¿é—®ï¼Œå› æ­¤è¿™ä¸ªåŸŸåæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ H5 å‡ç›´æ¥å†™é™æ€é¡µé¢ï¼Œå¹¶ä¸ä½¿ç”¨ laravel çš„ blade æ¨¡æ¿å»å†™H5ã€‚ 4.é€šè¿‡ ajax è·å– config é…ç½®
åœ¨éœ€è¦è°ƒç”¨åˆ†äº«çš„é¡µé¢ä¸Šï¼Œè¿›è¡Œ config é…ç½®çš„æ—¶å€™ï¼Œé¦–å…ˆé€šè¿‡ ajax å°†åŸºæœ¬å‚æ•°ä¼ é€ç»™æœåŠ¡ç«¯urlï¼ˆ`http://test.zks.design/jssdkconfig`ï¼‰ã€‚ ä¸€äº›éœ€è¦çš„å‚æ•°å¯èƒ½å¦‚ä¸‹ï¼š å¯ä»¥å‚ç…§ EasyWechat çš„æ–‡æ¡£ https://www.easywechat.com/docs/4.1/basic-services/jssdk å…¶ä¸­å»ºè®® $app-&amp;gt;jssdk-&amp;gt;setUrl($url) è®¾ç½®å½“å‰URL ä¸€å®šæ˜¯è‡ªå·±å‰ç«¯çš„é¡µé¢çš„ urlã€‚ 5.å°†è·å–åˆ°çš„ config ç›´æ¥æ”¾åœ¨ js ä¸­</description>
			<content type="html"><![CDATA[<h3 id="ä¸€ç¼˜ç”±">ä¸€ã€ç¼˜ç”±</h3>
<p>ä»€ä¹ˆéƒ½ä¸åšçš„æƒ…å†µä¸‹ï¼Œåœ¨å¾®ä¿¡åˆ†äº«H5é¡µé¢çš„æ—¶å€™ï¼Œåˆ†äº«åæ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/static/h5_before.png" alt="Before"></p>
<p>ä½†æ˜¯ï¼Œç°åœ¨éœ€æ±‚æ˜¯ï¼Œåˆ†äº«åä¸ºä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/static/h5_after.png" alt="After"></p>
<p>æ²¡åŠæ³•ï¼Œè‡ªå·±å¼€å‘çš„H5è¦æƒ³åœ¨å¾®ä¿¡ä¸­è¿›è¡Œä¼ æ’­ï¼Œä½¿ç”¨å¾®ä¿¡ JSSDK æ˜¯å¿…ä¸å¯å°‘çš„ç¯èŠ‚ã€‚è€Œ JSSDK è™½ç„¶åªæ˜¯ä¸ª js ï¼Œå¯æ˜¯åŠ å¯†å¿…é¡»å¾—åœ¨æœåŠ¡ç«¯è¿›è¡Œã€‚</p>
<h3 id="äºŒåŸºæœ¬æµç¨‹">äºŒã€åŸºæœ¬æµç¨‹</h3>
<p><strong>1.è®¾ç½®JSæ¥å£å®‰å…¨åŸŸå</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">è¿›å…¥å¾®ä¿¡å…¬ä¼—å·å¹³å° â€”&gt; å…¬ä¼—å·è®¾ç½® â€”&gt;  åŠŸèƒ½è®¾ç½® â€”&gt;  JSæ¥å£å®‰å…¨åŸŸåï¼ˆ`test.zks.design`ï¼‰

è®¾ç½®çš„æ—¶å€™ï¼Œå¾®ä¿¡æœ‰æ•™ä½ å¦‚ä½•å»è®¾ç½®ï¼Œå°†ä¸‹è½½çš„æ–‡ä»¶ï¼ˆMP_verify_acUZIwvhxMREbXNt.txtï¼‰æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•å°±å¯ä»¥äº†ã€‚
</code></pre></div><p><strong>2.é…ç½®ä¸€ä¸ªåŸºç¡€ url ç”¨äºè·å– jssdk çš„ config å†…å®¹</strong></p>
<p>ä½¿ç”¨çš„ url æ˜¯ <code>http://test.zks.design/jssdkconfig</code></p>
<p><strong>3.H5 é™æ€é¡µé¢å­˜æ”¾åœ¨ public/h5/ æ–‡ä»¶å¤¹ä¸‹</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">å› æ­¤åœ¨è®¿é—® H5 çš„æ—¶å€™ï¼Œéœ€è¦è®¿é—®åŸŸå `http://test.zks.design/h5/xxxx/`

å› ä¸º H5 ä¸»è¦æ˜¯åˆ†äº«ï¼Œè€Œä¸æ˜¯åŸŸåè®¿é—®ï¼Œå› æ­¤è¿™ä¸ªåŸŸåæ²¡ä»€ä¹ˆé—®é¢˜ã€‚

H5 å‡ç›´æ¥å†™é™æ€é¡µé¢ï¼Œå¹¶ä¸ä½¿ç”¨ laravel çš„ blade æ¨¡æ¿å»å†™H5ã€‚
</code></pre></div><p><strong>4.é€šè¿‡ ajax è·å– config é…ç½®</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">åœ¨éœ€è¦è°ƒç”¨åˆ†äº«çš„é¡µé¢ä¸Šï¼Œè¿›è¡Œ config é…ç½®çš„æ—¶å€™ï¼Œé¦–å…ˆé€šè¿‡ ajax å°†åŸºæœ¬å‚æ•°ä¼ é€ç»™æœåŠ¡ç«¯urlï¼ˆ`http://test.zks.design/jssdkconfig`ï¼‰ã€‚

ä¸€äº›éœ€è¦çš„å‚æ•°å¯èƒ½å¦‚ä¸‹ï¼š

å¯ä»¥å‚ç…§ EasyWechat çš„æ–‡æ¡£ https://www.easywechat.com/docs/4.1/basic-services/jssdk

å…¶ä¸­å»ºè®® $app-&gt;jssdk-&gt;setUrl($url) è®¾ç½®å½“å‰URL ä¸€å®šæ˜¯è‡ªå·±å‰ç«¯çš„é¡µé¢çš„ urlã€‚
</code></pre></div><p><strong>5.å°†è·å–åˆ°çš„ config ç›´æ¥æ”¾åœ¨ js ä¸­</strong></p>
<p>åœ¨H5é¡µé¢å¼•å…¥jsæ–‡ä»¶ï¼Œå¦åˆ™ wx.config ä¹‹ç±»æ— æ³•ä½¿ç”¨ï¼šhttp://res.wx.qq.com/open/js/jweixin-1.4.0.js</p>
<h3 id="ä¸‰å®ç°">ä¸‰ã€å®ç°</h3>
<p><strong>1ã€å®‰è£…å¹¶é…ç½® laravel-wechat</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">composer require <span class="s2">&#34;overtrue/laravel-wechat:~4.0&#34;</span>
</code></pre></div><p>å¹¶å‘å¸ƒé…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php artisan vendor:publish --provider<span class="o">=</span><span class="s2">&#34;Overtrue\LaravelWeChat\ServiceProvider&#34;</span>
</code></pre></div><p><strong>2.å®ç°æœåŠ¡å™¨ token éªŒè¯é€»è¾‘(åªæ˜¯åˆ†äº«çš„è¯ï¼Œè¿™æ­¥å¯ä»¥é€‰æ‹©çœç•¥)</strong></p>
<p>è¦å®ç°æœåŠ¡å™¨ token éªŒè¯ï¼Œé™¤äº†å¡«å†™å¾®ä¿¡å…¬ä¼—å·çš„é…ç½®ä¹‹å¤–ï¼Œè¿˜éœ€è¦é…ç½® config/wechat.phpã€‚å…ˆåœ¨æœåŠ¡å™¨ä»£ç å¡«å†™tokenå’ŒEncodingAESKeyï¼ˆtokenè‡ªå·±éšä¾¿å¡«ï¼‰ï¼Œç„¶åå†åœ¨å…¬ä¼—å·æœåŠ¡å™¨é…ç½®å¤„ç‚¹å‡»æäº¤ï¼ˆæ³¨æ„ä¸¤å¤„tokenä¿æŒä¸€è‡´ï¼‰</p>
<p>ä¹‹åæ˜¯éœ€è¦å¯¹ <code>http://test.zks.design/wechat </code>è¿›è¡Œç¼–ç å®ŒæˆéªŒè¯ã€‚ï¼ˆè¿™é‡Œä¸æ¶‰åŠæ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¹Ÿåœ¨è¿™é‡Œé¢è½¬å‘æˆ–å¤„ç†å³å¯ï¼‰ã€‚</p>
<p>è·¯ç”±æˆ‘æ˜¯ç›´æ¥é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// å¾®ä¿¡æ–¹é¢çš„è·¯ç”±
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">namespace</span><span class="p">(</span><span class="s2">&#34;Wechat&#34;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="k">function</span><span class="p">(){</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">any</span><span class="p">(</span><span class="s1">&#39;/wechat&#39;</span><span class="p">,</span><span class="s1">&#39;WechatController@index&#39;</span><span class="p">);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">any</span><span class="p">(</span><span class="s1">&#39;/jssdkconfig&#39;</span><span class="p">,</span><span class="s1">&#39;WechatController@getJSSDKConfig&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div><p>Wechatæ§åˆ¶å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php artisan make:controller Wechat/WechatController
</code></pre></div><p>å…¶ä¸­ index å‡½æ•°å¦‚ä¸‹ï¼š</p>
<p>éå¸¸ç®€å•ï¼Œè¿™ä¸ªå®Œæˆä¹‹åï¼Œå°±èƒ½å¤Ÿå®ç°å¾®ä¿¡å…¬ä¼—å·çš„ token è®¤è¯ ï¼ˆæ³¨æ„ï¼Œéœ€è¦å¯¹ config/wechat é…ç½®å’Œå…¬ä¼—å·çš„ç›¸å…³å‚æ•°åŒ¹é…æ­£ç¡®æ‰è¡Œ ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// tokenè®¤è¯åŠä¿¡æ¯ä¼ è¾“
</span><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(){</span>
    <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;request arrived.&#39;</span><span class="p">);</span>
    <span class="nv">$app</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;wechat.official_account&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">serve</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div><p><strong>3.å®ç° jssdkConfig ä¿¡æ¯è·å–çš„é€»è¾‘</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// è·å–jssdké…ç½®
</span><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">getJSSDKConfig</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">){</span>
    <span class="c1">// dump(explode(&#39;,&#39;,$request-&gt;get(&#39;apis&#39;)));
</span><span class="c1"></span>    <span class="nv">$arr</span> <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;apis&#39;</span><span class="p">));</span>
    <span class="nv">$debug</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span> <span class="o">===</span><span class="s1">&#39;true&#39;</span> <span class="o">?</span> <span class="k">true</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
    <span class="nv">$json</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span> <span class="o">===</span><span class="s1">&#39;true&#39;</span> <span class="o">?</span> <span class="k">true</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
    <span class="nv">$url</span> <span class="o">=</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">);</span>
    <span class="c1">//dump($request-&gt;get(&#39;url&#39;));
</span><span class="c1"></span>    <span class="c1">// check
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$url</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;status&#39;</span><span class="o">=&gt;</span><span class="k">false</span><span class="p">,</span><span class="s1">&#39;msg&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;params error&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="nv">$app</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="s1">&#39;wechat.official_account&#39;</span><span class="p">);</span>
    <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">jssdk</span><span class="o">-&gt;</span><span class="na">setUrl</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
    <span class="nv">$config</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">jssdk</span><span class="o">-&gt;</span><span class="na">buildConfig</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span><span class="nv">$debug</span><span class="p">,</span><span class="nv">$json</span><span class="p">,</span><span class="nv">$url</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨äº† GET çš„è¯·æ±‚æ–¹å¼ã€‚</p>
<p>åŒæ—¶ä¸»è¦çš„å‚æ•°æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">- apisï¼š éœ€è¦ä½¿ç”¨çš„æ¥å£åˆ—è¡¨ ä¼ å…¥æ ¼å¼ä¸º &#34;onMenuShareTimeline,onMenuShareAppMessage&#34; è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿åˆ†å‰²æˆæ•°ç»„
- debugï¼šä¼ å…¥çš„æ˜¯å­—ç¬¦çš„ true æˆ–è€… false
- jsonï¼šä¼ å…¥çš„æ˜¯å­—ç¬¦çš„ true æˆ–è€… false ï¼ˆè¡¨ç¤ºç”Ÿæˆçš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥å‚è€ƒ easyWechat çš„æ–‡æ¡£ï¼‰
- urlï¼šéœ€è¦åŠ å¯†çš„ url ï¼ˆä¼ å…¥çš„æ—¶å€™å¿…é¡»å°† &amp; è¿›è¡Œæ›¿æ¢ï¼Œå¦åˆ™ä¼šé€ æˆ config å¤±è´¥ 
</code></pre></div><p><strong>4.js è·å– config æ•°æ®</strong></p>
<p>åœ¨ H5 ä¸­ç›´æ¥ä½¿ç”¨ config çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨ js ä¸­é€šè¿‡ ajax è¯·æ±‚ url è·å–configå†…å®¹ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢æˆ‘ä½¿ç”¨çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span><span class="o">&gt;</span>
<span class="kd">function</span> <span class="nx">getjssdkconfig</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">shareLinkUlr</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;#&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// è·å–å½“å‰çš„url å»æ‰ # ä¹‹åçš„éƒ¨åˆ†
</span><span class="c1"></span>        <span class="nx">shareLinkUlr</span> <span class="o">=</span> <span class="nx">shareLinkUlr</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\&amp;/g</span><span class="p">,</span> <span class="s1">&#39;%26&#39;</span><span class="p">);</span> <span class="c1">// å°† &amp; æ›¿æ¢æˆ %26
</span><span class="c1"></span>
        <span class="kd">var</span> <span class="nx">apis</span><span class="o">=</span><span class="s2">&#34;onMenuShareTimeline,onMenuShareAppMessage&#34;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">debug</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">json</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">link</span><span class="o">=</span><span class="nx">shareLinkUlr</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="s2">&#34;apis=&#34;</span><span class="o">+</span><span class="nx">apis</span><span class="o">+</span><span class="s2">&#34;&amp;debug=&#34;</span><span class="o">+</span><span class="nx">debug</span><span class="o">+</span><span class="s2">&#34;&amp;json=&#34;</span><span class="o">+</span><span class="nx">json</span><span class="o">+</span><span class="s2">&#34;&amp;url=&#34;</span><span class="o">+</span><span class="nx">link</span><span class="p">;</span> <span class="c1">// æ‹¼æ¥ get å‚æ•°
</span><span class="c1"></span>        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;get&#39;</span><span class="p">,</span>
            <span class="nx">url</span><span class="o">:</span><span class="s1">&#39;http://test-api.zam9.com/api/jssdkconfig?&#39;</span><span class="o">+</span><span class="nx">data</span><span class="p">,</span>
            <span class="nx">success</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">configJsSDKAndDoSomething</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">configJsSDKAndDoSomething</span><span class="p">(</span><span class="nx">config</span><span class="p">){</span>
        <span class="nx">wx</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
        <span class="nx">wx</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// å…¶ä»–çš„ä¸€äº›æ“ä½œ
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;æ—å’Œæˆ35é€±å¹´å¹¸é‹å¤§è½‰è¼ª&#39;</span><span class="p">,</span> <span class="c1">// åˆ†äº«æ ‡é¢˜
</span><span class="c1"></span>                <span class="nx">link</span><span class="o">:</span> <span class="s1">&#39;http://test.zam9.com&#39;</span><span class="p">,</span> <span class="c1">// åˆ†äº«é“¾æ¥ï¼Œè®°å¾—ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œä¸èƒ½ç”¨document.URL
</span><span class="c1"></span>                <span class="nx">imgUrl</span><span class="o">:</span> <span class="s1">&#39;http://test.zam9.com/images/ettason-share.jpg&#39;</span><span class="p">,</span> <span class="c1">// åˆ†äº«å›¾æ ‡
</span><span class="c1"></span>                <span class="nx">desc</span><span class="o">:</span> <span class="s1">&#39;2019 Ettason 35th Anniversary Lucky Draw for WeChat&#39;</span><span class="p">,</span> <span class="c1">// åˆ†äº«æè¿°
</span><span class="c1"></span>                <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;åˆ†äº«æˆåŠŸï¼&#39;</span><span class="p">);</span>
                    <span class="c1">// ç”¨æˆ·ç¡®è®¤åˆ†äº«åæ‰§è¡Œçš„å›è°ƒå‡½æ•°
</span><span class="c1"></span>                <span class="p">},</span>
                <span class="nx">cancel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;å–æ¶ˆåˆ†äº«ï¼&#39;</span><span class="p">);</span>
                    <span class="c1">// ç”¨æˆ·å–æ¶ˆåˆ†äº«åæ‰§è¡Œçš„å›è°ƒå‡½æ•°
</span><span class="c1"></span>                <span class="p">}</span>
            <span class="p">};</span>
            <span class="nx">wx</span><span class="p">.</span><span class="nx">onMenuShareTimeline</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span> <span class="c1">// åˆ†äº«åˆ°æœ‹å‹åœˆ
</span><span class="c1"></span>            <span class="nx">wx</span><span class="p">.</span><span class="nx">onMenuShareAppMessage</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span> <span class="c1">// åˆ†äº«ç»™æœ‹å‹
</span><span class="c1"></span>        <span class="p">});</span>
        <span class="cm">/*wx.error(function(error){
</span><span class="cm">            console.log(error);
</span><span class="cm">        });*/</span>
    <span class="p">}</span>

    <span class="c1">// é¡µé¢åŠ è½½å®Œä¹‹åè¿›è¡Œæ“ä½œ
</span><span class="c1"></span>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// æ³¨æ„è¿™é‡Œçš„å‚æ•°
</span><span class="c1"></span>        <span class="c1">// apis ä½¿ç”¨çš„å‚æ•°æ˜¯ å­—ç¬¦ä¸²çš„æ‹¼æ¥ è¿™ä¸ªæ˜¯å’Œ php çš„æ–¹æ³•ä¸­çš„å¤„ç†ç›¸å¯¹åº”çš„
</span><span class="c1"></span>        <span class="nx">getjssdkconfig</span><span class="p">();</span>
    <span class="p">});</span>

<span class="o">&lt;</span><span class="err">/script&gt;</span>
</code></pre></div><h3 id="å››å…³é”®çš„å‡ ç‚¹">å››ã€å…³é”®çš„å‡ ç‚¹</h3>
<p><strong>1ã€JSON.parse()</strong></p>
<p>åœ¨æ‹¿åˆ°è¿”å›çš„ json æ•°æ®ä¹‹åï¼Œéœ€è¦ JSON.parse()ï¼Œå¦åˆ™æ˜¯ä¸æ­£ç¡®çš„ js å¯¹è±¡ï¼ŒæŠ¥ config:fail é”™è¯¯</p>
<p><strong>2ã€åˆ†äº«å‡ºå»çš„é“¾æ¥ç‚¹å‡»ä¹‹åé…ç½®å¤±è´¥</strong></p>
<p>è¿™ä¸ªä¸»è¦æ˜¯å› ä¸ºåˆ†äº«å‡ºå»ä¹‹åï¼Œç”±äºå¾®ä¿¡åŠ äº†å‡ ä¸ªå‚æ•°ï¼Œå¯¼è‡´å­˜åœ¨é—®é¢˜ã€‚</p>
<p>ç½‘ä¸Šå­˜åœ¨è§£å†³æ–¹æ¡ˆå°±æ˜¯ å°† &amp; è¿›è¡Œæ›¿æ¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">shareLinkUlr</span> <span class="o">=</span> shareLinkUlr.replace<span class="o">(</span>/<span class="se">\&amp;</span>/g, <span class="s1">&#39;%26&#39;</span><span class="o">)</span><span class="p">;</span> // å°† <span class="p">&amp;</span> æ›¿æ¢æˆ %26 
</code></pre></div><p><strong>3.jsapiListä¸ºç©ºå¹¶ä¸å½±å“åˆ†äº«åŠŸèƒ½ï¼Œåªè¦configä¸ºokå³å¯ã€‚</strong></p>
<h3 id="äº”æ€»ç»“">äº”ã€æ€»ç»“</h3>
<p>å…¶å®å°±æ˜¯åç«¯ç»™ä¸ªæ¥å£ï¼Œè¿”å›å¾®ä¿¡é…ç½®æä¾›ç»™å‰ç«¯å°±å®Œäº‹äº†ã€‚ğŸ˜œ</p>
]]></content>
		</item>
		
		<item>
			<title>PHPOfficeä¹‹ExcelğŸœ</title>
			<link>http://hugo.zkilm.cn/posts/20190320-phpoffice-excel/</link>
			<pubDate>Wed, 20 Mar 2019 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20190320-phpoffice-excel/</guid>
			<description>å¯¼è¯­  ç®€å•çš„æ•°æ®å¯¼å…¥å¯¼å‡ºå…¶å® Maatwebsite/Laravel-Excel å’Œ box/spout å°±å¤Ÿäº†ï¼Œå¬è¯´spoutåœ¨å¤§é‡æ•°æ®ä¸‹æ•ˆç‡è¾ƒLaravel-Excel å¿«ã€‚è¿™æ¬¡å› ä¸ºè¦æ ¹æ®Excelæ¨¡æ¿å¯¼å‡ºï¼Œåœ¨è¿™ä¸¤ä¸ªåŒ…æ²¡æ‰¾åˆ°æ€ä¹ˆå¼•å…¥æ¨¡æ¿çš„æ–¹æ³•ï¼Œè™½ç„¶å¯ä»¥è®¾ç½®ï¼Œä½†æ˜¯è¿‡äºéº»çƒ¦ï¼Œå°±æ”¾å¼ƒäº†ã€‚æœ€ç»ˆé€‰æ‹©äº† PHPOffice/PhpSpreadsheet ã€‚
  PhpSpreadsheetæ˜¯ä¸€ä¸ªç”¨çº¯PHPç¼–å†™çš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç±»ï¼Œå…è®¸æ‚¨è¯»å–å’Œå†™å…¥ä¸åŒçš„ç”µå­è¡¨æ ¼æ–‡ä»¶æ ¼å¼ï¼Œå¦‚Excelå’ŒLibreOffice Calcã€‚
 PhpSpreadsheetæ–‡æ¡£ä¼ é€é—¨
å®‰è£… composer require phpoffice/phpspreadsheet ä½¿ç”¨ &amp;lt;?php namespace App\Http\Controllers; use Illuminate\Http\Request; use App\Models\TreasureLog; use Carbon\Carbon; use Illuminate\Support\Facades\Auth; use PhpOffice\PhpSpreadsheet\Spreadsheet; use PhpOffice\PhpSpreadsheet\Writer\Xlsx; //å¯ä»¥ç”Ÿæˆå¤šç§æ ¼å¼ç±» use PhpOffice\PhpSpreadsheet\IOFactory; use PhpOffice\PhpSpreadsheet\Style\Alignment; use PhpOffice\PhpSpreadsheet\Style\Border; class TestController extends Controller{ . . public function excelExport() { $rows=TreasureLog::select(&amp;#39;id&amp;#39;,&amp;#39;user_id&amp;#39;,&amp;#39;product_id&amp;#39;,&amp;#39;product_name&amp;#39;,&amp;#39;type&amp;#39;,&amp;#39;coin_type&amp;#39;)-&amp;gt;limit(100)-&amp;gt;get()-&amp;gt;toArray(); //é€šè¿‡å·¥å‚æ¨¡å¼åˆ›å»ºå†…å®¹  $spreadsheet = IOFactory::load(public_path().&amp;#39;/phpoffice/biser.xlsx&amp;#39;); $worksheet = $spreadsheet-&amp;gt;getActiveSheet(); $worksheet-&amp;gt;setCellValue(&amp;#39;B8&amp;#39;,rand(100000,999999)); $worksheet-&amp;gt;setCellValue(&amp;#39;B9&amp;#39;,Carbon::now()); $worksheet-&amp;gt;setCellValue(&amp;#39;B10&amp;#39;,Auth::user()-&amp;gt;name); $num=12; foreach ($rows as $row){ $num++; $worksheet-&amp;gt;setCellValue(&amp;#39;A&amp;#39;.</description>
			<content type="html"><![CDATA[<h3 id="å¯¼è¯­">å¯¼è¯­</h3>
<blockquote>
<p>ç®€å•çš„æ•°æ®å¯¼å…¥å¯¼å‡ºå…¶å® <a href="https://github.com/Maatwebsite">Maatwebsite/Laravel-Excel</a> å’Œ <a href="https://github.com/box">box/spout</a> å°±å¤Ÿäº†ï¼Œå¬è¯´<code>spout</code>åœ¨å¤§é‡æ•°æ®ä¸‹æ•ˆç‡è¾ƒ<code>Laravel-Excel</code> å¿«ã€‚è¿™æ¬¡å› ä¸ºè¦æ ¹æ®<code>Excel</code>æ¨¡æ¿å¯¼å‡ºï¼Œåœ¨è¿™ä¸¤ä¸ªåŒ…æ²¡æ‰¾åˆ°æ€ä¹ˆå¼•å…¥æ¨¡æ¿çš„æ–¹æ³•ï¼Œè™½ç„¶å¯ä»¥è®¾ç½®ï¼Œä½†æ˜¯è¿‡äºéº»çƒ¦ï¼Œå°±æ”¾å¼ƒäº†ã€‚æœ€ç»ˆé€‰æ‹©äº† <code>PHPOffice/PhpSpreadsheet</code> ã€‚</p>
</blockquote>
<blockquote>
<p><a href="https://github.com/PHPOffice/PhpSpreadsheet">PhpSpreadsheet</a>æ˜¯ä¸€ä¸ªç”¨çº¯PHPç¼–å†™çš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç±»ï¼Œå…è®¸æ‚¨è¯»å–å’Œå†™å…¥ä¸åŒçš„ç”µå­è¡¨æ ¼æ–‡ä»¶æ ¼å¼ï¼Œå¦‚Excelå’ŒLibreOffice Calcã€‚</p>
</blockquote>
<p><a href="https://phpoffice.github.io/PhpSpreadsheet/master/PhpOffice.html">PhpSpreadsheetæ–‡æ¡£ä¼ é€é—¨</a></p>
<p><img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/promise/post/excel_template.jpg" alt="Excelæ¨¡æ¿æ•ˆæœå›¾"></p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">composer require phpoffice/phpspreadsheet
</code></pre></div><h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
    
<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\TreasureLog</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\Spreadsheet</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\Writer\Xlsx</span><span class="p">;</span>
<span class="c1">//å¯ä»¥ç”Ÿæˆå¤šç§æ ¼å¼ç±»
</span><span class="c1"></span><span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\IOFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\Style\Alignment</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PhpOffice\PhpSpreadsheet\Style\Border</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TestController</span> <span class="k">extends</span> <span class="nx">Controller</span><span class="p">{</span>
        <span class="o">.</span>
        <span class="o">.</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">excelExport</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$rows</span><span class="o">=</span><span class="nx">TreasureLog</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span><span class="s1">&#39;product_name&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;coin_type&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
        <span class="c1">//é€šè¿‡å·¥å‚æ¨¡å¼åˆ›å»ºå†…å®¹
</span><span class="c1"></span>        <span class="nv">$spreadsheet</span> <span class="o">=</span> <span class="nx">IOFactory</span><span class="o">::</span><span class="na">load</span><span class="p">(</span><span class="nx">public_path</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39;/phpoffice/biser.xlsx&#39;</span><span class="p">);</span>
        <span class="nv">$worksheet</span> <span class="o">=</span> <span class="nv">$spreadsheet</span><span class="o">-&gt;</span><span class="na">getActiveSheet</span><span class="p">();</span>
        <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;B8&#39;</span><span class="p">,</span><span class="nx">rand</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">999999</span><span class="p">));</span>
        <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;B9&#39;</span><span class="p">,</span><span class="nx">Carbon</span><span class="o">::</span><span class="na">now</span><span class="p">());</span>
        <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;B10&#39;</span><span class="p">,</span><span class="nx">Auth</span><span class="o">::</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>
        <span class="nv">$num</span><span class="o">=</span><span class="mi">12</span><span class="p">;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$rows</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">){</span>
            <span class="nv">$num</span><span class="o">++</span><span class="p">;</span>
            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]);</span>
            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]);</span>
            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;product_name&#39;</span><span class="p">]);</span>
            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]);</span>
            <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">setCellValue</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">,</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;coin_type&#39;</span><span class="p">]);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">){</span>
                <span class="nv">$styleArray</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;borders&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                        <span class="s1">&#39;outline&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                            <span class="s1">&#39;borderStyle&#39;</span> <span class="o">=&gt;</span> <span class="nx">Border</span><span class="o">::</span><span class="na">BORDER_THIN</span><span class="p">,</span>
                            <span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;argb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;00000000&#39;</span><span class="p">],</span>                        <span class="p">],</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;alignment&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                        <span class="s1">&#39;horizontal&#39;</span> <span class="o">=&gt;</span> <span class="nx">Alignment</span><span class="o">::</span><span class="na">HORIZONTAL_CENTER</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">];</span>
                <span class="nv">$styleArray_</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;borders&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                        <span class="s1">&#39;outline&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                            <span class="s1">&#39;borderStyle&#39;</span> <span class="o">=&gt;</span> <span class="nx">Border</span><span class="o">::</span><span class="na">BORDER_THIN</span><span class="p">,</span>
                            <span class="s1">&#39;color&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;argb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;00000000&#39;</span><span class="p">],</span>                        <span class="p">],</span>
                    <span class="p">],</span>
                <span class="p">];</span>
                <span class="c1">//è®¾ç½®è¶…å‡ºéƒ¨åˆ†æ ·å¼
</span><span class="c1"></span>                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">mergeCells</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:C&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray</span><span class="p">);</span>
                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">mergeCells</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:E&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray</span><span class="p">);</span>
                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">mergeCells</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:G&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray</span><span class="p">);</span>
                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">mergeCells</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:I&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray</span><span class="p">);</span>
                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray_</span><span class="p">);</span>
                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">getRowDimension</span><span class="p">(</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setRowHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
                <span class="nv">$worksheet</span><span class="o">-&gt;</span><span class="na">getStyle</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="o">.</span><span class="s1">&#39;:J&#39;</span><span class="o">.</span><span class="nv">$num</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">applyFromArray</span><span class="p">(</span><span class="nv">$styleArray_</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nv">$filename</span> <span class="o">=</span> <span class="nx">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nx">time</span><span class="p">())</span><span class="o">.</span><span class="nx">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">9999</span><span class="p">)</span><span class="o">.</span> <span class="s2">&#34;.xlsx&#34;</span><span class="p">;</span>
        <span class="c1">//ç¬¬ä¸€ç§ä¿å­˜æ–¹å¼
</span><span class="c1"></span>       <span class="cm">/* $writer = new Xlsx($spreadsheet);//å†™å…¥ç±»å‹å¯¹è±¡
</span><span class="cm">        $filename=public_path().&#39;/phpoffice/&#39;.$filename;//æ–‡ä»¶è·¯å¾„
</span><span class="cm">        $writer-&gt;save($filename);//å†™å…¥*/</span>

        <span class="c1">//ç¬¬äºŒç§ç›´æ¥é¡µé¢ä¸Šæ˜¾ç¤ºä¸‹è½½
</span><span class="c1"></span>        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#39;</span><span class="p">);</span>
        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Disposition: attachment;filename=&#34;&#39;</span><span class="o">.</span><span class="nv">$filename</span> <span class="o">.</span> <span class="s1">&#39;.xlsx&#34;&#39;</span><span class="p">);</span>
        <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Cache-Control: max-age=0&#39;</span><span class="p">);</span>
        <span class="c1">//æ³¨æ„createWriter($spreadsheet, &#39;Xls&#39;) ç¬¬äºŒä¸ªå‚æ•°é¦–å­—æ¯å¿…é¡»å¤§å†™
</span><span class="c1"></span>        <span class="nv">$writer</span> <span class="o">=</span> <span class="nx">IOFactory</span><span class="o">::</span><span class="na">createWriter</span><span class="p">(</span><span class="nv">$spreadsheet</span><span class="p">,</span> <span class="s1">&#39;Xlsx&#39;</span><span class="p">);</span>
        <span class="nv">$writer</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="s1">&#39;php://output&#39;</span><span class="p">);</span>

<span class="c1">//        return response(json_encode([&#39;status&#39;=&gt;1,&#39;msg&#39;=&gt;&#39;å¯¼å‡ºæˆåŠŸ&#39;,&#39;data&#39;=&gt;$rows]));//ajax
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="o">.</span>
    <span class="o">.</span>
<span class="p">}</span>
</code></pre></div><h3 id="æ•ˆæœ">æ•ˆæœ</h3>
<p><img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/promise/post/excel_result.jpg" alt="å®Œæˆæ•ˆæœå›¾"></p>
<h3 id="ç»“æŸè¯­">ç»“æŸè¯­</h3>
<blockquote>
<p>æ‘†è„±æ‚²è§‚ï¼Œæ‹¥æŠ±æ»¡æº¢è€Œå‡ºçš„å¸Œæœ›ï¼Œæœç€æ¢¦æƒ³ï¼Œå‡†å¤‡å‡ºå‘ã€‚ğŸ€</p>
</blockquote>
<p>å‚è€ƒï¼š</p>
<p><a href="http://www.heibaiketang.com/blog/show/69.html">http://www.heibaiketang.com/blog/show/69.html</a></p>
<p><a href="https://blog.csdn.net/gc258_2767_qq/article/details/81003656">https://blog.csdn.net/gc258_2767_qq/article/details/81003656</a></p>
]]></content>
		</item>
		
		<item>
			<title>ä½¿ç”¨LaravelS</title>
			<link>http://hugo.zkilm.cn/posts/20181228-laravel-swoole/</link>
			<pubDate>Fri, 28 Dec 2018 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20181228-laravel-swoole/</guid>
			<description>Laravels ä»‹ç»  LaravelSæ˜¯ä¸€ä¸ªèƒ¶æ°´é¡¹ç›®ï¼Œç”¨äºå¿«é€Ÿé›†æˆSwooleåˆ°Laravelæˆ–Lumenï¼Œç„¶åèµ‹äºˆå®ƒä»¬æ›´å¥½çš„æ€§èƒ½ã€æ›´å¤šå¯èƒ½æ€§ã€‚ åœ¨ä½¿ç”¨laravelsä¹‹å‰ï¼Œå¿…é¡»å…ˆè£…ä¸Šswooleçš„æ‰©å±•ã€‚
 swooleæ–‡æ¡£ï¼šhttps://wiki.swoole.com/wiki/index/prid-1
laravesæ–‡æ¡£ï¼šhttps://github.com/hhxsv5/laravel-s
ç¯å¢ƒï¼šåœ¨VMwareè™šæ‹Ÿæœºä¸­è‡ªå·±æ­çš„ç¯å¢ƒï¼ŒCentos7ï¼ŒPHP7.2.12ï¼ŒNginx1.14.2ï¼ŒMySQL 5.5.60ã€‚
å®‰è£… Swoole æ‰©å±• 1ã€ç›´æ¥ pecl install swoole ,ä¼šæŠ¥é”™ï¼Œå› ä¸ºè£…æœ‰phpè€ç‰ˆæœ¬çš„ä¾èµ–ï¼Œæ‰€ä»¥è¦è£…æ–°çš„
yum install -y php72w-mysqlnd php72w-fpm php70w-pecl-redis php72w-common php72w-pdo php72w php72w-gd php72w-gd php72w-cli php72w-mbstring php72w-devel å› ä¸ºæˆ‘æ˜¯PHP7.2ï¼Œå¦‚æœä½ æ˜¯PHP7.0,å°†ä¸Šé¢çš„php72æ›¿æ¢ä¸ºphp70å³å¯ã€‚
2ã€å¦‚æœæŠ¥é”™ï¼š
PHP Parse error: syntax error, unexpected //&amp;#39;new&amp;#39; (T_NEW) in /usr/share/pear/PEAR/Frontend.php on //line 91 è§£å†³æ–¹æ¡ˆï¼š
å®‰è£…PECL //phpç‰ˆæœ¬ &amp;gt; 7 wget http://pear.php.net/go-pear.phar php go-pear.phar //phpç‰ˆæœ¬ &amp;lt; 7 yum install php-pear 3ã€å®‰è£…swooleåŒ…
1.pecl install swoole 2.WARNING:channel &amp;#34;pecl.php.net&amp;#34; has updated its protocols,use &amp;#34;pecl channel-update pecl.</description>
			<content type="html"><![CDATA[<h3 id="laravels-ä»‹ç»">Laravels ä»‹ç»</h3>
<blockquote>
<p>LaravelSæ˜¯ä¸€ä¸ªèƒ¶æ°´é¡¹ç›®ï¼Œç”¨äºå¿«é€Ÿé›†æˆSwooleåˆ°Laravelæˆ–Lumenï¼Œç„¶åèµ‹äºˆå®ƒä»¬æ›´å¥½çš„æ€§èƒ½ã€æ›´å¤šå¯èƒ½æ€§ã€‚
åœ¨ä½¿ç”¨laravelsä¹‹å‰ï¼Œå¿…é¡»å…ˆè£…ä¸Šswooleçš„æ‰©å±•ã€‚</p>
</blockquote>
<p>swooleæ–‡æ¡£ï¼š<a href="https://wiki.swoole.com/wiki/index/prid-1">https://wiki.swoole.com/wiki/index/prid-1</a></p>
<p>laravesæ–‡æ¡£ï¼š<a href="https://github.com/hhxsv5/laravel-s">https://github.com/hhxsv5/laravel-s</a></p>
<p>ç¯å¢ƒï¼šåœ¨VMwareè™šæ‹Ÿæœºä¸­è‡ªå·±æ­çš„ç¯å¢ƒï¼ŒCentos7ï¼ŒPHP7.2.12ï¼ŒNginx1.14.2ï¼ŒMySQL 5.5.60ã€‚</p>
<h3 id="å®‰è£…-swoole-æ‰©å±•">å®‰è£… Swoole æ‰©å±•</h3>
<p>1ã€ç›´æ¥ <code>pecl install swoole</code> ,ä¼šæŠ¥é”™ï¼Œå› ä¸ºè£…æœ‰phpè€ç‰ˆæœ¬çš„ä¾èµ–ï¼Œæ‰€ä»¥è¦è£…æ–°çš„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">yum install -y php72w-mysqlnd php72w-fpm php70w-pecl-redis php72w-common php72w-pdo php72w php72w-gd php72w-gd php72w-cli php72w-mbstring php72w-devel
</code></pre></div><p>å› ä¸ºæˆ‘æ˜¯PHP7.2ï¼Œå¦‚æœä½ æ˜¯PHP7.0,å°†ä¸Šé¢çš„php72æ›¿æ¢ä¸ºphp70å³å¯ã€‚</p>
<p>2ã€å¦‚æœæŠ¥é”™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">PHP Parse error:  syntax error, unexpected //<span class="s1">&#39;new&#39;</span> <span class="o">(</span>T_NEW<span class="o">)</span> in /usr/share/pear/PEAR/Frontend.php on //line <span class="m">91</span>
</code></pre></div><p>è§£å†³æ–¹æ¡ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">å®‰è£…PECL
//phpç‰ˆæœ¬ &gt; <span class="m">7</span>
wget http://pear.php.net/go-pear.phar
php go-pear.phar

//phpç‰ˆæœ¬ &lt; <span class="m">7</span>
yum install php-pear
</code></pre></div><p>3ã€å®‰è£…swooleåŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">1.pecl install swoole
2.WARNING:channel <span class="s2">&#34;pecl.php.net&#34;</span> has updated its protocols,use <span class="s2">&#34;pecl channel-update pecl.php.net&#34;</span> to update.
éœ€è¦æ›´æ–°ï¼špecl channel-update pecl.php.net
3.æŸ¥æ‰¾ä¸‹php.iniçš„ä½ç½®ï¼šphp -i <span class="p">|</span>grep php.ini
4.ç„¶ååœ¨php.iniä¸­å¢åŠ ï¼šextension<span class="o">=</span>swoole.so
5.é‡å¯ä¸‹phpï¼šsystemctl restart php
6.æŸ¥çœ‹ä¸‹æ˜¯å¦å·²ç»æˆåŠŸåŠ è½½äº†swoole:php -m <span class="p">|</span> grep swoole
</code></pre></div><p>å¦‚æœè¿˜æ²¡è£…ä¸Šï¼Œæ¨èå‚è€ƒï¼š<a href="https://www.cnblogs.com/phpwechat/p/8417331.html">https://www.cnblogs.com/phpwechat/p/8417331.html</a></p>
<h3 id="ä½¿ç”¨laravels">ä½¿ç”¨LaravelS</h3>
<p>1ã€å®‰è£… <code>laravels</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">composer require <span class="s2">&#34;hhxsv5/laravel-s:~3.3&#34;</span> -vvv
</code></pre></div><p>2ã€æ³¨å†Œ <code>Service Provider</code>, ä½äº <code>config/app.php</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="c1">//...
</span><span class="c1"></span>    <span class="nx">Hhxsv5\LaravelS\Illuminate\LaravelSServiceProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="p">],</span>
</code></pre></div><p>3ã€å‘å¸ƒé…ç½®å’ŒäºŒè¿›åˆ¶æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php artisan laravels publish
</code></pre></div><p>4ã€ä¿®æ”¹é…ç½® <code>config/laravels.php</code>ï¼šç›‘å¬çš„IPã€ç«¯å£ç­‰ã€‚</p>
<p>5ã€é…ç½® <code>web.confg</code> æ–‡ä»¶ï¼Œæˆ‘çš„æ˜¯è¿™æ ·</p>
<pre><code class="language-apacheconfig" data-lang="apacheconfig">map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}
upstream laravels {
    # é€šè¿‡ IP:Port è¿æ¥
    server 127.0.0.1:5200 weight=5 max_fails=3 fail_timeout=30s;
    # é€šè¿‡ UnixSocket Stream è¿æ¥ï¼Œå°è¯€çªï¼šå°†socketæ–‡ä»¶æ”¾åœ¨/dev/shmç›®å½•ä¸‹ï¼Œå¯è·å¾—æ›´å¥½çš„æ€§èƒ½
    #server unix:/xxxpath/laravel-s-test/storage/laravels.sock weight=5 max_fails=3 fail_timeout=30s;
    #server 192.168.1.1:5200 weight=3 max_fails=3 fail_timeout=30s;
    #server 192.168.1.2:5200 backup;
    keepalive 16;
}
server {
    listen 80;
    # åˆ«å¿˜äº†ç»‘Hostå“Ÿ
    server_name laras.test;
    root /var/www/laras/public;
    #access_log /yyypath/log/nginx/$server_name.access.log  main;
    autoindex off;
    index index.html index.htm;
    # Nginxå¤„ç†é™æ€èµ„æº(å»ºè®®å¼€å¯gzip)ï¼ŒLaravelSå¤„ç†åŠ¨æ€èµ„æºã€‚
    location / {
        index  index.php index.html index.htm;
        try_files $uri $uri/ /index.php?$query_string;
        if (!-e $request_filename){  
            rewrite ^/(.*) /index.php last;  
        } 
    }
    location ~ \.php$ {
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }
    
    location ~* ^.+\.(jpg|jpeg|gif|png|bmp)$ {  
        access_log off;  
        root /var/www/laras/public;  
        expires 30d;  
        break; }
    # å½“è¯·æ±‚PHPæ–‡ä»¶æ—¶ç›´æ¥å“åº”404ï¼Œé˜²æ­¢æš´éœ²public/*.php
    #location ~* \.php$ {
    #    return 404;
    #}
    # Httpå’ŒWebSocketå…±å­˜ï¼ŒNginxé€šè¿‡locationåŒºåˆ†
    # !!! WebSocketè¿æ¥æ—¶è·¯å¾„ä¸º/ws
    # Javascript: var ws = new WebSocket(&quot;ws://laravels.com/ws&quot;);
    location =/ws {
        proxy_http_version 1.1;
        # proxy_connect_timeout 60s;
        # proxy_send_timeout 60s;
        # proxy_read_timeoutï¼šå¦‚æœ60ç§’å†…è¢«ä»£ç†çš„æœåŠ¡å™¨æ²¡æœ‰å“åº”æ•°æ®ç»™Nginxï¼Œé‚£ä¹ˆNginxä¼šå…³é—­å½“å‰è¿æ¥ï¼›åŒæ—¶ï¼ŒSwooleçš„å¿ƒè·³è®¾ç½®ä¹Ÿä¼šå½±å“è¿æ¥çš„å…³é—­
        # proxy_read_timeout 60s;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Real-PORT $remote_port;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header Scheme $scheme;
        proxy_set_header Server-Protocol $server_protocol;
        proxy_set_header Server-Name $server_name;
        proxy_set_header Server-Addr $server_addr;
        proxy_set_header Server-Port $server_port;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        proxy_pass http://laravels;
    }
    location @laravels {
        proxy_http_version 1.1;
        # proxy_connect_timeout 60s;
        # proxy_send_timeout 60s;
        # proxy_read_timeout 60s;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Real-PORT $remote_port;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header Scheme $scheme;
        proxy_set_header Server-Protocol $server_protocol;
        proxy_set_header Server-Name $server_name;
        proxy_set_header Server-Addr $server_addr;
        proxy_set_header Server-Port $server_port;
        proxy_set_header Connection &quot;&quot;;
        proxy_pass http://laravels;
    }
}
</code></pre><p>6ã€æ¯«ç§’çº§å®šæ—¶ä»»åŠ¡ <code>App\Jobs\Timer\TestCronJob</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">//å¦‚laravelsæ–‡æ¡£ æˆ‘çš„æ˜¯è¿™æ · ä»…ç”¨äºæµ‹è¯•
</span><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">client_send</span><span class="p">(</span><span class="s1">&#39;123456789&#39;</span><span class="p">);</span>
    <span class="nx">Test</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;num&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;66&#39;</span><span class="p">]);</span>
<span class="p">}</span>
<span class="c1">//namespace App\Services\WebSocketClientService
</span><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">client_send</span><span class="p">(</span><span class="nv">$msg</span><span class="p">,</span><span class="nv">$url</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="nv">$port</span><span class="o">=</span><span class="mi">5200</span><span class="p">)</span>
<span class="p">{</span>
        <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocketClientService</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$port</span><span class="p">);</span>
        <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
        <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$msg</span><span class="p">);</span>
         <span class="cm">/*$data = @$client-&gt;recv();
</span><span class="cm">        \Log::info($data);*/</span>
        <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div><p>7ã€å¯ç”¨ <code>WebSocket</code> æœåŠ¡å™¨ <code>App\Services\WebSocketService</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">å¦‚ laravels æ–‡æ¡£ 
https://github.com/hhxsv5/laravel-s/blob/master/README-CN.md#%E5%90%AF%E7%94%A8websocket%E6%9C%8D%E5%8A%A1%E5%99%A8
</code></pre></div><p>8ã€è§†å›¾é¡µé¢å¼€å¯ <code>websocket</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">&#34;ws://&#34;</span><span class="o">+</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span><span class="o">+</span><span class="s2">&#34;/ws?c=&#34;</span><span class="o">+</span><span class="s2">&#34;{{ csrf_token() }}&#34;</span><span class="p">);</span>
    <span class="c1">//æˆåŠŸè¿æ¥websocçš„æ—¶å€™
</span><span class="c1"></span>    <span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ws onopen&#39;</span><span class="p">);</span>
<span class="c1">//        ws.send(&#39;client msg&#39;);
</span><span class="c1"></span>    <span class="p">};</span>
    <span class="c1">//è¿æ¥é”™è¯¯çš„æ—¶å€™
</span><span class="c1"></span>    <span class="nx">ws</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ws onerror&#39;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">};</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</code></pre></div><p>9ã€å¼€å¯æœåŠ¡
é‡å¯ <code>nginx</code> å’Œ <code>php</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">systemctl  restart nginx
systemctl   restart  php-fpm
</code></pre></div><p>å¼€å¯ <code>laravels</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">php  bin/laravels  starts
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>å†æ¬¡å®‰è£… Homestead</title>
			<link>http://hugo.zkilm.cn/posts/20180929-reinstall-homestead/</link>
			<pubDate>Sat, 29 Sep 2018 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20180929-reinstall-homestead/</guid>
			<description>Homestead çš„å®‰è£…è®°å½•
ä¸‹è½½å¹¶å®‰è£… VirtualBox https://pan.baidu.com/s/1v_DiOlOOKZ3TWEjxAo1chw æå¯†ç ï¼šxlcx ä¹‹åæŒ‰ç…§æç¤ºæ“ä½œä¸€æ­¥ä¸€æ­¥è¿›è¡Œå®‰è£…å³å¯ã€‚ å‚è€ƒï¼šæˆ‘çš„å®‰è£…ä½ç½® D:\VirtualBox ubuntuçš„isoæ–‡ä»¶ä¸‹è½½ï¼šhttp://releases.ubuntu.com/18.04/ å‚è€ƒï¼šubuntu-18.04.1-live-server-amd64.iso 2018-07-25 23:39 812MæœåŠ¡å™¨å®‰è£…64ä½PCï¼ˆAMD64ï¼‰è®¡ç®—æœºå›¾åƒï¼ˆæ ‡å‡†ä¸‹è½½ï¼‰ å»ºè®®é‡å¯ç”µè„‘ ä¸‹è½½å¹¶å®‰è£…Vagrant é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zoB04XJmeY1lmhpnLVpnKw æå–ç ï¼šlej9 ç„¶åä¸€æ­¥ä¸€æ­¥æŒ‰ç…§é»˜è®¤å®‰è£…å³å¯ã€‚ å‚è€ƒï¼šæˆ‘çš„å®‰è£…ä½ç½® D:\vagrant å»ºè®®é‡å¯ç”µè„‘ å®‰è£…å’Œä½¿ç”¨ Homestead 1ã€ä¸‹è½½ Homestead è™šæ‹Ÿæœºç›’å­ï¼š
é“¾æ¥ï¼šhttps://pan.baidu.com/s/1fnyCkBC_IrPXjkI2Tw7Zng æå–ç ï¼šjpci å‚è€ƒï¼šæˆ‘çš„å­˜æ”¾ä½ç½®ä½ç½® D:\vagrant\ä¸‹ 2ã€åœ¨è§£å‹ç›®å½•ä¸­ lc-homestead-6.1.1-2018090400 è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯¼å…¥ Boxï¼š
vagrant box add metadata.json 3ã€ä¸‹è½½ Homestead ç®¡ç†è„šæœ¬ï¼š
git clone https://git.coding.net/summerblue/homestead.git Homestead å‚è€ƒï¼šæˆ‘çš„å­˜æ”¾ä½ç½® D:\
4ã€ä¸‹è½½å®Œæˆä¹‹åæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è¡Œè¿›å…¥ Homestead ç›®å½•ï¼Œå†ä½¿ç”¨ Git æ£€å‡ºæˆ‘ä»¬éœ€è¦çš„ Homestead ç‰ˆæœ¬ï¼š
git checkout v7.8.0 æ¥è‡ª laravel-china æ•™ç¨‹ï¼šä¸ºäº†ä¿è¯åç»­è®²è§£çš„æµç•…æ€§ï¼Œè¯·æ³¨æ„ç‰ˆæœ¬çš„ä¸€è‡´æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ v7.8.0
5ã€æ¥ä¸‹æ¥éœ€è¦åˆå§‹åŒ– Homesteadï¼š
bash init.sh #ï¼ˆåœ¨Homesteadä¸‹æ‰§è¡Œï¼‰ ä¼šåœ¨ Homestead ä¸‹å¤šå‡ºä¸‰ä¸ªæ–‡ä»¶ï¼šHomestead.yaml ï¼Œafter.</description>
			<content type="html"><![CDATA[<p><code>Homestead</code> çš„å®‰è£…è®°å½•</p>
<h3 id="ä¸‹è½½å¹¶å®‰è£…-virtualbox">ä¸‹è½½å¹¶å®‰è£… VirtualBox</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">https://pan.baidu.com/s/1v_DiOlOOKZ3TWEjxAo1chw  æå¯†ç ï¼šxlcx
ä¹‹åæŒ‰ç…§æç¤ºæ“ä½œä¸€æ­¥ä¸€æ­¥è¿›è¡Œå®‰è£…å³å¯ã€‚
å‚è€ƒï¼šæˆ‘çš„å®‰è£…ä½ç½®  D:\VirtualBox

ubuntuçš„isoæ–‡ä»¶ä¸‹è½½ï¼šhttp://releases.ubuntu.com/18.04/
å‚è€ƒï¼šubuntu-18.04.1-live-server-amd64.iso  2018-07-25 23:39 812MæœåŠ¡å™¨å®‰è£…64ä½PCï¼ˆAMD64ï¼‰è®¡ç®—æœºå›¾åƒï¼ˆæ ‡å‡†ä¸‹è½½ï¼‰

å»ºè®®é‡å¯ç”µè„‘
</code></pre></div><h3 id="ä¸‹è½½å¹¶å®‰è£…vagrant">ä¸‹è½½å¹¶å®‰è£…Vagrant</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zoB04XJmeY1lmhpnLVpnKw æå–ç ï¼šlej9
ç„¶åä¸€æ­¥ä¸€æ­¥æŒ‰ç…§é»˜è®¤å®‰è£…å³å¯ã€‚
å‚è€ƒï¼šæˆ‘çš„å®‰è£…ä½ç½®  D:\vagrant

å»ºè®®é‡å¯ç”µè„‘
</code></pre></div><h3 id="å®‰è£…å’Œä½¿ç”¨-homestead">å®‰è£…å’Œä½¿ç”¨ Homestead</h3>
<p>1ã€ä¸‹è½½ <code>Homestead</code> è™šæ‹Ÿæœºç›’å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1fnyCkBC_IrPXjkI2Tw7Zng æå–ç ï¼šjpci
å‚è€ƒï¼šæˆ‘çš„å­˜æ”¾ä½ç½®ä½ç½®  D:\vagrant\ä¸‹
</code></pre></div><p>2ã€åœ¨è§£å‹ç›®å½•ä¸­ <code>lc-homestead-6.1.1-2018090400</code> è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯¼å…¥ <code>Box</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">vagrant box add metadata.json
</code></pre></div><p>3ã€ä¸‹è½½ <code>Homestead</code> ç®¡ç†è„šæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">git clone https://git.coding.net/summerblue/homestead.git Homestead
</code></pre></div><p>å‚è€ƒï¼šæˆ‘çš„å­˜æ”¾ä½ç½®  D:\</p>
<p>4ã€ä¸‹è½½å®Œæˆä¹‹åæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤è¡Œè¿›å…¥ <code>Homestead</code> ç›®å½•ï¼Œå†ä½¿ç”¨ <code>Git</code> æ£€å‡ºæˆ‘ä»¬éœ€è¦çš„ <code>Homestead</code> ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">git checkout v7.8.0
</code></pre></div><p>æ¥è‡ª <code>laravel-china</code> æ•™ç¨‹ï¼šä¸ºäº†ä¿è¯åç»­è®²è§£çš„æµç•…æ€§ï¼Œè¯·æ³¨æ„ç‰ˆæœ¬çš„ä¸€è‡´æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <code>v7.8.0</code></p>
<p>5ã€æ¥ä¸‹æ¥éœ€è¦åˆå§‹åŒ– <code>Homestead</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">bash init.sh  <span class="c1">#ï¼ˆåœ¨Homesteadä¸‹æ‰§è¡Œï¼‰</span>
</code></pre></div><p>ä¼šåœ¨ <code>Homestead</code> ä¸‹å¤šå‡ºä¸‰ä¸ªæ–‡ä»¶ï¼š<code>Homestead.yaml</code>  ï¼Œ<code>after.sh</code>   ï¼Œ<code>aliases</code></p>
<h3 id="ssh-ç§˜é’¥ç™»å½•é…ç½®">SSH ç§˜é’¥ç™»å½•é…ç½®</h3>
<p>Homestead.yaml é…ç½®æ–‡ä»¶ä¸‹çš„authorize: ~/.ssh/id_rsa.pubï¼ˆSSH ç§˜é’¥ç™»å½•é…ç½®ï¼‰</p>
<p>1ã€å…ˆä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ä¸»æœºä¸Šæ˜¯å¦å·²ç»ç”Ÿæˆè¿‡ <code>SSH Key</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">ls -al ~/.ssh
</code></pre></div><p>2ã€å¦‚æœå­˜åœ¨ <code>id_rsa</code> å’Œ <code>id_rsa.pub</code> çš„è¯ï¼Œè¯·è·³è¿‡ä»¥ä¸‹ç”Ÿæˆ <code>SSH</code> çš„æ­¥éª¤ç»§ç»­é˜…è¯»å‰©ä¸‹å†…å®¹ã€‚
å¦åˆ™ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ç”Ÿæˆ <code>SSH Key</code>ï¼Œè¯·å°† <code>your_email@example.com</code> æ›¿æ¢ä¸ºä½ çš„é‚®ç®±ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">ssh-keygen -t rsa -C <span class="s2">&#34;your_email@example.com&#34;</span>
</code></pre></div><p>æ³¨æ„ï¼šå…¨éƒ¨é»˜è®¤ <code>Enter</code> å³å¯</p>
<p>3ã€æ£€æŸ¥æ˜¯å¦ç”Ÿæˆï¼š<code>ls -al ~/.ssh</code>ï¼Œä¼šå‘ç°å¤šå‡ºä¸€ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">SSH ç§˜é’¥çš„ä¸¤ä¸ªæ–‡ä»¶ï¼š
id_rsa â€”â€” SSH ç§˜é’¥çš„ ç§é’¥ <span class="o">(</span>Private Key<span class="o">)</span>
id_rsa.pub â€”â€” SSH ç§˜é’¥çš„ å…¬é’¥ <span class="o">(</span>Public Key<span class="o">)</span>
</code></pre></div><h3 id="homesteadyaml-é…ç½®æ–‡ä»¶">Homestead.yaml é…ç½®æ–‡ä»¶</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="l">//å‚è€ƒï¼šæˆ‘æ˜¯è¿™æ ·é…ç½®çš„</span><span class="w">
</span><span class="w">    </span>---<span class="w">
</span><span class="w">    </span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;192.168.10.10&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
</span><span class="w">    </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">    </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l">virtualbox</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="nt">authorize</span><span class="p">:</span><span class="w"> </span><span class="l">~/.ssh/id_rsa.pub</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="nt">keys</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="l">~/.ssh/id_rsa</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="nt">folders</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">E:/code/homestead  //æœ¬æœºå­˜æ”¾ä»£ç ä½ç½®</span><span class="w">
</span><span class="w">          </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/code  //è™šæ‹Ÿæœºå­˜æ”¾ä»£ç ä½ç½®</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="nt">sites</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">laravel.test   //é¡¹ç›®è®¿é—®åŸŸåï¼Œè®°å¾—hostsæ–‡ä»¶çš„æ·»åŠ </span><span class="w">
</span><span class="w">          </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/code/laravel/public  //è™šæ‹Ÿæœºé¡¹ç›®è®¿é—®å…¥å£æ–‡ä»¶</span><span class="w">
</span><span class="w">        </span>- <span class="nt">map</span><span class="p">:</span><span class="w"> </span><span class="l">xxx   </span><span class="w">
</span><span class="w">          </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l">/home/vagrant/code/xxx  </span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="nt">databases</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="l">laravel   //ç¬¬ä¸€ä¸ªé¡¹ç›®æ•°æ®åº“å</span><span class="w">
</span><span class="w">        </span>- <span class="l">xxx   //æ­¤é¡¹ç›®æ•°æ®åº“å</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c"># blackfire:</span><span class="w">
</span><span class="w">    </span><span class="c">#     - id: foo</span><span class="w">
</span><span class="w">    </span><span class="c">#       token: bar</span><span class="w">
</span><span class="w">    </span><span class="c">#       client-id: foo</span><span class="w">
</span><span class="w">    </span><span class="c">#       client-token: bar</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c"># ports:</span><span class="w">
</span><span class="w">    </span><span class="c">#     - send: 50000</span><span class="w">
</span><span class="w">    </span><span class="c">#       to: 5000</span><span class="w">
</span><span class="w">    </span><span class="c">#     - send: 7777</span><span class="w">
</span><span class="w">    </span><span class="c">#       to: 777</span><span class="w">
</span><span class="w">    </span><span class="c">#       protocol: udp</span><span class="w">
</span></code></pre></div><h3 id="éœ€è¦æ³¨æ„">éœ€è¦æ³¨æ„ï¼š</h3>
<p>éœ€è¦æ³¨æ„ï¼ˆå‡åœ¨æœ¬åœ°çš„Homesteadä¸‹æ“ä½œï¼‰</p>
<p>1ã€åœ¨æˆ‘ä»¬æ¯æ¬¡å¯¹ <code>Homestead.yaml</code> æ–‡ä»¶è¿›è¡Œäº†æ›´æ”¹ä¹‹åï¼Œéƒ½éœ€è¦è¿è¡Œä¸‹é¢å‘½ä»¤æ¥ä½¿å…¶æ›´æ”¹ç”Ÿæ•ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">vagrant provision <span class="o">&amp;&amp;</span> vagrant reload
</code></pre></div><p>2ã€æ•°æ®åº“ç›¸å…³</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">é»˜è®¤è´¦æˆ·ï¼šhomestead  å¯†ç ï¼šsecret
è¿ä¸Šè™šæ‹Ÿæœºï¼šmysql -u homestead -p    è¿›å…¥æ•°æ®åº“
</code></pre></div><p>3ã€å½“ <code>vagrant up</code> å‡ºç° <code>Vagrant could not detect VirtualBox!</code> æ˜¯å¯èƒ½çš„é—®é¢˜æ˜¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">VBOX_INSTALL_PATHæˆ–VBOX_MSI_INSTALL_PATHç¯å¢ƒå˜é‡ã€‚
</code></pre></div><p>æˆ‘æ˜¯ç›´æ¥é‡å¯ç”µè„‘å°±å¥½äº†~~~</p>
<p>4ã€<code>vagrant</code> ç›¸å…³å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">vagrant init	<span class="c1">#åˆå§‹åŒ– vagrant</span>
vagrant up	    <span class="c1">#å¯åŠ¨ vagrant</span>
vagrant halt	<span class="c1">#å…³é—­ vagrant</span>
vagrant ssh	    <span class="c1">#é€šè¿‡SSHç™»å½•vagrantï¼ˆéœ€è¦å…ˆå¯åŠ¨ vagrantï¼‰</span>
vagrant provision	<span class="c1">#é‡æ–°åº”ç”¨æ›´æ”¹ vagrant é…ç½®</span>
vagrant destroy	    <span class="c1">#åˆ é™¤ vagrant</span>
</code></pre></div><p>5ã€å¼‚å¸¸é€€å‡ºåï¼Œ<code>vagrant up</code> æŠ¥é”™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">vagrant haltThere was an error <span class="k">while</span> executing <span class="sb">`</span>VBoxManage<span class="sb">`</span>, a CLI used by Vagrant <span class="k">for</span> controlling VirtualBox. The <span class="nb">command</span> and std err is shown below.
</code></pre></div><p>è§£å†³ï¼šé‡å¯ç”µè„‘æˆ–è€…åœ¨ä»»åŠ¡ç®¡ç†å™¨ç»“æŸæ‰€æœ‰ <code>VirtualBox</code> ç›¸å…³è¿›ç¨‹</p>
]]></content>
		</item>
		
		<item>
			<title>è…¾è®¯äº‘å­˜å‚¨çš„ç®€å•ä½¿ç”¨</title>
			<link>http://hugo.zkilm.cn/posts/20180806-tengcent-cos/</link>
			<pubDate>Mon, 06 Aug 2018 00:00:00 +0000</pubDate>
			
			<guid>http://hugo.zkilm.cn/posts/20180806-tengcent-cos/</guid>
			<description>å¯¼è¯­ å°†ä¸€äº›å›¾ç‰‡æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°ï¼ŒåŠ è½½æ…¢ï¼Œè€—èµ„æºã€‚å¯ä»¥é€‰æ‹©å°†æ–‡ä»¶ä¸Šä¼ è‡³äº‘ç«¯ï¼Œä¾‹å¦‚ä¸ƒç‰›äº‘ï¼Œé˜¿é‡Œäº‘ï¼Œè…¾è®¯äº‘ç­‰éƒ½å¯ä»¥ä½œä¸ºé€‰æ‹©æ–¹æ¡ˆï¼Œç®€å•è®°å½•ä¸‹å°†å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ è‡³è…¾è®¯äº‘å­˜å‚¨çš„è¿‡ç¨‹ã€‚
å¯¹è±¡å­˜å‚¨ COS ç®€ä»‹
 å¯¹è±¡å­˜å‚¨ï¼ˆCloud Object Storageï¼Œç®€ç§°ï¼šCOSï¼‰æ˜¯è…¾è®¯äº‘æä¾›çš„ä¸€ç§å­˜å‚¨æµ·é‡æ–‡ä»¶çš„åˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡ï¼Œç”¨æˆ·å¯é€šè¿‡ç½‘ç»œéšæ—¶å­˜å‚¨å’ŒæŸ¥çœ‹æ•°æ®ã€‚è…¾è®¯äº‘ COS ä½¿æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½ä½¿ç”¨å…·å¤‡é«˜æ‰©å±•æ€§ã€ä½æˆæœ¬ã€å¯é å’Œå®‰å…¨çš„æ•°æ®å­˜å‚¨æœåŠ¡ã€‚
 æ–‡æ¡£åœ°å€ï¼šhttps://cloud.tencent.com/document/product/436/11365
ä¸Šä¼ å‰å‡†å¤‡ å¿«é€Ÿå…¥é—¨æµç¨‹å›¾ï¼š
åœ¨æ³¨å†Œå®Œå¹¶åˆ›å»ºå¥½å­˜å‚¨æ¡¶åï¼Œéœ€è¦æ‹¿åˆ°ç›¸å…³é…ç½®ä¿¡æ¯ï¼ŒAPPIDï¼ŒSecretIdï¼ŒSecretKeyï¼ˆå¯†é’¥ç®¡ç†ï¼‰ï¼Œåœ¨å­˜å‚¨æ¡¶ä¸‹åˆ›å»ºä¸€ä¸ªtestæ–‡ä»¶å¤¹ï¼Œæœ¬æ¬¡æµ‹è¯•å›¾ç‰‡å…¨éƒ¨ä¸Šä¼ åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸åˆ›å»ºï¼Œå­˜å‚¨æ¡¶æ£€æµ‹åˆ°æ²¡æœ‰è¯¥æ–‡ä»¶å¤¹ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚æœ¬æ¬¡è®°å½•åªæ˜¯èµ°åˆ°äº†ä¸Šä¼ å¯¹è±¡ ã€‚
æµ‹è¯•è¿‡ç¨‹ 1ã€composerè…¾è®¯äº‘COSå¯¹è±¡å­˜å‚¨ V5åŒ…
composer require freyo/flysystem-qcloud-cos-v5 2ã€åœ¨config/app.phpçš„providersä¸‹æ·»åŠ 
Freyo\Flysystem\QcloudCOSv5\ServiceProvider::class, 3ã€åœ¨app/filesystems.phpä¸­çš„disksé‡Œä¸‹æ·»åŠ 
&amp;#39;disks&amp;#39;=&amp;gt;[ // ...  &amp;#39;cosv5&amp;#39; =&amp;gt; [ &amp;#39;driver&amp;#39; =&amp;gt; &amp;#39;cosv5&amp;#39;, &amp;#39;region&amp;#39; =&amp;gt; env(&amp;#39;COSV5_REGION&amp;#39;, &amp;#39;ap-guangzhou&amp;#39;), &amp;#39;credentials&amp;#39; =&amp;gt; [ &amp;#39;appId&amp;#39; =&amp;gt; env(&amp;#39;COSV5_APP_ID&amp;#39;), &amp;#39;secretId&amp;#39; =&amp;gt; env(&amp;#39;COSV5_SECRET_ID&amp;#39;), &amp;#39;secretKey&amp;#39; =&amp;gt; env(&amp;#39;COSV5_SECRET_KEY&amp;#39;), ], &amp;#39;timeout&amp;#39; =&amp;gt; env(&amp;#39;COSV5_TIMEOUT&amp;#39;, 60), &amp;#39;connect_timeout&amp;#39; =&amp;gt; env(&amp;#39;COSV5_CONNECT_TIMEOUT&amp;#39;, 60), &amp;#39;bucket&amp;#39; =&amp;gt; env(&amp;#39;COSV5_BUCKET&amp;#39;), &amp;#39;cdn&amp;#39; =&amp;gt; env(&amp;#39;COSV5_CDN&amp;#39;), &amp;#39;scheme&amp;#39; =&amp;gt; env(&amp;#39;COSV5_SCHEME&amp;#39;, &amp;#39;https&amp;#39;), ], ], 4ã€åœ¨.</description>
			<content type="html"><![CDATA[<h3 id="å¯¼è¯­">å¯¼è¯­</h3>
<p>å°†ä¸€äº›å›¾ç‰‡æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°ï¼ŒåŠ è½½æ…¢ï¼Œè€—èµ„æºã€‚å¯ä»¥é€‰æ‹©å°†æ–‡ä»¶ä¸Šä¼ è‡³äº‘ç«¯ï¼Œä¾‹å¦‚ä¸ƒç‰›äº‘ï¼Œé˜¿é‡Œäº‘ï¼Œè…¾è®¯äº‘ç­‰éƒ½å¯ä»¥ä½œä¸ºé€‰æ‹©æ–¹æ¡ˆï¼Œç®€å•è®°å½•ä¸‹å°†å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ è‡³è…¾è®¯äº‘å­˜å‚¨çš„è¿‡ç¨‹ã€‚</p>
<p>å¯¹è±¡å­˜å‚¨ COS ç®€ä»‹</p>
<blockquote>
<p>å¯¹è±¡å­˜å‚¨ï¼ˆCloud Object Storageï¼Œç®€ç§°ï¼šCOSï¼‰æ˜¯è…¾è®¯äº‘æä¾›çš„ä¸€ç§å­˜å‚¨æµ·é‡æ–‡ä»¶çš„åˆ†å¸ƒå¼å­˜å‚¨æœåŠ¡ï¼Œç”¨æˆ·å¯é€šè¿‡ç½‘ç»œéšæ—¶å­˜å‚¨å’ŒæŸ¥çœ‹æ•°æ®ã€‚è…¾è®¯äº‘ COS ä½¿æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½ä½¿ç”¨å…·å¤‡é«˜æ‰©å±•æ€§ã€ä½æˆæœ¬ã€å¯é å’Œå®‰å…¨çš„æ•°æ®å­˜å‚¨æœåŠ¡ã€‚</p>
</blockquote>
<p>æ–‡æ¡£åœ°å€ï¼š<a href="https://cloud.tencent.com/document/product/436/11365">https://cloud.tencent.com/document/product/436/11365</a></p>
<h3 id="ä¸Šä¼ å‰å‡†å¤‡">ä¸Šä¼ å‰å‡†å¤‡</h3>
<p>å¿«é€Ÿå…¥é—¨æµç¨‹å›¾ï¼š</p>
<p><img src="https://mc.qcloudimg.com/static/img/520720197375cee1cc86ad0ebc38ffe2/image.png" alt="æ•ˆæœå›¾"></p>
<p><img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/static/cos_1.jpg" alt="æ•ˆæœå›¾"></p>
<p>åœ¨æ³¨å†Œå®Œå¹¶åˆ›å»ºå¥½å­˜å‚¨æ¡¶åï¼Œéœ€è¦æ‹¿åˆ°ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œ<code>APPID</code>ï¼Œ<code>SecretId</code>ï¼Œ<code>SecretKey</code>ï¼ˆå¯†é’¥ç®¡ç†ï¼‰ï¼Œåœ¨å­˜å‚¨æ¡¶ä¸‹åˆ›å»ºä¸€ä¸ªtestæ–‡ä»¶å¤¹ï¼Œæœ¬æ¬¡æµ‹è¯•å›¾ç‰‡å…¨éƒ¨ä¸Šä¼ åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸åˆ›å»ºï¼Œå­˜å‚¨æ¡¶æ£€æµ‹åˆ°æ²¡æœ‰è¯¥æ–‡ä»¶å¤¹ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚æœ¬æ¬¡è®°å½•åªæ˜¯èµ°åˆ°äº†ä¸Šä¼ å¯¹è±¡ ã€‚</p>
<h3 id="æµ‹è¯•è¿‡ç¨‹">æµ‹è¯•è¿‡ç¨‹</h3>
<p>1ã€<code>composer</code>è…¾è®¯äº‘COSå¯¹è±¡å­˜å‚¨ V5åŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">composer require freyo/flysystem-qcloud-cos-v5
</code></pre></div><p>2ã€åœ¨<code>config/app.php</code>çš„<code>providers</code>ä¸‹æ·»åŠ </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Freyo\Flysystem\QcloudCOSv5\ServiceProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
</code></pre></div><p>3ã€åœ¨<code>app/filesystems.php</code>ä¸­çš„<code>disks</code>é‡Œä¸‹æ·»åŠ </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="s1">&#39;disks&#39;</span><span class="o">=&gt;</span><span class="p">[</span>
    <span class="c1">// ...
</span><span class="c1"></span>    <span class="s1">&#39;cosv5&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cosv5&#39;</span><span class="p">,</span>
          <span class="s1">&#39;region&#39;</span>          <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_REGION&#39;</span><span class="p">,</span> <span class="s1">&#39;ap-guangzhou&#39;</span><span class="p">),</span>
          <span class="s1">&#39;credentials&#39;</span>     <span class="o">=&gt;</span> <span class="p">[</span>
              <span class="s1">&#39;appId&#39;</span>     <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_APP_ID&#39;</span><span class="p">),</span>
              <span class="s1">&#39;secretId&#39;</span>  <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_SECRET_ID&#39;</span><span class="p">),</span>
              <span class="s1">&#39;secretKey&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_SECRET_KEY&#39;</span><span class="p">),</span>
          <span class="p">],</span>
          <span class="s1">&#39;timeout&#39;</span>         <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_TIMEOUT&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
          <span class="s1">&#39;connect_timeout&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_CONNECT_TIMEOUT&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
          <span class="s1">&#39;bucket&#39;</span>          <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_BUCKET&#39;</span><span class="p">),</span>
          <span class="s1">&#39;cdn&#39;</span>             <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_CDN&#39;</span><span class="p">),</span>
          <span class="s1">&#39;scheme&#39;</span>          <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;COSV5_SCHEME&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">],</span>
</code></pre></div><p>4ã€åœ¨<code>.env</code>ä¸­æ·»åŠ ç›¸å…³é…ç½®æ•°æ®</p>
<pre><code class="language-dotenv" data-lang="dotenv"># cosv5
FILESYSTEM_DRIVER=cosv5    //æˆ–åœ¨app/filesystems.phpä¿®æ”¹'default' =&gt; 'cosv5',
COSV5_REGION=ap-guangzhou
COSV5_APP_ID=125600****
COSV5_SECRET_ID=AKIDPFwZahxVA60j**********JTO8lDTHiaL
COSV5_SECRET_KEY=kT7MVUKsJYeZ********CTcaMzazEH8q
COSV5_TIMEOUT=60
COSV5_CONNECT_TIMEOUT=60
COSV5_BUCKET=test1-1256003521
COSV5_CDN=https://test1-1256003521.cos.ap-guangzhou.myqcloud.com
COSV5_SCHEME=https
</code></pre><p>5ã€ç›¸å…³è·¯ç”±</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">//è…¾è®¯äº‘å­˜å‚¨æµ‹è¯•
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/cos&#39;</span><span class="p">,</span> <span class="s1">&#39;TestController@cos&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;cos&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/cos/put&#39;</span><span class="p">,</span> <span class="s1">&#39;TestController@filePut&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;cos.put&#39;</span><span class="p">);</span>
</code></pre></div><p>6ã€<code>TestController</code>ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
<span class="cm">/*
</span><span class="cm"> * è…¾è®¯äº‘å­˜å‚¨è¡¨å•é¡µ
</span><span class="cm"> * */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">cos</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$imgs</span><span class="o">=</span><span class="nx">CosImage</span><span class="o">::</span><span class="na">latest</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;cos.cos&#39;</span><span class="p">,</span><span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;imgs&#39;</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/*
</span><span class="cm"> * å°†æ¥æ”¶åˆ°çš„å›¾ç‰‡èµ„æºä¼ åˆ°è…¾è®¯äº‘COS
</span><span class="cm"> * */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">filePut</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$fileContents</span><span class="o">=</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">);</span>
    <span class="nv">$path</span><span class="o">=</span><span class="nx">Storage</span><span class="o">::</span><span class="na">disk</span><span class="p">(</span><span class="s1">&#39;cosv5&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="nv">$fileContents</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$path</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="nv">$result</span><span class="o">=</span><span class="nx">CosImage</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;url_img&#39;</span><span class="o">=&gt;</span><span class="nv">$path</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$result</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span><span class="s1">&#39;ä¸Šä¼ æˆåŠŸ&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h3 id="ç»“æœ">ç»“æœ</h3>
<p><img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/static/cos_3.jpg" alt="æ•ˆæœå›¾"></p>
<p><img src="https://test1-1256003521.cos.ap-guangzhou.myqcloud.com/static/cos_2.jpg" alt="æ•ˆæœå›¾"></p>
<p><strong>åªæ˜¯åšäº†ç®€å•çš„å¯¹è±¡ä¸Šä¼ ï¼Œåé¢çš„åŒ…æ‹¬ä¸‹è½½å¯¹è±¡ï¼Œä¸Šä¼ å¯¹è±¡ï¼Œåˆ é™¤å­˜å‚¨æ¡¶ç­‰å¹¶æ²¡æœ‰åšï¼ï¼ï¼</strong></p>
]]></content>
		</item>
		
	</channel>
</rss>
